(self.webpackChunkmapasApp=self.webpackChunkmapasApp||[]).push([[179],{278:(er,Nt,Me)=>{"use strict";var K=Me(481),Ie=Me(322),Dt=Me(256);const c=[{path:"mapas",loadChildren:()=>Me.e(161).then(Me.bind(Me,161)).then(sn=>sn.MapasModule)},{path:"**",redirectTo:"mapas"}];class Ee{}Ee.\u0275fac=function(_t){return new(_t||Ee)},Ee.\u0275mod=Dt.oAB({type:Ee}),Ee.\u0275inj=Dt.cJS({imports:[Ie.Bz.forRoot(c),Ie.Bz]});var Ht=Me(898);var kt=Me(895);function bt(sn,_t){if(1&sn&&(Dt.TgZ(0,"li",2),Dt._uU(1),Dt.qZA()),2&sn){const Qt=_t.$implicit;Dt.Q6J("routerLink",Qt.ruta),Dt.xp6(1),Dt.hij(" ",Qt.nombre," ")}}class gt{constructor(){this.menuItems=[{ruta:"/mapas/fullscreen",nombre:"FullScreen"},{ruta:"/mapas/zoom-range",nombre:"Zoom Range"},{ruta:"/mapas/marcadores",nombre:"Marcadores"},{ruta:"/mapas/propiedades",nombre:"Propiedades"}]}}gt.\u0275fac=function(_t){return new(_t||gt)},gt.\u0275cmp=Dt.Xpm({type:gt,selectors:[["app-menu"]],decls:2,vars:1,consts:[[1,"list-group"],["class","list-group-item","routerLinkActive","active",3,"routerLink",4,"ngFor","ngForOf"],["routerLinkActive","active",1,"list-group-item",3,"routerLink"]],template:function(_t,Qt){1&_t&&(Dt.TgZ(0,"ul",0),Dt.YNc(1,bt,2,2,"li",1),Dt.qZA()),2&_t&&(Dt.xp6(1),Dt.Q6J("ngForOf",Qt.menuItems))},dependencies:[kt.sg,Ie.rH,Ie.Od],styles:["li[_ngcontent-%COMP%]{cursor:pointer}"]});class Je{constructor(){this.title="mapasApp"}ngOnInit(){Ht.accessToken="pk.eyJ1IjoibW9oYW1lZWUiLCJhIjoiY2xkaWhodHQ1MDdrODN2bXdvd3VsaDA0MyJ9.kT6O7mGsiLKbDJci6loDwA"}}Je.\u0275fac=function(_t){return new(_t||Je)},Je.\u0275cmp=Dt.Xpm({type:Je,selectors:[["app-root"]],decls:2,vars:0,template:function(_t,Qt){1&_t&&Dt._UZ(0,"app-menu")(1,"router-outlet")},dependencies:[Ie.lC,gt]});class Pt{}Pt.\u0275fac=function(_t){return new(_t||Pt)},Pt.\u0275mod=Dt.oAB({type:Pt,bootstrap:[Je]}),Pt.\u0275inj=Dt.cJS({imports:[K.b2,Ee]}),K.q6().bootstrapModule(Pt).catch(sn=>console.error(sn))},898:function(er){er.exports=function(){"use strict";var Nt,Me,K;function Ie(c,Ee){if(Nt)if(Me){var Ht="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+Nt+")(sharedChunk); ("+Me+")(sharedChunk); self.onerror = null;",Vt={};Nt(Vt),K=Ee(Vt),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(K.workerUrl=window.URL.createObjectURL(new Blob([Ht],{type:"text/javascript"})))}else Me=Ee;else Nt=Ee}return Ie(0,function(c){var Ee=typeof self<"u"?self:{},Ht="2.12.0";let Vt;const kt={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==Vt){const t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{Vt=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):t}catch{Vt=t}}return Vt},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},bt={supported:!1,testSupport:function(t){!Pt&&Je&&(sn?_t(t):gt=t)}};let gt,Je,Pt=!1,sn=!1;function _t(t){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,Je),t.isContextLost())return;bt.supported=!0}catch{}t.deleteTexture(e),Pt=!0}Ee.document&&(Je=Ee.document.createElement("img"),Je.onload=function(){gt&&_t(gt),gt=null,sn=!0},Je.onerror=function(){Pt=!0,gt=null},Je.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Qt="01";var nn=Ut;function Ut(t,e,n,s){this.cx=3*t,this.bx=3*(n-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(s-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=n,this.p2y=s}Ut.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(void 0===e&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var n=t,s=0;s<8;s++){var u=this.sampleCurveX(n)-t;if(Math.abs(u)<e)return n;var f=this.sampleCurveDerivativeX(n);if(Math.abs(f)<1e-6)break;n-=u/f}var m=0,v=1;for(n=t,s=0;s<20&&(u=this.sampleCurveX(n),!(Math.abs(u-t)<e));s++)t>u?m=n:v=n,n=.5*(v-m)+m;return n},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}};var Qe=sr;function sr(t,e){this.x=t,this.y=e}sr.prototype={clone:function(){return new sr(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,n=t.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),n=Math.sin(t),s=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=s,this},_rotateAround:function(t,e){var n=Math.cos(t),s=Math.sin(t),u=e.y+s*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-s*(this.y-e.y),this.y=u,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},sr.convert=function(t){return t instanceof sr?t:Array.isArray(t)?new sr(t[0],t[1]):t};const jt=Math.PI/180,$t=180/Math.PI;function qe(t){return t*jt}function Xt(t){return t*$t}const ar=[[0,0],[1,0],[1,1],[0,1]];function ut(t){if(t<=0)return 0;if(t>=1)return 1;const e=t*t,n=e*t;return 4*(t<.5?n:3*(t-e)+n-.75)}function Bt(t,e,n,s){const u=new nn(t,e,n,s);return function(f){return u.solve(f)}}const wt=Bt(.25,.1,.25,1);function tt(t,e,n){return Math.min(n,Math.max(e,t))}function cn(t,e,n){return(n=tt((n-t)/(e-t),0,1))*n*(3-2*n)}function Nn(t,e,n){const s=n-e,u=((t-e)%s+s)%s+e;return u===e?n:u}function Jt(t,e,n){if(!t.length)return n(null,[]);let s=t.length;const u=new Array(t.length);let f=null;t.forEach((m,v)=>{e(m,(D,C)=>{D&&(f=D),u[v]=C,0==--s&&n(f,u)})})}function We(t){const e=[];for(const n in t)e.push(t[n]);return e}function Ue(t,...e){for(const n of e)for(const s in n)t[s]=n[s];return t}let it=1;function ht(){return it++}function Lt(){return function t(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function at(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function dn(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function qn(t,e){t.forEach(n=>{e[n]&&(e[n]=e[n].bind(e))})}function Un(t,e){return-1!==t.indexOf(e,t.length-e.length)}function en(t,e,n){const s={};for(const u in t)s[u]=e.call(n||this,t[u],u,t);return s}function jn(t,e,n){const s={};for(const u in t)e.call(n||this,t[u],u,t)&&(s[u]=t[u]);return s}function Ln(t){return Array.isArray(t)?t.map(Ln):"object"==typeof t&&t?en(t,Ln):t}const tr={};function vn(t){tr[t]||(typeof console<"u"&&console.warn(t),tr[t]=!0)}function nr(t,e,n){return(n.y-t.y)*(e.x-t.x)>(e.y-t.y)*(n.x-t.x)}function zt(t){let e=0;for(let n,s,u=0,f=t.length,m=f-1;u<f;m=u++)n=t[u],s=t[m],e+=(s.x-n.x)*(n.y+s.y);return e}function Xr(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function ni(t){const e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,s,u,f)=>{const m=u||f;return e[s]=!m||m.toLowerCase(),""}),e["max-age"]){const n=parseInt(e["max-age"],10);isNaN(n)?delete e["max-age"]:e["max-age"]=n}return e}let si=null;function Vn(t){if(null==si){const e=t.navigator?t.navigator.userAgent:null;si=!!t.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return si}function Ni(t){try{const e=Ee[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function Wi(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]}const Br="mapbox-tiles";let Vr,yo,rs=500,Vs=50;function vo(){try{return Ee.caches}catch{}}function ai(){vo()&&!Vr&&(Vr=Ee.caches.open(Br))}function yn(t){const e=t.indexOf("?");if(e<0)return t;const s=function(u){const f=u.indexOf("?");return f>0?u.slice(f+1).split("&"):[]}(t).filter(u=>{const f=u.split("=");return"language"===f[0]||"worldview"===f[0]});return s.length?`${t.slice(0,e)}?${s.join("&")}`:t.slice(0,e)}let fr=1/0;const rn={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(rn);class Et extends Error{constructor(e,n,s){401===n&&so(s)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=n,this.url=s}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const xo=Xr()?()=>self.worker&&self.worker.referrer:()=>("blob:"===Ee.location.protocol?Ee.parent:Ee).location.href,Yr=function(t,e){if(!(/^file:/.test(n=t.url)||/^file:/.test(xo())&&!/^\w+:/.test(n))){if(Ee.fetch&&Ee.Request&&Ee.AbortController&&Ee.Request.prototype.hasOwnProperty("signal"))return function(s,u){const f=new Ee.AbortController,m=new Ee.Request(s.url,{method:s.method||"GET",body:s.body,credentials:s.credentials,headers:s.headers,referrer:xo(),signal:f.signal});let v=!1,D=!1;const C=(P=m.url).indexOf("sku=")>0&&so(P);var P;"json"===s.type&&m.headers.set("Accept","application/json");const F=($,G,J)=>{if(D)return;if($&&"SecurityError"!==$.message&&vn($),G&&J)return N(G);const ie=Date.now();Ee.fetch(m).then(ue=>{if(ue.ok){const ge=C?ue.clone():null;return N(ue,ge,ie)}return u(new Et(ue.statusText,ue.status,s.url))}).catch(ue=>{20!==ue.code&&u(new Error(ue.message))})},N=($,G,J)=>{("arrayBuffer"===s.type?$.arrayBuffer():"json"===s.type?$.json():$.text()).then(ie=>{D||(G&&J&&function(ue,ge,ce){if(ai(),!Vr)return;const pe={status:ge.status,statusText:ge.statusText,headers:new Ee.Headers};ge.headers.forEach((Oe,ke)=>pe.headers.set(ke,Oe));const _e=ni(ge.headers.get("Cache-Control")||"");if(_e["no-store"])return;_e["max-age"]&&pe.headers.set("Expires",new Date(ce+1e3*_e["max-age"]).toUTCString());const ye=pe.headers.get("Expires");ye&&(new Date(ye).getTime()-ce<42e4||function(Oe,ke){if(void 0===yo)try{new Response(new ReadableStream),yo=!0}catch{yo=!1}yo?ke(Oe.body):Oe.blob().then(ke)}(ge,Oe=>{const ke=new Ee.Response(Oe,pe);ai(),Vr&&Vr.then(Ze=>Ze.put(yn(ue.url),ke)).catch(Ze=>vn(Ze.message))}))}(m,G,J),v=!0,u(null,ie,$.headers.get("Cache-Control"),$.headers.get("Expires")))}).catch(ie=>{D||u(new Error(ie.message))})};return C?function($,G){if(ai(),!Vr)return G(null);const J=yn($.url);Vr.then(ie=>{ie.match(J).then(ue=>{const ge=function(ce){if(!ce)return!1;const pe=new Date(ce.headers.get("Expires")||0),_e=ni(ce.headers.get("Cache-Control")||"");return pe>Date.now()&&!_e["no-cache"]}(ue);ie.delete(J),ge&&ie.put(J,ue.clone()),G(null,ue,ge)}).catch(G)}).catch(G)}(m,F):F(null,null),{cancel:()=>{D=!0,v||f.abort()}}}(t,e);if(Xr()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var n;return function(s,u){const f=new Ee.XMLHttpRequest;f.open(s.method||"GET",s.url,!0),"arrayBuffer"===s.type&&(f.responseType="arraybuffer");for(const m in s.headers)f.setRequestHeader(m,s.headers[m]);return"json"===s.type&&(f.responseType="text",f.setRequestHeader("Accept","application/json")),f.withCredentials="include"===s.credentials,f.onerror=()=>{u(new Error(f.statusText))},f.onload=()=>{if((f.status>=200&&f.status<300||0===f.status)&&null!==f.response){let m=f.response;if("json"===s.type)try{m=JSON.parse(f.response)}catch(v){return u(v)}u(null,m,f.getResponseHeader("Cache-Control"),f.getResponseHeader("Expires"))}else u(new Et(f.statusText,f.status,s.url))},f.send(s.body),{cancel:()=>f.abort()}}(t,e)},$n=function(t,e){return Yr(Ue(t,{type:"arrayBuffer"}),e)};function oo(t){const e=Ee.document.createElement("a");return e.href=t,e.protocol===Ee.document.location.protocol&&e.host===Ee.document.location.host}const li="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let mr,Dr;mr=[],Dr=0;const Nr=function(t,e){if(bt.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),Dr>=kt.MAX_PARALLEL_IMAGE_REQUESTS){const f={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return mr.push(f),f}Dr++;let n=!1;const s=()=>{if(!n)for(n=!0,Dr--;mr.length&&Dr<kt.MAX_PARALLEL_IMAGE_REQUESTS;){const f=mr.shift(),{requestParameters:m,callback:v,cancelled:D}=f;D||(f.cancel=Nr(m,v).cancel)}},u=$n(t,(f,m,v,D)=>{s(),f?e(f):m&&(Ee.createImageBitmap?function(C,P){const F=new Ee.Blob([new Uint8Array(C)],{type:"image/png"});Ee.createImageBitmap(F).then(N=>{P(null,N)}).catch(N=>{P(new Error(`Could not load image because of ${N.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(m,(C,P)=>e(C,P,v,D)):function(C,P){const F=new Ee.Image,N=Ee.URL;F.onload=()=>{P(null,F),N.revokeObjectURL(F.src),F.onload=null,Ee.requestAnimationFrame(()=>{F.src=li})},F.onerror=()=>P(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const $=new Ee.Blob([new Uint8Array(C)],{type:"image/png"});F.src=C.byteLength?N.createObjectURL($):li}(m,(C,P)=>e(C,P,v,D)))});return{cancel:()=>{u.cancel(),s()}}},Gn="NO_ACCESS_TOKEN";function Kr(t){return 0===t.indexOf("mapbox:")}function so(t){return kt.API_URL_REGEX.test(t)}function Zo(t){return kt.API_CDN_URL_REGEX.test(t)}function bo(t){return kt.API_STYLE_REGEX.test(t)&&!is(t)}function is(t){return kt.API_SPRITE_REGEX.test(t)}const qo=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Ei(t){const e=t.match(qo);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function pi(t){const e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}function Ui(t){if(!t)return null;const e=t.split(".");if(!e||3!==e.length)return null;try{return JSON.parse(decodeURIComponent(Ee.atob(e[1]).split("").map(n=>"%"+("00"+n.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class le{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const n=Ui(kt.ACCESS_TOKEN);let s="";return s=n&&n.u?Ee.btoa(encodeURIComponent(n.u).replace(/%([0-9A-F]{2})/g,(u,f)=>String.fromCharCode(Number("0x"+f)))):kt.ACCESS_TOKEN||"",e?`mapbox.eventData.${e}:${s}`:`mapbox.eventData:${s}`}fetchEventData(){const e=Ni("localStorage"),n=this.getStorageKey(),s=this.getStorageKey("uuid");if(e)try{const u=Ee.localStorage.getItem(n);u&&(this.eventData=JSON.parse(u));const f=Ee.localStorage.getItem(s);f&&(this.anonId=f)}catch{vn("Unable to read from LocalStorage")}}saveEventData(){const e=Ni("localStorage"),n=this.getStorageKey(),s=this.getStorageKey("uuid");if(e)try{Ee.localStorage.setItem(s,this.anonId),Object.keys(this.eventData).length>=1&&Ee.localStorage.setItem(n,JSON.stringify(this.eventData))}catch{vn("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,n,s,u){if(!kt.EVENTS_URL)return;const f=Ei(kt.EVENTS_URL);f.params.push(`access_token=${u||kt.ACCESS_TOKEN||""}`);const m={event:this.type,created:new Date(e).toISOString()},v=n?Ue(m,n):m,D={url:pi(f),headers:{"Content-Type":"text/plain"},body:JSON.stringify([v])};var P;this.pendingRequest=(P=C=>{this.pendingRequest=null,s(C),this.saveEventData(),this.processRequests(u)},Yr(Ue(D,{method:"POST"}),P))}queueRequest(e,n){this.queue.push(e),this.processRequests(n)}}const H=new class extends le{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(t,e){kt.EVENTS_URL&&kt.ACCESS_TOKEN&&Array.isArray(t)&&t.some(n=>Kr(n)||so(n))&&this.queueRequest(Date.now(),e)}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=Ui(kt.ACCESS_TOKEN),n=e?e.u:kt.ACCESS_TOKEN;let s=n!==this.eventData.tokenU;dn(this.anonId)||(this.anonId=Lt(),s=!0);const u=this.queue.shift();if(this.eventData.lastSuccess){const f=new Date(this.eventData.lastSuccess),m=new Date(u),v=(u-this.eventData.lastSuccess)/864e5;s=s||v>=1||v<-1||f.getDate()!==m.getDate()}else s=!0;s?this.postEvent(u,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Ht,skuId:Qt,"enabled.telemetry":!1,userId:this.anonId},f=>{f||(this.eventData.lastSuccess=u,this.eventData.tokenU=n)},t):this.processRequests()}},X=H.postTurnstileEvent.bind(H),ae=new class extends le{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,e,n,s){this.skuToken=e,this.errorCb=s,kt.EVENTS_URL&&(n||kt.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},n):this.errorCb(new Error(Gn)))}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),dn(this.anonId)||(this.anonId=Lt()),this.postEvent(n,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Ht,skuId:Qt,skuToken:this.skuToken,userId:this.anonId},s=>{s?this.errorCb(s):e&&(this.success[e]=!0)},t))}},fe=ae.postMapLoadEvent.bind(ae),xe=new class extends le{constructor(){super("gljs.performance")}postPerformanceEvent(t,e){kt.EVENTS_URL&&(t||kt.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},t)}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:e,performanceData:n}=this.queue.shift(),s=function(u){const f=Ee.performance.getEntriesByType("resource"),m=Ee.performance.getEntriesByType("mark"),v=function(N){const $={};if(N)for(const G in N)if("other"!==G)for(const J of N[G]){const ie=`${G}ResolveRangeMin`,ue=`${G}ResolveRangeMax`,ge=`${G}RequestCount`,ce=`${G}RequestCachedCount`;$[ie]=Math.min($[ie]||1/0,J.startTime),$[ue]=Math.max($[ue]||-1/0,J.responseEnd);const pe=_e=>{void 0===$[_e]&&($[_e]=0),++$[_e]};void 0!==J.transferSize&&0===J.transferSize&&pe(ce),pe(ge)}return $}(function(N,$){const G={};if(N)for(const J of N){const ie=$(J);void 0===G[ie]&&(G[ie]=[]),G[ie].push(J)}return G}(f,we)),D=Ee.devicePixelRatio,C=Ee.navigator.connection||Ee.navigator.mozConnection||Ee.navigator.webkitConnection,P={counters:[],metadata:[],attributes:[]},F=(N,$,G)=>{null!=G&&N.push({name:$,value:G.toString()})};for(const N in v)F(P.counters,N,v[N]);if(u.interactionRange[0]!==1/0&&u.interactionRange[1]!==-1/0&&(F(P.counters,"interactionRangeMin",u.interactionRange[0]),F(P.counters,"interactionRangeMax",u.interactionRange[1])),m)for(const N of Object.keys(Q)){const $=Q[N],G=m.find(J=>J.name===$);G&&F(P.counters,$,G.startTime)}return F(P.counters,"visibilityHidden",u.visibilityHidden),F(P.attributes,"style",function(N){if(N)for(const $ of N){const G=$.name.split("?")[0];if(bo(G)){const J=G.split("/").slice(-2);if(2===J.length)return`mapbox://styles/${J[0]}/${J[1]}`}}}(f)),F(P.attributes,"terrainEnabled",u.terrainEnabled?"true":"false"),F(P.attributes,"fogEnabled",u.fogEnabled?"true":"false"),F(P.attributes,"projection",u.projection),F(P.attributes,"zoom",u.zoom),F(P.metadata,"devicePixelRatio",D),F(P.metadata,"connectionEffectiveType",C?C.effectiveType:void 0),F(P.metadata,"navigatorUserAgent",Ee.navigator.userAgent),F(P.metadata,"screenWidth",Ee.screen.width),F(P.metadata,"screenHeight",Ee.screen.height),F(P.metadata,"windowWidth",Ee.innerWidth),F(P.metadata,"windowHeight",Ee.innerHeight),F(P.metadata,"mapWidth",u.width/D),F(P.metadata,"mapHeight",u.height/D),F(P.metadata,"webglRenderer",u.renderer),F(P.metadata,"webglVendor",u.vendor),F(P.metadata,"sdkVersion",Ht),F(P.metadata,"sdkIdentifier","mapbox-gl-js"),P}(n);for(const u of s.metadata);for(const u of s.counters);for(const u of s.attributes);this.postEvent(e,s,()=>{},t)}},Se=xe.postPerformanceEvent.bind(xe),Ce=new class extends le{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,e,n,s){if(!kt.API_URL||!kt.SESSION_PATH)return;const u=Ei(kt.API_URL+kt.SESSION_PATH);u.params.push(`sku=${e||""}`),u.params.push(`access_token=${s||kt.ACCESS_TOKEN||""}`);const f={url:pi(u),headers:{"Content-Type":"text/plain"}};var v;this.pendingRequest=(v=m=>{this.pendingRequest=null,n(m),this.saveEventData(),this.processRequests(s)},Yr(Ue(f,{method:"GET"}),v))}getSessionAPI(t,e,n,s){this.skuToken=e,this.errorCb=s,kt.SESSION_PATH&&kt.API_URL&&(n||kt.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},n):this.errorCb(new Error(Gn)))}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||this.getSession(n,this.skuToken,s=>{s?this.errorCb(s):e&&(this.success[e]=!0)},t)}},re=Ce.getSessionAPI.bind(Ce),ne=new Set,Q={create:"create",load:"load",fullLoad:"fullLoad"},ve={mark(t){Ee.performance.mark(t)},measure(t,e,n){Ee.performance.measure(t,e,n)}};function we(t){const e=t.name.split("?")[0];return Zo(e)&&e.includes("mapbox-gl.js")?"javascript":Zo(e)&&e.includes("mapbox-gl.css")?"css":kt.API_FONTS_REGEX.test(e)?"fontRange":is(e)?"sprite":bo(e)?"style":kt.API_TILEJSON_REGEX.test(e)?"tilejson":"other"}const lt=Ee.performance;function mt(t){const e=t?t.url.toString():void 0;return lt.getEntriesByName(e)}let Ct,yt,xn,On;const Kt={now:()=>void 0!==xn?xn:Ee.performance.now(),setNow(t){xn=t},restoreNow(){xn=void 0},frame(t){const e=Ee.requestAnimationFrame(t);return{cancel:()=>Ee.cancelAnimationFrame(e)}},getImageData(t,e=0){const{width:n,height:s}=t;On||(On=Ee.document.createElement("canvas"));const u=On.getContext("2d",{willReadFrequently:!0});if(!u)throw new Error("failed to create canvas 2d context");return(n>On.width||s>On.height)&&(On.width=n,On.height=s),u.clearRect(-e,-e,n+2*e,s+2*e),u.drawImage(t,0,0,n,s),u.getImageData(-e,-e,n+2*e,s+2*e)},resolveURL:t=>(Ct||(Ct=Ee.document.createElement("a")),Ct.href=t,Ct.href),get devicePixelRatio(){return Ee.devicePixelRatio},get prefersReducedMotion(){return!!Ee.matchMedia&&(null==yt&&(yt=Ee.matchMedia("(prefers-reduced-motion: reduce)")),yt.matches)}};function lr(t,e,n){n[t]&&-1!==n[t].indexOf(e)||(n[t]=n[t]||[],n[t].push(e))}function Kn(t,e,n){if(n&&n[t]){const s=n[t].indexOf(e);-1!==s&&n[t].splice(s,1)}}class mi{constructor(e,n={}){Ue(this,n),this.type=e}}class os extends mi{constructor(e,n={}){super("error",Ue({error:e},n))}}class Di{on(e,n){return this._listeners=this._listeners||{},lr(e,n,this._listeners),this}off(e,n){return Kn(e,n,this._listeners),Kn(e,n,this._oneTimeListeners),this}once(e,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},lr(e,n,this._oneTimeListeners),this):new Promise(s=>this.once(e,s))}fire(e,n){"string"==typeof e&&(e=new mi(e,n||{}));const s=e.type;if(this.listens(s)){e.target=this;const u=this._listeners&&this._listeners[s]?this._listeners[s].slice():[];for(const v of u)v.call(this,e);const f=this._oneTimeListeners&&this._oneTimeListeners[s]?this._oneTimeListeners[s].slice():[];for(const v of f)Kn(s,v,this._oneTimeListeners),v.call(this,e);const m=this._eventedParent;m&&(Ue(e,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),m.fire(e))}else e instanceof os&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,n){return this._eventedParent=e,this._eventedParentData=n,this}}var Ge=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function wo(t,...e){for(const n of e)for(const s in n)t[s]=n[s];return t}function $r(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function ao(t){if(Array.isArray(t))return t.map(ao);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const e={};for(const n in t)e[n]=ao(t[n]);return e}return $r(t)}class Ja extends Error{constructor(e,n){super(n),this.message=n,this.key=e}}var Ti=Ja;class lo{constructor(e,n=[]){this.parent=e,this.bindings={};for(const[s,u]of n)this.bindings[s]=u}concat(e){return new lo(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var ya=lo;const Sn={kind:"null"},xt={kind:"number"},fn={kind:"string"},Tn={kind:"boolean"},_r={kind:"color"},Jr={kind:"object"},ot={kind:"value"},Cn={kind:"collator"},yr={kind:"formatted"},Qr={kind:"resolvedImage"};function pr(t,e){return{kind:"array",itemType:t,N:e}}function Mn(t){if("array"===t.kind){const e=Mn(t.itemType);return"number"==typeof t.N?`array<${e}, ${t.N}>`:"value"===t.itemType.kind?"array":`array<${e}>`}return t.kind}const Ri=[Sn,xt,fn,Tn,_r,yr,Jr,pr(ot),Qr];function Tr(t,e){if("error"===e.kind)return null;if("array"===t.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!Tr(t.itemType,e.itemType))&&("number"!=typeof t.N||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if("value"===t.kind)for(const n of Ri)if(!Tr(n,e))return null}return`Expected ${Mn(t)} but found ${Mn(e)} instead.`}function xs(t,e){return e.some(n=>n.kind===t.kind)}function Eo(t,e){return e.some(n=>"null"===n?null===t:"array"===n?Array.isArray(t):"object"===n?t&&!Array.isArray(t)&&"object"==typeof t:n===typeof t)}var bn,$s={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Xi(t){return(t=Math.round(t))<0?0:t>255?255:t}function va(t){return Xi("%"===t[t.length-1]?parseFloat(t)/100*255:parseInt(t))}function ei(t){return(e="%"===t[t.length-1]?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function ri(t,e,n){return n<0?n+=1:n>1&&(n-=1),6*n<1?t+(e-t)*n*6:2*n<1?e:3*n<2?t+(e-t)*(2/3-n)*6:t}try{bn={}.parseCSSColor=function(t){var e,n=t.replace(/ /g,"").toLowerCase();if(n in $s)return $s[n].slice();if("#"===n[0])return 4===n.length?(e=parseInt(n.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:7===n.length&&(e=parseInt(n.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var s=n.indexOf("("),u=n.indexOf(")");if(-1!==s&&u+1===n.length){var f=n.substr(0,s),m=n.substr(s+1,u-(s+1)).split(","),v=1;switch(f){case"rgba":if(4!==m.length)return null;v=ei(m.pop());case"rgb":return 3!==m.length?null:[va(m[0]),va(m[1]),va(m[2]),v];case"hsla":if(4!==m.length)return null;v=ei(m.pop());case"hsl":if(3!==m.length)return null;var D=(parseFloat(m[0])%360+360)%360/360,C=ei(m[1]),P=ei(m[2]),F=P<=.5?P*(C+1):P+C-P*C,N=2*P-F;return[Xi(255*ri(N,F,D+1/3)),Xi(255*ri(N,F,D)),Xi(255*ri(N,F,D-1/3)),v];default:return null}}return null}}catch{}class Ur{constructor(e,n,s,u=1){this.r=e,this.g=n,this.b=s,this.a=u}static parse(e){if(!e)return;if(e instanceof Ur)return e;if("string"!=typeof e)return;const n=bn(e);return n?new Ur(n[0]/255*n[3],n[1]/255*n[3],n[2]/255*n[3],n[3]):void 0}toString(){const[e,n,s,u]=this.toArray();return`rgba(${Math.round(e)},${Math.round(n)},${Math.round(s)},${u})`}toArray(){const{r:e,g:n,b:s,a:u}=this;return 0===u?[0,0,0,0]:[255*e/u,255*n/u,255*s/u,u]}toArray01(){const{r:e,g:n,b:s,a:u}=this;return 0===u?[0,0,0,0]:[e/u,n/u,s/u,u]}toArray01PremultipliedAlpha(){const{r:e,g:n,b:s,a:u}=this;return[e,n,s,u]}}Ur.black=new Ur(0,0,0,1),Ur.white=new Ur(1,1,1,1),Ur.transparent=new Ur(0,0,0,0),Ur.red=new Ur(1,0,0,1),Ur.blue=new Ur(0,0,1,1);var Wn=Ur;class Ci{constructor(e,n,s){this.sensitivity=e?n?"variant":"case":n?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,n){return this.collator.compare(e,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Yi{constructor(e,n,s,u,f){this.text=e.normalize?e.normalize():e,this.image=n,this.scale=s,this.fontStack=u,this.textColor=f}}class Gr{constructor(e){this.sections=e}static fromString(e){return new Gr([new Yi(e,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(e=>0!==e.text.length||e.image&&0!==e.image.name.length)}static factory(e){return e instanceof Gr?e:Gr.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const n of this.sections){if(n.image){e.push(["image",n.image.name]);continue}e.push(n.text);const s={};n.fontStack&&(s["text-font"]=["literal",n.fontStack.split(",")]),n.scale&&(s["font-scale"]=n.scale),n.textColor&&(s["text-color"]=["rgba"].concat(n.textColor.toArray())),e.push(s)}return e}}class Xn{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Xn({name:e,available:!1}):null}serialize(){return["image",this.name]}}function hc(t,e,n,s){return"number"==typeof t&&t>=0&&t<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof n&&n>=0&&n<=255?void 0===s||"number"==typeof s&&s>=0&&s<=1?null:`Invalid rgba value [${[t,e,n,s].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof s?[t,e,n,s]:[t,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Gs(t){if(null===t||"string"==typeof t||"boolean"==typeof t||"number"==typeof t||t instanceof Wn||t instanceof Ci||t instanceof Gr||t instanceof Xn)return!0;if(Array.isArray(t)){for(const e of t)if(!Gs(e))return!1;return!0}if("object"==typeof t){for(const e in t)if(!Gs(t[e]))return!1;return!0}return!1}function Hr(t){if(null===t)return Sn;if("string"==typeof t)return fn;if("boolean"==typeof t)return Tn;if("number"==typeof t)return xt;if(t instanceof Wn)return _r;if(t instanceof Ci)return Cn;if(t instanceof Gr)return yr;if(t instanceof Xn)return Qr;if(Array.isArray(t)){const e=t.length;let n;for(const s of t){const u=Hr(s);if(n){if(n===u)continue;n=ot;break}n=u}return pr(n||ot,e)}return Jr}function ss(t){const e=typeof t;return null===t?"":"string"===e||"number"===e||"boolean"===e?String(t):t instanceof Wn||t instanceof Gr||t instanceof Xn?t.toString():JSON.stringify(t)}class Hs{constructor(e,n){this.type=e,this.value=n}static parse(e,n){if(2!==e.length)return n.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Gs(e[1]))return n.error("invalid value");const s=e[1];let u=Hr(s);const f=n.expectedType;return"array"!==u.kind||0!==u.N||!f||"array"!==f.kind||"number"==typeof f.N&&0!==f.N||(u=f),new Hs(u,s)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof Wn?["rgba"].concat(this.value.toArray()):this.value instanceof Gr?this.value.serialize():this.value}}var Ro=Hs,ur=class{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}};const xa={string:fn,number:xt,boolean:Tn,object:Jr};class Li{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let s,u=1;const f=e[0];if("array"===f){let v,D;if(e.length>2){const C=e[1];if("string"!=typeof C||!(C in xa)||"object"===C)return n.error('The item type argument of "array" must be one of string, number, boolean',1);v=xa[C],u++}else v=ot;if(e.length>3){if(null!==e[2]&&("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2])))return n.error('The length argument to "array" must be a positive integer literal',2);D=e[2],u++}s=pr(v,D)}else s=xa[f];const m=[];for(;u<e.length;u++){const v=n.parse(e[u],u,ot);if(!v)return null;m.push(v)}return new Li(s,m)}evaluate(e){for(let n=0;n<this.args.length;n++){const s=this.args[n].evaluate(e);if(!Tr(this.type,Hr(s)))return s;if(n===this.args.length-1)throw new ur(`Expected value to be of type ${Mn(this.type)}, but found ${Mn(Hr(s))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,n=[e.kind];if("array"===e.kind){const s=e.itemType;if("string"===s.kind||"number"===s.kind||"boolean"===s.kind){n.push(s.kind);const u=e.N;("number"==typeof u||this.args.length>1)&&n.push(u)}}return n.concat(this.args.map(s=>s.serialize()))}}var ii=Li;class bs{constructor(e){this.type=yr,this.sections=e}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const s=e[1];if(!Array.isArray(s)&&"object"==typeof s)return n.error("First argument must be an image or text section.");const u=[];let f=!1;for(let m=1;m<=e.length-1;++m){const v=e[m];if(f&&"object"==typeof v&&!Array.isArray(v)){f=!1;let D=null;if(v["font-scale"]&&(D=n.parse(v["font-scale"],1,xt),!D))return null;let C=null;if(v["text-font"]&&(C=n.parse(v["text-font"],1,pr(fn)),!C))return null;let P=null;if(v["text-color"]&&(P=n.parse(v["text-color"],1,_r),!P))return null;const F=u[u.length-1];F.scale=D,F.font=C,F.textColor=P}else{const D=n.parse(e[m],1,ot);if(!D)return null;const C=D.type.kind;if("string"!==C&&"value"!==C&&"null"!==C&&"resolvedImage"!==C)return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");f=!0,u.push({content:D,scale:null,font:null,textColor:null})}}return new bs(u)}evaluate(e){return new Gr(this.sections.map(n=>{const s=n.content.evaluate(e);return Hr(s)===Qr?new Yi("",s,null,null,null):new Yi(ss(s),null,n.scale?n.scale.evaluate(e):null,n.font?n.font.evaluate(e).join(","):null,n.textColor?n.textColor.evaluate(e):null)}))}eachChild(e){for(const n of this.sections)e(n.content),n.scale&&e(n.scale),n.font&&e(n.font),n.textColor&&e(n.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const n of this.sections){e.push(n.content.serialize());const s={};n.scale&&(s["font-scale"]=n.scale.serialize()),n.font&&(s["text-font"]=n.font.serialize()),n.textColor&&(s["text-color"]=n.textColor.serialize()),e.push(s)}return e}}class as{constructor(e){this.type=Qr,this.input=e}static parse(e,n){if(2!==e.length)return n.error("Expected two arguments.");const s=n.parse(e[1],1,fn);return s?new as(s):n.error("No image name provided.")}evaluate(e){const n=this.input.evaluate(e),s=Xn.fromString(n);return s&&e.availableImages&&(s.available=e.availableImages.indexOf(n)>-1),s}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Zs={"to-boolean":Tn,"to-color":_r,"to-number":xt,"to-string":fn};class ji{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const s=e[0];if(("to-boolean"===s||"to-string"===s)&&2!==e.length)return n.error("Expected one argument.");const u=Zs[s],f=[];for(let m=1;m<e.length;m++){const v=n.parse(e[m],m,ot);if(!v)return null;f.push(v)}return new ji(u,f)}evaluate(e){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(e));if("color"===this.type.kind){let n,s;for(const u of this.args){if(n=u.evaluate(e),s=null,n instanceof Wn)return n;if("string"==typeof n){const f=e.parseColor(n);if(f)return f}else if(Array.isArray(n)&&(s=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:hc(n[0],n[1],n[2],n[3]),!s))return new Wn(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new ur(s||`Could not parse color from value '${"string"==typeof n?n:String(JSON.stringify(n))}'`)}if("number"===this.type.kind){let n=null;for(const s of this.args){if(n=s.evaluate(e),null===n)return 0;const u=Number(n);if(!isNaN(u))return u}throw new ur(`Could not convert ${JSON.stringify(n)} to number.`)}return"formatted"===this.type.kind?Gr.fromString(ss(this.args[0].evaluate(e))):"resolvedImage"===this.type.kind?Xn.fromString(ss(this.args[0].evaluate(e))):ss(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if("formatted"===this.type.kind)return new bs([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new as(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(n=>{e.push(n.serialize())}),e}}var qs=ji;const Ml=["Unknown","Point","LineString","Polygon"];var Al=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Ml[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const t=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:n,y:s}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(n*e-t[0])+this.featureDistanceData.bearing[1]*(s*e-t[1])}return 0}parseColor(t){let e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=Wn.parse(t)),e}};class ls{constructor(e,n,s,u){this.name=e,this.type=n,this._evaluate=s,this.args=u}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,n){const s=e[0],u=ls.definitions[s];if(!u)return n.error(`Unknown expression "${s}". If you wanted a literal array, use ["literal", [...]].`,0);const f=Array.isArray(u)?u[0]:u.type,m=Array.isArray(u)?[[u[1],u[2]]]:u.overloads,v=m.filter(([C])=>!Array.isArray(C)||C.length===e.length-1);let D=null;for(const[C,P]of v){D=new uo(n.registry,n.path,null,n.scope);const F=[];let N=!1;for(let $=1;$<e.length;$++){const G=e[$],J=Array.isArray(C)?C[$-1]:C.type,ie=D.parse(G,1+F.length,J);if(!ie){N=!0;break}F.push(ie)}if(!N)if(Array.isArray(C)&&C.length!==F.length)D.error(`Expected ${C.length} arguments, but found ${F.length} instead.`);else{for(let $=0;$<F.length;$++){const G=Array.isArray(C)?C[$]:C.type,J=F[$];D.concat($+1).checkSubtype(G,J.type)}if(0===D.errors.length)return new ls(s,f,P,F)}}if(1===v.length)n.errors.push(...D.errors);else{const C=(v.length?v:m).map(([F])=>{return N=F,Array.isArray(N)?`(${N.map(Mn).join(", ")})`:`(${Mn(N.type)}...)`;var N}).join(" | "),P=[];for(let F=1;F<e.length;F++){const N=n.parse(e[F],1+P.length);if(!N)return null;P.push(Mn(N.type))}n.error(`Expected arguments of type ${C}, but found (${P.join(", ")}) instead.`)}return null}static register(e,n){ls.definitions=n;for(const s in n)e[s]=ls}}var ws=ls;class Qa{constructor(e,n,s){this.type=Cn,this.locale=s,this.caseSensitive=e,this.diacriticSensitive=n}static parse(e,n){if(2!==e.length)return n.error("Expected one argument.");const s=e[1];if("object"!=typeof s||Array.isArray(s))return n.error("Collator options argument must be an object.");const u=n.parse(void 0!==s["case-sensitive"]&&s["case-sensitive"],1,Tn);if(!u)return null;const f=n.parse(void 0!==s["diacritic-sensitive"]&&s["diacritic-sensitive"],1,Tn);if(!f)return null;let m=null;return s.locale&&(m=n.parse(s.locale,1,fn),!m)?null:new Qa(u,f,m)}evaluate(e){return new Ci(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const ci=8192;function co(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function Wo(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function dc(t,e){const n=(180+t[0])/360,s=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,u=Math.pow(2,e.z);return[Math.round(n*u*ci),Math.round(s*u*ci)]}function fc(t,e,n){const s=t[0]-e[0],u=t[1]-e[1],f=t[0]-n[0],m=t[1]-n[1];return s*m-f*u==0&&s*f<=0&&u*m<=0}function pc(t,e){let n=!1;for(let m=0,v=e.length;m<v;m++){const D=e[m];for(let C=0,P=D.length;C<P-1;C++){if(fc(t,D[C],D[C+1]))return!1;(u=D[C])[1]>(s=t)[1]!=(f=D[C+1])[1]>s[1]&&s[0]<(f[0]-u[0])*(s[1]-u[1])/(f[1]-u[1])+u[0]&&(n=!n)}}var s,u,f;return n}function ba(t,e){for(let n=0;n<e.length;n++)if(pc(t,e[n]))return!0;return!1}function Pl(t,e,n,s){const u=s[0]-n[0],f=s[1]-n[1],m=(t[0]-n[0])*f-u*(t[1]-n[1]),v=(e[0]-n[0])*f-u*(e[1]-n[1]);return m>0&&v<0||m<0&&v>0}function Rl(t,e,n){for(const C of n)for(let P=0;P<C.length-1;++P)if((v=[(m=C[P+1])[0]-(f=C[P])[0],m[1]-f[1]])[0]*(D=[(u=e)[0]-(s=t)[0],u[1]-s[1]])[1]-v[1]*D[0]!=0&&Pl(s,u,f,m)&&Pl(f,m,s,u))return!0;var s,u,f,m,v,D;return!1}function el(t,e){for(let n=0;n<t.length;++n)if(!pc(t[n],e))return!1;for(let n=0;n<t.length-1;++n)if(Rl(t[n],t[n+1],e))return!1;return!0}function tl(t,e){for(let n=0;n<e.length;n++)if(el(t,e[n]))return!0;return!1}function cs(t,e,n){const s=[];for(let u=0;u<t.length;u++){const f=[];for(let m=0;m<t[u].length;m++){const v=dc(t[u][m],n);co(e,v),f.push(v)}s.push(f)}return s}function nl(t,e,n){const s=[];for(let u=0;u<t.length;u++){const f=cs(t[u],e,n);s.push(f)}return s}function us(t,e,n,s){if(t[0]<n[0]||t[0]>n[2]){const u=.5*s;let f=t[0]-n[0]>u?-s:n[0]-t[0]>u?s:0;0===f&&(f=t[0]-n[2]>u?-s:n[2]-t[0]>u?s:0),t[0]+=f}co(e,t)}function rr(t,e,n,s){const u=Math.pow(2,s.z)*ci,f=[s.x*ci,s.y*ci],m=[];if(!t)return m;for(const v of t)for(const D of v){const C=[D.x+f[0],D.y+f[1]];us(C,e,n,u),m.push(C)}return m}function hs(t,e,n,s){const u=Math.pow(2,s.z)*ci,f=[s.x*ci,s.y*ci],m=[];if(!t)return m;for(const D of t){const C=[];for(const P of D){const F=[P.x+f[0],P.y+f[1]];co(e,F),C.push(F)}m.push(C)}if(e[2]-e[0]<=u/2){(v=e)[0]=v[1]=1/0,v[2]=v[3]=-1/0;for(const D of m)for(const C of D)us(C,e,n,u)}var v;return m}class ds{constructor(e,n){this.type=Tn,this.geojson=e,this.geometries=n}static parse(e,n){if(2!==e.length)return n.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Gs(e[1])){const s=e[1];if("FeatureCollection"===s.type)for(let u=0;u<s.features.length;++u){const f=s.features[u].geometry.type;if("Polygon"===f||"MultiPolygon"===f)return new ds(s,s.features[u].geometry)}else if("Feature"===s.type){const u=s.geometry.type;if("Polygon"===u||"MultiPolygon"===u)return new ds(s,s.geometry)}else if("Polygon"===s.type||"MultiPolygon"===s.type)return new ds(s,s)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(n,s){const u=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],m=n.canonicalID();if(!m)return!1;if("Polygon"===s.type){const v=cs(s.coordinates,f,m),D=rr(n.geometry(),u,f,m);if(!Wo(u,f))return!1;for(const C of D)if(!pc(C,v))return!1}if("MultiPolygon"===s.type){const v=nl(s.coordinates,f,m),D=rr(n.geometry(),u,f,m);if(!Wo(u,f))return!1;for(const C of D)if(!ba(C,v))return!1}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(n,s){const u=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],m=n.canonicalID();if(!m)return!1;if("Polygon"===s.type){const v=cs(s.coordinates,f,m),D=hs(n.geometry(),u,f,m);if(!Wo(u,f))return!1;for(const C of D)if(!el(C,v))return!1}if("MultiPolygon"===s.type){const v=nl(s.coordinates,f,m),D=hs(n.geometry(),u,f,m);if(!Wo(u,f))return!1;for(const C of D)if(!tl(C,v))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Es=ds;function Ws(t){if(t instanceof ws&&("get"===t.name&&1===t.args.length||"feature-state"===t.name||"has"===t.name&&1===t.args.length||"properties"===t.name||"geometry-type"===t.name||"id"===t.name||/^filter-/.test(t.name))||t instanceof Es)return!1;let e=!0;return t.eachChild(n=>{e&&!Ws(n)&&(e=!1)}),e}function Xs(t){if(t instanceof ws&&"feature-state"===t.name)return!1;let e=!0;return t.eachChild(n=>{e&&!Xs(n)&&(e=!1)}),e}function Ys(t,e){if(t instanceof ws&&e.indexOf(t.name)>=0)return!1;let n=!0;return t.eachChild(s=>{n&&!Ys(s,e)&&(n=!1)}),n}class Ks{constructor(e,n){this.type=n.type,this.name=e,this.boundExpression=n}static parse(e,n){if(2!==e.length||"string"!=typeof e[1])return n.error("'var' expression requires exactly one string literal argument.");const s=e[1];return n.scope.has(s)?new Ks(s,n.scope.get(s)):n.error(`Unknown variable "${s}". Make sure "${s}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var Js=Ks;class wa{constructor(e,n=[],s,u=new ya,f=[]){this.registry=e,this.path=n,this.key=n.map(m=>`[${m}]`).join(""),this.scope=u,this.errors=f,this.expectedType=s}parse(e,n,s,u,f={}){return n?this.concat(n,s,u)._parse(e,f):this._parse(e,f)}_parse(e,n){function s(u,f,m){return"assert"===m?new ii(f,[u]):"coerce"===m?new qs(f,[u]):u}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const u=e[0];if("string"!=typeof u)return this.error(`Expression name must be a string, but found ${typeof u} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const f=this.registry[u];if(f){let m=f.parse(e,this);if(!m)return null;if(this.expectedType){const v=this.expectedType,D=m.type;if("string"!==v.kind&&"number"!==v.kind&&"boolean"!==v.kind&&"object"!==v.kind&&"array"!==v.kind||"value"!==D.kind)if("color"!==v.kind&&"formatted"!==v.kind&&"resolvedImage"!==v.kind||"value"!==D.kind&&"string"!==D.kind){if(this.checkSubtype(v,D))return null}else m=s(m,v,n.typeAnnotation||"coerce");else m=s(m,v,n.typeAnnotation||"assert")}if(!(m instanceof Ro)&&"resolvedImage"!==m.type.kind&&Lo(m)){const v=new Al;try{m=new Ro(m.type,m.evaluate(v))}catch(D){return this.error(D.message),null}}return m}return this.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===e?"'undefined' value invalid. Use null instead.":"object"==typeof e?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,n,s){const u="number"==typeof e?this.path.concat(e):this.path,f=s?this.scope.concat(s):this.scope;return new wa(this.registry,u,n||null,f,this.errors)}error(e,...n){const s=`${this.key}${n.map(u=>`[${u}]`).join("")}`;this.errors.push(new Ti(s,e))}checkSubtype(e,n){const s=Tr(e,n);return s&&this.error(s),s}}var uo=wa;function Lo(t){if(t instanceof Js)return Lo(t.boundExpression);if(t instanceof ws&&"error"===t.name||t instanceof Qa||t instanceof Es)return!1;const e=t instanceof qs||t instanceof ii;let n=!0;return t.eachChild(s=>{n=e?n&&Lo(s):n&&s instanceof Ro}),!!n&&Ws(t)&&Ys(t,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function ui(t,e){const n=t.length-1;let s,u,f=0,m=n,v=0;for(;f<=m;)if(v=Math.floor((f+m)/2),s=t[v],u=t[v+1],s<=e){if(v===n||e<u)return v;f=v+1}else{if(!(s>e))throw new ur("Input is not a number.");m=v-1}return 0}class Ds{constructor(e,n,s){this.type=e,this.input=n,this.labels=[],this.outputs=[];for(const[u,f]of s)this.labels.push(u),this.outputs.push(f)}static parse(e,n){if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");const s=n.parse(e[1],1,xt);if(!s)return null;const u=[];let f=null;n.expectedType&&"value"!==n.expectedType.kind&&(f=n.expectedType);for(let m=1;m<e.length;m+=2){const v=1===m?-1/0:e[m],D=e[m+1],C=m,P=m+1;if("number"!=typeof v)return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',C);if(u.length&&u[u.length-1][0]>=v)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',C);const F=n.parse(D,P,f);if(!F)return null;f=f||F.type,u.push([v,F])}return new Ds(f,s,u)}evaluate(e){const n=this.labels,s=this.outputs;if(1===n.length)return s[0].evaluate(e);const u=this.input.evaluate(e);if(u<=n[0])return s[0].evaluate(e);const f=n.length;return u>=n[f-1]?s[f-1].evaluate(e):s[ui(n,u)].evaluate(e)}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let n=0;n<this.labels.length;n++)n>0&&e.push(this.labels[n]),e.push(this.outputs[n].serialize());return e}}var Ea=Ds;function gn(t,e,n){return t*(1-n)+e*n}var Qs=Object.freeze({__proto__:null,number:gn,color:function(t,e,n){return new Wn(gn(t.r,e.r,n),gn(t.g,e.g,n),gn(t.b,e.b,n),gn(t.a,e.a,n))},array:function(t,e,n){return t.map((s,u)=>gn(s,e[u],n))}});const mc=4/29,rl=6/29,ea=3*rl*rl,Si=Math.PI/180,xu=180/Math.PI;function Cs(t){return t>.008856451679035631?Math.pow(t,1/3):t/ea+mc}function il(t){return t>rl?t*t*t:ea*(t-mc)}function fo(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function ki(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function ol(t){const e=ki(t.r),n=ki(t.g),s=ki(t.b),u=Cs((.4124564*e+.3575761*n+.1804375*s)/.95047),f=Cs((.2126729*e+.7151522*n+.072175*s)/1);return{l:116*f-16,a:500*(u-f),b:200*(f-Cs((.0193339*e+.119192*n+.9503041*s)/1.08883)),alpha:t.a}}function wn(t){let e=(t.l+16)/116,n=isNaN(t.a)?e:e+t.a/500,s=isNaN(t.b)?e:e-t.b/200;return e=1*il(e),n=.95047*il(n),s=1.08883*il(s),new Wn(fo(3.2404542*n-1.5371385*e-.4985314*s),fo(-.969266*n+1.8760108*e+.041556*s),fo(.0556434*n-.2040259*e+1.0572252*s),t.alpha)}function ti(t,e,n){const s=e-t;return t+n*(s>180||s<-180?s-360*Math.round(s/360):s)}const Ll={forward:ol,reverse:wn,interpolate:function(t,e,n){return{l:gn(t.l,e.l,n),a:gn(t.a,e.a,n),b:gn(t.b,e.b,n),alpha:gn(t.alpha,e.alpha,n)}}},ta={forward:function(t){const{l:e,a:n,b:s}=ol(t),u=Math.atan2(s,n)*xu;return{h:u<0?u+360:u,c:Math.sqrt(n*n+s*s),l:e,alpha:t.a}},reverse:function(t){const e=t.h*Si,n=t.c;return wn({l:t.l,a:Math.cos(e)*n,b:Math.sin(e)*n,alpha:t.alpha})},interpolate:function(t,e,n){return{h:ti(t.h,e.h,n),c:gn(t.c,e.c,n),l:gn(t.l,e.l,n),alpha:gn(t.alpha,e.alpha,n)}}};var sl=Object.freeze({__proto__:null,lab:Ll,hcl:ta});class kl{constructor(e,n,s,u,f){this.type=e,this.operator=n,this.interpolation=s,this.input=u,this.labels=[],this.outputs=[];for(const[m,v]of f)this.labels.push(m),this.outputs.push(v)}static interpolationFactor(e,n,s,u){let f=0;if("exponential"===e.name)f=Ol(n,e.base,s,u);else if("linear"===e.name)f=Ol(n,1,s,u);else if("cubic-bezier"===e.name){const m=e.controlPoints;f=new nn(m[0],m[1],m[2],m[3]).solve(Ol(n,1,s,u))}return f}static parse(e,n){let[s,u,f,...m]=e;if(!Array.isArray(u)||0===u.length)return n.error("Expected an interpolation type expression.",1);if("linear"===u[0])u={name:"linear"};else if("exponential"===u[0]){const C=u[1];if("number"!=typeof C)return n.error("Exponential interpolation requires a numeric base.",1,1);u={name:"exponential",base:C}}else{if("cubic-bezier"!==u[0])return n.error(`Unknown interpolation type ${String(u[0])}`,1,0);{const C=u.slice(1);if(4!==C.length||C.some(P=>"number"!=typeof P||P<0||P>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);u={name:"cubic-bezier",controlPoints:C}}}if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(f=n.parse(f,2,xt),!f)return null;const v=[];let D=null;"interpolate-hcl"===s||"interpolate-lab"===s?D=_r:n.expectedType&&"value"!==n.expectedType.kind&&(D=n.expectedType);for(let C=0;C<m.length;C+=2){const P=m[C],F=m[C+1],N=C+3,$=C+4;if("number"!=typeof P)return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',N);if(v.length&&v[v.length-1][0]>=P)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',N);const G=n.parse(F,$,D);if(!G)return null;D=D||G.type,v.push([P,G])}return"number"===D.kind||"color"===D.kind||"array"===D.kind&&"number"===D.itemType.kind&&"number"==typeof D.N?new kl(D,s,u,f,v):n.error(`Type ${Mn(D)} is not interpolatable.`)}evaluate(e){const n=this.labels,s=this.outputs;if(1===n.length)return s[0].evaluate(e);const u=this.input.evaluate(e);if(u<=n[0])return s[0].evaluate(e);const f=n.length;if(u>=n[f-1])return s[f-1].evaluate(e);const m=ui(n,u),v=kl.interpolationFactor(this.interpolation,u,n[m],n[m+1]),D=s[m].evaluate(e),C=s[m+1].evaluate(e);return"interpolate"===this.operator?Qs[this.type.kind.toLowerCase()](D,C,v):"interpolate-hcl"===this.operator?ta.reverse(ta.interpolate(ta.forward(D),ta.forward(C),v)):Ll.reverse(Ll.interpolate(Ll.forward(D),Ll.forward(C),v))}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const n=[this.operator,e,this.input.serialize()];for(let s=0;s<this.labels.length;s++)n.push(this.labels[s],this.outputs[s].serialize());return n}}function Ol(t,e,n,s){const u=s-n,f=t-n;return 0===u?0:1===e?f/u:(Math.pow(e,f)-1)/(Math.pow(e,u)-1)}var Vi=kl;class fs{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expectected at least one argument.");let s=null;const u=n.expectedType;u&&"value"!==u.kind&&(s=u);const f=[];for(const v of e.slice(1)){const D=n.parse(v,1+f.length,s,void 0,{typeAnnotation:"omit"});if(!D)return null;s=s||D.type,f.push(D)}const m=u&&f.some(v=>Tr(u,v.type));return new fs(m?ot:s,f)}evaluate(e){let n,s=null,u=0;for(const f of this.args){if(u++,s=f.evaluate(e),s&&s instanceof Xn&&!s.available&&(n||(n=s),s=null,u===this.args.length))return n;if(null!==s)break}return s}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(n=>{e.push(n.serialize())}),e}}var pt=fs;class Jn{constructor(e,n){this.type=n.type,this.bindings=[].concat(e),this.result=n}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const n of this.bindings)e(n[1]);e(this.result)}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const s=[];for(let f=1;f<e.length-1;f+=2){const m=e[f];if("string"!=typeof m)return n.error(`Expected string, but found ${typeof m} instead.`,f);if(/[^a-zA-Z0-9_]/.test(m))return n.error("Variable names must contain only alphanumeric characters or '_'.",f);const v=n.parse(e[f+1],f+1);if(!v)return null;s.push([m,v])}const u=n.parse(e[e.length-1],e.length-1,n.expectedType,s);return u?new Jn(s,u):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[n,s]of this.bindings)e.push(n,s.serialize());return e.push(this.result.serialize()),e}}var na=Jn;class Xo{constructor(e,n,s){this.type=e,this.index=n,this.input=s}static parse(e,n){if(3!==e.length)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=n.parse(e[1],1,xt),u=n.parse(e[2],2,pr(n.expectedType||ot));return s&&u?new Xo(u.type.itemType,s,u):null}evaluate(e){const n=this.index.evaluate(e),s=this.input.evaluate(e);if(n<0)throw new ur(`Array index out of bounds: ${n} < 0.`);if(n>=s.length)throw new ur(`Array index out of bounds: ${n} > ${s.length-1}.`);if(n!==Math.floor(n))throw new ur(`Array index must be an integer, but found ${n} instead.`);return s[n]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var hi=Xo;class Da{constructor(e,n){this.type=Tn,this.needle=e,this.haystack=n}static parse(e,n){if(3!==e.length)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=n.parse(e[1],1,ot),u=n.parse(e[2],2,ot);return s&&u?xs(s.type,[Tn,fn,xt,Sn,ot])?new Da(s,u):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Mn(s.type)} instead`):null}evaluate(e){const n=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(null==s)return!1;if(!Eo(n,["boolean","string","number","null"]))throw new ur(`Expected first argument to be of type boolean, string, number or null, but found ${Mn(Hr(n))} instead.`);if(!Eo(s,["string","array"]))throw new ur(`Expected second argument to be of type array or string, but found ${Mn(Hr(s))} instead.`);return s.indexOf(n)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var ps=Da;class gi{constructor(e,n,s){this.type=xt,this.needle=e,this.haystack=n,this.fromIndex=s}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=n.parse(e[1],1,ot),u=n.parse(e[2],2,ot);if(!s||!u)return null;if(!xs(s.type,[Tn,fn,xt,Sn,ot]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Mn(s.type)} instead`);if(4===e.length){const f=n.parse(e[3],3,xt);return f?new gi(s,u,f):null}return new gi(s,u)}evaluate(e){const n=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(!Eo(n,["boolean","string","number","null"]))throw new ur(`Expected first argument to be of type boolean, string, number or null, but found ${Mn(Hr(n))} instead.`);if(!Eo(s,["string","array"]))throw new ur(`Expected second argument to be of type array or string, but found ${Mn(Hr(s))} instead.`);if(this.fromIndex){const u=this.fromIndex.evaluate(e);return s.indexOf(n,u)}return s.indexOf(n)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var gc=gi;class al{constructor(e,n,s,u,f,m){this.inputType=e,this.type=n,this.input=s,this.cases=u,this.outputs=f,this.otherwise=m}static parse(e,n){if(e.length<5)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return n.error("Expected an even number of arguments.");let s,u;n.expectedType&&"value"!==n.expectedType.kind&&(u=n.expectedType);const f={},m=[];for(let C=2;C<e.length-1;C+=2){let P=e[C];const F=e[C+1];Array.isArray(P)||(P=[P]);const N=n.concat(C);if(0===P.length)return N.error("Expected at least one branch label.");for(const G of P){if("number"!=typeof G&&"string"!=typeof G)return N.error("Branch labels must be numbers or strings.");if("number"==typeof G&&Math.abs(G)>Number.MAX_SAFE_INTEGER)return N.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof G&&Math.floor(G)!==G)return N.error("Numeric branch labels must be integer values.");if(s){if(N.checkSubtype(s,Hr(G)))return null}else s=Hr(G);if(void 0!==f[String(G)])return N.error("Branch labels must be unique.");f[String(G)]=m.length}const $=n.parse(F,C,u);if(!$)return null;u=u||$.type,m.push($)}const v=n.parse(e[1],1,ot);if(!v)return null;const D=n.parse(e[e.length-1],e.length-1,u);return D?"value"!==v.type.kind&&n.concat(1).checkSubtype(s,v.type)?null:new al(s,u,v,f,m,D):null}evaluate(e){const n=this.input.evaluate(e);return(Hr(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],n=Object.keys(this.cases).sort(),s=[],u={};for(const m of n){const v=u[this.cases[m]];void 0===v?(u[this.cases[m]]=s.length,s.push([this.cases[m],[m]])):s[v][1].push(m)}const f=m=>"number"===this.inputType.kind?Number(m):m;for(const[m,v]of s)e.push(1===v.length?f(v[0]):v.map(f)),e.push(this.outputs[m].serialize());return e.push(this.otherwise.serialize()),e}}var Bc=al;class ra{constructor(e,n,s){this.type=e,this.branches=n,this.otherwise=s}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return n.error("Expected an odd number of arguments.");let s;n.expectedType&&"value"!==n.expectedType.kind&&(s=n.expectedType);const u=[];for(let m=1;m<e.length-1;m+=2){const v=n.parse(e[m],m,Tn);if(!v)return null;const D=n.parse(e[m+1],m+1,s);if(!D)return null;u.push([v,D]),s=s||D.type}const f=n.parse(e[e.length-1],e.length-1,s);return f?new ra(s,u,f):null}evaluate(e){for(const[n,s]of this.branches)if(n.evaluate(e))return s.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[n,s]of this.branches)e(n),e(s);e(this.otherwise)}outputDefined(){return this.branches.every(([e,n])=>n.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(n=>{e.push(n.serialize())}),e}}var ll=ra;class Zr{constructor(e,n,s,u){this.type=e,this.input=n,this.beginIndex=s,this.endIndex=u}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=n.parse(e[1],1,ot),u=n.parse(e[2],2,xt);if(!s||!u)return null;if(!xs(s.type,[pr(ot),fn,ot]))return n.error(`Expected first argument to be of type array or string, but found ${Mn(s.type)} instead`);if(4===e.length){const f=n.parse(e[3],3,xt);return f?new Zr(s.type,s,u,f):null}return new Zr(s.type,s,u)}evaluate(e){const n=this.input.evaluate(e),s=this.beginIndex.evaluate(e);if(!Eo(n,["string","array"]))throw new ur(`Expected first argument to be of type array or string, but found ${Mn(Hr(n))} instead.`);if(this.endIndex){const u=this.endIndex.evaluate(e);return n.slice(s,u)}return n.slice(s)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var $i=Zr;function cl(t,e){return"=="===t||"!="===t?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function ia(t,e,n,s){return 0===s.compare(e,n)}function Gi(t,e,n){const s="=="!==t&&"!="!==t;return class N0{constructor(f,m,v){this.type=Tn,this.lhs=f,this.rhs=m,this.collator=v,this.hasUntypedArgument="value"===f.type.kind||"value"===m.type.kind}static parse(f,m){if(3!==f.length&&4!==f.length)return m.error("Expected two or three arguments.");const v=f[0];let D=m.parse(f[1],1,ot);if(!D)return null;if(!cl(v,D.type))return m.concat(1).error(`"${v}" comparisons are not supported for type '${Mn(D.type)}'.`);let C=m.parse(f[2],2,ot);if(!C)return null;if(!cl(v,C.type))return m.concat(2).error(`"${v}" comparisons are not supported for type '${Mn(C.type)}'.`);if(D.type.kind!==C.type.kind&&"value"!==D.type.kind&&"value"!==C.type.kind)return m.error(`Cannot compare types '${Mn(D.type)}' and '${Mn(C.type)}'.`);s&&("value"===D.type.kind&&"value"!==C.type.kind?D=new ii(C.type,[D]):"value"!==D.type.kind&&"value"===C.type.kind&&(C=new ii(D.type,[C])));let P=null;if(4===f.length){if("string"!==D.type.kind&&"string"!==C.type.kind&&"value"!==D.type.kind&&"value"!==C.type.kind)return m.error("Cannot use collator to compare non-string types.");if(P=m.parse(f[3],3,Cn),!P)return null}return new N0(D,C,P)}evaluate(f){const m=this.lhs.evaluate(f),v=this.rhs.evaluate(f);if(s&&this.hasUntypedArgument){const D=Hr(m),C=Hr(v);if(D.kind!==C.kind||"string"!==D.kind&&"number"!==D.kind)throw new ur(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${D.kind}, ${C.kind}) instead.`)}if(this.collator&&!s&&this.hasUntypedArgument){const D=Hr(m),C=Hr(v);if("string"!==D.kind||"string"!==C.kind)return e(f,m,v)}return this.collator?n(f,m,v,this.collator.evaluate(f)):e(f,m,v)}eachChild(f){f(this.lhs),f(this.rhs),this.collator&&f(this.collator)}outputDefined(){return!0}serialize(){const f=[t];return this.eachChild(m=>{f.push(m.serialize())}),f}}}const Nc=Gi("==",function(t,e,n){return e===n},ia),_c=Gi("!=",function(t,e,n){return e!==n},function(t,e,n,s){return!ia(0,e,n,s)}),yc=Gi("<",function(t,e,n){return e<n},function(t,e,n,s){return s.compare(e,n)<0}),bu=Gi(">",function(t,e,n){return e>n},function(t,e,n,s){return s.compare(e,n)>0}),vc=Gi("<=",function(t,e,n){return e<=n},function(t,e,n,s){return s.compare(e,n)<=0}),xc=Gi(">=",function(t,e,n){return e>=n},function(t,e,n,s){return s.compare(e,n)>=0});class ul{constructor(e,n,s,u,f,m){this.type=fn,this.number=e,this.locale=n,this.currency=s,this.unit=u,this.minFractionDigits=f,this.maxFractionDigits=m}static parse(e,n){if(3!==e.length)return n.error("Expected two arguments.");const s=n.parse(e[1],1,xt);if(!s)return null;const u=e[2];if("object"!=typeof u||Array.isArray(u))return n.error("NumberFormat options argument must be an object.");let f=null;if(u.locale&&(f=n.parse(u.locale,1,fn),!f))return null;let m=null;if(u.currency&&(m=n.parse(u.currency,1,fn),!m))return null;let v=null;if(u.unit&&(v=n.parse(u.unit,1,fn),!v))return null;let D=null;if(u["min-fraction-digits"]&&(D=n.parse(u["min-fraction-digits"],1,xt),!D))return null;let C=null;return u["max-fraction-digits"]&&(C=n.parse(u["max-fraction-digits"],1,xt),!C)?null:new ul(s,f,m,v,D,C)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class hl{constructor(e){this.type=xt,this.input=e}static parse(e,n){if(2!==e.length)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);const s=n.parse(e[1],1);return s?"array"!==s.type.kind&&"string"!==s.type.kind&&"value"!==s.type.kind?n.error(`Expected argument of type string or array, but found ${Mn(s.type)} instead.`):new hl(s):null}evaluate(e){const n=this.input.evaluate(e);if("string"==typeof n||Array.isArray(n))return n.length;throw new ur(`Expected value to be of type string or array, but found ${Mn(Hr(n))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(n=>{e.push(n.serialize())}),e}}const dl={"==":Nc,"!=":_c,">":bu,"<":yc,">=":xc,"<=":vc,array:ii,at:hi,boolean:ii,case:ll,coalesce:pt,collator:Qa,format:bs,image:as,in:ps,"index-of":gc,interpolate:Vi,"interpolate-hcl":Vi,"interpolate-lab":Vi,length:hl,let:na,literal:Ro,match:Bc,number:ii,"number-format":ul,object:ii,slice:$i,step:Ea,string:ii,"to-boolean":qs,"to-color":qs,"to-number":qs,"to-string":qs,var:Js,within:Es};function Fl(t,[e,n,s,u]){e=e.evaluate(t),n=n.evaluate(t),s=s.evaluate(t);const f=u?u.evaluate(t):1,m=hc(e,n,s,f);if(m)throw new ur(m);return new Wn(e/255*f,n/255*f,s/255*f,f)}function Ss(t,e){return t in e}function ms(t,e){const n=e[t];return void 0===n?null:n}function ko(t){return{type:t}}ws.register(dl,{error:[{kind:"error"},[fn],(t,[e])=>{throw new ur(e.evaluate(t))}],typeof:[fn,[ot],(t,[e])=>Mn(Hr(e.evaluate(t)))],"to-rgba":[pr(xt,4),[_r],(t,[e])=>e.evaluate(t).toArray()],rgb:[_r,[xt,xt,xt],Fl],rgba:[_r,[xt,xt,xt,xt],Fl],has:{type:Tn,overloads:[[[fn],(t,[e])=>Ss(e.evaluate(t),t.properties())],[[fn,Jr],(t,[e,n])=>Ss(e.evaluate(t),n.evaluate(t))]]},get:{type:ot,overloads:[[[fn],(t,[e])=>ms(e.evaluate(t),t.properties())],[[fn,Jr],(t,[e,n])=>ms(e.evaluate(t),n.evaluate(t))]]},"feature-state":[ot,[fn],(t,[e])=>ms(e.evaluate(t),t.featureState||{})],properties:[Jr,[],t=>t.properties()],"geometry-type":[fn,[],t=>t.geometryType()],id:[ot,[],t=>t.id()],zoom:[xt,[],t=>t.globals.zoom],pitch:[xt,[],t=>t.globals.pitch||0],"distance-from-center":[xt,[],t=>t.distanceFromCenter()],"heatmap-density":[xt,[],t=>t.globals.heatmapDensity||0],"line-progress":[xt,[],t=>t.globals.lineProgress||0],"sky-radial-progress":[xt,[],t=>t.globals.skyRadialProgress||0],accumulated:[ot,[],t=>void 0===t.globals.accumulated?null:t.globals.accumulated],"+":[xt,ko(xt),(t,e)=>{let n=0;for(const s of e)n+=s.evaluate(t);return n}],"*":[xt,ko(xt),(t,e)=>{let n=1;for(const s of e)n*=s.evaluate(t);return n}],"-":{type:xt,overloads:[[[xt,xt],(t,[e,n])=>e.evaluate(t)-n.evaluate(t)],[[xt],(t,[e])=>-e.evaluate(t)]]},"/":[xt,[xt,xt],(t,[e,n])=>e.evaluate(t)/n.evaluate(t)],"%":[xt,[xt,xt],(t,[e,n])=>e.evaluate(t)%n.evaluate(t)],ln2:[xt,[],()=>Math.LN2],pi:[xt,[],()=>Math.PI],e:[xt,[],()=>Math.E],"^":[xt,[xt,xt],(t,[e,n])=>Math.pow(e.evaluate(t),n.evaluate(t))],sqrt:[xt,[xt],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[xt,[xt],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[xt,[xt],(t,[e])=>Math.log(e.evaluate(t))],log2:[xt,[xt],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[xt,[xt],(t,[e])=>Math.sin(e.evaluate(t))],cos:[xt,[xt],(t,[e])=>Math.cos(e.evaluate(t))],tan:[xt,[xt],(t,[e])=>Math.tan(e.evaluate(t))],asin:[xt,[xt],(t,[e])=>Math.asin(e.evaluate(t))],acos:[xt,[xt],(t,[e])=>Math.acos(e.evaluate(t))],atan:[xt,[xt],(t,[e])=>Math.atan(e.evaluate(t))],min:[xt,ko(xt),(t,e)=>Math.min(...e.map(n=>n.evaluate(t)))],max:[xt,ko(xt),(t,e)=>Math.max(...e.map(n=>n.evaluate(t)))],abs:[xt,[xt],(t,[e])=>Math.abs(e.evaluate(t))],round:[xt,[xt],(t,[e])=>{const n=e.evaluate(t);return n<0?-Math.round(-n):Math.round(n)}],floor:[xt,[xt],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[xt,[xt],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[Tn,[fn,ot],(t,[e,n])=>t.properties()[e.value]===n.value],"filter-id-==":[Tn,[ot],(t,[e])=>t.id()===e.value],"filter-type-==":[Tn,[fn],(t,[e])=>t.geometryType()===e.value],"filter-<":[Tn,[fn,ot],(t,[e,n])=>{const s=t.properties()[e.value],u=n.value;return typeof s==typeof u&&s<u}],"filter-id-<":[Tn,[ot],(t,[e])=>{const n=t.id(),s=e.value;return typeof n==typeof s&&n<s}],"filter->":[Tn,[fn,ot],(t,[e,n])=>{const s=t.properties()[e.value],u=n.value;return typeof s==typeof u&&s>u}],"filter-id->":[Tn,[ot],(t,[e])=>{const n=t.id(),s=e.value;return typeof n==typeof s&&n>s}],"filter-<=":[Tn,[fn,ot],(t,[e,n])=>{const s=t.properties()[e.value],u=n.value;return typeof s==typeof u&&s<=u}],"filter-id-<=":[Tn,[ot],(t,[e])=>{const n=t.id(),s=e.value;return typeof n==typeof s&&n<=s}],"filter->=":[Tn,[fn,ot],(t,[e,n])=>{const s=t.properties()[e.value],u=n.value;return typeof s==typeof u&&s>=u}],"filter-id->=":[Tn,[ot],(t,[e])=>{const n=t.id(),s=e.value;return typeof n==typeof s&&n>=s}],"filter-has":[Tn,[ot],(t,[e])=>e.value in t.properties()],"filter-has-id":[Tn,[],t=>null!==t.id()&&void 0!==t.id()],"filter-type-in":[Tn,[pr(fn)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[Tn,[pr(ot)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[Tn,[fn,pr(ot)],(t,[e,n])=>n.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[Tn,[fn,pr(ot)],(t,[e,n])=>function(s,u,f,m){for(;f<=m;){const v=f+m>>1;if(u[v]===s)return!0;u[v]>s?m=v-1:f=v+1}return!1}(t.properties()[e.value],n.value,0,n.value.length-1)],all:{type:Tn,overloads:[[[Tn,Tn],(t,[e,n])=>e.evaluate(t)&&n.evaluate(t)],[ko(Tn),(t,e)=>{for(const n of e)if(!n.evaluate(t))return!1;return!0}]]},any:{type:Tn,overloads:[[[Tn,Tn],(t,[e,n])=>e.evaluate(t)||n.evaluate(t)],[ko(Tn),(t,e)=>{for(const n of e)if(n.evaluate(t))return!0;return!1}]]},"!":[Tn,[Tn],(t,[e])=>!e.evaluate(t)],"is-supported-script":[Tn,[fn],(t,[e])=>{const n=t.globals&&t.globals.isSupportedScript;return!n||n(e.evaluate(t))}],upcase:[fn,[fn],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[fn,[fn],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[fn,ko(ot),(t,e)=>e.map(n=>ss(n.evaluate(t))).join("")],"resolved-locale":[fn,[Cn],(t,[e])=>e.evaluate(t).resolvedLocale()]});var Ta=dl;function bc(t){return{result:"success",value:t}}function Hi(t){return{result:"error",value:t}}function Yo(t){return"data-driven"===t["property-type"]}function Is(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function _i(t){return!!t.expression&&t.expression.interpolated}function An(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":null===t?"null":typeof t}function z(t){return"object"==typeof t&&null!==t&&!Array.isArray(t)}function W(t){return t}function U(t,e){const n="color"===e.type,s=t.stops&&"object"==typeof t.stops[0][0],u=s||!(s||void 0!==t.property),f=t.type||(_i(e)?"exponential":"interval");if(n&&((t=wo({},t)).stops&&(t.stops=t.stops.map(C=>[C[0],Wn.parse(C[1])])),t.default=Wn.parse(t.default?t.default:e.default)),t.colorSpace&&"rgb"!==t.colorSpace&&!sl[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let m,v,D;if("exponential"===f)m=rt;else if("interval"===f)m=$e;else if("categorical"===f){m=me,v=Object.create(null);for(const C of t.stops)v[C[0]]=C[1];D=typeof t.stops[0][0]}else{if("identity"!==f)throw new Error(`Unknown function type "${f}"`);m=Yt}if(s){const C={},P=[];for(let $=0;$<t.stops.length;$++){const G=t.stops[$],J=G[0].zoom;void 0===C[J]&&(C[J]={zoom:J,type:t.type,property:t.property,default:t.default,stops:[]},P.push(J)),C[J].stops.push([G[0].value,G[1]])}const F=[];for(const $ of P)F.push([C[$].zoom,U(C[$],e)]);const N={name:"linear"};return{kind:"composite",interpolationType:N,interpolationFactor:Vi.interpolationFactor.bind(void 0,N),zoomStops:F.map($=>$[0]),evaluate:({zoom:$},G)=>rt({stops:F,base:t.base},e,$).evaluate($,G)}}if(u){const C="exponential"===f?{name:"exponential",base:void 0!==t.base?t.base:1}:null;return{kind:"camera",interpolationType:C,interpolationFactor:Vi.interpolationFactor.bind(void 0,C),zoomStops:t.stops.map(P=>P[0]),evaluate:({zoom:P})=>m(t,e,P,v,D)}}return{kind:"source",evaluate(C,P){const F=P&&P.properties?P.properties[t.property]:void 0;return void 0===F?ee(t.default,e.default):m(t,e,F,v,D)}}}function ee(t,e,n){return void 0!==t?t:void 0!==e?e:void 0!==n?n:void 0}function me(t,e,n,s,u){return ee(typeof n===u?s[n]:void 0,t.default,e.default)}function $e(t,e,n){if("number"!==An(n))return ee(t.default,e.default);const s=t.stops.length;if(1===s||n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[s-1][0])return t.stops[s-1][1];const u=ui(t.stops.map(f=>f[0]),n);return t.stops[u][1]}function rt(t,e,n){const s=void 0!==t.base?t.base:1;if("number"!==An(n))return ee(t.default,e.default);const u=t.stops.length;if(1===u||n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[u-1][0])return t.stops[u-1][1];const f=ui(t.stops.map(P=>P[0]),n),m=function(P,F,N,$){const G=$-N,J=P-N;return 0===G?0:1===F?J/G:(Math.pow(F,J)-1)/(Math.pow(F,G)-1)}(n,s,t.stops[f][0],t.stops[f+1][0]),v=t.stops[f][1],D=t.stops[f+1][1];let C=Qs[e.type]||W;if(t.colorSpace&&"rgb"!==t.colorSpace){const P=sl[t.colorSpace];C=(F,N)=>P.reverse(P.interpolate(P.forward(F),P.forward(N),m))}return"function"==typeof v.evaluate?{evaluate(...P){const F=v.evaluate.apply(void 0,P),N=D.evaluate.apply(void 0,P);if(void 0!==F&&void 0!==N)return C(F,N,m)}}:C(v,D,m)}function Yt(t,e,n){return"color"===e.type?n=Wn.parse(n):"formatted"===e.type?n=Gr.fromString(n.toString()):"resolvedImage"===e.type?n=Xn.fromString(n.toString()):An(n)===e.type||"enum"===e.type&&e.values[n]||(n=void 0),ee(n,t.default,e.default)}class Qn{constructor(e,n){var s;this.expression=e,this._warningHistory={},this._evaluator=new Al,this._defaultValue=n?"color"===(s=n).type&&(z(s.default)||Array.isArray(s.default))?new Wn(0,0,0,0):"color"===s.type?Wn.parse(s.default)||null:void 0===s.default?null:s.default:null,this._enumValues=n&&"enum"===n.type?n.values:null}evaluateWithoutErrorHandling(e,n,s,u,f,m,v,D){return this._evaluator.globals=e,this._evaluator.feature=n,this._evaluator.featureState=s,this._evaluator.canonical=u||null,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=m,this._evaluator.featureTileCoord=v||null,this._evaluator.featureDistanceData=D||null,this.expression.evaluate(this._evaluator)}evaluate(e,n,s,u,f,m,v,D){this._evaluator.globals=e,this._evaluator.feature=n||null,this._evaluator.featureState=s||null,this._evaluator.canonical=u||null,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=m||null,this._evaluator.featureTileCoord=v||null,this._evaluator.featureDistanceData=D||null;try{const C=this.expression.evaluate(this._evaluator);if(null==C||"number"==typeof C&&C!=C)return this._defaultValue;if(this._enumValues&&!(C in this._enumValues))throw new ur(`Expected value to be one of ${Object.keys(this._enumValues).map(P=>JSON.stringify(P)).join(", ")}, but found ${JSON.stringify(C)} instead.`);return C}catch(C){return this._warningHistory[C.message]||(this._warningHistory[C.message]=!0,typeof console<"u"&&console.warn(C.message)),this._defaultValue}}}function Hn(t){return Array.isArray(t)&&t.length>0&&"string"==typeof t[0]&&t[0]in Ta}function Zn(t,e){const n=new uo(Ta,[],e?function(u){const f={color:_r,string:fn,number:xt,enum:fn,boolean:Tn,formatted:yr,resolvedImage:Qr};return"array"===u.type?pr(f[u.value]||ot,u.length):f[u.type]}(e):void 0),s=n.parse(t,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return s?bc(new Qn(s,e)):Hi(n.errors)}class In{constructor(e,n){this.kind=e,this._styleExpression=n,this.isStateDependent="constant"!==e&&!Xs(n.expression)}evaluateWithoutErrorHandling(e,n,s,u,f,m){return this._styleExpression.evaluateWithoutErrorHandling(e,n,s,u,f,m)}evaluate(e,n,s,u,f,m){return this._styleExpression.evaluate(e,n,s,u,f,m)}}class jr{constructor(e,n,s,u){this.kind=e,this.zoomStops=s,this._styleExpression=n,this.isStateDependent="camera"!==e&&!Xs(n.expression),this.interpolationType=u}evaluateWithoutErrorHandling(e,n,s,u,f,m){return this._styleExpression.evaluateWithoutErrorHandling(e,n,s,u,f,m)}evaluate(e,n,s,u,f,m){return this._styleExpression.evaluate(e,n,s,u,f,m)}interpolationFactor(e,n,s){return this.interpolationType?Vi.interpolationFactor(this.interpolationType,e,n,s):0}}function cr(t,e){if("error"===(t=Zn(t,e)).result)return t;const n=t.value.expression,s=Ws(n);if(!s&&!Yo(e))return Hi([new Ti("","data expressions not supported")]);const u=Ys(n,["zoom","pitch","distance-from-center"]);if(!u&&!Is(e))return Hi([new Ti("","zoom expressions not supported")]);const f=Do(n);return f||u?f instanceof Ti?Hi([f]):f instanceof Vi&&!_i(e)?Hi([new Ti("",'"interpolate" expressions cannot be used with this property')]):bc(f?new jr(s?"camera":"composite",t.value,f.labels,f instanceof Vi?f.interpolation:void 0):new In(s?"constant":"source",t.value)):Hi([new Ti("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Cr{constructor(e,n){this._parameters=e,this._specification=n,wo(this,U(this._parameters,this._specification))}static deserialize(e){return new Cr(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Do(t){let e=null;if(t instanceof na)e=Do(t.result);else if(t instanceof pt){for(const n of t.args)if(e=Do(n),e)break}else(t instanceof Ea||t instanceof Vi)&&t.input instanceof ws&&"zoom"===t.input.name&&(e=t);return e instanceof Ti||t.eachChild(n=>{const s=Do(n);s instanceof Ti?e=s:!e&&s?e=new Ti("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&s&&e!==s&&(e=new Ti("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}class St{constructor(e,n,s,u){this.message=(e?`${e}: `:"")+s,u&&(this.identifier=u),null!=n&&n.__line__&&(this.line=n.__line__)}}function qr(t){const e=t.key,n=t.value,s=t.valueSpec||{},u=t.objectElementValidators||{},f=t.style,m=t.styleSpec;let v=[];const D=An(n);if("object"!==D)return[new St(e,n,`object expected, ${D} found`)];for(const C in n){const P=C.split(".")[0];let N;u[P]?N=u[P]:s[P]?N=yi:u["*"]?N=u["*"]:s["*"]&&(N=yi),N?v=v.concat(N({key:(e&&`${e}.`)+C,value:n[C],valueSpec:s[P]||s["*"],style:f,styleSpec:m,object:n,objectKey:C},n)):v.push(new St(e,n[C],`unknown property "${C}"`))}for(const C in s)u[C]||s[C].required&&void 0===s[C].default&&void 0===n[C]&&v.push(new St(e,n,`missing required property "${C}"`));return v}function To(t){const e=t.value,n=t.valueSpec,s=t.style,u=t.styleSpec,f=t.key,m=t.arrayElementValidator||yi;if("array"!==An(e))return[new St(f,e,`array expected, ${An(e)} found`)];if(n.length&&e.length!==n.length)return[new St(f,e,`array length ${n.length} expected, length ${e.length} found`)];if(n["min-length"]&&e.length<n["min-length"])return[new St(f,e,`array length at least ${n["min-length"]} expected, length ${e.length} found`)];let v={type:n.value,values:n.values,minimum:n.minimum,maximum:n.maximum,function:void 0};u.$version<7&&(v.function=n.function),"object"===An(n.value)&&(v=n.value);let D=[];for(let C=0;C<e.length;C++)D=D.concat(m({array:e,arrayIndex:C,value:e[C],valueSpec:v,style:s,styleSpec:u,key:`${f}[${C}]`}));return D}function oa(t){const e=t.key,n=t.value,s=t.valueSpec;let u=An(n);if("number"===u&&n!=n&&(u="NaN"),"number"!==u)return[new St(e,n,`number expected, ${u} found`)];if("minimum"in s){let f=s.minimum;if("array"===An(s.minimum)&&(f=s.minimum[t.arrayIndex]),n<f)return[new St(e,n,`${n} is less than the minimum value ${f}`)]}if("maximum"in s){let f=s.maximum;if("array"===An(s.maximum)&&(f=s.maximum[t.arrayIndex]),n>f)return[new St(e,n,`${n} is greater than the maximum value ${f}`)]}return[]}function Ca(t){const e=t.valueSpec,n=$r(t.value.type);let s,u,f,m={};const v="categorical"!==n&&void 0===t.value.property,D=!v,C="array"===An(t.value.stops)&&"array"===An(t.value.stops[0])&&"object"===An(t.value.stops[0][0]),P=qr({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function($){if("identity"===n)return[new St($.key,$.value,'identity function may not have a "stops" property')];let G=[];const J=$.value;return G=G.concat(To({key:$.key,value:J,valueSpec:$.valueSpec,style:$.style,styleSpec:$.styleSpec,arrayElementValidator:F})),"array"===An(J)&&0===J.length&&G.push(new St($.key,J,"array must have at least one stop")),G},default:function($){return yi({key:$.key,value:$.value,valueSpec:e,style:$.style,styleSpec:$.styleSpec})}}});return"identity"===n&&v&&P.push(new St(t.key,t.value,'missing required property "property"')),"identity"===n||t.value.stops||P.push(new St(t.key,t.value,'missing required property "stops"')),"exponential"===n&&t.valueSpec.expression&&!_i(t.valueSpec)&&P.push(new St(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(D&&!Yo(t.valueSpec)?P.push(new St(t.key,t.value,"property functions not supported")):v&&!Is(t.valueSpec)&&P.push(new St(t.key,t.value,"zoom functions not supported"))),"categorical"!==n&&!C||void 0!==t.value.property||P.push(new St(t.key,t.value,'"property" property is required')),P;function F($){let G=[];const J=$.value,ie=$.key;if("array"!==An(J))return[new St(ie,J,`array expected, ${An(J)} found`)];if(2!==J.length)return[new St(ie,J,`array length 2 expected, length ${J.length} found`)];if(C){if("object"!==An(J[0]))return[new St(ie,J,`object expected, ${An(J[0])} found`)];if(void 0===J[0].zoom)return[new St(ie,J,"object stop key must have zoom")];if(void 0===J[0].value)return[new St(ie,J,"object stop key must have value")];const ue=$r(J[0].zoom);if("number"!=typeof ue)return[new St(ie,J[0].zoom,"stop zoom values must be numbers")];if(f&&f>ue)return[new St(ie,J[0].zoom,"stop zoom values must appear in ascending order")];ue!==f&&(f=ue,u=void 0,m={}),G=G.concat(qr({key:`${ie}[0]`,value:J[0],valueSpec:{zoom:{}},style:$.style,styleSpec:$.styleSpec,objectElementValidators:{zoom:oa,value:N}}))}else G=G.concat(N({key:`${ie}[0]`,value:J[0],valueSpec:{},style:$.style,styleSpec:$.styleSpec},J));return Hn(ao(J[1]))?G.concat([new St(`${ie}[1]`,J[1],"expressions are not allowed in function stops.")]):G.concat(yi({key:`${ie}[1]`,value:J[1],valueSpec:e,style:$.style,styleSpec:$.styleSpec}))}function N($,G){const J=An($.value),ie=$r($.value),ue=null!==$.value?$.value:G;if(s){if(J!==s)return[new St($.key,ue,`${J} stop domain type must match previous stop domain type ${s}`)]}else s=J;if("number"!==J&&"string"!==J&&"boolean"!==J&&"number"!=typeof ie&&"string"!=typeof ie&&"boolean"!=typeof ie)return[new St($.key,ue,"stop domain value must be a number, string, or boolean")];if("number"!==J&&"categorical"!==n){let ge=`number expected, ${J} found`;return Yo(e)&&void 0===n&&(ge+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new St($.key,ue,ge)]}return"categorical"!==n||"number"!==J||"number"==typeof ie&&isFinite(ie)&&Math.floor(ie)===ie?"categorical"!==n&&"number"===J&&"number"==typeof ie&&"number"==typeof u&&void 0!==u&&ie<u?[new St($.key,ue,"stop domain values must appear in ascending order")]:(u=ie,"categorical"===n&&ie in m?[new St($.key,ue,"stop domain values must be unique")]:(m[ie]=!0,[])):[new St($.key,ue,`integer expected, found ${String(ie)}`)]}}function Sa(t){const e=("property"===t.expressionContext?cr:Zn)(ao(t.value),t.valueSpec);if("error"===e.result)return e.value.map(s=>new St(`${t.key}${s.key}`,t.value,s.message));const n=e.value.expression||e.value._styleExpression.expression;if("property"===t.expressionContext&&"text-font"===t.propertyKey&&!n.outputDefined())return[new St(t.key,t.value,`Invalid data expression for "${t.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===t.expressionContext&&"layout"===t.propertyType&&!Xs(n))return[new St(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===t.expressionContext)return wu(n,t);if(t.expressionContext&&0===t.expressionContext.indexOf("cluster")){if(!Ys(n,["zoom","feature-state"]))return[new St(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===t.expressionContext&&!Ws(n))return[new St(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function wu(t,e){const n=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(e.valueSpec&&e.valueSpec.expression)for(const u of e.valueSpec.expression.parameters)n.delete(u);if(0===n.size)return[];const s=[];return t instanceof ws&&n.has(t.name)?[new St(e.key,e.value,`["${t.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(t.eachChild(u=>{s.push(...wu(u,e))}),s)}function Ia(t){const e=t.key,n=t.value,s=t.valueSpec,u=[];return Array.isArray(s.values)?-1===s.values.indexOf($r(n))&&u.push(new St(e,n,`expected one of [${s.values.join(", ")}], ${JSON.stringify(n)} found`)):-1===Object.keys(s.values).indexOf($r(n))&&u.push(new St(e,n,`expected one of [${Object.keys(s.values).join(", ")}], ${JSON.stringify(n)} found`)),u}function Ma(t){if(!0===t||!1===t)return!0;if(!Array.isArray(t)||0===t.length)return!1;switch(t[0]){case"has":return t.length>=2&&"$id"!==t[1]&&"$type"!==t[1];case"in":return t.length>=3&&("string"!=typeof t[1]||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==t.length||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(const e of t.slice(1))if(!Ma(e)&&"boolean"!=typeof e)return!1;return!0;default:return!0}}function sa(t,e="fill"){if(null==t)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Ma(t)||(t=aa(t));const n=t;let s=!0;try{s=function(C){if(!Aa(C))return C;let P=ao(C);return fl(P),P=Ii(P),P}(n)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(n,null,2)}\n        `)}const u=Ge[`filter_${e}`],f=Zn(s,u);let m=null;if("error"===f.result)throw new Error(f.value.map(C=>`${C.key}: ${C.message}`).join(", "));m=(C,P,F)=>f.value.evaluate(C,P,{},F);let v=null,D=null;if(s!==n){const C=Zn(n,u);if("error"===C.result)throw new Error(C.value.map(P=>`${P.key}: ${P.message}`).join(", "));v=(P,F,N,$,G)=>C.value.evaluate(P,F,{},N,void 0,void 0,$,G),D=!Ws(C.value.expression)}return{filter:m,dynamicFilter:v||void 0,needGeometry:Pa(s),needFeature:!!D}}function Ii(t){if(!Array.isArray(t))return t;const e=function(n){if(wc.has(n[0]))for(let s=1;s<n.length;s++)if(Aa(n[s]))return!0;return n}(t);return!0===e?e:e.map(n=>Ii(n))}function fl(t){let e=!1;const n=[];if("case"===t[0]){for(let s=1;s<t.length-1;s+=2)e=e||Aa(t[s]),n.push(t[s+1]);n.push(t[t.length-1])}else if("match"===t[0]){e=e||Aa(t[1]);for(let s=2;s<t.length-1;s+=2)n.push(t[s+1]);n.push(t[t.length-1])}else if("step"===t[0]){e=e||Aa(t[1]);for(let s=1;s<t.length-1;s+=2)n.push(t[s+1])}e&&(t.length=0,t.push("any",...n));for(let s=1;s<t.length;s++)fl(t[s])}function Aa(t){if(!Array.isArray(t))return!1;if("pitch"===(e=t[0])||"distance-from-center"===e)return!0;var e;for(let n=1;n<t.length;n++)if(Aa(t[n]))return!0;return!1}const wc=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Eu(t,e){return t<e?-1:t>e?1:0}function Pa(t){if(!Array.isArray(t))return!1;if("within"===t[0])return!0;for(let e=1;e<t.length;e++)if(Pa(t[e]))return!0;return!1}function aa(t){if(!t)return!0;const e=t[0];return t.length<=1?"any"!==e:"=="===e?Ra(t[1],t[2],"=="):"!="===e?Bl(Ra(t[1],t[2],"==")):"<"===e||">"===e||"<="===e||">="===e?Ra(t[1],t[2],e):"any"===e?(n=t.slice(1),["any"].concat(n.map(aa))):"all"===e?["all"].concat(t.slice(1).map(aa)):"none"===e?["all"].concat(t.slice(1).map(aa).map(Bl)):"in"===e?la(t[1],t.slice(2)):"!in"===e?Bl(la(t[1],t.slice(2))):"has"===e?zl(t[1]):"!has"===e?Bl(zl(t[1])):"within"!==e||t;var n}function Ra(t,e,n){switch(t){case"$type":return[`filter-type-${n}`,e];case"$id":return[`filter-id-${n}`,e];default:return[`filter-${n}`,t,e]}}function la(t,e){if(0===e.length)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(n=>typeof n!=typeof e[0])?["filter-in-large",t,["literal",e.sort(Eu)]]:["filter-in-small",t,["literal",e]]}}function zl(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function Bl(t){return["!",t]}function pl(t){return Ma(ao(t.value))?Sa(wo({},t,{expressionContext:"filter",valueSpec:t.styleSpec[`filter_${t.layerType||"fill"}`]})):po(t)}function po(t){const e=t.value,n=t.key;if("array"!==An(e))return[new St(n,e,`array expected, ${An(e)} found`)];const s=t.styleSpec;let u,f=[];if(e.length<1)return[new St(n,e,"filter array must have at least 1 element")];switch(f=f.concat(Ia({key:`${n}[0]`,value:e[0],valueSpec:s.filter_operator,style:t.style,styleSpec:t.styleSpec})),$r(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&"$type"===$r(e[1])&&f.push(new St(n,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":3!==e.length&&f.push(new St(n,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(u=An(e[1]),"string"!==u&&f.push(new St(`${n}[1]`,e[1],`string expected, ${u} found`)));for(let m=2;m<e.length;m++)u=An(e[m]),"$type"===$r(e[1])?f=f.concat(Ia({key:`${n}[${m}]`,value:e[m],valueSpec:s.geometry_type,style:t.style,styleSpec:t.styleSpec})):"string"!==u&&"number"!==u&&"boolean"!==u&&f.push(new St(`${n}[${m}]`,e[m],`string, number, or boolean expected, ${u} found`));break;case"any":case"all":case"none":for(let m=1;m<e.length;m++)f=f.concat(po({key:`${n}[${m}]`,value:e[m],style:t.style,styleSpec:t.styleSpec}));break;case"has":case"!has":u=An(e[1]),2!==e.length?f.push(new St(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):"string"!==u&&f.push(new St(`${n}[1]`,e[1],`string expected, ${u} found`));break;case"within":u=An(e[1]),2!==e.length?f.push(new St(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):"object"!==u&&f.push(new St(`${n}[1]`,e[1],`object expected, ${u} found`))}return f}function ml(t,e){const n=t.key,s=t.style,u=t.styleSpec,f=t.value,m=t.objectKey,v=u[`${e}_${t.layerType}`];if(!v)return[];const D=m.match(/^(.*)-transition$/);if("paint"===e&&D&&v[D[1]]&&v[D[1]].transition)return yi({key:n,value:f,valueSpec:u.transition,style:s,styleSpec:u});const C=t.valueSpec||v[m];if(!C)return[new St(n,f,`unknown property "${m}"`)];let P;if("string"===An(f)&&Yo(C)&&!C.tokens&&(P=/^{([^}]+)}$/.exec(f)))return[new St(n,f,`"${m}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(P[1])} }\`.`)];const F=[];return"symbol"===t.layerType&&("text-field"===m&&s&&!s.glyphs&&F.push(new St(n,f,'use of "text-field" requires a style "glyphs" property')),"text-font"===m&&z(ao(f))&&"identity"===$r(f.type)&&F.push(new St(n,f,'"text-font" does not support identity functions'))),F.concat(yi({key:t.key,value:f,valueSpec:C,style:s,styleSpec:u,expressionContext:"property",propertyType:e,propertyKey:m}))}function La(t){return ml(t,"paint")}function Nl(t){return ml(t,"layout")}function Ul(t){let e=[];const n=t.value,s=t.key,u=t.style,f=t.styleSpec;n.type||n.ref||e.push(new St(s,n,'either "type" or "ref" is required'));let m=$r(n.type);const v=$r(n.ref);if(n.id){const D=$r(n.id);for(let C=0;C<t.arrayIndex;C++){const P=u.layers[C];$r(P.id)===D&&e.push(new St(s,n.id,`duplicate layer id "${n.id}", previously used at line ${P.id.__line__}`))}}if("ref"in n){let D;["type","source","source-layer","filter","layout"].forEach(C=>{C in n&&e.push(new St(s,n[C],`"${C}" is prohibited for ref layers`))}),u.layers.forEach(C=>{$r(C.id)===v&&(D=C)}),D?D.ref?e.push(new St(s,n.ref,"ref cannot reference another ref layer")):m=$r(D.type):"string"==typeof v&&e.push(new St(s,n.ref,`ref layer "${v}" not found`))}else if("background"!==m&&"sky"!==m)if(n.source){const D=u.sources&&u.sources[n.source],C=D&&$r(D.type);D?"vector"===C&&"raster"===m?e.push(new St(s,n.source,`layer "${n.id}" requires a raster source`)):"raster"===C&&"raster"!==m?e.push(new St(s,n.source,`layer "${n.id}" requires a vector source`)):"vector"!==C||n["source-layer"]?"raster-dem"===C&&"hillshade"!==m?e.push(new St(s,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==m||!n.paint||!n.paint["line-gradient"]&&!n.paint["line-trim-offset"]||"geojson"===C&&D.lineMetrics||e.push(new St(s,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new St(s,n,`layer "${n.id}" must specify a "source-layer"`)):e.push(new St(s,n.source,`source "${n.source}" not found`))}else e.push(new St(s,n,'missing required property "source"'));return e=e.concat(qr({key:s,value:n,valueSpec:f.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":()=>[],type:()=>yi({key:`${s}.type`,value:n.type,valueSpec:f.layer.type,style:t.style,styleSpec:t.styleSpec,object:n,objectKey:"type"}),filter:D=>pl(wo({layerType:m},D)),layout:D=>qr({layer:n,key:D.key,value:D.value,valueSpec:{},style:D.style,styleSpec:D.styleSpec,objectElementValidators:{"*":C=>Nl(wo({layerType:m},C))}}),paint:D=>qr({layer:n,key:D.key,value:D.value,valueSpec:{},style:D.style,styleSpec:D.styleSpec,objectElementValidators:{"*":C=>La(wo({layerType:m},C))}})}})),e}function Ko(t){const e=t.value,n=t.key,s=An(e);return"string"!==s?[new St(n,e,`string expected, ${s} found`)]:[]}const jl={promoteId:function({key:t,value:e}){if("string"===An(e))return Ko({key:t,value:e});{const n=[];for(const s in e)n.push(...Ko({key:`${t}.${s}`,value:e[s]}));return n}}};function Du(t){const e=t.value,n=t.key,s=t.styleSpec,u=t.style;if(!e.type)return[new St(n,e,'"type" is required')];const f=$r(e.type);let m;switch(f){case"vector":case"raster":case"raster-dem":return m=qr({key:n,value:e,valueSpec:s[`source_${f.replace("-","_")}`],style:t.style,styleSpec:s,objectElementValidators:jl}),m;case"geojson":if(m=qr({key:n,value:e,valueSpec:s.source_geojson,style:u,styleSpec:s,objectElementValidators:jl}),e.cluster)for(const v in e.clusterProperties){const[D,C]=e.clusterProperties[v],P="string"==typeof D?[D,["accumulated"],["get",v]]:D;m.push(...Sa({key:`${n}.${v}.map`,value:C,expressionContext:"cluster-map"})),m.push(...Sa({key:`${n}.${v}.reduce`,value:P,expressionContext:"cluster-reduce"}))}return m;case"video":return qr({key:n,value:e,valueSpec:s.source_video,style:u,styleSpec:s});case"image":return qr({key:n,value:e,valueSpec:s.source_image,style:u,styleSpec:s});case"canvas":return[new St(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ia({key:`${n}.type`,value:e.type,valueSpec:{values:Uc(s)},style:u,styleSpec:s})}}function Uc(t){return t.source.reduce((e,n)=>{const s=t[n];return"enum"===s.type.type&&(e=e.concat(Object.keys(s.type.values))),e},[])}function gl(t){const e=t.value,n=t.styleSpec,s=n.light,u=t.style;let f=[];const m=An(e);if(void 0===e)return f;if("object"!==m)return f=f.concat([new St("light",e,`object expected, ${m} found`)]),f;for(const v in e){const D=v.match(/^(.*)-transition$/);f=f.concat(D&&s[D[1]]&&s[D[1]].transition?yi({key:v,value:e[v],valueSpec:n.transition,style:u,styleSpec:n}):s[v]?yi({key:v,value:e[v],valueSpec:s[v],style:u,styleSpec:n}):[new St(v,e[v],`unknown property "${v}"`)])}return f}function Vl(t){const e=t.value,n=t.key,s=t.style,u=t.styleSpec,f=u.terrain;let m=[];const v=An(e);if(void 0===e)return m;if("object"!==v)return m=m.concat([new St("terrain",e,`object expected, ${v} found`)]),m;for(const D in e){const C=D.match(/^(.*)-transition$/);m=m.concat(C&&f[C[1]]&&f[C[1]].transition?yi({key:D,value:e[D],valueSpec:u.transition,style:s,styleSpec:u}):f[D]?yi({key:D,value:e[D],valueSpec:f[D],style:s,styleSpec:u}):[new St(D,e[D],`unknown property "${D}"`)])}if(e.source){const D=s.sources&&s.sources[e.source],C=D&&$r(D.type);D?"raster-dem"!==C&&m.push(new St(n,e.source,`terrain cannot be used with a source of type ${String(C)}, it only be used with a "raster-dem" source type`)):m.push(new St(n,e.source,`source "${e.source}" not found`))}else m.push(new St(n,e,'terrain is missing required property "source"'));return m}function jc(t){const e=t.value,n=t.style,s=t.styleSpec,u=s.fog;let f=[];const m=An(e);if(void 0===e)return f;if("object"!==m)return f=f.concat([new St("fog",e,`object expected, ${m} found`)]),f;for(const v in e){const D=v.match(/^(.*)-transition$/);f=f.concat(D&&u[D[1]]&&u[D[1]].transition?yi({key:v,value:e[v],valueSpec:s.transition,style:n,styleSpec:s}):u[v]?yi({key:v,value:e[v],valueSpec:u[v],style:n,styleSpec:s}):[new St(v,e[v],`unknown property "${v}"`)])}return f}const Vc={"*":()=>[],array:To,boolean:function(t){const e=t.value,n=t.key,s=An(e);return"boolean"!==s?[new St(n,e,`boolean expected, ${s} found`)]:[]},number:oa,color:function(t){const e=t.key,n=t.value,s=An(n);return"string"!==s?[new St(e,n,`color expected, ${s} found`)]:null===bn(n)?[new St(e,n,`color expected, "${n}" found`)]:[]},enum:Ia,filter:pl,function:Ca,layer:Ul,object:qr,source:Du,light:gl,terrain:Vl,fog:jc,string:Ko,formatted:function(t){return 0===Ko(t).length?[]:Sa(t)},resolvedImage:function(t){return 0===Ko(t).length?[]:Sa(t)},projection:function(t){const e=t.value,n=t.styleSpec,s=n.projection,u=t.style;let f=[];const m=An(e);if("object"===m)for(const v in e)f=f.concat(yi({key:v,value:e[v],valueSpec:s[v],style:u,styleSpec:n}));else"string"!==m&&(f=f.concat([new St("projection",e,`object or string expected, ${m} found`)]));return f}};function yi(t){const e=t.value,n=t.valueSpec,s=t.styleSpec;return n.expression&&z($r(e))?Ca(t):n.expression&&Hn(ao(e))?Sa(t):n.type&&Vc[n.type]?Vc[n.type](t):qr(wo({},t,{valueSpec:n.type?s[n.type]:n}))}function ka(t){const e=t.value,n=t.key,s=Ko(t);return s.length||(-1===e.indexOf("{fontstack}")&&s.push(new St(n,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&s.push(new St(n,e,'"glyphs" url must include a "{range}" token'))),s}function $c(t,e=Ge){return go(yi({key:"",value:t,valueSpec:e.$root,styleSpec:e,style:t,objectElementValidators:{glyphs:ka,"*":()=>[]}}))}const Tu=t=>go(La(t)),mo=t=>go(Nl(t));function go(t){return t.slice().sort((e,n)=>e.line&&n.line?e.line-n.line:0)}function $l(t,e){let n=!1;if(e&&e.length)for(const s of e)t.fire(new os(new Error(s.message))),n=!0;return n}var ca=Oo;function Oo(t,e,n){var s=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var u=new Int32Array(this.arrayBuffer);t=u[0],this.d=(e=u[1])+2*(n=u[2]);for(var f=0;f<this.d*this.d;f++){var m=u[3+f],v=u[3+f+1];s.push(m===v?null:u.subarray(m,v))}var D=u[3+s.length+1];this.keys=u.subarray(u[3+s.length],D),this.bboxes=u.subarray(D),this.insert=this._insertReadonly}else{this.d=e+2*n;for(var C=0;C<this.d*this.d;C++)s.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=n,this.scale=e/t,this.uid=0;var P=n/e*t;this.min=-P,this.max=t+P}Oo.prototype.insert=function(t,e,n,s,u){this._forEachCell(e,n,s,u,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(n),this.bboxes.push(s),this.bboxes.push(u)},Oo.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Oo.prototype._insertCell=function(t,e,n,s,u,f){this.cells[u].push(f)},Oo.prototype.query=function(t,e,n,s,u){var f=this.min,m=this.max;if(t<=f&&e<=f&&m<=n&&m<=s&&!u)return Array.prototype.slice.call(this.keys);var v=[];return this._forEachCell(t,e,n,s,this._queryCell,v,{},u),v},Oo.prototype._queryCell=function(t,e,n,s,u,f,m,v){var D=this.cells[u];if(null!==D)for(var C=this.keys,P=this.bboxes,F=0;F<D.length;F++){var N=D[F];if(void 0===m[N]){var $=4*N;(v?v(P[$+0],P[$+1],P[$+2],P[$+3]):t<=P[$+2]&&e<=P[$+3]&&n>=P[$+0]&&s>=P[$+1])?(m[N]=!0,f.push(C[N])):m[N]=!1}}},Oo.prototype._forEachCell=function(t,e,n,s,u,f,m,v){for(var D=this._convertToCellCoord(t),C=this._convertToCellCoord(e),P=this._convertToCellCoord(n),F=this._convertToCellCoord(s),N=D;N<=P;N++)for(var $=C;$<=F;$++){var G=this.d*$+N;if((!v||v(this._convertFromCellCoord(N),this._convertFromCellCoord($),this._convertFromCellCoord(N+1),this._convertFromCellCoord($+1)))&&u.call(this,t,e,n,s,G,f,m,v))return}},Oo.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},Oo.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},Oo.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=3+this.cells.length+1+1,n=0,s=0;s<this.cells.length;s++)n+=this.cells[s].length;var u=new Int32Array(e+n+this.keys.length+this.bboxes.length);u[0]=this.extent,u[1]=this.n,u[2]=this.padding;for(var f=e,m=0;m<t.length;m++){var v=t[m];u[3+m]=f,u.set(v,f),f+=v.length}return u[3+t.length]=f,u.set(this.keys,f),u[3+t.length+1]=f+=this.keys.length,u.set(this.bboxes,f),f+=this.bboxes.length,u.buffer};const Gl={};function Ot(t,e,n={}){Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),Gl[e]={klass:t,omit:n.omit||[]}}Ot(Object,"Object"),ca.serialize=function(t,e){const n=t.toArrayBuffer();return e&&e.push(n),{buffer:n}},ca.deserialize=function(t){return new ca(t.buffer)},Object.defineProperty(ca,"name",{value:"Grid"}),Ot(ca,"Grid"),Ot(Wn,"Color"),Ot(Error,"Error"),Ot(Et,"AJAXError"),Ot(Xn,"ResolvedImage"),Ot(Cr,"StylePropertyFunction"),Ot(Qn,"StyleExpression",{omit:["_evaluator"]}),Ot(jr,"ZoomDependentExpression"),Ot(In,"ZoomConstantExpression"),Ot(ws,"CompoundExpression",{omit:["_evaluate"]});for(const t in Ta)Gl[Ta[t]._classRegistryKey]||Ot(Ta[t],`Expression${t}`);function Gc(t){return t&&typeof ArrayBuffer<"u"&&(t instanceof ArrayBuffer||t.constructor&&"ArrayBuffer"===t.constructor.name)}function Oa(t){return Ee.ImageBitmap&&t instanceof Ee.ImageBitmap}function Ki(t,e){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(Gc(t)||Oa(t))return e&&e.push(t),t;if(ArrayBuffer.isView(t)){const n=t;return e&&e.push(n.buffer),n}if(t instanceof Ee.ImageData)return e&&e.push(t.data.buffer),t;if(Array.isArray(t)){const n=[];for(const s of t)n.push(Ki(s,e));return n}if("object"==typeof t){const n=t.constructor,s=n._classRegistryKey;if(!s)throw new Error(`can't serialize object of unregistered class ${s}`);const u=n.serialize?n.serialize(t,e):{};if(!n.serialize){for(const f in t)t.hasOwnProperty(f)&&(Gl[s].omit.indexOf(f)>=0||(u[f]=Ki(t[f],e)));t instanceof Error&&(u.message=t.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==s&&(u.$name=s),u}throw new Error("can't serialize object of type "+typeof t)}function Jo(t){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||Gc(t)||Oa(t)||ArrayBuffer.isView(t)||t instanceof Ee.ImageData)return t;if(Array.isArray(t))return t.map(Jo);if("object"==typeof t){const e=t.$name||"Object",{klass:n}=Gl[e];if(!n)throw new Error(`can't deserialize unregistered class ${e}`);if(n.deserialize)return n.deserialize(t);const s=Object.create(n.prototype);for(const u of Object.keys(t))"$name"!==u&&(s[u]=Jo(t[u]));return s}throw new Error("can't deserialize object of type "+typeof t)}const Ms=t=>t>=1536&&t<=1791,Hc=t=>t>=1872&&t<=1919,As=t=>t>=2208&&t<=2303,ua=t=>t>=11904&&t<=12031,Hl=t=>t>=12032&&t<=12255,Sr=t=>t>=12272&&t<=12287,Ec=t=>t>=12288&&t<=12351,Zc=t=>t>=12352&&t<=12447,Dc=t=>t>=12448&&t<=12543,Cu=t=>t>=12544&&t<=12591,Tc=t=>t>=12704&&t<=12735,mh=t=>t>=12736&&t<=12783,gh=t=>t>=12784&&t<=12799,_l=t=>t>=12800&&t<=13055,Su=t=>t>=13056&&t<=13311,_h=t=>t>=13312&&t<=19903,di=t=>t>=19968&&t<=40959,qc=t=>t>=40960&&t<=42127,gs=t=>t>=42128&&t<=42191,Iu=t=>t>=44032&&t<=55215,Oi=t=>t>=63744&&t<=64255,h=t=>t>=64336&&t<=65023,r=t=>t>=65040&&t<=65055,l=t=>t>=65072&&t<=65103,p=t=>t>=65104&&t<=65135,_=t=>t>=65136&&t<=65279,b=t=>t>=65280&&t<=65519;function S(t){for(const e of t)if(V(e.charCodeAt(0)))return!0;return!1}function A(t){for(const e of t)if(!R(e.charCodeAt(0)))return!1;return!0}function R(t){return!(Ms(t)||Hc(t)||As(t)||h(t)||_(t))}function V(t){return!(746!==t&&747!==t&&(t<4352||!(Tc(t)||Cu(t)||l(t)&&!(t>=65097&&t<=65103)||Oi(t)||Su(t)||ua(t)||mh(t)||!(!Ec(t)||t>=12296&&t<=12305||t>=12308&&t<=12319||12336===t)||_h(t)||di(t)||_l(t)||(e=t,e>=12592&&e<=12687)||(e=>e>=43360&&e<=43391)(t)||(e=>e>=55216&&e<=55295)(t)||(e=>e>=4352&&e<=4607)(t)||Iu(t)||Zc(t)||Sr(t)||(e=>e>=12688&&e<=12703)(t)||Hl(t)||gh(t)||Dc(t)&&12540!==t||!(!b(t)||65288===t||65289===t||65293===t||t>=65306&&t<=65310||65339===t||65341===t||65343===t||t>=65371&&t<=65503||65507===t||t>=65512&&t<=65519)||!(!p(t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||(e=>e>=5120&&e<=5759)(t)||(e=>e>=6320&&e<=6399)(t)||r(t)||(e=>e>=19904&&e<=19967)(t)||qc(t)||gs(t))));var e}function j(t){return!(V(t)||(e=t,(n=e)>=128&&n<=255&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||(n=>n>=8192&&n<=8303)(e)&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||(n=>n>=8448&&n<=8527)(e)||(n=>n>=8528&&n<=8591)(e)||(n=>n>=8960&&n<=9215)(e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||9003===e||e>=9085&&e<=9114||e>=9150&&e<=9165||9167===e||e>=9169&&e<=9179||e>=9186&&e<=9215)||(n=>n>=9216&&n<=9279)(e)&&9251!==e||(n=>n>=9280&&n<=9311)(e)||(n=>n>=9312&&n<=9471)(e)||(n=>n>=9632&&n<=9727)(e)||(n=>n>=9728&&n<=9983)(e)&&!(e>=9754&&e<=9759)||(n=>n>=11008&&n<=11263)(e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Ec(e)||Dc(e)||(n=>n>=57344&&n<=63743)(e)||l(e)||p(e)||b(e)||8734===e||8756===e||8757===e||e>=9984&&e<=10087||e>=10102&&e<=10131||65532===e||65533===e));var e,n}function y(t){return t>=1424&&t<=2303||h(t)||_(t)}function E(t,e){return!(!e&&y(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||(n=t,n>=6016&&n<=6143));var n}function x(t){for(const e of t)if(y(e.charCodeAt(0)))return!0;return!1}const T="deferred",M="loading",L="loaded";let O=null,Z="unavailable",Y=null;const oe=function(t){t&&"string"==typeof t&&t.indexOf("NetworkError")>-1&&(Z="error"),O&&O(t)};function se(){he.fire(new mi("pluginStateChange",{pluginStatus:Z,pluginURL:Y}))}const he=new Di,be=function(){return Z},Le=function(){if(Z!==T||!Y)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Z=M,se(),Y&&$n({url:Y},t=>{t?oe(t):(Z=L,se())})},Pe={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Z===L||null!=Pe.applyArabicShaping,isLoading:()=>Z===M,setState(t){Z=t.pluginStatus,Y=t.pluginURL},isParsed:()=>null!=Pe.applyArabicShaping&&null!=Pe.processBidirectionalText&&null!=Pe.processStyledBidirectionalText,getPluginURL:()=>Y};class Te{constructor(e,n){this.zoom=e,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.transition=n.transition,this.pitch=n.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(e){return function(n,s){for(const u of n)if(!E(u.charCodeAt(0),s))return!1;return!0}(e,Pe.isLoaded())}}class et{constructor(e,n){this.property=e,this.value=n,this.expression=function(s,u){if(z(s))return new Cr(s,u);if(Hn(s)){const f=cr(s,u);if("error"===f.result)throw new Error(f.value.map(m=>`${m.key}: ${m.message}`).join(", "));return f.value}{let f=s;return"string"==typeof s&&"color"===u.type&&(f=Wn.parse(s)),{kind:"constant",evaluate:()=>f}}}(void 0===n?e.specification.default:n,e.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(e,n,s){return this.property.possiblyEvaluate(this,e,n,s)}}class Re{constructor(e){this.property=e,this.value=new et(e,void 0)}transitioned(e,n){return new ze(this.property,this.value,n,Ue({},e.transition,this.transition),e.now)}untransitioned(){return new ze(this.property,this.value,null,{},0)}}class He{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return Ln(this._values[e].value.value)}setValue(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new Re(this._values[e].property)),this._values[e].value=new et(this._values[e].property,null===n?void 0:Ln(n))}getTransition(e){return Ln(this._values[e].transition)}setTransition(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new Re(this._values[e].property)),this._values[e].transition=Ln(n)||void 0}serialize(){const e={};for(const n of Object.keys(this._values)){const s=this.getValue(n);void 0!==s&&(e[n]=s);const u=this.getTransition(n);void 0!==u&&(e[`${n}-transition`]=u)}return e}transitioned(e,n){const s=new ct(this._properties);for(const u of Object.keys(this._values))s._values[u]=this._values[u].transitioned(e,n._values[u]);return s}untransitioned(){const e=new ct(this._properties);for(const n of Object.keys(this._values))e._values[n]=this._values[n].untransitioned();return e}}class ze{constructor(e,n,s,u,f){const m=u.delay||0,v=u.duration||0;f=f||0,this.property=e,this.value=n,this.begin=f+m,this.end=this.begin+v,e.specification.transition&&(u.delay||u.duration)&&(this.prior=s)}possiblyEvaluate(e,n,s){const u=e.now||0,f=this.value.possiblyEvaluate(e,n,s),m=this.prior;if(m){if(u>this.end)return this.prior=null,f;if(this.value.isDataDriven())return this.prior=null,f;if(u<this.begin)return m.possiblyEvaluate(e,n,s);{const v=(u-this.begin)/(this.end-this.begin);return this.property.interpolate(m.possiblyEvaluate(e,n,s),f,ut(v))}}return f}}class ct{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,n,s){const u=new vt(this._properties);for(const f of Object.keys(this._values))u._values[f]=this._values[f].possiblyEvaluate(e,n,s);return u}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Ne{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return Ln(this._values[e].value)}setValue(e,n){this._values[e]=new et(this._values[e].property,null===n?void 0:Ln(n))}serialize(){const e={};for(const n of Object.keys(this._values)){const s=this.getValue(n);void 0!==s&&(e[n]=s)}return e}possiblyEvaluate(e,n,s){const u=new vt(this._properties);for(const f of Object.keys(this._values))u._values[f]=this._values[f].possiblyEvaluate(e,n,s);return u}}class Ke{constructor(e,n,s){this.property=e,this.value=n,this.parameters=s}isConstant(){return"constant"===this.value.kind}constantOr(e){return"constant"===this.value.kind?this.value.value:e}evaluate(e,n,s,u){return this.property.evaluate(this.value,this.parameters,e,n,s,u)}}class vt{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Ae{constructor(e){this.specification=e}possiblyEvaluate(e,n){return e.expression.evaluate(n)}interpolate(e,n,s){const u=Qs[this.specification.type];return u?u(e,n,s):e}}class Be{constructor(e,n){this.specification=e,this.overrides=n}possiblyEvaluate(e,n,s,u){return new Ke(this,"constant"===e.expression.kind||"camera"===e.expression.kind?{kind:"constant",value:e.expression.evaluate(n,null,{},s,u)}:e.expression,n)}interpolate(e,n,s){if("constant"!==e.value.kind||"constant"!==n.value.kind)return e;if(void 0===e.value.value||void 0===n.value.value)return new Ke(this,{kind:"constant",value:void 0},e.parameters);const u=Qs[this.specification.type];return u?new Ke(this,{kind:"constant",value:u(e.value.value,n.value.value,s)},e.parameters):e}evaluate(e,n,s,u,f,m){return"constant"===e.kind?e.value:e.evaluate(n,s,u,f,m)}}class Zt{constructor(e){this.specification=e}possiblyEvaluate(e,n,s,u){return!!e.expression.evaluate(n,null,{},s,u)}interpolate(){return!1}}class an{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const n=new Te(0,{});for(const s in e){const u=e[s];u.specification.overridable&&this.overridableProperties.push(s);const f=this.defaultPropertyValues[s]=new et(u,void 0),m=this.defaultTransitionablePropertyValues[s]=new Re(u);this.defaultTransitioningPropertyValues[s]=m.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=f.possiblyEvaluate(n)}}}function qt(t,e){return 256*(t=tt(Math.floor(t),0,255))+tt(Math.floor(e),0,255)}Ot(Be,"DataDrivenProperty"),Ot(Ae,"DataConstantProperty"),Ot(Zt,"ColorRampProperty");const mn={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Pn{constructor(e,n){this._structArray=e,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class tn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,n){return e._trim(),n&&(e.isTransferred=!0,n.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const n=Object.create(this.prototype);return n.arrayBuffer=e.arrayBuffer,n.length=e.length,n.capacity=e.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Ft(t,e=1){let n=0,s=0;return{members:t.map(u=>{const f=mn[u.type].BYTES_PER_ELEMENT,m=n=vr(n,Math.max(e,f)),v=u.components||1;return s=Math.max(s,f),n+=f*v,{name:u.name,type:u.type,components:v,offset:m}}),size:vr(n,Math.max(s,e)),alignment:e}}function vr(t,e){return Math.ceil(t/e)*e}class hr extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n){const s=this.length;return this.resize(s+1),this.emplace(s,e,n)}emplace(e,n,s){const u=2*e;return this.int16[u+0]=n,this.int16[u+1]=s,e}}hr.prototype.bytesPerElement=4,Ot(hr,"StructArrayLayout2i4");class Mr extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s){const u=this.length;return this.resize(u+1),this.emplace(u,e,n,s)}emplace(e,n,s,u){const f=3*e;return this.int16[f+0]=n,this.int16[f+1]=s,this.int16[f+2]=u,e}}Mr.prototype.bytesPerElement=6,Ot(Mr,"StructArrayLayout3i6");class xr extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,n,s,u)}emplace(e,n,s,u,f){const m=4*e;return this.int16[m+0]=n,this.int16[m+1]=s,this.int16[m+2]=u,this.int16[m+3]=f,e}}xr.prototype.bytesPerElement=8,Ot(xr,"StructArrayLayout4i8");class Qo extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,u,f,m,v){const D=this.length;return this.resize(D+1),this.emplace(D,e,n,s,u,f,m,v)}emplace(e,n,s,u,f,m,v,D){const C=6*e,P=12*e,F=3*e;return this.int16[C+0]=n,this.int16[C+1]=s,this.uint8[P+4]=u,this.uint8[P+5]=f,this.uint8[P+6]=m,this.uint8[P+7]=v,this.float32[F+2]=D,e}}Qo.prototype.bytesPerElement=12,Ot(Qo,"StructArrayLayout2i4ub1f12");class es extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,n,s,u)}emplace(e,n,s,u,f){const m=4*e;return this.float32[m+0]=n,this.float32[m+1]=s,this.float32[m+2]=u,this.float32[m+3]=f,e}}es.prototype.bytesPerElement=16,Ot(es,"StructArrayLayout4f16");class Co extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,u,f){const m=this.length;return this.resize(m+1),this.emplace(m,e,n,s,u,f)}emplace(e,n,s,u,f,m){const v=6*e,D=3*e;return this.uint16[v+0]=n,this.uint16[v+1]=s,this.uint16[v+2]=u,this.uint16[v+3]=f,this.float32[D+2]=m,e}}Co.prototype.bytesPerElement=12,Ot(Co,"StructArrayLayout4ui1f12");class _s extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,s,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,n,s,u)}emplace(e,n,s,u,f){const m=4*e;return this.uint16[m+0]=n,this.uint16[m+1]=s,this.uint16[m+2]=u,this.uint16[m+3]=f,e}}_s.prototype.bytesPerElement=8,Ot(_s,"StructArrayLayout4ui8");class Or extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s,u,f,m){const v=this.length;return this.resize(v+1),this.emplace(v,e,n,s,u,f,m)}emplace(e,n,s,u,f,m,v){const D=6*e;return this.int16[D+0]=n,this.int16[D+1]=s,this.int16[D+2]=u,this.int16[D+3]=f,this.int16[D+4]=m,this.int16[D+5]=v,e}}Or.prototype.bytesPerElement=12,Ot(Or,"StructArrayLayout6i12");class Ar extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,s,u,f,m,v,D,C,P,F,N){const $=this.length;return this.resize($+1),this.emplace($,e,n,s,u,f,m,v,D,C,P,F,N)}emplace(e,n,s,u,f,m,v,D,C,P,F,N,$){const G=12*e;return this.int16[G+0]=n,this.int16[G+1]=s,this.int16[G+2]=u,this.int16[G+3]=f,this.uint16[G+4]=m,this.uint16[G+5]=v,this.uint16[G+6]=D,this.uint16[G+7]=C,this.int16[G+8]=P,this.int16[G+9]=F,this.int16[G+10]=N,this.int16[G+11]=$,e}}Ar.prototype.bytesPerElement=24,Ot(Ar,"StructArrayLayout4i4ui4i24");class ir extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,u,f,m){const v=this.length;return this.resize(v+1),this.emplace(v,e,n,s,u,f,m)}emplace(e,n,s,u,f,m,v){const D=10*e,C=5*e;return this.int16[D+0]=n,this.int16[D+1]=s,this.int16[D+2]=u,this.float32[C+2]=f,this.float32[C+3]=m,this.float32[C+4]=v,e}}ir.prototype.bytesPerElement=20,Ot(ir,"StructArrayLayout3i3f20");class vi extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint32[1*e+0]=n,e}}vi.prototype.bytesPerElement=4,Ot(vi,"StructArrayLayout1ul4");class So extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,s,u,f,m,v,D,C,P,F,N,$){const G=this.length;return this.resize(G+1),this.emplace(G,e,n,s,u,f,m,v,D,C,P,F,N,$)}emplace(e,n,s,u,f,m,v,D,C,P,F,N,$,G){const J=20*e,ie=10*e;return this.int16[J+0]=n,this.int16[J+1]=s,this.int16[J+2]=u,this.int16[J+3]=f,this.int16[J+4]=m,this.float32[ie+3]=v,this.float32[ie+4]=D,this.float32[ie+5]=C,this.float32[ie+6]=P,this.int16[J+14]=F,this.uint32[ie+8]=N,this.uint16[J+18]=$,this.uint16[J+19]=G,e}}So.prototype.bytesPerElement=40,Ot(So,"StructArrayLayout5i4f1i1ul2ui40");class Lr extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s,u,f,m,v){const D=this.length;return this.resize(D+1),this.emplace(D,e,n,s,u,f,m,v)}emplace(e,n,s,u,f,m,v,D){const C=8*e;return this.int16[C+0]=n,this.int16[C+1]=s,this.int16[C+2]=u,this.int16[C+4]=f,this.int16[C+5]=m,this.int16[C+6]=v,this.int16[C+7]=D,e}}Lr.prototype.bytesPerElement=16,Ot(Lr,"StructArrayLayout3i2i2i16");class Fo extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s,u,f){const m=this.length;return this.resize(m+1),this.emplace(m,e,n,s,u,f)}emplace(e,n,s,u,f,m){const v=4*e,D=8*e;return this.float32[v+0]=n,this.float32[v+1]=s,this.float32[v+2]=u,this.int16[D+6]=f,this.int16[D+7]=m,e}}Fo.prototype.bytesPerElement=16,Ot(Fo,"StructArrayLayout2f1f2i16");class Mu extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,n,s,u)}emplace(e,n,s,u,f){const m=12*e,v=3*e;return this.uint8[m+0]=n,this.uint8[m+1]=s,this.float32[v+1]=u,this.float32[v+2]=f,e}}Mu.prototype.bytesPerElement=12,Ot(Mu,"StructArrayLayout2ub2f12");class Fa extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s){const u=this.length;return this.resize(u+1),this.emplace(u,e,n,s)}emplace(e,n,s,u){const f=3*e;return this.float32[f+0]=n,this.float32[f+1]=s,this.float32[f+2]=u,e}}Fa.prototype.bytesPerElement=12,Ot(Fa,"StructArrayLayout3f12");class Ji extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,s){const u=this.length;return this.resize(u+1),this.emplace(u,e,n,s)}emplace(e,n,s,u){const f=3*e;return this.uint16[f+0]=n,this.uint16[f+1]=s,this.uint16[f+2]=u,e}}Ji.prototype.bytesPerElement=6,Ot(Ji,"StructArrayLayout3ui6");class zo extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,s,u,f,m,v,D,C,P,F,N,$,G,J,ie,ue,ge,ce,pe,_e){const ye=this.length;return this.resize(ye+1),this.emplace(ye,e,n,s,u,f,m,v,D,C,P,F,N,$,G,J,ie,ue,ge,ce,pe,_e)}emplace(e,n,s,u,f,m,v,D,C,P,F,N,$,G,J,ie,ue,ge,ce,pe,_e,ye){const Oe=30*e,ke=15*e,Ze=60*e;return this.int16[Oe+0]=n,this.int16[Oe+1]=s,this.int16[Oe+2]=u,this.float32[ke+2]=f,this.float32[ke+3]=m,this.uint16[Oe+8]=v,this.uint16[Oe+9]=D,this.uint32[ke+5]=C,this.uint32[ke+6]=P,this.uint32[ke+7]=F,this.uint16[Oe+16]=N,this.uint16[Oe+17]=$,this.uint16[Oe+18]=G,this.float32[ke+10]=J,this.float32[ke+11]=ie,this.uint8[Ze+48]=ue,this.uint8[Ze+49]=ge,this.uint8[Ze+50]=ce,this.uint32[ke+13]=pe,this.int16[Oe+28]=_e,this.uint8[Ze+58]=ye,e}}zo.prototype.bytesPerElement=60,Ot(zo,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Ps extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,s,u,f,m,v,D,C,P,F,N,$,G,J,ie,ue,ge,ce,pe,_e,ye,Oe,ke,Ze,dt,je,Xe,Ye,st){const ft=this.length;return this.resize(ft+1),this.emplace(ft,e,n,s,u,f,m,v,D,C,P,F,N,$,G,J,ie,ue,ge,ce,pe,_e,ye,Oe,ke,Ze,dt,je,Xe,Ye,st)}emplace(e,n,s,u,f,m,v,D,C,P,F,N,$,G,J,ie,ue,ge,ce,pe,_e,ye,Oe,ke,Ze,dt,je,Xe,Ye,st,ft){const Ve=38*e,It=19*e;return this.int16[Ve+0]=n,this.int16[Ve+1]=s,this.int16[Ve+2]=u,this.float32[It+2]=f,this.float32[It+3]=m,this.int16[Ve+8]=v,this.int16[Ve+9]=D,this.int16[Ve+10]=C,this.int16[Ve+11]=P,this.int16[Ve+12]=F,this.int16[Ve+13]=N,this.uint16[Ve+14]=$,this.uint16[Ve+15]=G,this.uint16[Ve+16]=J,this.uint16[Ve+17]=ie,this.uint16[Ve+18]=ue,this.uint16[Ve+19]=ge,this.uint16[Ve+20]=ce,this.uint16[Ve+21]=pe,this.uint16[Ve+22]=_e,this.uint16[Ve+23]=ye,this.uint16[Ve+24]=Oe,this.uint16[Ve+25]=ke,this.uint16[Ve+26]=Ze,this.uint16[Ve+27]=dt,this.uint16[Ve+28]=je,this.uint32[It+15]=Xe,this.float32[It+16]=Ye,this.float32[It+17]=st,this.float32[It+18]=ft,e}}Ps.prototype.bytesPerElement=76,Ot(Ps,"StructArrayLayout3i2f6i15ui1ul3f76");class Rs extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.float32[1*e+0]=n,e}}Rs.prototype.bytesPerElement=4,Ot(Rs,"StructArrayLayout1f4");class Cc extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,u,f){const m=this.length;return this.resize(m+1),this.emplace(m,e,n,s,u,f)}emplace(e,n,s,u,f,m){const v=5*e;return this.float32[v+0]=n,this.float32[v+1]=s,this.float32[v+2]=u,this.float32[v+3]=f,this.float32[v+4]=m,e}}Cc.prototype.bytesPerElement=20,Ot(Cc,"StructArrayLayout5f20");class Io extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,s,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,n,s,u)}emplace(e,n,s,u,f){const m=6*e;return this.uint32[3*e+0]=n,this.uint16[m+2]=s,this.uint16[m+3]=u,this.uint16[m+4]=f,e}}Io.prototype.bytesPerElement=12,Ot(Io,"StructArrayLayout1ul3ui12");class ha extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n){const s=this.length;return this.resize(s+1),this.emplace(s,e,n)}emplace(e,n,s){const u=2*e;return this.uint16[u+0]=n,this.uint16[u+1]=s,e}}ha.prototype.bytesPerElement=4,Ot(ha,"StructArrayLayout2ui4");class yh extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint16[1*e+0]=n,e}}yh.prototype.bytesPerElement=2,Ot(yh,"StructArrayLayout1ui2");class Qh extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n){const s=this.length;return this.resize(s+1),this.emplace(s,e,n)}emplace(e,n,s){const u=2*e;return this.float32[u+0]=n,this.float32[u+1]=s,e}}Qh.prototype.bytesPerElement=8,Ot(Qh,"StructArrayLayout2f8");class cf extends Pn{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}cf.prototype.size=40;class vh extends So{get(e){return new cf(this,e)}}Ot(vh,"CollisionBoxArray");class Bp extends Pn{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Bp.prototype.size=60;class Np extends zo{get(e){return new Bp(this,e)}}Ot(Np,"PlacedSymbolArray");class Up extends Pn{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}Up.prototype.size=76;class uf extends Ps{get(e){return new Up(this,e)}}Ot(uf,"SymbolInstanceArray");class jp extends Rs{getoffsetX(e){return this.float32[1*e+0]}}Ot(jp,"GlyphOffsetArray");class Vp extends hr{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}Ot(Vp,"SymbolLineVertexArray");class ts extends Pn{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}ts.prototype.size=12;class ed extends Io{get(e){return new ts(this,e)}}Ot(ed,"FeatureIndexArray");class hf extends ha{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}Ot(hf,"FillExtrusionCentroidArray");const df=Ft([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Bo=Ft([{name:"a_dash",components:4,type:"Uint16"}]);var yl={exports:{}},$p=function(t,e){var n,s,u,f,m,v,D,C;for(s=t.length-(n=3&t.length),u=e,m=3432918353,v=461845907,C=0;C<s;)D=255&t.charCodeAt(C)|(255&t.charCodeAt(++C))<<8|(255&t.charCodeAt(++C))<<16|(255&t.charCodeAt(++C))<<24,++C,u=27492+(65535&(f=5*(65535&(u=(u^=D=(65535&(D=(D=(65535&D)*m+(((D>>>16)*m&65535)<<16)&4294967295)<<15|D>>>17))*v+(((D>>>16)*v&65535)<<16)&4294967295)<<13|u>>>19))+((5*(u>>>16)&65535)<<16)&4294967295))+((58964+(f>>>16)&65535)<<16);switch(D=0,n){case 3:D^=(255&t.charCodeAt(C+2))<<16;case 2:D^=(255&t.charCodeAt(C+1))<<8;case 1:u^=D=(65535&(D=(D=(65535&(D^=255&t.charCodeAt(C)))*m+(((D>>>16)*m&65535)<<16)&4294967295)<<15|D>>>17))*v+(((D>>>16)*v&65535)<<16)&4294967295}return u^=t.length,u=2246822507*(65535&(u^=u>>>16))+((2246822507*(u>>>16)&65535)<<16)&4294967295,u=3266489909*(65535&(u^=u>>>13))+((3266489909*(u>>>16)&65535)<<16)&4294967295,(u^=u>>>16)>>>0},Gp=function(t,e){for(var n,s=t.length,u=e^s,f=0;s>=4;)n=1540483477*(65535&(n=255&t.charCodeAt(f)|(255&t.charCodeAt(++f))<<8|(255&t.charCodeAt(++f))<<16|(255&t.charCodeAt(++f))<<24))+((1540483477*(n>>>16)&65535)<<16),u=1540483477*(65535&u)+((1540483477*(u>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),s-=4,++f;switch(s){case 3:u^=(255&t.charCodeAt(f+2))<<16;case 2:u^=(255&t.charCodeAt(f+1))<<8;case 1:u=1540483477*(65535&(u^=255&t.charCodeAt(f)))+((1540483477*(u>>>16)&65535)<<16)}return u=1540483477*(65535&(u^=u>>>13))+((1540483477*(u>>>16)&65535)<<16),(u^=u>>>15)>>>0};yl.exports=$p,yl.exports.murmur3=$p,yl.exports.murmur2=Gp;class td{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,n,s,u){this.ids.push(mf(e)),this.positions.push(n,s,u)}getPositions(e){const n=mf(e);let s=0,u=this.ids.length-1;for(;s<u;){const m=s+u>>1;this.ids[m]>=n?u=m:s=m+1}const f=[];for(;this.ids[s]===n;)f.push({index:this.positions[3*s],start:this.positions[3*s+1],end:this.positions[3*s+2]}),s++;return f}static serialize(e,n){const s=new Float64Array(e.ids),u=new Uint32Array(e.positions);return gf(s,u,0,s.length-1),n&&n.push(s.buffer,u.buffer),{ids:s,positions:u}}static deserialize(e){const n=new td;return n.ids=e.ids,n.positions=e.positions,n.indexed=!0,n}}function mf(t){const e=+t;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:yl.exports(String(t))}function gf(t,e,n,s){for(;n<s;){const u=t[n+s>>1];let f=n-1,m=s+1;for(;;){do{f++}while(t[f]<u);do{m--}while(t[m]>u);if(f>=m)break;xh(t,f,m),xh(e,3*f,3*m),xh(e,3*f+1,3*m+1),xh(e,3*f+2,3*m+2)}m-n<s-m?(gf(t,e,n,m),n=m+1):(gf(t,e,m+1,s),s=m)}}function xh(t,e,n){const s=t[e];t[e]=t[n],t[n]=s}Ot(td,"FeaturePositionMap");class Zl{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,n){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,n),this.initialized=!0),!!this.location}}class nd extends Zl{constructor(e){super(e),this.current=0}set(e,n,s){this.fetchUniformLocation(e,n)&&this.current!==s&&(this.current=s,this.gl.uniform1f(this.location,s))}}class rd extends Zl{constructor(e){super(e),this.current=[0,0,0,0]}set(e,n,s){this.fetchUniformLocation(e,n)&&(s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]&&s[3]===this.current[3]||(this.current=s,this.gl.uniform4f(this.location,s[0],s[1],s[2],s[3])))}}class id extends Zl{constructor(e){super(e),this.current=Wn.transparent}set(e,n,s){this.fetchUniformLocation(e,n)&&(s.r===this.current.r&&s.g===this.current.g&&s.b===this.current.b&&s.a===this.current.a||(this.current=s,this.gl.uniform4f(this.location,s.r,s.g,s.b,s.a)))}}const Yg=new Float32Array(16),bh=new Float32Array(9),Kg=new Float32Array(4);function _f(t){return[qt(255*t.r,255*t.g),qt(255*t.b,255*t.a)]}class Wc{constructor(e,n,s){this.value=e,this.uniformNames=n.map(u=>`u_${u}`),this.type=s}setUniform(e,n,s,u,f){n.set(e,f,u.constantOr(this.value))}getBinding(e,n){return"color"===this.type?new id(e):new nd(e)}}class Sc{constructor(e,n){this.uniformNames=n.map(s=>`u_${s}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,n,s,u,f){const m="u_pattern"===f||"u_dash"===f?this.pattern:"u_pixel_ratio"===f?this.pixelRatio:null;m&&n.set(e,f,m)}getBinding(e,n){return"u_pattern"===n||"u_dash"===n?new rd(e):new nd(e)}}class vl{constructor(e,n,s,u){this.expression=e,this.type=s,this.maxValue=0,this.paintVertexAttributes=n.map(f=>({name:`a_${f}`,type:"Float32",components:"color"===s?2:1,offset:0})),this.paintVertexArray=new u}populatePaintArray(e,n,s,u,f,m){const v=this.paintVertexArray.length,D=this.expression.evaluate(new Te(0),n,{},f,u,m);this.paintVertexArray.resize(e),this._setPaintValue(v,e,D)}updatePaintArray(e,n,s,u,f){const m=this.expression.evaluate({zoom:0},s,u,void 0,f);this._setPaintValue(e,n,m)}_setPaintValue(e,n,s){if("color"===this.type){const u=_f(s);for(let f=e;f<n;f++)this.paintVertexArray.emplace(f,u[0],u[1])}else{for(let u=e;u<n;u++)this.paintVertexArray.emplace(u,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class No{constructor(e,n,s,u,f,m){this.expression=e,this.uniformNames=n.map(v=>`u_${v}_t`),this.type=s,this.useIntegerZoom=u,this.zoom=f,this.maxValue=0,this.paintVertexAttributes=n.map(v=>({name:`a_${v}`,type:"Float32",components:"color"===s?4:2,offset:0})),this.paintVertexArray=new m}populatePaintArray(e,n,s,u,f,m){const v=this.expression.evaluate(new Te(this.zoom),n,{},f,u,m),D=this.expression.evaluate(new Te(this.zoom+1),n,{},f,u,m),C=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(C,e,v,D)}updatePaintArray(e,n,s,u,f){const m=this.expression.evaluate({zoom:this.zoom},s,u,void 0,f),v=this.expression.evaluate({zoom:this.zoom+1},s,u,void 0,f);this._setPaintValue(e,n,m,v)}_setPaintValue(e,n,s,u){if("color"===this.type){const f=_f(s),m=_f(u);for(let v=e;v<n;v++)this.paintVertexArray.emplace(v,f[0],f[1],m[0],m[1])}else{for(let f=e;f<n;f++)this.paintVertexArray.emplace(f,s,u);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(u))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,n,s,u,f){const m=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,v=tt(this.expression.interpolationFactor(m,this.zoom,this.zoom+1),0,1);n.set(e,f,v)}getBinding(e,n){return new nd(e)}}class xl{constructor(e,n,s,u,f){this.expression=e,this.layerId=f,this.paintVertexAttributes=("array"===s?Bo:df).members;for(let m=0;m<n.length;++m);this.paintVertexArray=new u}populatePaintArray(e,n,s){const u=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(u,e,n.patterns&&n.patterns[this.layerId],s)}updatePaintArray(e,n,s,u,f,m){this._setPaintValues(e,n,s.patterns&&s.patterns[this.layerId],m)}_setPaintValues(e,n,s,u){if(!u||!s)return;const f=u[s];if(!f)return;const{tl:m,br:v,pixelRatio:D}=f;for(let C=e;C<n;C++)this.paintVertexArray.emplace(C,m[0],m[1],v[0],v[1],D)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ql{constructor(e,n,s=(()=>!0)){this.binders={},this._buffers=[];const u=[];for(const f in e.paint._values){if(!s(f))continue;const m=e.paint.get(f);if(!(m instanceof Ke&&Yo(m.property.specification)))continue;const v=Jg(f,e.type),D=m.value,C=m.property.specification.type,P=m.property.useIntegerZoom,F="line-dasharray"===f||f.endsWith("pattern"),N="line-dasharray"===f&&"constant"!==e.layout.get("line-cap").value.kind;if("constant"!==D.kind||N)if("source"===D.kind||N||F){const $=Hp(f,C,"source");this.binders[f]=F?new xl(D,v,C,$,e.id):new vl(D,v,C,$),u.push(`/a_${f}`)}else{const $=Hp(f,C,"composite");this.binders[f]=new No(D,v,C,P,n,$),u.push(`/z_${f}`)}else this.binders[f]=F?new Sc(D.value,v):new Wc(D.value,v,C),u.push(`/u_${f}`)}this.cacheKey=u.sort().join("")}getMaxValue(e){const n=this.binders[e];return n instanceof vl||n instanceof No?n.maxValue:0}populatePaintArrays(e,n,s,u,f,m){for(const v in this.binders){const D=this.binders[v];(D instanceof vl||D instanceof No||D instanceof xl)&&D.populatePaintArray(e,n,s,u,f,m)}}setConstantPatternPositions(e){for(const n in this.binders){const s=this.binders[n];s instanceof Sc&&s.setConstantPatternPositions(e)}}updatePaintArrays(e,n,s,u,f,m){let v=!1;for(const D in e){const C=n.getPositions(D);for(const P of C){const F=s.feature(P.index);for(const N in this.binders){const $=this.binders[N];if(($ instanceof vl||$ instanceof No||$ instanceof xl)&&!0===$.expression.isStateDependent){const G=u.paint.get(N);$.expression=G.value,$.updatePaintArray(P.start,P.end,F,e[D],f,m),v=!0}}}}return v}defines(){const e=[];for(const n in this.binders){const s=this.binders[n];(s instanceof Wc||s instanceof Sc)&&e.push(...s.uniformNames.map(u=>`#define HAS_UNIFORM_${u}`))}return e}getBinderAttributes(){const e=[];for(const n in this.binders){const s=this.binders[n];if(s instanceof vl||s instanceof No||s instanceof xl)for(let u=0;u<s.paintVertexAttributes.length;u++)e.push(s.paintVertexAttributes[u].name)}return e}getBinderUniforms(){const e=[];for(const n in this.binders){const s=this.binders[n];if(s instanceof Wc||s instanceof Sc||s instanceof No)for(const u of s.uniformNames)e.push(u)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const n=[];for(const s in this.binders){const u=this.binders[s];if(u instanceof Wc||u instanceof Sc||u instanceof No)for(const f of u.uniformNames)n.push({name:f,property:s,binding:u.getBinding(e,f)})}return n}setUniforms(e,n,s,u,f){for(const{name:m,property:v,binding:D}of s)this.binders[v].setUniform(e,D,f,u.get(v),m)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const n=this.binders[e];(n instanceof vl||n instanceof No||n instanceof xl)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer)}}upload(e){for(const n in this.binders){const s=this.binders[n];(s instanceof vl||s instanceof No||s instanceof xl)&&s.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const n=this.binders[e];(n instanceof vl||n instanceof No||n instanceof xl)&&n.destroy()}}}class Xc{constructor(e,n,s=(()=>!0)){this.programConfigurations={};for(const u of e)this.programConfigurations[u.id]=new ql(u,n,s);this.needsUpload=!1,this._featureMap=new td,this._bufferOffset=0}populatePaintArrays(e,n,s,u,f,m,v){for(const D in this.programConfigurations)this.programConfigurations[D].populatePaintArrays(e,n,u,f,m,v);void 0!==n.id&&this._featureMap.add(n.id,s,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,n,s,u,f){for(const m of s)this.needsUpload=this.programConfigurations[m.id].updatePaintArrays(e,this._featureMap,n,m,u,f)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const yf={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function Jg(t,e){return yf[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}const Qg={"line-pattern":{source:Co,composite:Co},"fill-pattern":{source:Co,composite:Co},"fill-extrusion-pattern":{source:Co,composite:Co},"line-dasharray":{source:_s,composite:_s}},e_={color:{source:Qh,composite:es},number:{source:Rs,composite:Qh}};function Hp(t,e,n){const s=Qg[t];return s&&s[n]||e_[e][n]}Ot(Wc,"ConstantBinder"),Ot(Sc,"PatternConstantBinder"),Ot(vl,"SourceExpressionBinder"),Ot(xl,"PatternCompositeBinder"),Ot(No,"CompositeExpressionBinder"),Ot(ql,"ProgramConfiguration",{omit:["_buffers"]}),Ot(Xc,"ProgramConfigurationSet");const od="-transition";class za extends Di{constructor(e,n){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==e.type&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&"sky"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),n.layout&&(this._unevaluatedLayout=new Ne(n.layout)),n.paint)){this._transitionablePaint=new He(n.paint);for(const s in e.paint)this.setPaintProperty(s,e.paint[s],{validate:!1});for(const s in e.layout)this.setLayoutProperty(s,e.layout[s],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new vt(n.paint)}}getLayoutProperty(e){return"visibility"===e?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,n,s={}){null!=n&&this._validate(mo,`layers.${this.id}.layout.${e}`,e,n,s)||("visibility"!==e?this._unevaluatedLayout.setValue(e,n):this.visibility=n)}getPaintProperty(e){return Un(e,od)?this._transitionablePaint.getTransition(e.slice(0,-od.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,n,s={}){if(null!=n&&this._validate(Tu,`layers.${this.id}.paint.${e}`,e,n,s))return!1;if(Un(e,od))return this._transitionablePaint.setTransition(e.slice(0,-od.length),n||void 0),!1;{const u=this._transitionablePaint._values[e],f=u.value.isDataDriven(),m=u.value;this._transitionablePaint.setValue(e,n),this._handleSpecialPaintPropertyUpdate(e);const v=this._transitionablePaint._values[e].value,D=v.isDataDriven(),C=Un(e,"pattern")||"line-dasharray"===e;return D||f||C||this._handleOverridablePaintPropertyUpdate(e,m,v)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,n,s){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||"none"===this.visibility}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,n){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,n)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),jn(e,(n,s)=>!(void 0===n||"layout"===s&&!Object.keys(n).length||"paint"===s&&!Object.keys(n).length))}_validate(e,n,s,u,f={}){return(!f||!1!==f.validate)&&$l(this,e.call($c,{key:n,layerType:this.type,objectKey:s,value:u,styleSpec:Ge,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const n=this.paint.get(e);if(n instanceof Ke&&Yo(n.property.specification)&&("source"===n.value.kind||"composite"===n.value.kind)&&n.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=sa(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const Zp=Ft([{name:"a_pos",components:2,type:"Int16"}],4),vf=Ft([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class xi{constructor(e=[]){this.segments=e}prepareSegment(e,n,s,u){let f=this.segments[this.segments.length-1];return e>xi.MAX_VERTEX_ARRAY_LENGTH&&vn(`Max vertices per segment is ${xi.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!f||f.vertexLength+e>xi.MAX_VERTEX_ARRAY_LENGTH||f.sortKey!==u)&&(f={vertexOffset:n.length,primitiveOffset:s.length,vertexLength:0,primitiveLength:0},void 0!==u&&(f.sortKey=u),this.segments.push(f)),f}get(){return this.segments}destroy(){for(const e of this.segments)for(const n in e.vaos)e.vaos[n].destroy()}static simpleSegment(e,n,s,u){return new xi([{vertexOffset:e,primitiveOffset:n,vertexLength:s,primitiveLength:u,vaos:{},sortKey:0}])}}xi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ot(xi,"SegmentVector");var pn=8192;class Ic{constructor(e,n){e&&(n?this.setSouthWest(e).setNorthEast(n):4===e.length?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof or?new or(e.lng,e.lat):or.convert(e),this}setSouthWest(e){return this._sw=e instanceof or?new or(e.lng,e.lat):or.convert(e),this}extend(e){const n=this._sw,s=this._ne;let u,f;if(e instanceof or)u=e,f=e;else{if(!(e instanceof Ic))return Array.isArray(e)?4===e.length||e.every(Array.isArray)?this.extend(Ic.convert(e)):this.extend(or.convert(e)):"object"==typeof e&&null!==e&&e.hasOwnProperty("lat")&&e.hasOwnProperty("lon")?this.extend(or.convert(e)):this;if(u=e._sw,f=e._ne,!u||!f)return this}return n||s?(n.lng=Math.min(u.lng,n.lng),n.lat=Math.min(u.lat,n.lat),s.lng=Math.max(f.lng,s.lng),s.lat=Math.max(f.lat,s.lat)):(this._sw=new or(u.lng,u.lat),this._ne=new or(f.lng,f.lat)),this}getCenter(){return new or((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new or(this.getWest(),this.getNorth())}getSouthEast(){return new or(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:n,lat:s}=or.convert(e);let u=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(u=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=s&&s<=this._ne.lat&&u}static convert(e){return!e||e instanceof Ic?e:new Ic(e)}}const sd=6371008.8;class or{constructor(e,n){if(isNaN(e)||isNaN(n))throw new Error(`Invalid LngLat object: (${e}, ${n})`);if(this.lng=+e,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new or(Nn(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const n=Math.PI/180,s=this.lat*n,u=e.lat*n,f=Math.sin(s)*Math.sin(u)+Math.cos(s)*Math.cos(u)*Math.cos((e.lng-this.lng)*n);return sd*Math.acos(Math.min(f,1))}toBounds(e=0){const n=360*e/40075017,s=n/Math.cos(Math.PI/180*this.lat);return new Ic(new or(this.lng-s,this.lat-n),new or(this.lng+s,this.lat+n))}static convert(e){if(e instanceof or)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new or(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"==typeof e&&null!==e)return new or(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const xf=2*Math.PI*sd;function Wl(t){return xf*Math.cos(t*Math.PI/180)}function Ba(t){return(180+t)/360}function Na(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function da(t,e){return t/Wl(e)}function fa(t){return 360*t-180}function Fi(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function qp(t,e){return t*Wl(Fi(e))}const Ua=85.051129;function bf(t){return 1/Math.cos(t*Math.PI/180)}class Yc{constructor(e,n,s=0){this.x=+e,this.y=+n,this.z=+s}static fromLngLat(e,n=0){const s=or.convert(e);return new Yc(Ba(s.lng),Na(s.lat),da(n,s.lat))}toLngLat(){return new or(fa(this.x),Fi(this.y))}toAltitude(){return qp(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/xf*bf(Fi(this.y))}}function wh(t,e,n,s,u,f,m,v,D){const C=(e+s)/2,P=(n+u)/2,F=new Qe(C,P);v(F),function(N,$,G,J,ie,ue){const ge=G-ie,ce=J-ue;return Math.abs((J-$)*ge-(G-N)*ce)/Math.hypot(ge,ce)}(F.x,F.y,f.x,f.y,m.x,m.y)>=D?(wh(t,e,n,C,P,f,F,v,D),wh(t,C,P,s,u,F,m,v,D)):t.push(m)}function wf(t,e,n){let s=t[0],u=s.x,f=s.y;e(s);const m=[s];for(let v=1;v<t.length;v++){const D=t[v],{x:C,y:P}=D;e(D),wh(m,u,f,C,P,s,D,e,n),u=C,f=P,s=D}return m}function Au(t,e,n,s){if(s(e,n)){const u=e.add(n)._mult(.5);Au(t,e,u,s),Au(t,u,n,s)}else t.push(n)}function ad(t,e){let n=t[0];const s=[n];for(let u=1;u<t.length;u++){const f=t[u];Au(s,n,f,e),n=f}return s}const ld=Math.pow(2,14)-1,cd=-ld-1;function Ef(t,e){const n=Math.round(t.x*e),s=Math.round(t.y*e);return t.x=tt(n,cd,ld),t.y=tt(s,cd,ld),(n<t.x||n>t.x+1||s<t.y||s>t.y+1)&&vn("Geometry exceeds allowed extent, reduce your vector tile buffer size"),t}function ja(t,e,n){const s=t.loadGeometry(),u=t.extent,f=pn/u;if(e&&n&&n.projection.isReprojectedInTileSpace){const m=1<<e.z,{scale:v,x:D,y:C,projection:P}=n,F=N=>{const $=fa((e.x+N.x/u)/m),G=Fi((e.y+N.y/u)/m),J=P.project($,G);N.x=(J.x*v-D)*u,N.y=(J.y*v-C)*u};for(let N=0;N<s.length;N++)if(1!==t.type)s[N]=wf(s[N],F,1);else{const $=[];for(const G of s[N])G.x<0||G.x>=u||G.y<0||G.y>=u||(F(G),$.push(G));s[N]=$}}for(const m of s)for(const v of m)Ef(v,f);return s}function Va(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?ja(t):[]}}function ud(t,e,n,s,u){t.emplaceBack(2*e+(s+1)/2,2*n+(u+1)/2)}function Eh(t,e,n){t.emplaceBack(e.x,e.y,e.z,16384*n[0],16384*n[1],16384*n[2])}class Df{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new hr,this.indexArray=new Ji,this.segments=new xi,this.programConfigurations=new Xc(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,s,u){const f=this.layers[0],m=[];let v=null;"circle"===f.type&&(v=f.layout.get("circle-sort-key"));for(const{feature:C,id:P,index:F,sourceLayerIndex:N}of e){const $=this.layers[0]._featureFilter.needGeometry,G=Va(C,$);if(!this.layers[0]._featureFilter.filter(new Te(this.zoom),G,s))continue;const J=v?v.evaluate(G,{},s):void 0,ie={id:P,properties:C.properties,type:C.type,sourceLayerIndex:N,index:F,geometry:$?G.geometry:ja(C,s,u),patterns:{},sortKey:J};m.push(ie)}v&&m.sort((C,P)=>C.sortKey-P.sortKey);let D=null;"globe"===u.projection.name&&(this.globeExtVertexArray=new Or,D=u.projection);for(const C of m){const{geometry:P,index:F,sourceLayerIndex:N}=C,$=e[F].feature;this.addFeature(C,P,F,n.availableImages,s,D),n.featureIndex.insert($,P,F,N,this.index)}}update(e,n,s,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,s,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Zp.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,vf.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,n,s,u,f,m){for(const v of n)for(const D of v){const C=D.x,P=D.y;if(C<0||C>=pn||P<0||P>=pn)continue;if(m){const $=m.projectTilePoint(C,P,f),G=m.upVector(f,C,P),J=this.globeExtVertexArray;Eh(J,$,G),Eh(J,$,G),Eh(J,$,G),Eh(J,$,G)}const F=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),N=F.vertexLength;ud(this.layoutVertexArray,C,P,-1,-1),ud(this.layoutVertexArray,C,P,1,-1),ud(this.layoutVertexArray,C,P,1,1),ud(this.layoutVertexArray,C,P,-1,1),this.indexArray.emplaceBack(N,N+1,N+2),this.indexArray.emplaceBack(N,N+2,N+3),F.vertexLength+=4,F.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,{},u,f)}}function Wp(t,e){for(let n=0;n<t.length;n++)if(Ru(e,t[n]))return!0;for(let n=0;n<e.length;n++)if(Ru(t,e[n]))return!0;return!!Pu(t,e)}function t_(t,e,n){return!!Ru(t,e)||!!Xl(e,t,n)}function Tf(t,e){if(1===t.length)return Kp(e,t[0]);for(let n=0;n<e.length;n++){const s=e[n];for(let u=0;u<s.length;u++)if(Ru(t,s[u]))return!0}for(let n=0;n<t.length;n++)if(Kp(e,t[n]))return!0;for(let n=0;n<e.length;n++)if(Pu(t,e[n]))return!0;return!1}function Xp(t,e,n){if(t.length>1){if(Pu(t,e))return!0;for(let s=0;s<e.length;s++)if(Xl(e[s],t,n))return!0}for(let s=0;s<t.length;s++)if(Xl(t[s],e,n))return!0;return!1}function Pu(t,e){if(0===t.length||0===e.length)return!1;for(let n=0;n<t.length-1;n++){const s=t[n],u=t[n+1];for(let f=0;f<e.length-1;f++)if(Cf(s,u,e[f],e[f+1]))return!0}return!1}function Cf(t,e,n,s){return nr(t,n,s)!==nr(e,n,s)&&nr(t,e,n)!==nr(t,e,s)}function Xl(t,e,n){const s=n*n;if(1===e.length)return t.distSqr(e[0])<s;for(let u=1;u<e.length;u++)if(Yp(t,e[u-1],e[u])<s)return!0;return!1}function Yp(t,e,n){const s=e.distSqr(n);if(0===s)return t.distSqr(e);const u=((t.x-e.x)*(n.x-e.x)+(t.y-e.y)*(n.y-e.y))/s;return t.distSqr(u<0?e:u>1?n:n.sub(e)._mult(u)._add(e))}function Kp(t,e){let n,s,u,f=!1;for(let m=0;m<t.length;m++){n=t[m];for(let v=0,D=n.length-1;v<n.length;D=v++)s=n[v],u=n[D],s.y>e.y!=u.y>e.y&&e.x<(u.x-s.x)*(e.y-s.y)/(u.y-s.y)+s.x&&(f=!f)}return f}function Ru(t,e){let n=!1;for(let s=0,u=t.length-1;s<t.length;u=s++){const f=t[s],m=t[u];f.y>e.y!=m.y>e.y&&e.x<(m.x-f.x)*(e.y-f.y)/(m.y-f.y)+f.x&&(n=!n)}return n}function Jp(t,e,n,s,u){for(const m of t)if(e<=m.x&&n<=m.y&&s>=m.x&&u>=m.y)return!0;const f=[new Qe(e,n),new Qe(e,u),new Qe(s,u),new Qe(s,n)];if(t.length>2)for(const m of f)if(Ru(t,m))return!0;for(let m=0;m<t.length-1;m++)if(Sf(t[m],t[m+1],f))return!0;return!1}function Sf(t,e,n){const s=n[0],u=n[2];if(t.x<s.x&&e.x<s.x||t.x>u.x&&e.x>u.x||t.y<s.y&&e.y<s.y||t.y>u.y&&e.y>u.y)return!1;const f=nr(t,e,n[0]);return f!==nr(t,e,n[1])||f!==nr(t,e,n[2])||f!==nr(t,e,n[3])}function Lu(t,e,n){const s=e.paint.get(t).value;return"constant"===s.kind?s.value:n.programConfigurations.get(e.id).getMaxValue(t)}function Dh(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function Th(t,e,n,s,u){if(!e[0]&&!e[1])return t;const f=Qe.convert(e)._mult(u);"viewport"===n&&f._rotate(-s);const m=[];for(let v=0;v<t.length;v++)m.push(t[v].sub(f));return m}function hd(t,e,n,s){const u=Qe.convert(t)._mult(s);return"viewport"===e&&u._rotate(-n),u}Ot(Df,"CircleBucket",{omit:["layers"]});const Qp=new an({"circle-sort-key":new Be(Ge.layout_circle["circle-sort-key"])});var em={paint:new an({"circle-radius":new Be(Ge.paint_circle["circle-radius"]),"circle-color":new Be(Ge.paint_circle["circle-color"]),"circle-blur":new Be(Ge.paint_circle["circle-blur"]),"circle-opacity":new Be(Ge.paint_circle["circle-opacity"]),"circle-translate":new Ae(Ge.paint_circle["circle-translate"]),"circle-translate-anchor":new Ae(Ge.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ae(Ge.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ae(Ge.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Be(Ge.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Be(Ge.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Be(Ge.paint_circle["circle-stroke-opacity"])}),layout:Qp},Ch=1e-6,ns=typeof Float32Array<"u"?Float32Array:Array;function tm(){var t=new ns(9);return ns!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function nm(t,e,n){var s=e[0],u=e[1],f=e[2],m=e[3],v=e[4],D=e[5],C=e[6],P=e[7],F=e[8],N=n[0],$=n[1],G=n[2],J=n[3],ie=n[4],ue=n[5],ge=n[6],ce=n[7],pe=n[8];return t[0]=N*s+$*m+G*C,t[1]=N*u+$*v+G*P,t[2]=N*f+$*D+G*F,t[3]=J*s+ie*m+ue*C,t[4]=J*u+ie*v+ue*P,t[5]=J*f+ie*D+ue*F,t[6]=ge*s+ce*m+pe*C,t[7]=ge*u+ce*v+pe*P,t[8]=ge*f+ce*D+pe*F,t}function $a(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function If(t,e){var n=e[0],s=e[1],u=e[2],f=e[3],m=e[4],v=e[5],D=e[6],C=e[7],P=e[8],F=e[9],N=e[10],$=e[11],G=e[12],J=e[13],ie=e[14],ue=e[15],ge=n*v-s*m,ce=n*D-u*m,pe=n*C-f*m,_e=s*D-u*v,ye=s*C-f*v,Oe=u*C-f*D,ke=P*J-F*G,Ze=P*ie-N*G,dt=P*ue-$*G,je=F*ie-N*J,Xe=F*ue-$*J,Ye=N*ue-$*ie,st=ge*Ye-ce*Xe+pe*je+_e*dt-ye*Ze+Oe*ke;return st?(t[0]=(v*Ye-D*Xe+C*je)*(st=1/st),t[1]=(u*Xe-s*Ye-f*je)*st,t[2]=(J*Oe-ie*ye+ue*_e)*st,t[3]=(N*ye-F*Oe-$*_e)*st,t[4]=(D*dt-m*Ye-C*Ze)*st,t[5]=(n*Ye-u*dt+f*Ze)*st,t[6]=(ie*pe-G*Oe-ue*ce)*st,t[7]=(P*Oe-N*pe+$*ce)*st,t[8]=(m*Xe-v*dt+C*ke)*st,t[9]=(s*dt-n*Xe-f*ke)*st,t[10]=(G*ye-J*pe+ue*ge)*st,t[11]=(F*pe-P*ye-$*ge)*st,t[12]=(v*Ze-m*je-D*ke)*st,t[13]=(n*je-s*Ze+u*ke)*st,t[14]=(J*ce-G*_e-ie*ge)*st,t[15]=(P*_e-F*ce+N*ge)*st,t):null}function Kc(t,e,n){var s=e[0],u=e[1],f=e[2],m=e[3],v=e[4],D=e[5],C=e[6],P=e[7],F=e[8],N=e[9],$=e[10],G=e[11],J=e[12],ie=e[13],ue=e[14],ge=e[15],ce=n[0],pe=n[1],_e=n[2],ye=n[3];return t[0]=ce*s+pe*v+_e*F+ye*J,t[1]=ce*u+pe*D+_e*N+ye*ie,t[2]=ce*f+pe*C+_e*$+ye*ue,t[3]=ce*m+pe*P+_e*G+ye*ge,t[4]=(ce=n[4])*s+(pe=n[5])*v+(_e=n[6])*F+(ye=n[7])*J,t[5]=ce*u+pe*D+_e*N+ye*ie,t[6]=ce*f+pe*C+_e*$+ye*ue,t[7]=ce*m+pe*P+_e*G+ye*ge,t[8]=(ce=n[8])*s+(pe=n[9])*v+(_e=n[10])*F+(ye=n[11])*J,t[9]=ce*u+pe*D+_e*N+ye*ie,t[10]=ce*f+pe*C+_e*$+ye*ue,t[11]=ce*m+pe*P+_e*G+ye*ge,t[12]=(ce=n[12])*s+(pe=n[13])*v+(_e=n[14])*F+(ye=n[15])*J,t[13]=ce*u+pe*D+_e*N+ye*ie,t[14]=ce*f+pe*C+_e*$+ye*ue,t[15]=ce*m+pe*P+_e*G+ye*ge,t}function pa(t,e,n){var s,u,f,m,v,D,C,P,F,N,$,G,J=n[0],ie=n[1],ue=n[2];return e===t?(t[12]=e[0]*J+e[4]*ie+e[8]*ue+e[12],t[13]=e[1]*J+e[5]*ie+e[9]*ue+e[13],t[14]=e[2]*J+e[6]*ie+e[10]*ue+e[14],t[15]=e[3]*J+e[7]*ie+e[11]*ue+e[15]):(u=e[1],f=e[2],m=e[3],v=e[4],D=e[5],C=e[6],P=e[7],F=e[8],N=e[9],$=e[10],G=e[11],t[0]=s=e[0],t[1]=u,t[2]=f,t[3]=m,t[4]=v,t[5]=D,t[6]=C,t[7]=P,t[8]=F,t[9]=N,t[10]=$,t[11]=G,t[12]=s*J+v*ie+F*ue+e[12],t[13]=u*J+D*ie+N*ue+e[13],t[14]=f*J+C*ie+$*ue+e[14],t[15]=m*J+P*ie+G*ue+e[15]),t}function Ga(t,e,n){var s=n[0],u=n[1],f=n[2];return t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t[3]=e[3]*s,t[4]=e[4]*u,t[5]=e[5]*u,t[6]=e[6]*u,t[7]=e[7]*u,t[8]=e[8]*f,t[9]=e[9]*f,t[10]=e[10]*f,t[11]=e[11]*f,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Mf(t,e,n){var s=Math.sin(n),u=Math.cos(n),f=e[4],m=e[5],v=e[6],D=e[7],C=e[8],P=e[9],F=e[10],N=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=f*u+C*s,t[5]=m*u+P*s,t[6]=v*u+F*s,t[7]=D*u+N*s,t[8]=C*u-f*s,t[9]=P*u-m*s,t[10]=F*u-v*s,t[11]=N*u-D*s,t}function Af(t,e,n){var s=Math.sin(n),u=Math.cos(n),f=e[0],m=e[1],v=e[2],D=e[3],C=e[8],P=e[9],F=e[10],N=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=f*u-C*s,t[1]=m*u-P*s,t[2]=v*u-F*s,t[3]=D*u-N*s,t[8]=f*s+C*u,t[9]=m*s+P*u,t[10]=v*s+F*u,t[11]=D*s+N*u,t}function n_(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function r_(t,e,n){var s,u,f,m=n[0],v=n[1],D=n[2],C=Math.hypot(m,v,D);return C<Ch?null:(m*=C=1/C,v*=C,D*=C,s=Math.sin(e),u=Math.cos(e),t[0]=m*m*(f=1-u)+u,t[1]=v*m*f+D*s,t[2]=D*m*f-v*s,t[3]=0,t[4]=m*v*f-D*s,t[5]=v*v*f+u,t[6]=D*v*f+m*s,t[7]=0,t[8]=m*D*f+v*s,t[9]=v*D*f-m*s,t[10]=D*D*f+u,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var ky=Kc;function rm(){var t=new ns(3);return ns!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Pf(t){var e=new ns(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function Sh(t){return Math.hypot(t[0],t[1],t[2])}function ku(t,e,n){var s=new ns(3);return s[0]=t,s[1]=e,s[2]=n,s}function Yl(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function Rf(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function dd(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t}function Ls(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t}function Kl(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t}function ys(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function Ou(t,e,n,s){return t[0]=e[0]+n[0]*s,t[1]=e[1]+n[1]*s,t[2]=e[2]+n[2]*s,t}function Mo(t,e){var n=e[0],s=e[1],u=e[2],f=n*n+s*s+u*u;return f>0&&(f=1/Math.sqrt(f)),t[0]=e[0]*f,t[1]=e[1]*f,t[2]=e[2]*f,t}function Ha(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function im(t,e,n){var s=e[0],u=e[1],f=e[2],m=n[0],v=n[1],D=n[2];return t[0]=u*D-f*v,t[1]=f*m-s*D,t[2]=s*v-u*m,t}function bi(t,e,n){var s=e[0],u=e[1],f=e[2],m=n[3]*s+n[7]*u+n[11]*f+n[15];return t[0]=(n[0]*s+n[4]*u+n[8]*f+n[12])/(m=m||1),t[1]=(n[1]*s+n[5]*u+n[9]*f+n[13])/m,t[2]=(n[2]*s+n[6]*u+n[10]*f+n[14])/m,t}function fd(t,e,n){var s=n[0],u=n[1],f=n[2],m=e[0],v=e[1],D=e[2],C=u*D-f*v,P=f*m-s*D,F=s*v-u*m,N=u*F-f*P,$=f*C-s*F,G=s*P-u*C,J=2*n[3];return P*=J,F*=J,$*=2,G*=2,t[0]=m+(C*=J)+(N*=2),t[1]=v+P+$,t[2]=D+F+G,t}var Jc,bl=Rf,Oy=dd,om=Sh;function sm(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function am(t,e){var n=e[0],s=e[1],u=e[2],f=e[3],m=n*n+s*s+u*u+f*f;return m>0&&(m=1/Math.sqrt(m)),t[0]=n*m,t[1]=s*m,t[2]=u*m,t[3]=f*m,t}function Qc(t,e,n){var s=e[0],u=e[1],f=e[2],m=e[3];return t[0]=n[0]*s+n[4]*u+n[8]*f+n[12]*m,t[1]=n[1]*s+n[5]*u+n[9]*f+n[13]*m,t[2]=n[2]*s+n[6]*u+n[10]*f+n[14]*m,t[3]=n[3]*s+n[7]*u+n[11]*f+n[15]*m,t}function lm(){var t=new ns(4);return ns!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function Lf(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function Ih(t,e,n){n*=.5;var s=e[0],u=e[1],f=e[2],m=e[3],v=Math.sin(n),D=Math.cos(n);return t[0]=s*D+m*v,t[1]=u*D+f*v,t[2]=f*D-u*v,t[3]=m*D-s*v,t}function cm(t,e,n){n*=.5;var s=e[0],u=e[1],f=e[2],m=e[3],v=Math.sin(n),D=Math.cos(n);return t[0]=s*D-f*v,t[1]=u*D+m*v,t[2]=f*D+s*v,t[3]=m*D-u*v,t}rm(),Jc=new ns(4),ns!=Float32Array&&(Jc[0]=0,Jc[1]=0,Jc[2]=0,Jc[3]=0);var kf=am;rm(),ku(1,0,0),ku(0,1,0),lm(),lm(),tm();class Of{constructor(e,n){this.pos=e,this.dir=n}intersectsPlane(e,n,s){const u=Ha(n,this.dir);if(Math.abs(u)<1e-6)return!1;const f=((e[0]-this.pos[0])*n[0]+(e[1]-this.pos[1])*n[1]+(e[2]-this.pos[2])*n[2])/u;return s[0]=this.pos[0]+this.dir[0]*f,s[1]=this.pos[1]+this.dir[1]*f,s[2]=this.pos[2]+this.dir[2]*f,!0}closestPointOnSphere(e,n,s){if(J=($=this.pos)[0],ie=$[1],ue=$[2],ge=(G=e)[0],ce=G[1],pe=G[2],Math.abs(J-ge)<=Ch*Math.max(1,Math.abs(J),Math.abs(ge))&&Math.abs(ie-ce)<=Ch*Math.max(1,Math.abs(ie),Math.abs(ce))&&Math.abs(ue-pe)<=Ch*Math.max(1,Math.abs(ue),Math.abs(pe))||0===n)return s[0]=s[1]=s[2]=0,!1;var $,G,J,ie,ue,ge,ce,pe;const[u,f,m]=this.dir,v=this.pos[0]-e[0],D=this.pos[1]-e[1],C=this.pos[2]-e[2],P=u*u+f*f+m*m,F=2*(v*u+D*f+C*m),N=F*F-4*P*(v*v+D*D+C*C-n*n);if(N<0){const $=Math.max(-F/2,0),G=v+u*$,J=D+f*$,ie=C+m*$,ue=Math.hypot(G,J,ie);return s[0]=G*n/ue,s[1]=J*n/ue,s[2]=ie*n/ue,!1}{const $=(-F-Math.sqrt(N))/(2*P);if($<0){const G=Math.hypot(v,D,C);return s[0]=v*n/G,s[1]=D*n/G,s[2]=C*n/G,!1}return s[0]=v+u*$,s[1]=D+f*$,s[2]=C+m*$,!0}}}class Mi{constructor(e,n,s,u,f){this.TL=e,this.TR=n,this.BR=s,this.BL=u,this.horizon=f}static fromInvProjectionMatrix(e,n,s){const u=[-1,1,1],f=[1,1,1],m=[1,-1,1],v=[-1,-1,1],D=bi(u,u,e),C=bi(f,f,e),P=bi(m,m,e),F=bi(v,v,e);return new Mi(D,C,P,F,n/s)}}class Ff{constructor(e,n){this.points=e,this.planes=n}static fromInvProjectionMatrix(e,n,s,u){const f=Math.pow(2,s),m=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(D=>{const C=Qc([],D,e),P=1/C[3]/n*f;return(F=C)[0]=(N=C)[0]*($=[P,P,u?1/C[3]:P,P])[0],F[1]=N[1]*$[1],F[2]=N[2]*$[2],F[3]=N[3]*$[3],F;var F,N,$}),v=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(D=>{const C=Mo([],im([],bl([],m[D[0]],m[D[1]]),bl([],m[D[2]],m[D[1]]))),P=-Ha(C,m[D[1]]);return C.concat(P)});return new Ff(m,v)}}class Uo{static fromPoints(e){const n=[1/0,1/0,1/0],s=[-1/0,-1/0,-1/0];for(const u of e)Ls(n,n,u),Kl(s,s,u);return new Uo(n,s)}static applyTransform(e,n){const s=e.getCorners();for(let u=0;u<s.length;++u)bi(s[u],s[u],n);return Uo.fromPoints(s)}constructor(e,n){this.min=e,this.max=n,this.center=ys([],Yl([],this.min,this.max),.5)}quadrant(e){const n=[e%2==0,e<2],s=Pf(this.min),u=Pf(this.max);for(let f=0;f<n.length;f++)s[f]=n[f]?this.min[f]:this.center[f],u[f]=n[f]?this.center[f]:this.max[f];return u[2]=this.max[2],new Uo(s,u)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,n=this.max;return[[e[0],e[1],e[2]],[n[0],e[1],e[2]],[n[0],n[1],e[2]],[e[0],n[1],e[2]],[e[0],e[1],n[2]],[n[0],e[1],n[2]],[n[0],n[1],n[2]],[e[0],n[1],n[2]]]}intersects(e){const n=this.getCorners();let s=!0;for(let u=0;u<e.planes.length;u++){const f=e.planes[u];let m=0;for(let v=0;v<n.length;v++)m+=Ha(f,n[v])+f[3]>=0;if(0===m)return 0;m!==n.length&&(s=!1)}if(s)return 2;for(let u=0;u<3;u++){let f=Number.MAX_VALUE,m=-Number.MAX_VALUE;for(let v=0;v<e.points.length;v++){const D=e.points[v][u]-this.min[u];f=Math.min(f,D),m=Math.max(m,D)}if(m<0||f>this.max[u]-this.min[u])return 0}return 1}}function zf(t,e,n,s,u,f,m,v,D){if(f&&t.queryGeometry.isAboveHorizon)return!1;f&&(D*=t.pixelToTileUnitsFactor);const C=t.tileID.canonical,P=n.projection.upVectorScale(C,n.center.lat,n.worldSize).metersToTile;for(const F of e)for(const N of F){const $=N.add(v),G=u&&n.elevation?n.elevation.exaggeration()*u.getElevationAt($.x,$.y,!0):0,J=n.projection.projectTilePoint($.x,$.y,C);if(G>0){const ce=n.projection.upVector(C,$.x,$.y);J.x+=ce[0]*P*G,J.y+=ce[1]*P*G,J.z+=ce[2]*P*G}const ie=f?$:um(J.x,J.y,J.z,s),ue=f?t.tilespaceRays.map(ce=>o_(ce,G)):t.queryGeometry.screenGeometry,ge=Qc([],[J.x,J.y,J.z,1],s);if(!m&&f?D*=ge[3]/n.cameraToCenterDistance:m&&!f&&(D*=n.cameraToCenterDistance/ge[3]),f){const ce=Fi((N.y/pn+C.y)/(1<<C.z));D/=n.projection.pixelsPerMeter(ce,1)/da(1,ce)}if(t_(ue,ie,D))return!0}return!1}function um(t,e,n,s){const u=Qc([],[t,e,n,1],s);return new Qe(u[0]/u[3],u[1]/u[3])}const hm=ku(0,0,0),i_=ku(0,0,1);function o_(t,e){const n=rm();return hm[2]=e,t.intersectsPlane(hm,i_,n),new Qe(n[0],n[1])}class dm extends Df{}function Bf(t,{width:e,height:n},s,u){if(u){if(u instanceof Uint8ClampedArray)u=new Uint8Array(u.buffer);else if(u.length!==e*n*s)throw new RangeError("mismatched image size")}else u=new Uint8Array(e*n*s);return t.width=e,t.height=n,t.data=u,t}function s_(t,e,n){const{width:s,height:u}=e;s===t.width&&u===t.height||(fm(t,e,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,s),height:Math.min(t.height,u)},n),t.width=s,t.height=u,t.data=e.data)}function fm(t,e,n,s,u,f){if(0===u.width||0===u.height)return e;if(u.width>t.width||u.height>t.height||n.x>t.width-u.width||n.y>t.height-u.height)throw new RangeError("out of range source coordinates for image copy");if(u.width>e.width||u.height>e.height||s.x>e.width-u.width||s.y>e.height-u.height)throw new RangeError("out of range destination coordinates for image copy");const m=t.data,v=e.data;for(let D=0;D<u.height;D++){const C=((n.y+D)*t.width+n.x)*f,P=((s.y+D)*e.width+s.x)*f;for(let F=0;F<u.width*f;F++)v[P+F]=m[C+F]}return e}Ot(dm,"HeatmapBucket",{omit:["layers"]});class ks{constructor(e,n){Bf(this,e,1,n)}resize(e){s_(this,new ks(e),1)}clone(){return new ks({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,s,u,f){fm(e,n,s,u,f,1)}}class jo{constructor(e,n){Bf(this,e,4,n)}resize(e){s_(this,new jo(e),4)}replace(e,n){n?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new jo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,s,u,f){fm(e,n,s,u,f,4)}}Ot(ks,"AlphaImage"),Ot(jo,"RGBAImage");var pm={paint:new an({"heatmap-radius":new Be(Ge.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Be(Ge.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ae(Ge.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Zt(Ge.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ae(Ge.paint_heatmap["heatmap-opacity"])})};function pd(t){const e={},n=t.resolution||256,s=t.clips?t.clips.length:1,u=t.image||new jo({width:n,height:s}),f=(m,v,D)=>{e[t.evaluationKey]=D;const C=t.expression.evaluate(e);u.data[m+v+0]=Math.floor(255*C.r/C.a),u.data[m+v+1]=Math.floor(255*C.g/C.a),u.data[m+v+2]=Math.floor(255*C.b/C.a),u.data[m+v+3]=Math.floor(255*C.a)};if(t.clips)for(let m=0,v=0;m<s;++m,v+=4*n)for(let D=0,C=0;D<n;D++,C+=4){const P=D/(n-1),{start:F,end:N}=t.clips[m];f(v,C,F*(1-P)+N*P)}else for(let m=0,v=0;m<n;m++,v+=4)f(0,v,m/(n-1));return u}var mm={paint:new an({"hillshade-illumination-direction":new Ae(Ge.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Ae(Ge.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ae(Ge.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ae(Ge.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ae(Ge.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ae(Ge.paint_hillshade["hillshade-accent-color"])})};const Fy=Ft([{name:"a_pos",components:2,type:"Int16"}],4),{members:a_}=Fy;var Fu={exports:{}};function Mh(t,e,n){n=n||2;var s,u,f,m,v,D,C,P=e&&e.length,F=P?e[0]*n:t.length,N=md(t,0,F,n,!0),$=[];if(!N||N.next===N.prev)return $;if(P&&(N=function(J,ie,ue,ge){var ce,pe,_e,ye=[];for(ce=0,pe=ie.length;ce<pe;ce++)(_e=md(J,ie[ce]*ge,ce<pe-1?ie[ce+1]*ge:J.length,ge,!1))===_e.next&&(_e.steiner=!0),ye.push(u_(_e));for(ye.sort(tu),ce=0;ce<ye.length;ce++)ue=c_(ye[ce],ue);return ue}(t,e,N,n)),t.length>80*n){s=f=t[0],u=m=t[1];for(var G=n;G<F;G+=n)(v=t[G])<s&&(s=v),(D=t[G+1])<u&&(u=D),v>f&&(f=v),D>m&&(m=D);C=0!==(C=Math.max(f-s,m-u))?32767/C:0}return eu(N,$,n,s,u,C,0),$}function md(t,e,n,s,u){var f,m;if(u===Rh(t,e,n,s)>0)for(f=e;f<n;f+=s)m=ym(f,t[f],t[f+1],m);else for(f=n-s;f>=e;f-=s)m=ym(f,t[f],t[f+1],m);return m&&Ah(m,m.next)&&(Ph(m),m=m.next),m}function zu(t,e){if(!t)return t;e||(e=t);var n,s=t;do{if(n=!1,s.steiner||!Ah(s,s.next)&&0!==Fr(s.prev,s,s.next))s=s.next;else{if(Ph(s),(s=e=s.prev)===s.next)break;n=!0}}while(n||s!==e);return e}function eu(t,e,n,s,u,f,m){if(t){!m&&f&&function(P,F,N,$){var G=P;do{0===G.z&&(G.z=Bu(G.x,G.y,F,N,$)),G.prevZ=G.prev,G.nextZ=G.next,G=G.next}while(G!==P);G.prevZ.nextZ=null,G.prevZ=null,function(J){var ie,ue,ge,ce,pe,_e,ye,Oe,ke=1;do{for(ue=J,J=null,pe=null,_e=0;ue;){for(_e++,ge=ue,ye=0,ie=0;ie<ke&&(ye++,ge=ge.nextZ);ie++);for(Oe=ke;ye>0||Oe>0&&ge;)0!==ye&&(0===Oe||!ge||ue.z<=ge.z)?(ce=ue,ue=ue.nextZ,ye--):(ce=ge,ge=ge.nextZ,Oe--),pe?pe.nextZ=ce:J=ce,ce.prevZ=pe,pe=ce;ue=ge}pe.nextZ=null,ke*=2}while(_e>1)}(G)}(t,s,u,f);for(var v,D,C=t;t.prev!==t.next;)if(v=t.prev,D=t.next,f?Nf(t,s,u,f):l_(t))e.push(v.i/n|0),e.push(t.i/n|0),e.push(D.i/n|0),Ph(t),t=D.next,C=D.next;else if((t=D)===C){m?1===m?eu(t=gm(zu(t),e,n),e,n,s,u,f,2):2===m&&_m(t,e,n,s,u,f):eu(zu(t),e,n,s,u,f,1);break}}}function l_(t){var e=t.prev,n=t,s=t.next;if(Fr(e,n,s)>=0)return!1;for(var u=e.x,f=n.x,m=s.x,v=e.y,D=n.y,C=s.y,P=u<f?u<m?u:m:f<m?f:m,F=v<D?v<C?v:C:D<C?D:C,N=u>f?u>m?u:m:f>m?f:m,$=v>D?v>C?v:C:D>C?D:C,G=s.next;G!==e;){if(G.x>=P&&G.x<=N&&G.y>=F&&G.y<=$&&Mc(u,v,f,D,m,C,G.x,G.y)&&Fr(G.prev,G,G.next)>=0)return!1;G=G.next}return!0}function Nf(t,e,n,s){var u=t.prev,f=t,m=t.next;if(Fr(u,f,m)>=0)return!1;for(var v=u.x,D=f.x,C=m.x,P=u.y,F=f.y,N=m.y,$=v<D?v<C?v:C:D<C?D:C,G=P<F?P<N?P:N:F<N?F:N,J=v>D?v>C?v:C:D>C?D:C,ie=P>F?P>N?P:N:F>N?F:N,ue=Bu($,G,e,n,s),ge=Bu(J,ie,e,n,s),ce=t.prevZ,pe=t.nextZ;ce&&ce.z>=ue&&pe&&pe.z<=ge;){if(ce.x>=$&&ce.x<=J&&ce.y>=G&&ce.y<=ie&&ce!==u&&ce!==m&&Mc(v,P,D,F,C,N,ce.x,ce.y)&&Fr(ce.prev,ce,ce.next)>=0||(ce=ce.prevZ,pe.x>=$&&pe.x<=J&&pe.y>=G&&pe.y<=ie&&pe!==u&&pe!==m&&Mc(v,P,D,F,C,N,pe.x,pe.y)&&Fr(pe.prev,pe,pe.next)>=0))return!1;pe=pe.nextZ}for(;ce&&ce.z>=ue;){if(ce.x>=$&&ce.x<=J&&ce.y>=G&&ce.y<=ie&&ce!==u&&ce!==m&&Mc(v,P,D,F,C,N,ce.x,ce.y)&&Fr(ce.prev,ce,ce.next)>=0)return!1;ce=ce.prevZ}for(;pe&&pe.z<=ge;){if(pe.x>=$&&pe.x<=J&&pe.y>=G&&pe.y<=ie&&pe!==u&&pe!==m&&Mc(v,P,D,F,C,N,pe.x,pe.y)&&Fr(pe.prev,pe,pe.next)>=0)return!1;pe=pe.nextZ}return!0}function gm(t,e,n){var s=t;do{var u=s.prev,f=s.next.next;!Ah(u,f)&&_d(u,s,s.next,f)&&Nu(u,f)&&Nu(f,u)&&(e.push(u.i/n|0),e.push(s.i/n|0),e.push(f.i/n|0),Ph(s),Ph(s.next),s=t=f),s=s.next}while(s!==t);return zu(s)}function _m(t,e,n,s,u,f){var m=t;do{for(var v=m.next.next;v!==m.prev;){if(m.i!==v.i&&gd(m,v)){var D=nu(m,v);return m=zu(m,m.next),D=zu(D,D.next),eu(m,e,n,s,u,f,0),void eu(D,e,n,s,u,f,0)}v=v.next}m=m.next}while(m!==t)}function tu(t,e){return t.x-e.x}function c_(t,e){var n=function(u,f){var m,v=f,D=u.x,C=u.y,P=-1/0;do{if(C<=v.y&&C>=v.next.y&&v.next.y!==v.y){var F=v.x+(C-v.y)*(v.next.x-v.x)/(v.next.y-v.y);if(F<=D&&F>P&&(P=F,m=v.x<v.next.x?v:v.next,F===D))return m}v=v.next}while(v!==f);if(!m)return null;var N,$=m,G=m.x,J=m.y,ie=1/0;v=m;do{D>=v.x&&v.x>=G&&D!==v.x&&Mc(C<J?D:P,C,G,J,C<J?P:D,C,v.x,v.y)&&(N=Math.abs(C-v.y)/(D-v.x),Nu(v,u)&&(N<ie||N===ie&&(v.x>m.x||v.x===m.x&&Uf(m,v)))&&(m=v,ie=N)),v=v.next}while(v!==$);return m}(t,e);if(!n)return e;var s=nu(n,t);return zu(s,s.next),zu(n,n.next)}function Uf(t,e){return Fr(t.prev,t,e.prev)<0&&Fr(e.next,t,t.next)<0}function Bu(t,e,n,s,u){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*u|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-s)*u|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function u_(t){var e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function Mc(t,e,n,s,u,f,m,v){return(u-m)*(e-v)>=(t-m)*(f-v)&&(t-m)*(s-v)>=(n-m)*(e-v)&&(n-m)*(f-v)>=(u-m)*(s-v)}function gd(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(n,s){var u=n;do{if(u.i!==n.i&&u.next.i!==n.i&&u.i!==s.i&&u.next.i!==s.i&&_d(u,u.next,n,s))return!0;u=u.next}while(u!==n);return!1}(t,e)&&(Nu(t,e)&&Nu(e,t)&&function(n,s){var u=n,f=!1,m=(n.x+s.x)/2,v=(n.y+s.y)/2;do{u.y>v!=u.next.y>v&&u.next.y!==u.y&&m<(u.next.x-u.x)*(v-u.y)/(u.next.y-u.y)+u.x&&(f=!f),u=u.next}while(u!==n);return f}(t,e)&&(Fr(t.prev,t,e.prev)||Fr(t,e.prev,e))||Ah(t,e)&&Fr(t.prev,t,t.next)>0&&Fr(e.prev,e,e.next)>0)}function Fr(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function Ah(t,e){return t.x===e.x&&t.y===e.y}function _d(t,e,n,s){var u=vd(Fr(t,e,n)),f=vd(Fr(t,e,s)),m=vd(Fr(n,s,t)),v=vd(Fr(n,s,e));return u!==f&&m!==v||!(0!==u||!yd(t,n,e))||!(0!==f||!yd(t,s,e))||!(0!==m||!yd(n,t,s))||!(0!==v||!yd(n,e,s))}function yd(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function vd(t){return t>0?1:t<0?-1:0}function Nu(t,e){return Fr(t.prev,t,t.next)<0?Fr(t,e,t.next)>=0&&Fr(t,t.prev,e)>=0:Fr(t,e,t.prev)<0||Fr(t,t.next,e)<0}function nu(t,e){var n=new jf(t.i,t.x,t.y),s=new jf(e.i,e.x,e.y),u=t.next,f=e.prev;return t.next=e,e.prev=t,n.next=u,u.prev=n,s.next=n,n.prev=s,f.next=s,s.prev=f,s}function ym(t,e,n,s){var u=new jf(t,e,n);return s?(u.next=s.next,u.prev=s,s.next.prev=u,s.next=u):(u.prev=u,u.next=u),u}function Ph(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function jf(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Rh(t,e,n,s){for(var u=0,f=e,m=n-s;f<n;f+=s)u+=(t[m]-t[f])*(t[f+1]+t[m+1]),m=f;return u}function h_(t,e,n,s,u){Vf(t,e,n||0,s||t.length-1,u||vm)}function Vf(t,e,n,s,u){for(;s>n;){if(s-n>600){var f=s-n+1,m=e-n+1,v=Math.log(f),D=.5*Math.exp(2*v/3),C=.5*Math.sqrt(v*D*(f-D)/f)*(m-f/2<0?-1:1);Vf(t,e,Math.max(n,Math.floor(e-m*D/f+C)),Math.min(s,Math.floor(e+(f-m)*D/f+C)),u)}var P=t[e],F=n,N=s;for(Lh(t,n,e),u(t[s],P)>0&&Lh(t,n,s);F<N;){for(Lh(t,F,N),F++,N--;u(t[F],P)<0;)F++;for(;u(t[N],P)>0;)N--}0===u(t[n],P)?Lh(t,n,N):Lh(t,++N,s),N<=e&&(n=N+1),e<=N&&(s=N-1)}}function Lh(t,e,n){var s=t[e];t[e]=t[n],t[n]=s}function vm(t,e){return t<e?-1:t>e?1:0}function xm(t,e){const n=t.length;if(n<=1)return[t];const s=[];let u,f;for(let m=0;m<n;m++){const v=zt(t[m]);0!==v&&(t[m].area=Math.abs(v),void 0===f&&(f=v<0),f===v<0?(u&&s.push(u),u=[t[m]]):u.push(t[m]))}if(u&&s.push(u),e>1)for(let m=0;m<s.length;m++)s[m].length<=e||(h_(s[m],e,1,s[m].length-1,d_),s[m]=s[m].slice(0,e));return s}function d_(t,e){return e.area-t.area}function ru(t,e,n){const s=n.patternDependencies;let u=!1;for(const f of e){const m=f.paint.get(`${t}-pattern`);m.isConstant()||(u=!0);const v=m.constantOr(null);v&&(u=!0,s[v]=!0)}return u}function $f(t,e,n,s,u){const f=u.patternDependencies;for(const m of e){const v=m.paint.get(`${t}-pattern`).value;if("constant"!==v.kind){let D=v.evaluate({zoom:s},n,{},u.availableImages);D=D&&D.name?D.name:D,f[D]=!0,n.patterns[m.id]=D}}return n}Fu.exports=Mh,Fu.exports.default=Mh,Mh.deviation=function(t,e,n,s){var u=e&&e.length,f=Math.abs(Rh(t,0,u?e[0]*n:t.length,n));if(u)for(var m=0,v=e.length;m<v;m++)f-=Math.abs(Rh(t,e[m]*n,m<v-1?e[m+1]*n:t.length,n));var D=0;for(m=0;m<s.length;m+=3){var C=s[m]*n,P=s[m+1]*n,F=s[m+2]*n;D+=Math.abs((t[C]-t[F])*(t[P+1]-t[C+1])-(t[C]-t[P])*(t[F+1]-t[C+1]))}return 0===f&&0===D?0:Math.abs((D-f)/f)},Mh.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},s=0,u=0;u<t.length;u++){for(var f=0;f<t[u].length;f++)for(var m=0;m<e;m++)n.vertices.push(t[u][f][m]);u>0&&n.holes.push(s+=t[u-1].length)}return n};class Jl{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new hr,this.indexArray=new Ji,this.indexArray2=new ha,this.programConfigurations=new Xc(e.layers,e.zoom),this.segments=new xi,this.segments2=new xi,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.projection=e.projection}populate(e,n,s,u){this.hasPattern=ru("fill",this.layers,n);const f=this.layers[0].layout.get("fill-sort-key"),m=[];for(const{feature:v,id:D,index:C,sourceLayerIndex:P}of e){const F=this.layers[0]._featureFilter.needGeometry,N=Va(v,F);if(!this.layers[0]._featureFilter.filter(new Te(this.zoom),N,s))continue;const $=f?f.evaluate(N,{},s,n.availableImages):void 0,G={id:D,properties:v.properties,type:v.type,sourceLayerIndex:P,index:C,geometry:F?N.geometry:ja(v,s,u),patterns:{},sortKey:$};m.push(G)}f&&m.sort((v,D)=>v.sortKey-D.sortKey);for(const v of m){const{geometry:D,index:C,sourceLayerIndex:P}=v;if(this.hasPattern){const F=$f("fill",this.layers,v,this.zoom,n);this.patternFeatures.push(F)}else this.addFeature(v,D,C,s,{},n.availableImages);n.featureIndex.insert(e[C].feature,D,C,P,this.index)}}update(e,n,s,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,s,u)}addFeatures(e,n,s,u,f){for(const m of this.patternFeatures)this.addFeature(m,m.geometry,m.index,n,s,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,a_),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,n,s,u,f,m=[]){for(const v of xm(n,500)){let D=0;for(const G of v)D+=G.length;const C=this.segments.prepareSegment(D,this.layoutVertexArray,this.indexArray),P=C.vertexLength,F=[],N=[];for(const G of v){if(0===G.length)continue;G!==v[0]&&N.push(F.length/2);const J=this.segments2.prepareSegment(G.length,this.layoutVertexArray,this.indexArray2),ie=J.vertexLength;this.layoutVertexArray.emplaceBack(G[0].x,G[0].y),this.indexArray2.emplaceBack(ie+G.length-1,ie),F.push(G[0].x),F.push(G[0].y);for(let ue=1;ue<G.length;ue++)this.layoutVertexArray.emplaceBack(G[ue].x,G[ue].y),this.indexArray2.emplaceBack(ie+ue-1,ie+ue),F.push(G[ue].x),F.push(G[ue].y);J.vertexLength+=G.length,J.primitiveLength+=G.length}const $=Fu.exports(F,N);for(let G=0;G<$.length;G+=3)this.indexArray.emplaceBack(P+$[G],P+$[G+1],P+$[G+2]);C.vertexLength+=D,C.primitiveLength+=$.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,f,m,u)}}Ot(Jl,"FillBucket",{omit:["layers","patternFeatures"]});const kh=new an({"fill-sort-key":new Be(Ge.layout_fill["fill-sort-key"])});var f_={paint:new an({"fill-antialias":new Ae(Ge.paint_fill["fill-antialias"]),"fill-opacity":new Be(Ge.paint_fill["fill-opacity"]),"fill-color":new Be(Ge.paint_fill["fill-color"]),"fill-outline-color":new Be(Ge.paint_fill["fill-outline-color"]),"fill-translate":new Ae(Ge.paint_fill["fill-translate"]),"fill-translate-anchor":new Ae(Ge.paint_fill["fill-translate-anchor"]),"fill-pattern":new Be(Ge.paint_fill["fill-pattern"])}),layout:kh};const bm=Ft([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),p_=Ft([{name:"a_centroid_pos",components:2,type:"Uint16"}]),m_=Ft([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:g_}=bm;var Oh={},__=Qe,xd=Ac;function Ac(t,e,n,s,u){this.properties={},this.extent=n,this.type=0,this._pbf=t,this._geometry=-1,this._keys=s,this._values=u,t.readFields(y_,this,e)}function y_(t,e,n){1==t?e.id=n.readVarint():2==t?function(s,u){for(var f=s.readVarint()+s.pos;s.pos<f;){var m=u._keys[s.readVarint()],v=u._values[s.readVarint()];u.properties[m]=v}}(n,e):3==t?e.type=n.readVarint():4==t&&(e._geometry=n.pos)}function Gf(t){for(var e,n,s=0,u=0,f=t.length,m=f-1;u<f;m=u++)s+=((n=t[m]).x-(e=t[u]).x)*(e.y+n.y);return s}Ac.types=["Unknown","Point","LineString","Polygon"],Ac.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,n=t.readVarint()+t.pos,s=1,u=0,f=0,m=0,v=[];t.pos<n;){if(u<=0){var D=t.readVarint();s=7&D,u=D>>3}if(u--,1===s||2===s)f+=t.readSVarint(),m+=t.readSVarint(),1===s&&(e&&v.push(e),e=[]),e.push(new __(f,m));else{if(7!==s)throw new Error("unknown command "+s);e&&e.push(e[0].clone())}}return e&&v.push(e),v},Ac.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,n=1,s=0,u=0,f=0,m=1/0,v=-1/0,D=1/0,C=-1/0;t.pos<e;){if(s<=0){var P=t.readVarint();n=7&P,s=P>>3}if(s--,1===n||2===n)(u+=t.readSVarint())<m&&(m=u),u>v&&(v=u),(f+=t.readSVarint())<D&&(D=f),f>C&&(C=f);else if(7!==n)throw new Error("unknown command "+n)}return[m,D,v,C]},Ac.prototype.toGeoJSON=function(t,e,n){var s,u,f=this.extent*Math.pow(2,n),m=this.extent*t,v=this.extent*e,D=this.loadGeometry(),C=Ac.types[this.type];function P($){for(var G=0;G<$.length;G++){var J=$[G];$[G]=[360*(J.x+m)/f-180,360/Math.PI*Math.atan(Math.exp((180-360*(J.y+v)/f)*Math.PI/180))-90]}}switch(this.type){case 1:var F=[];for(s=0;s<D.length;s++)F[s]=D[s][0];P(D=F);break;case 2:for(s=0;s<D.length;s++)P(D[s]);break;case 3:for(D=function($){var G=$.length;if(G<=1)return[$];for(var J,ie,ue=[],ge=0;ge<G;ge++){var ce=Gf($[ge]);0!==ce&&(void 0===ie&&(ie=ce<0),ie===ce<0?(J&&ue.push(J),J=[$[ge]]):J.push($[ge]))}return J&&ue.push(J),ue}(D),s=0;s<D.length;s++)for(u=0;u<D[s].length;u++)P(D[s][u])}1===D.length?D=D[0]:C="Multi"+C;var N={type:"Feature",geometry:{type:C,coordinates:D},properties:this.properties};return"id"in this&&(N.id=this.id),N};var Fh=xd,wm=Em;function Em(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(v_,this,e),this.length=this._features.length}function v_(t,e,n){15===t?e.version=n.readVarint():1===t?e.name=n.readString():5===t?e.extent=n.readVarint():2===t?e._features.push(n.pos):3===t?e._keys.push(n.readString()):4===t&&e._values.push(function(s){for(var u=null,f=s.readVarint()+s.pos;s.pos<f;){var m=s.readVarint()>>3;u=1===m?s.readString():2===m?s.readFloat():3===m?s.readDouble():4===m?s.readVarint64():5===m?s.readVarint():6===m?s.readSVarint():7===m?s.readBoolean():null}return u}(n))}Em.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new Fh(this._pbf,e,this.extent,this._keys,this._values)};var x_=wm;function b_(t,e,n){if(3===t){var s=new x_(n,n.readVarint()+n.pos);s.length&&(e[s.name]=s)}}var Hf=Oh.VectorTile=function(t,e){this.layers=t.readFields(b_,{},e)},bd=Oh.VectorTileFeature=xd;function Ql(t,e,n,s){const u=[],f=0===s?(m,v,D,C,P,F)=>{m.push(new Qe(F,D+(F-v)/(C-v)*(P-D)))}:(m,v,D,C,P,F)=>{m.push(new Qe(v+(F-D)/(P-D)*(C-v),F))};for(const m of t){const v=[];for(const D of m){if(D.length<=2)continue;const C=[];for(let N=0;N<D.length-1;N++){const $=D[N].x,G=D[N].y,J=D[N+1].x,ie=D[N+1].y,ue=0===s?$:G,ge=0===s?J:ie;ue<e?ge>e&&f(C,$,G,J,ie,e):ue>n?ge<n&&f(C,$,G,J,ie,n):C.push(D[N]),ge<e&&ue>=e&&f(C,$,G,J,ie,e),ge>n&&ue<=n&&f(C,$,G,J,ie,n)}let P=D[D.length-1];const F=0===s?P.x:P.y;F>=e&&F<=n&&C.push(P),C.length&&(P=C[C.length-1],C[0].x===P.x&&C[0].y===P.y||C.push(C[0]),v.push(C))}v.length&&u.push(v)}return u}Oh.VectorTileLayer=wm;const ec=bd.types,w_=Math.pow(2,13);function zh(t,e,n,s,u,f,m,v){t.emplaceBack((e<<1)+m,(n<<1)+f,(Math.floor(s*w_)<<1)+u,Math.round(v))}function wd(t,e,n){t.emplaceBack(e.x,e.y,e.z,16384*n[0],16384*n[1],16384*n[2])}class E_{constructor(){this.acc=new Qe(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new Qe(e.x,e.y),this.max=new Qe(e.x,e.y))}append(e,n){this.currentPolyCount.edges++,this.acc._add(e);const s=this.min,u=this.max;e.x<s.x?s.x=e.x:e.x>u.x&&(u.x=e.x),e.y<s.y?s.y=e.y:e.y>u.y&&(u.y=e.y),((0===e.x||e.x===pn)&&e.x===n.x)!=((0===e.y||e.y===pn)&&e.y===n.y)&&this.processBorderOverlap(e,n),n.x<0!=e.x<0&&this.addBorderIntersection(0,gn(n.y,e.y,(0-n.x)/(e.x-n.x))),n.x>pn!=e.x>pn&&this.addBorderIntersection(1,gn(n.y,e.y,(pn-n.x)/(e.x-n.x))),n.y<0!=e.y<0&&this.addBorderIntersection(2,gn(n.x,e.x,(0-n.y)/(e.y-n.y))),n.y>pn!=e.y>pn&&this.addBorderIntersection(3,gn(n.x,e.x,(pn-n.y)/(e.y-n.y)))}addBorderIntersection(e,n){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const s=this.borders[e];n<s[0]&&(s[0]=n),n>s[1]&&(s[1]=n)}processBorderOverlap(e,n){if(e.x===n.x){if(e.y===n.y)return;const s=0===e.x?0:1;this.addBorderIntersection(s,n.y),this.addBorderIntersection(s,e.y)}else{const s=0===e.y?2:3;this.addBorderIntersection(s,n.x),this.addBorderIntersection(s,e.x)}}centroid(){const e=this.polyCount.reduce((n,s)=>n+s.edges,0);return 0!==e?this.acc.div(e)._round():new Qe(0,0)}span(){return new Qe(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,n)=>e+ +(n[0]!==Number.MAX_VALUE),0)}}class Uu{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.layoutVertexArray=new xr,this.centroidVertexArray=new hf,this.indexArray=new Ji,this.programConfigurations=new Xc(e.layers,e.zoom),this.segments=new xi,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.enableTerrain=e.enableTerrain}populate(e,n,s,u){this.features=[],this.hasPattern=ru("fill-extrusion",this.layers,n),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(f){const m=Math.exp(Math.PI*(1-f.y/(1<<f.z)*2));return 80150034*m/(m*m+1)/pn/(1<<f.z)}(s),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:f,id:m,index:v,sourceLayerIndex:D}of e){const C=this.layers[0]._featureFilter.needGeometry,P=Va(f,C);if(!this.layers[0]._featureFilter.filter(new Te(this.zoom),P,s))continue;const F={id:m,sourceLayerIndex:D,index:v,geometry:C?P.geometry:ja(f,s,u),properties:f.properties,type:f.type,patterns:{}},N=this.layoutVertexArray.length;this.hasPattern?this.features.push($f("fill-extrusion",this.layers,F,this.zoom,n)):this.addFeature(F,F.geometry,v,s,{},n.availableImages,u),n.featureIndex.insert(f,F.geometry,v,D,this.index,N)}this.sortBorders()}addFeatures(e,n,s,u,f){for(const m of this.features){const{geometry:v}=m;this.addFeature(m,v,m.index,n,s,u,f)}this.sortBorders()}update(e,n,s,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,s,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,g_),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,m_.members,!0))),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,p_.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,n,s,u,f,m,v){const D=[new Qe(0,0),new Qe(pn,pn)],C=v.projection,P="globe"===C.name,F=this.enableTerrain&&!P?new E_:null,N="Polygon"===ec[e.type];P&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Or);const $=xm(n,500);for(let ue=$.length-1;ue>=0;ue--){const ge=$[ue];(0===ge.length||(G=ge[0]).every(ce=>ce.x<=0)||G.every(ce=>ce.x>=pn)||G.every(ce=>ce.y<=0)||G.every(ce=>ce.y>=pn))&&$.splice(ue,1)}var G;let J;if(P)J=ma($,D,u);else{J=[];for(const ue of $)J.push({polygon:ue,bounds:D})}const ie=N?this.edgeRadius:0;for(const{polygon:ue,bounds:ge}of J){let ce=0,pe=0;for(const ye of ue)N&&!ye[0].equals(ye[ye.length-1])&&ye.push(ye[0]),pe+=N?ye.length-1:ye.length;const _e=this.segments.prepareSegment((N?5:4)*pe,this.layoutVertexArray,this.indexArray);if(N){const ye=[],Oe=[];ce=_e.vertexLength;for(const Ze of ue){let dt,je;Ze.length&&Ze!==ue[0]&&Oe.push(ye.length/2),dt=Ze[1].sub(Ze[0])._perp()._unit();for(let Xe=1;Xe<Ze.length;Xe++){const Ye=Ze[Xe],st=Ze[Xe===Ze.length-1?1:Xe+1];let{x:ft,y:Ve}=Ye;if(ie){je=st.sub(Ye)._perp()._unit();const It=dt.add(je)._unit(),ln=ie*Math.min(4,1/(dt.x*It.x+dt.y*It.y));ft+=ln*It.x,Ve+=ln*It.y,dt=je}zh(this.layoutVertexArray,ft,Ve,0,0,1,1,0),_e.vertexLength++,ye.push(Ye.x,Ye.y),P&&wd(this.layoutVertexExtArray,C.projectTilePoint(ft,Ve,u),C.upVector(u,ft,Ve))}}const ke=Fu.exports(ye,Oe);for(let Ze=0;Ze<ke.length;Ze+=3)this.indexArray.emplaceBack(ce+ke[Ze],ce+ke[Ze+2],ce+ke[Ze+1]),_e.primitiveLength++}for(const ye of ue){F&&ye.length&&F.startRing(ye[0]);let Oe,ke,Ze,dt=ye.length>4&&qf(ye[ye.length-2],ye[0],ye[1]),je=ie?Dm(ye[ye.length-2],ye[0],ye[1],ie):0;ke=ye[1].sub(ye[0])._perp()._unit();let Xe=!0;for(let Ye=1,st=0;Ye<ye.length;Ye++){let ft=ye[Ye-1],Ve=ye[Ye];const It=ye[Ye===ye.length-1?1:Ye+1];if(F&&N&&F.currentPolyCount.top++,Tm(Ve,ft,ge)){ie&&(ke=It.sub(Ve)._perp()._unit(),Xe=!Xe);continue}F&&F.append(Ve,ft);const ln=Ve.sub(ft)._perp(),Rt=ln.x/(Math.abs(ln.x)+Math.abs(ln.y)),Wt=ln.y>0?1:0,Mt=ft.dist(Ve);if(st+Mt>32768&&(st=0),ie){Ze=It.sub(Ve)._perp()._unit();let kn=Zf(ft,Ve,It,D_(ke,Ze),ie);isNaN(kn)&&(kn=0);const hn=Ve.sub(ft)._unit();ft=ft.add(hn.mult(je))._round(),Ve=Ve.add(hn.mult(-kn))._round(),je=kn,ke=Ze}const un=_e.vertexLength,Fn=ye.length>4&&qf(ft,Ve,It);let Rn=Cm(st,dt,Xe);if(zh(this.layoutVertexArray,ft.x,ft.y,Rt,Wt,0,0,Rn),zh(this.layoutVertexArray,ft.x,ft.y,Rt,Wt,0,1,Rn),st+=Mt,Rn=Cm(st,Fn,!Xe),dt=Fn,zh(this.layoutVertexArray,Ve.x,Ve.y,Rt,Wt,0,0,Rn),zh(this.layoutVertexArray,Ve.x,Ve.y,Rt,Wt,0,1,Rn),_e.vertexLength+=4,this.indexArray.emplaceBack(un+0,un+1,un+2),this.indexArray.emplaceBack(un+1,un+3,un+2),_e.primitiveLength+=2,ie){const kn=ce+(1===Ye?ye.length-2:Ye-2),hn=1===Ye?ce:kn+1;if(this.indexArray.emplaceBack(un+1,kn,un+3),this.indexArray.emplaceBack(kn,hn,un+3),_e.primitiveLength+=2,void 0===Oe&&(Oe=un),!Tm(It,ye[Ye],ge)){const gr=Ye===ye.length-1?Oe:_e.vertexLength;this.indexArray.emplaceBack(un+2,un+3,gr),this.indexArray.emplaceBack(un+3,gr+1,gr),this.indexArray.emplaceBack(un+3,hn,gr+1),_e.primitiveLength+=3}Xe=!Xe}if(P){const kn=this.layoutVertexExtArray,hn=C.projectTilePoint(ft.x,ft.y,u),gr=C.projectTilePoint(Ve.x,Ve.y,u),En=C.upVector(u,ft.x,ft.y),Bn=C.upVector(u,Ve.x,Ve.y);wd(kn,hn,En),wd(kn,hn,En),wd(kn,gr,Bn),wd(kn,gr,Bn)}}N&&(ce+=ye.length-1)}}if(F&&F.polyCount.length>0){if(F.borders){F.vertexArrayOffset=this.centroidVertexArray.length;const ue=F.borders,ge=this.featuresOnBorder.push(F)-1;for(let ce=0;ce<4;ce++)ue[ce][0]!==Number.MAX_VALUE&&this.borders[ce].push(ge)}this.encodeCentroid(F.borders?void 0:F.centroid(),F)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,f,m,u)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((n,s)=>this.featuresOnBorder[n].borders[e][0]-this.featuresOnBorder[s].borders[e][0])}encodeCentroid(e,n,s=!0){let u,f;if(e)if(0!==e.y){const v=n.span()._mult(this.tileToMeter);u=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(v.x/10)),f=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(v.y/10))}else u=Math.ceil(7*(e.x+450)),f=0;else u=0,f=+s;let m=s?this.centroidVertexArray.length:n.vertexArrayOffset;for(const v of n.polyCount){s&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*v.edges+v.top);for(let D=0;D<v.top;D++)this.centroidVertexArray.emplace(m++,u,f);for(let D=0;D<2*v.edges;D++)this.centroidVertexArray.emplace(m++,0,f),this.centroidVertexArray.emplace(m++,u,f)}}}function D_(t,e){const n=t.add(e)._unit();return t.x*n.x+t.y*n.y}function Dm(t,e,n,s){const u=e.sub(t)._perp()._unit(),f=n.sub(e)._perp()._unit();return Zf(t,e,n,D_(u,f),s)}function Zf(t,e,n,s,u){const f=Math.sqrt(1-s*s);return Math.min(t.dist(e)/3,e.dist(n)/3,u*f/s)}function Tm(t,e,n){return t.x<n[0].x&&e.x<n[0].x||t.x>n[1].x&&e.x>n[1].x||t.y<n[0].y&&e.y<n[0].y||t.y>n[1].y&&e.y>n[1].y}function qf(t,e,n){if(t.x<0||t.x>=pn||e.x<0||e.x>=pn||n.x<0||n.x>=pn)return!1;const s=n.sub(e),u=s.perp(),f=t.sub(e);return(s.x*f.x+s.y*f.y)/Math.sqrt((s.x*s.x+s.y*s.y)*(f.x*f.x+f.y*f.y))>-.866&&u.x*f.x+u.y*f.y<0}function Cm(t,e,n){const s=e?2|t:-3&t;return n?1|s:-2&s}function Sm(){const t=Math.PI/32,e=Math.tan(t),n=sd;return n*Math.sqrt(1+2*e*e)-n}function ma(t,e,n){const s=1<<n.z,u=fa(n.x/s),f=fa((n.x+1)/s),m=Fi(n.y/s),v=Fi((n.y+1)/s);return function(D,C,P,F,N=0,$){const G=[];if(!D.length||!P||!F)return G;const J=(ye,Oe)=>{for(const ke of ye)G.push({polygon:ke,bounds:Oe})},ie=Math.ceil(Math.log2(P)),ue=Math.ceil(Math.log2(F)),ge=ie-ue,ce=[];for(let ye=0;ye<Math.abs(ge);ye++)ce.push(ge>0?0:1);for(let ye=0;ye<Math.min(ie,ue);ye++)ce.push(0),ce.push(1);let pe=D;if(pe=Ql(pe,C[0].y-N,C[1].y+N,1),pe=Ql(pe,C[0].x-N,C[1].x+N,0),!pe.length)return G;const _e=[];for(ce.length?_e.push({polygons:pe,bounds:C,depth:0}):J(pe,C);_e.length;){const ye=_e.pop(),Oe=ye.depth,ke=ce[Oe],Ze=ye.bounds[0],dt=ye.bounds[1],je=0===ke?Ze.x:Ze.y,Xe=0===ke?dt.x:dt.y,Ye=$?$(ke,je,Xe):.5*(je+Xe),st=Ql(ye.polygons,je-N,Ye+N,ke),ft=Ql(ye.polygons,Ye-N,Xe+N,ke);if(st.length){const Ve=[Ze,new Qe(0===ke?Ye:dt.x,1===ke?Ye:dt.y)];ce.length>Oe+1?_e.push({polygons:st,bounds:Ve,depth:Oe+1}):J(st,Ve)}if(ft.length){const Ve=[new Qe(0===ke?Ye:Ze.x,1===ke?Ye:Ze.y),dt];ce.length>Oe+1?_e.push({polygons:ft,bounds:Ve,depth:Oe+1}):J(ft,Ve)}}return G}(t,e,Math.ceil((f-u)/11.25),Math.ceil((m-v)/11.25),1,(D,C,P)=>{if(0===D)return.5*(C+P);{const F=Fi((n.y+C/pn)/s);return(Na(.5*(Fi((n.y+P/pn)/s)+F))*s-n.y)*pn}})}Ot(Uu,"FillExtrusionBucket",{omit:["layers","features"]}),Ot(E_,"PartMetadata");const T_=new an({"fill-extrusion-edge-radius":new Ae(Ge["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var Im={paint:new an({"fill-extrusion-opacity":new Ae(Ge["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Be(Ge["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ae(Ge["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ae(Ge["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Be(Ge["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Be(Ge["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Be(Ge["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Ae(Ge["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Ae(Ge["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Ae(Ge["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"])}),layout:T_};function Mm(t,e,n){var s=2*Math.PI*6378137/256/Math.pow(2,n);return[t*s-2*Math.PI*6378137/2,e*s-2*Math.PI*6378137/2]}class Ed{constructor(e,n,s){this.z=e,this.x=n,this.y=s,this.key=ju(0,e,e,n,s)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,n){const s=(m=this.y,v=this.z,D=Mm(256*(f=this.x),256*(m=Math.pow(2,v)-m-1),v),C=Mm(256*(f+1),256*(m+1),v),D[0]+","+D[1]+","+C[0]+","+C[1]),u=function(f,m,v){let D,C="";for(let P=f;P>0;P--)D=1<<P-1,C+=(m&D?1:0)+(v&D?2:0);return C}(this.z,this.x,this.y);var f,m,v,D,C;return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===n?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",u).replace("{bbox-epsg-3857}",s)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Am{constructor(e,n){this.wrap=e,this.canonical=n,this.key=ju(e,n.z,n.z,n.x,n.y)}}class Vo{constructor(e,n,s,u,f){this.overscaledZ=e,this.wrap=n,this.canonical=new Ed(s,+u,+f),this.key=0===n&&e===s?this.canonical.key:ju(n,e,s,u,f)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const n=this.canonical.z-e;return e>this.canonical.z?new Vo(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Vo(e,this.wrap,e,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(e,n=!0){if(this.overscaledZ===e&&n)return this.key;if(e>this.canonical.z)return ju(this.wrap*+n,e,this.canonical.z,this.canonical.x,this.canonical.y);{const s=this.canonical.z-e;return ju(this.wrap*+n,e,e,this.canonical.x>>s,this.canonical.y>>s)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const n=this.canonical.z-e.canonical.z;return 0===e.overscaledZ||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>n&&e.canonical.y===this.canonical.y>>n}children(e){if(this.overscaledZ>=e)return[new Vo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,s=2*this.canonical.x,u=2*this.canonical.y;return[new Vo(n,this.wrap,n,s,u),new Vo(n,this.wrap,n,s+1,u),new Vo(n,this.wrap,n,s,u+1),new Vo(n,this.wrap,n,s+1,u+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Vo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Vo(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Am(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function ju(t,e,n,s,u){const f=1<<Math.min(n,22);let m=f*(u%f)+s%f;return t&&n<22&&(m+=f*f*((t<0?-2*t-1:2*t)%(1<<2*(22-n)))),16*(32*m+n)+(e-n)}Ot(Ed,"CanonicalTileID"),Ot(Vo,"OverscaledTileID",{omit:["projMatrix"]});class Vu extends Qe{constructor(e,n,s){super(e,n),this.z=s}}function Bh(t,e){return t.x*e.x+t.y*e.y}function Pm(t,e){if(1===t.length){let n=0;const s=e[n++];let u;for(;!u||s.equals(u);)if(u=e[n++],!u)return 1/0;for(;n<e.length;n++){const f=e[n],m=t[0],v=u.sub(s),D=f.sub(s),C=m.sub(s),P=Bh(v,v),F=Bh(v,D),N=Bh(D,D),$=Bh(C,v),G=Bh(C,D),J=P*N-F*F,ie=(N*$-F*G)/J,ue=(P*G-F*$)/J,ge=s.z*(1-ie-ue)+u.z*ie+f.z*ue;if(isFinite(ge))return ge}return 1/0}{let n=1/0;for(const s of e)n=Math.min(n,s.z);return n}}function zn(t,e,n,s,u,f,m,v){const D=m*u.getElevationAt(t,e,!0,!0),C=0!==f[0],P=C?0===f[1]?m*(f[0]/7-450):m*function(F,N,$){const G=Math.floor(N[0]/8),J=Math.floor(N[1]/8),ie=10*(N[0]-8*G),ue=10*(N[1]-8*J),ge=F.getElevationAt(G,J,!0,!0),ce=F.getMeterToDEM($),pe=Math.floor(.5*(ie*ce-1)),_e=Math.floor(.5*(ue*ce-1)),ye=F.tileCoordToPixel(G,J),Oe=2*pe+1,ke=2*_e+1,Ze=(ln=Oe,Rt=ke,[(ft=F).getElevationAtPixel(Ve=ye.x-pe,It=ye.y-_e,!0),ft.getElevationAtPixel(Ve+Rt,It,!0),ft.getElevationAtPixel(Ve,It+Rt,!0),ft.getElevationAtPixel(Ve+ln,It+Rt,!0)]),dt=Math.abs(Ze[0]-Ze[1]),je=Math.abs(Ze[2]-Ze[3]),Xe=Math.abs(Ze[0]-Ze[2])+Math.abs(Ze[1]-Ze[3]),Ye=Math.min(.25,.5*ce*(dt+je)/Oe),st=Math.min(.25,.5*ce*Xe/ke);var ft,Ve,It,ln,Rt;return ge+Math.max(Ye*ie,st*ue)}(u,f,v):D;return{base:D+(0===n)?-1:n,top:C?Math.max(P+s,D+n+2):D+s}}const Rm=Ft([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:Lm}=Rm,km=Ft([{name:"a_packed",components:4,type:"Float32"}]),{members:C_}=km,S_=bd.types,Om=Math.cos(Math.PI/180*37.5);class Dd{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new Qo,this.layoutVertexArray2=new es,this.indexArray=new Ji,this.programConfigurations=new Xc(e.layers,e.zoom),this.segments=new xi,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,s,u){this.hasPattern=ru("line",this.layers,n);const f=this.layers[0].layout.get("line-sort-key"),m=[];for(const{feature:P,id:F,index:N,sourceLayerIndex:$}of e){const G=this.layers[0]._featureFilter.needGeometry,J=Va(P,G);if(!this.layers[0]._featureFilter.filter(new Te(this.zoom),J,s))continue;const ie=f?f.evaluate(J,{},s):void 0,ue={id:F,properties:P.properties,type:P.type,sourceLayerIndex:$,index:N,geometry:G?J.geometry:ja(P,s,u),patterns:{},sortKey:ie};m.push(ue)}f&&m.sort((P,F)=>P.sortKey-F.sortKey);const{lineAtlas:v,featureIndex:D}=n,C=this.addConstantDashes(v);for(const P of m){const{geometry:F,index:N,sourceLayerIndex:$}=P;if(C&&this.addFeatureDashes(P,v),this.hasPattern){const G=$f("line",this.layers,P,this.zoom,n);this.patternFeatures.push(G)}else this.addFeature(P,F,N,s,v.positions,n.availableImages);D.insert(e[N].feature,F,N,$,this.index)}}addConstantDashes(e){let n=!1;for(const s of this.layers){const u=s.paint.get("line-dasharray").value,f=s.layout.get("line-cap").value;if("constant"!==u.kind||"constant"!==f.kind)n=!0;else{const m=f.value,v=u.value;if(!v)continue;e.addDash(v,m)}}return n}addFeatureDashes(e,n){const s=this.zoom;for(const u of this.layers){const f=u.paint.get("line-dasharray").value,m=u.layout.get("line-cap").value;if("constant"===f.kind&&"constant"===m.kind)continue;let v,D;if("constant"===f.kind){if(v=f.value,!v)continue}else v=f.evaluate({zoom:s},e);D="constant"===m.kind?m.value:m.evaluate({zoom:s},e),n.addDash(v,D),e.patterns[u.id]=n.getKey(v,D)}}update(e,n,s,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,s,u)}addFeatures(e,n,s,u,f){for(const m of this.patternFeatures)this.addFeature(m,m.geometry,m.index,n,s,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,C_)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Lm),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,n,s,u,f,m){const v=this.layers[0].layout,D=v.get("line-join").evaluate(e,{}),C=v.get("line-cap").evaluate(e,{}),P=v.get("line-miter-limit"),F=v.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const N of n)this.addLine(N,e,D,C,P,F);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,f,m,u)}addLine(e,n,s,u,f,m){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ue=0;ue<e.length-1;ue++)this.totalDistance+=e[ue].dist(e[ue+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const v="Polygon"===S_[n.type];let D=e.length;for(;D>=2&&e[D-1].equals(e[D-2]);)D--;let C=0;for(;C<D-1&&e[C].equals(e[C+1]);)C++;if(D<(v?3:2))return;"bevel"===s&&(f=1.05);const P=this.overscaling<=16?122880/(512*this.overscaling):0,F=this.segments.prepareSegment(10*D,this.layoutVertexArray,this.indexArray);let N,$,G,J,ie;this.e1=this.e2=-1,v&&(N=e[D-2],ie=e[C].sub(N)._unit()._perp());for(let ue=C;ue<D;ue++){if(G=ue===D-1?v?e[C+1]:void 0:e[ue+1],G&&e[ue].equals(G))continue;ie&&(J=ie),N&&($=N),N=e[ue],ie=G?G.sub(N)._unit()._perp():J,J=J||ie;let ge=J.add(ie);0===ge.x&&0===ge.y||ge._unit();const ce=J.x*ie.x+J.y*ie.y,pe=ge.x*ie.x+ge.y*ie.y,_e=0!==pe?1/pe:1/0,ye=2*Math.sqrt(2-2*pe),Oe=pe<Om&&$&&G,ke=J.x*ie.y-J.y*ie.x>0;if(Oe&&ue>C){const je=N.dist($);if(je>2*P){const Xe=N.sub(N.sub($)._mult(P/je)._round());this.updateDistance($,Xe),this.addCurrentVertex(Xe,J,0,0,F),$=Xe}}const Ze=$&&G;let dt=Ze?s:v?"butt":u;if(Ze&&"round"===dt&&(_e<m?dt="miter":_e<=2&&(dt="fakeround")),"miter"===dt&&_e>f&&(dt="bevel"),"bevel"===dt&&(_e>2&&(dt="flipbevel"),_e<f&&(dt="miter")),$&&this.updateDistance($,N),"miter"===dt)ge._mult(_e),this.addCurrentVertex(N,ge,0,0,F);else if("flipbevel"===dt){if(_e>100)ge=ie.mult(-1);else{const je=_e*J.add(ie).mag()/J.sub(ie).mag();ge._perp()._mult(je*(ke?-1:1))}this.addCurrentVertex(N,ge,0,0,F),this.addCurrentVertex(N,ge.mult(-1),0,0,F)}else if("bevel"===dt||"fakeround"===dt){const je=-Math.sqrt(_e*_e-1),Xe=ke?je:0,Ye=ke?0:je;if($&&this.addCurrentVertex(N,J,Xe,Ye,F),"fakeround"===dt){const st=Math.round(180*ye/Math.PI/20);for(let ft=1;ft<st;ft++){let Ve=ft/st;if(.5!==Ve){const ln=Ve-.5;Ve+=Ve*ln*(Ve-1)*((1.0904+ce*(ce*(3.55645-1.43519*ce)-3.2452))*ln*ln+(.848013+ce*(.215638*ce-1.06021)))}const It=ie.sub(J)._mult(Ve)._add(J)._unit()._mult(ke?-1:1);this.addHalfVertex(N,It.x,It.y,!1,ke,0,F)}}G&&this.addCurrentVertex(N,ie,-Xe,-Ye,F)}else if("butt"===dt)this.addCurrentVertex(N,ge,0,0,F);else if("square"===dt){const je=$?1:-1;$||this.addCurrentVertex(N,ge,je,je,F),this.addCurrentVertex(N,ge,0,0,F),$&&this.addCurrentVertex(N,ge,je,je,F)}else"round"===dt&&($&&(this.addCurrentVertex(N,J,0,0,F),this.addCurrentVertex(N,J,1,1,F,!0)),G&&(this.addCurrentVertex(N,ie,-1,-1,F,!0),this.addCurrentVertex(N,ie,0,0,F)));if(Oe&&ue<D-1){const je=N.dist(G);if(je>2*P){const Xe=N.add(G.sub(N)._mult(P/je)._round());this.updateDistance(N,Xe),this.addCurrentVertex(Xe,ie,0,0,F),N=Xe}}}}addCurrentVertex(e,n,s,u,f,m=!1){const v=n.y*u-n.x,D=-n.y-n.x*u;this.addHalfVertex(e,n.x+n.y*s,n.y-n.x*s,m,!1,s,f),this.addHalfVertex(e,v,D,m,!0,-u,f)}addHalfVertex({x:e,y:n},s,u,f,m,v,D){this.layoutVertexArray.emplaceBack((e<<1)+(f?1:0),(n<<1)+(m?1:0),Math.round(63*s)+128,Math.round(63*u)+128,1+(0===v?0:v<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const C=D.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,C),D.primitiveLength++),m?this.e2=C:this.e1=C}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,n){this.distance+=e.dist(n),this.updateScaledDistance()}}Ot(Dd,"LineBucket",{omit:["layers","patternFeatures"]});const Fm=new an({"line-cap":new Be(Ge.layout_line["line-cap"]),"line-join":new Be(Ge.layout_line["line-join"]),"line-miter-limit":new Ae(Ge.layout_line["line-miter-limit"]),"line-round-limit":new Ae(Ge.layout_line["line-round-limit"]),"line-sort-key":new Be(Ge.layout_line["line-sort-key"])});var zm={paint:new an({"line-opacity":new Be(Ge.paint_line["line-opacity"]),"line-color":new Be(Ge.paint_line["line-color"]),"line-translate":new Ae(Ge.paint_line["line-translate"]),"line-translate-anchor":new Ae(Ge.paint_line["line-translate-anchor"]),"line-width":new Be(Ge.paint_line["line-width"]),"line-gap-width":new Be(Ge.paint_line["line-gap-width"]),"line-offset":new Be(Ge.paint_line["line-offset"]),"line-blur":new Be(Ge.paint_line["line-blur"]),"line-dasharray":new Be(Ge.paint_line["line-dasharray"]),"line-pattern":new Be(Ge.paint_line["line-pattern"]),"line-gradient":new Zt(Ge.paint_line["line-gradient"]),"line-trim-offset":new Ae(Ge.paint_line["line-trim-offset"])}),layout:Fm};const Bm=new class extends Be{possiblyEvaluate(t,e){return e=new Te(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,n,s){return e=Ue({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,n,s)}}(zm.paint.properties["line-width"].specification);function I_(t,e){return e>0?e+2*t:t}Bm.useIntegerZoom=!0;const Nm=Ft([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Um=Ft([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),iu=Ft([{name:"a_projected_pos",components:4,type:"Float32"}],4);Ft([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const M_=Ft([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),Wf=Ft([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Ft([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Td=Ft([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),A_=Ft([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Ft([{name:"triangle",components:3,type:"Uint16"}]),Ft([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Ft([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Ft([{type:"Float32",name:"offsetX"}]),Ft([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);const tc=128;function jm(t,e){const{expression:n}=e;if("constant"===n.kind)return{kind:"constant",layoutSize:n.evaluate(new Te(t+1))};if("source"===n.kind)return{kind:"source"};{const{zoomStops:s,interpolationType:u}=n;let f=0;for(;f<s.length&&s[f]<=t;)f++;f=Math.max(0,f-1);let m=f;for(;m<s.length&&s[m]<t+1;)m++;m=Math.min(s.length-1,m);const v=s[f],D=s[m];return"composite"===n.kind?{kind:"composite",minZoom:v,maxZoom:D,interpolationType:u}:{kind:"camera",minZoom:v,maxZoom:D,minSize:n.evaluate(new Te(v)),maxSize:n.evaluate(new Te(D)),interpolationType:u}}}function Cd(t,{uSize:e,uSizeT:n},{lowerSize:s,upperSize:u}){return"source"===t.kind?s/tc:"composite"===t.kind?gn(s/tc,u/tc,n):e}function ou(t,e){let n=0,s=0;if("constant"===t.kind)s=t.layoutSize;else if("source"!==t.kind){const{interpolationType:u,minZoom:f,maxZoom:m}=t,v=u?tt(Vi.interpolationFactor(u,e,f,m),0,1):0;"camera"===t.kind?s=gn(t.minSize,t.maxSize,v):n=v}return{uSizeT:n,uSize:s}}var zy=Object.freeze({__proto__:null,getSizeData:jm,evaluateSizeForFeature:Cd,evaluateSizeForZoom:ou,SIZE_PACK_FACTOR:tc});function P_(t,e,n){return t.sections.forEach(s=>{s.text=function(u,f,m){const v=f.layout.get("text-transform").evaluate(m,{});return"uppercase"===v?u=u.toLocaleUpperCase():"lowercase"===v&&(u=u.toLocaleLowerCase()),Pe.applyArabicShaping&&(u=Pe.applyArabicShaping(u)),u}(s.text,e,n)}),t}const wl={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"};function R_(t){return"\ufe36"===t||"\ufe48"===t||"\ufe38"===t||"\ufe44"===t||"\ufe42"===t||"\ufe3e"===t||"\ufe3c"===t||"\ufe3a"===t||"\ufe18"===t||"\ufe40"===t||"\ufe10"===t||"\ufe13"===t||"\ufe14"===t||"\uff40"===t||"\uffe3"===t||"\ufe11"===t||"\ufe12"===t}function Vm(t){return"\ufe35"===t||"\ufe47"===t||"\ufe37"===t||"\ufe43"===t||"\ufe41"===t||"\ufe3d"===t||"\ufe3b"===t||"\ufe39"===t||"\ufe17"===t||"\ufe3f"===t}var Pc=Pr,$m=function(t,e,n,s,u){var f,m,v=8*u-s-1,D=(1<<v)-1,C=D>>1,P=-7,F=n?u-1:0,N=n?-1:1,$=t[e+F];for(F+=N,f=$&(1<<-P)-1,$>>=-P,P+=v;P>0;f=256*f+t[e+F],F+=N,P-=8);for(m=f&(1<<-P)-1,f>>=-P,P+=s;P>0;m=256*m+t[e+F],F+=N,P-=8);if(0===f)f=1-C;else{if(f===D)return m?NaN:1/0*($?-1:1);m+=Math.pow(2,s),f-=C}return($?-1:1)*m*Math.pow(2,f-s)},Xf=function(t,e,n,s,u,f){var m,v,D,C=8*f-u-1,P=(1<<C)-1,F=P>>1,N=23===u?Math.pow(2,-24)-Math.pow(2,-77):0,$=s?0:f-1,G=s?1:-1,J=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(v=isNaN(e)?1:0,m=P):(m=Math.floor(Math.log(e)/Math.LN2),e*(D=Math.pow(2,-m))<1&&(m--,D*=2),(e+=m+F>=1?N/D:N*Math.pow(2,1-F))*D>=2&&(m++,D/=2),m+F>=P?(v=0,m=P):m+F>=1?(v=(e*D-1)*Math.pow(2,u),m+=F):(v=e*Math.pow(2,F-1)*Math.pow(2,u),m=0));u>=8;t[n+$]=255&v,$+=G,v/=256,u-=8);for(m=m<<u|v,C+=u;C>0;t[n+$]=255&m,$+=G,m/=256,C-=8);t[n+$-G]|=128*J};function Pr(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}Pr.Varint=0,Pr.Fixed64=1,Pr.Bytes=2,Pr.Fixed32=5;var Yf=4294967296,Gm=1/Yf,Hm=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function nc(t){return t.type===Pr.Bytes?t.readVarint()+t.pos:t.pos+1}function Zm(t,e,n){var s=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(s);for(var u=n.pos-1;u>=t;u--)n.buf[u+s]=n.buf[u]}function qm(t,e){for(var n=0;n<t.length;n++)e.writeVarint(t[n])}function Wm(t,e){for(var n=0;n<t.length;n++)e.writeSVarint(t[n])}function Kf(t,e){for(var n=0;n<t.length;n++)e.writeFloat(t[n])}function By(t,e){for(var n=0;n<t.length;n++)e.writeDouble(t[n])}function Jf(t,e){for(var n=0;n<t.length;n++)e.writeBoolean(t[n])}function L_(t,e){for(var n=0;n<t.length;n++)e.writeFixed32(t[n])}function Ny(t,e){for(var n=0;n<t.length;n++)e.writeSFixed32(t[n])}function $u(t,e){for(var n=0;n<t.length;n++)e.writeFixed64(t[n])}function Xm(t,e){for(var n=0;n<t.length;n++)e.writeSFixed64(t[n])}function Sd(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function au(t,e,n){t[n]=e,t[n+1]=e>>>8,t[n+2]=e>>>16,t[n+3]=e>>>24}function Ym(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}function k_(t,e,n){e.glyphs=[],1===t&&n.readMessage(Id,e)}function Id(t,e,n){if(3===t){const{id:s,bitmap:u,width:f,height:m,left:v,top:D,advance:C}=n.readMessage(Gu,{});e.glyphs.push({id:s,bitmap:new ks({width:f+6,height:m+6},u),metrics:{width:f,height:m,left:v,top:D,advance:C}})}else 4===t?e.ascender=n.readSVarint():5===t&&(e.descender=n.readSVarint())}function Gu(t,e,n){1===t?e.id=n.readVarint():2===t?e.bitmap=n.readBytes():3===t?e.width=n.readVarint():4===t?e.height=n.readVarint():5===t?e.left=n.readSVarint():6===t?e.top=n.readSVarint():7===t&&(e.advance=n.readVarint())}function Nh(t){let e=0,n=0;for(const m of t)e+=m.w*m.h,n=Math.max(n,m.w);t.sort((m,v)=>v.h-m.h);const s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}];let u=0,f=0;for(const m of t)for(let v=s.length-1;v>=0;v--){const D=s[v];if(!(m.w>D.w||m.h>D.h)){if(m.x=D.x,m.y=D.y,f=Math.max(f,m.y+m.h),u=Math.max(u,m.x+m.w),m.w===D.w&&m.h===D.h){const C=s.pop();v<s.length&&(s[v]=C)}else m.h===D.h?(D.x+=m.w,D.w-=m.w):m.w===D.w?(D.y+=m.h,D.h-=m.h):(s.push({x:D.x+m.w,y:D.y,w:D.w-m.w,h:m.h}),D.y+=m.h,D.h-=m.h);break}}return{w:u,h:f,fill:e/(u*f)||0}}Pr.prototype={destroy:function(){this.buf=null},readFields:function(t,e,n){for(n=n||this.length;this.pos<n;){var s=this.readVarint(),u=s>>3,f=this.pos;this.type=7&s,t(u,e,this),this.pos===f&&this.skip(s)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=Sd(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=Ym(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=Sd(this.buf,this.pos)+Sd(this.buf,this.pos+4)*Yf;return this.pos+=8,t},readSFixed64:function(){var t=Sd(this.buf,this.pos)+Ym(this.buf,this.pos+4)*Yf;return this.pos+=8,t},readFloat:function(){var t=$m(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=$m(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,n,s=this.buf;return e=127&(n=s[this.pos++]),n<128?e:(e|=(127&(n=s[this.pos++]))<<7,n<128?e:(e|=(127&(n=s[this.pos++]))<<14,n<128?e:(e|=(127&(n=s[this.pos++]))<<21,n<128?e:function(u,f,m){var v,D,C=m.buf;if(v=(112&(D=C[m.pos++]))>>4,D<128||(v|=(127&(D=C[m.pos++]))<<3,D<128)||(v|=(127&(D=C[m.pos++]))<<10,D<128)||(v|=(127&(D=C[m.pos++]))<<17,D<128)||(v|=(127&(D=C[m.pos++]))<<24,D<128)||(v|=(1&(D=C[m.pos++]))<<31,D<128))return function su(t,e,n){return n?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}(u,v,f);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(n=s[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&Hm?Hm.decode(this.buf.subarray(e,t)):function(n,s,u){for(var f="",m=s;m<u;){var v,D,C,P=n[m],F=null,N=P>239?4:P>223?3:P>191?2:1;if(m+N>u)break;1===N?P<128&&(F=P):2===N?128==(192&(v=n[m+1]))&&(F=(31&P)<<6|63&v)<=127&&(F=null):3===N?(D=n[m+2],128==(192&(v=n[m+1]))&&128==(192&D)&&((F=(15&P)<<12|(63&v)<<6|63&D)<=2047||F>=55296&&F<=57343)&&(F=null)):4===N&&(D=n[m+2],C=n[m+3],128==(192&(v=n[m+1]))&&128==(192&D)&&128==(192&C)&&((F=(15&P)<<18|(63&v)<<12|(63&D)<<6|63&C)<=65535||F>=1114112)&&(F=null)),null===F?(F=65533,N=1):F>65535&&(F-=65536,f+=String.fromCharCode(F>>>10&1023|55296),F=56320|1023&F),f+=String.fromCharCode(F),m+=N}return f}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==Pr.Bytes)return t.push(this.readVarint(e));var n=nc(this);for(t=t||[];this.pos<n;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==Pr.Bytes)return t.push(this.readSVarint());var e=nc(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==Pr.Bytes)return t.push(this.readBoolean());var e=nc(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==Pr.Bytes)return t.push(this.readFloat());var e=nc(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==Pr.Bytes)return t.push(this.readDouble());var e=nc(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==Pr.Bytes)return t.push(this.readFixed32());var e=nc(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==Pr.Bytes)return t.push(this.readSFixed32());var e=nc(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==Pr.Bytes)return t.push(this.readFixed64());var e=nc(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==Pr.Bytes)return t.push(this.readSFixed64());var e=nc(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===Pr.Varint)for(;this.buf[this.pos++]>127;);else if(e===Pr.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Pr.Fixed32)this.pos+=4;else{if(e!==Pr.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),au(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),au(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),au(this.buf,-1&t,this.pos),au(this.buf,Math.floor(t*Gm),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),au(this.buf,-1&t,this.pos),au(this.buf,Math.floor(t*Gm),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(e,n){var s,u,f,v;if(e>=0?(s=e%4294967296|0,u=e/4294967296|0):(u=~(-e/4294967296),4294967295^(s=~(-e%4294967296))?s=s+1|0:(s=0,u=u+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),f=s,(v=n).buf[v.pos++]=127&f|128,f>>>=7,v.buf[v.pos++]=127&f|128,f>>>=7,v.buf[v.pos++]=127&f|128,f>>>=7,v.buf[v.pos++]=127&f|128,v.buf[v.pos]=127&(f>>>=7),function(f,m){var v=(7&f)<<4;m.buf[m.pos++]|=v|((f>>>=3)?128:0),f&&(m.buf[m.pos++]=127&f|((f>>>=7)?128:0),f&&(m.buf[m.pos++]=127&f|((f>>>=7)?128:0),f&&(m.buf[m.pos++]=127&f|((f>>>=7)?128:0),f&&(m.buf[m.pos++]=127&f|((f>>>=7)?128:0),f&&(m.buf[m.pos++]=127&f)))))}(u,n)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(s,u,f){for(var m,v,D=0;D<u.length;D++){if((m=u.charCodeAt(D))>55295&&m<57344){if(!v){m>56319||D+1===u.length?(s[f++]=239,s[f++]=191,s[f++]=189):v=m;continue}if(m<56320){s[f++]=239,s[f++]=191,s[f++]=189,v=m;continue}m=v-55296<<10|m-56320|65536,v=null}else v&&(s[f++]=239,s[f++]=191,s[f++]=189,v=null);m<128?s[f++]=m:(m<2048?s[f++]=m>>6|192:(m<65536?s[f++]=m>>12|224:(s[f++]=m>>18|240,s[f++]=m>>12&63|128),s[f++]=m>>6&63|128),s[f++]=63&m|128)}return f}(this.buf,t,this.pos);var n=this.pos-e;n>=128&&Zm(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(t){this.realloc(4),Xf(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),Xf(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=t[n]},writeRawMessage:function(t,e){this.pos++;var n=this.pos;t(e,this);var s=this.pos-n;s>=128&&Zm(n,s,this),this.pos=n-1,this.writeVarint(s),this.pos+=s},writeMessage:function(t,e,n){this.writeTag(t,Pr.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,qm,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,Wm,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,Jf,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,Kf,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,By,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,L_,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,Ny,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,$u,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,Xm,e)},writeBytesField:function(t,e){this.writeTag(t,Pr.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,Pr.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,Pr.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,Pr.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,Pr.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,Pr.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,Pr.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,Pr.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,Pr.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,Pr.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};class lu{constructor(e,{pixelRatio:n,version:s,stretchX:u,stretchY:f,content:m}){this.paddedRect=e,this.pixelRatio=n,this.stretchX=u,this.stretchY=f,this.content=m,this.version=s}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Md{constructor(e,n){const s={},u={};this.haveRenderCallbacks=[];const f=[];this.addImages(e,s,f),this.addImages(n,u,f);const{w:m,h:v}=Nh(f),D=new jo({width:m||1,height:v||1});for(const C in e){const P=e[C],F=s[C].paddedRect;jo.copy(P.data,D,{x:0,y:0},{x:F.x+1,y:F.y+1},P.data)}for(const C in n){const P=n[C],F=u[C].paddedRect,N=F.x+1,$=F.y+1,G=P.data.width,J=P.data.height;jo.copy(P.data,D,{x:0,y:0},{x:N,y:$},P.data),jo.copy(P.data,D,{x:0,y:J-1},{x:N,y:$-1},{width:G,height:1}),jo.copy(P.data,D,{x:0,y:0},{x:N,y:$+J},{width:G,height:1}),jo.copy(P.data,D,{x:G-1,y:0},{x:N-1,y:$},{width:1,height:J}),jo.copy(P.data,D,{x:0,y:0},{x:N+G,y:$},{width:1,height:J})}this.image=D,this.iconPositions=s,this.patternPositions=u}addImages(e,n,s){for(const u in e){const f=e[u],m={x:0,y:0,w:f.data.width+2,h:f.data.height+2};s.push(m),n[u]=new lu(m,f),f.hasRenderCallback&&this.haveRenderCallbacks.push(u)}}patchUpdatedImages(e,n){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(s=>e.hasImage(s)),e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const s in e.updatedImages)this.patchUpdatedImage(this.iconPositions[s],e.getImage(s),n),this.patchUpdatedImage(this.patternPositions[s],e.getImage(s),n)}patchUpdatedImage(e,n,s){if(!e||!n||e.version===n.version)return;e.version=n.version;const[u,f]=e.tl;s.update(n.data,void 0,{x:u,y:f})}}Ot(lu,"ImagePosition"),Ot(Md,"ImageAtlas");const $o={horizontal:1,vertical:2,horizontalOnly:3};class Hu{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,n){const s=new Hu;return s.scale=e||1,s.fontStack=n,s}static forImage(e){const n=new Hu;return n.imageName=e,n}}class Rc{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,n){const s=new Rc;for(let u=0;u<e.sections.length;u++){const f=e.sections[u];f.image?s.addImageSection(f):s.addTextSection(f,n)}return s}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(n,s){let u="";for(let f=0;f<n.length;f++){const m=n.charCodeAt(f+1)||null,v=n.charCodeAt(f-1)||null;u+=!s&&(m&&j(m)&&!wl[n[f+1]]||v&&j(v)&&!wl[n[f-1]])||!wl[n[f]]?n[f]:wl[n[f]]}return u}(this.text,e)}trim(){let e=0;for(let s=0;s<this.text.length&&Zu[this.text.charCodeAt(s)];s++)e++;let n=this.text.length;for(let s=this.text.length-1;s>=0&&s>=e&&Zu[this.text.charCodeAt(s)];s--)n--;this.text=this.text.substring(e,n),this.sectionIndex=this.sectionIndex.slice(e,n)}substring(e,n){const s=new Rc;return s.text=this.text.substring(e,n),s.sectionIndex=this.sectionIndex.slice(e,n),s.sections=this.sections,s}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,n)=>Math.max(e,this.sections[n].scale),0)}addTextSection(e,n){this.text+=e.text,this.sections.push(Hu.forText(e.scale,e.fontStack||n));const s=this.sections.length-1;for(let u=0;u<e.text.length;++u)this.sectionIndex.push(s)}addImageSection(e){const n=e.image?e.image.name:"";if(0===n.length)return void vn("Can't add FormattedSection with an empty image.");const s=this.getNextImageSectionCharCode();s?(this.text+=String.fromCharCode(s),this.sections.push(Hu.forImage(n)),this.sectionIndex.push(this.sections.length-1)):vn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Uh(t,e,n,s,u,f,m,v,D,C,P,F,N,$,G){const J=Rc.fromFeature(t,u);F===$o.vertical&&J.verticalizePunctuation(N);let ie=[];const ue=function(ye,Oe,ke,Ze,dt,je){if(!ye)return[];const Xe=[],Ye=function(It,ln,Rt,Wt,Mt,un){let Fn=0;for(let Rn=0;Rn<It.length();Rn++){const kn=It.getSection(Rn);Fn+=Ad(It.getCharCode(Rn),kn,Wt,Mt,ln,un)}return Fn/Math.max(1,Math.ceil(Fn/Rt))}(ye,Oe,ke,Ze,dt,je),st=ye.text.indexOf("\u200b")>=0;let ft=0;for(let It=0;It<ye.length();It++){const ln=ye.getSection(It),Rt=ye.getCharCode(It);if(Zu[Rt]||(ft+=Ad(Rt,ln,Ze,dt,Oe,je)),It<ye.length()-1){const Wt=!((Ve=Rt)<11904||!(Tc(Ve)||Cu(Ve)||l(Ve)||Oi(Ve)||Su(Ve)||ua(Ve)||mh(Ve)||Ec(Ve)||_h(Ve)||di(Ve)||_l(Ve)||b(Ve)||Zc(Ve)||Sr(Ve)||Hl(Ve)||gh(Ve)||Dc(Ve)||r(Ve)||gs(Ve)||qc(Ve)));(Km[Rt]||Wt||ln.imageName)&&Xe.push(Qf(It+1,ft,Ye,Xe,O_(Rt,ye.getCharCode(It+1),Wt&&st),!1))}}var Ve;return Qm(Qf(ye.length(),ft,Ye,Xe,0,!0))}(J,C,f,e,s,$),{processBidirectionalText:ge,processStyledBidirectionalText:ce}=Pe;if(ge&&1===J.sections.length){const ye=ge(J.toString(),ue);for(const Oe of ye){const ke=new Rc;ke.text=Oe,ke.sections=J.sections;for(let Ze=0;Ze<Oe.length;Ze++)ke.sectionIndex.push(0);ie.push(ke)}}else if(ce){const ye=ce(J.text,J.sectionIndex,ue);for(const Oe of ye){const ke=new Rc;ke.text=Oe[0],ke.sectionIndex=Oe[1],ke.sections=J.sections,ie.push(ke)}}else ie=function(ye,Oe){const ke=[],Ze=ye.text;let dt=0;for(const je of Oe)ke.push(ye.substring(dt,je)),dt=je;return dt<Ze.length&&ke.push(ye.substring(dt,Ze.length)),ke}(J,ue);const pe=[],_e={positionedLines:pe,text:J.toString(),top:P[1],bottom:P[1],left:P[0],right:P[0],writingMode:F,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(ye,Oe,ke,Ze,dt,je,Xe,Ye,st,ft,Ve,It){let ln=0,Rt=0,Wt=0;const Mt="right"===Ye?1:"left"===Ye?0:.5;let un=!1;for(const En of dt){const Bn=En.getSections();for(const br of Bn){if(br.imageName)continue;const Rr=Oe[br.fontStack];if(Rr&&(un=void 0!==Rr.ascender&&void 0!==Rr.descender,!un))break}if(!un)break}let Fn=0;for(const En of dt){En.trim();const Bn=En.getMaxScale(),br=24*(Bn-1),Rr={positionedGlyphs:[],lineOffset:0};ye.positionedLines[Fn]=Rr;const Ir=Rr.positionedGlyphs;let kr=0;if(!En.length()){Rt+=je,++Fn;continue}let zr=0,oi=0;for(let wr=0;wr<En.length();wr++){const Ai=En.getSection(wr),wi=En.getSectionIndex(wr),dr=En.getCharCode(wr);let Wr=Ai.scale,Bi=null,Er=null,fi=null,Po=24,to=0;const no=!(st===$o.horizontal||!Ve&&!V(dr)||Ve&&(Zu[dr]||(Rn=dr,Ms(Rn)||Hc(Rn)||As(Rn)||h(Rn)||_(Rn))));if(Ai.imageName){const Go=Ze[Ai.imageName];if(!Go)continue;fi=Ai.imageName,ye.iconsInText=ye.iconsInText||!0,Er=Go.paddedRect;const ro=Go.displaySize;Wr=24*Wr/It,Bi={width:ro[0],height:ro[1],left:1,top:-3,advance:no?ro[1]:ro[0],localGlyph:!1},to=un?-Bi.height*Wr:24*Bn-17-ro[1]*Wr,Po=Bi.advance;const lc=(no?ro[0]:ro[1])*Wr-24*Bn;lc>0&&lc>kr&&(kr=lc)}else{const Go=ke[Ai.fontStack];if(!Go)continue;Go[dr]&&(Er=Go[dr]);const ro=Oe[Ai.fontStack];if(!ro)continue;const lc=ro.glyphs[dr];if(!lc)continue;if(Bi=lc.metrics,Po=8203!==dr?24:0,un){const yu=void 0!==ro.ascender?Math.abs(ro.ascender):0,hh=void 0!==ro.descender?Math.abs(ro.descender):0,dh=(yu+hh)*Wr;zr<dh&&(zr=dh,oi=(yu-hh)/2*Wr),to=-yu*Wr}else to=24*(Bn-Wr)-17}no?(ye.verticalizable=!0,Ir.push({glyph:dr,imageName:fi,x:ln,y:Rt+to,vertical:no,scale:Wr,localGlyph:Bi.localGlyph,fontStack:Ai.fontStack,sectionIndex:wi,metrics:Bi,rect:Er}),ln+=Po*Wr+ft):(Ir.push({glyph:dr,imageName:fi,x:ln,y:Rt+to,vertical:no,scale:Wr,localGlyph:Bi.localGlyph,fontStack:Ai.fontStack,sectionIndex:wi,metrics:Bi,rect:Er}),ln+=Bi.advance*Wr+ft)}0!==Ir.length&&(Wt=Math.max(ln-ft,Wt),un?ep(Ir,Mt,kr,oi,je*Bn/2):ep(Ir,Mt,kr,0,je/2)),ln=0;const eo=je*Bn+kr;Rr.lineOffset=Math.max(kr,br),Rt+=eo,++Fn}var Rn;const kn=Rt,{horizontalAlign:hn,verticalAlign:gr}=Pd(Xe);(function(En,Bn,br,Rr,Ir,kr){const zr=(Bn-br)*Ir,oi=-kr*Rr;for(const eo of En)for(const wr of eo.positionedGlyphs)wr.x+=zr,wr.y+=oi})(ye.positionedLines,Mt,hn,gr,Wt,kn),ye.top+=-gr*kn,ye.bottom=ye.top+kn,ye.left+=-hn*Wt,ye.right=ye.left+Wt,ye.hasBaseline=un}(_e,e,n,s,ie,m,v,D,F,C,N,G),!function(ye){for(const Oe of ye)if(0!==Oe.positionedGlyphs.length)return!1;return!0}(pe)&&_e}const Zu={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Km={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Ad(t,e,n,s,u,f){if(e.imageName){const m=s[e.imageName];return m?m.displaySize[0]*e.scale*24/f+u:0}{const m=n[e.fontStack],v=m&&m.glyphs[t];return v?v.metrics.advance*e.scale+u:0}}function Jm(t,e,n,s){const u=Math.pow(t-e,2);return s?t<e?u/2:2*u:u+Math.abs(n)*n}function O_(t,e,n){let s=0;return 10===t&&(s-=1e4),n&&(s+=150),40!==t&&65288!==t||(s+=50),41!==e&&65289!==e||(s+=50),s}function Qf(t,e,n,s,u,f){let m=null,v=Jm(e,n,u,f);for(const D of s){const C=Jm(e-D.x,n,u,f)+D.badness;C<=v&&(m=D,v=C)}return{index:t,x:e,priorBreak:m,badness:v}}function Qm(t){return t?Qm(t.priorBreak).concat(t.index):[]}function Pd(t){let e=.5,n=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function ep(t,e,n,s,u){if(!(e||n||s||u))return;const f=t.length-1,m=t[f],v=(m.x+m.metrics.advance*m.scale)*e;for(let D=0;D<=f;D++)t[D].x-=v,t[D].y+=n+s+u}function F_(t,e,n){const{horizontalAlign:s,verticalAlign:u}=Pd(n),f=e[0]-t.displaySize[0]*s,m=e[1]-t.displaySize[1]*u;return{image:t,top:m,bottom:m+t.displaySize[1],left:f,right:f+t.displaySize[0]}}function eg(t,e,n,s,u,f){const m=t.image;let v;if(m.content){const ie=m.content,ue=m.pixelRatio||1;v=[ie[0]/ue,ie[1]/ue,m.displaySize[0]-ie[2]/ue,m.displaySize[1]-ie[3]/ue]}const D=e.left*f,C=e.right*f;let P,F,N,$;"width"===n||"both"===n?($=u[0]+D-s[3],F=u[0]+C+s[1]):($=u[0]+(D+C-m.displaySize[0])/2,F=$+m.displaySize[0]);const G=e.top*f,J=e.bottom*f;return"height"===n||"both"===n?(P=u[1]+G-s[0],N=u[1]+J+s[2]):(P=u[1]+(G+J-m.displaySize[1])/2,N=P+m.displaySize[1]),{image:m,top:P,right:F,bottom:N,left:$,collisionPadding:v}}class zi extends Qe{constructor(e,n,s,u,f){super(e,n),this.angle=u,this.z=s,void 0!==f&&(this.segment=f)}clone(){return new zi(this.x,this.y,this.z,this.angle,this.segment)}}function tp(t,e,n,s,u){if(void 0===e.segment)return!0;let f=e,m=e.segment+1,v=0;for(;v>-n/2;){if(m--,m<0)return!1;v-=t[m].dist(f),f=t[m]}v+=t[m].dist(t[m+1]),m++;const D=[];let C=0;for(;v<n/2;){const P=t[m],F=t[m+1];if(!F)return!1;let N=t[m-1].angleTo(P)-P.angleTo(F);for(N=Math.abs((N+3*Math.PI)%(2*Math.PI)-Math.PI),D.push({distance:v,angleDelta:N}),C+=N;v-D[0].distance>s;)C-=D.shift().angleDelta;if(C>u)return!1;m++,v+=P.dist(F)}return!0}function tg(t){let e=0;for(let n=0;n<t.length-1;n++)e+=t[n].dist(t[n+1]);return e}function z_(t,e,n){return t?.6*e*n:0}function Rd(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function ng(t,e,n,s,u,f){const m=z_(n,u,f),v=Rd(n,s)*f;let D=0;const C=tg(t)/2;for(let P=0;P<t.length-1;P++){const F=t[P],N=t[P+1],$=F.dist(N);if(D+$>C){const G=(C-D)/$,J=gn(F.x,N.x,G),ie=gn(F.y,N.y,G),ue=new zi(J,ie,0,N.angleTo(F),P);return!m||tp(t,ue,v,m,e)?ue:void 0}D+=$}}function B_(t,e,n,s,u,f,m,v,D){const C=z_(s,f,m),P=Rd(s,u),F=P*m,N=0===t[0].x||t[0].x===D||0===t[0].y||t[0].y===D;return e-F<e/4&&(e=F+e/4),rg(t,N?e/2*v%e:(P/2+2*f)*m*v%e,e,C,n,F,N,!1,D)}function rg(t,e,n,s,u,f,m,v,D){const C=f/2,P=tg(t);let F=0,N=e-n,$=[];for(let G=0;G<t.length-1;G++){const J=t[G],ie=t[G+1],ue=J.dist(ie),ge=ie.angleTo(J);for(;N+n<F+ue;){N+=n;const ce=(N-F)/ue,pe=gn(J.x,ie.x,ce),_e=gn(J.y,ie.y,ce);if(pe>=0&&pe<D&&_e>=0&&_e<D&&N-C>=0&&N+C<=P){const ye=new zi(pe,_e,0,ge,G);ye._round(),s&&!tp(t,ye,f,s,u)||$.push(ye)}}F+=ue}return v||$.length||m||($=rg(t,F/2,n,s,u,f,m,!0,D)),$}function ig(t,e,n,s,u){const f=[];for(let m=0;m<t.length;m++){const v=t[m];let D;for(let C=0;C<v.length-1;C++){let P=v[C],F=v[C+1];P.x<e&&F.x<e||(P.x<e?P=new Qe(e,P.y+(e-P.x)/(F.x-P.x)*(F.y-P.y))._round():F.x<e&&(F=new Qe(e,P.y+(e-P.x)/(F.x-P.x)*(F.y-P.y))._round()),P.y<n&&F.y<n||(P.y<n?P=new Qe(P.x+(n-P.y)/(F.y-P.y)*(F.x-P.x),n)._round():F.y<n&&(F=new Qe(P.x+(n-P.y)/(F.y-P.y)*(F.x-P.x),n)._round()),P.x>=s&&F.x>=s||(P.x>=s?P=new Qe(s,P.y+(s-P.x)/(F.x-P.x)*(F.y-P.y))._round():F.x>=s&&(F=new Qe(s,P.y+(s-P.x)/(F.x-P.x)*(F.y-P.y))._round()),P.y>=u&&F.y>=u||(P.y>=u?P=new Qe(P.x+(u-P.y)/(F.y-P.y)*(F.x-P.x),u)._round():F.y>=u&&(F=new Qe(P.x+(u-P.y)/(F.y-P.y)*(F.x-P.x),u)._round()),D&&P.equals(D[D.length-1])||(D=[P],f.push(D)),D.push(F)))))}}return f}Ot(zi,"Anchor");const qu=1e20;function og(t,e,n,s,u,f,m,v,D){for(let C=e;C<e+s;C++)sg(t,n*f+C,f,u,m,v,D);for(let C=n;C<n+u;C++)sg(t,C*f+e,1,s,m,v,D)}function sg(t,e,n,s,u,f,m){f[0]=0,m[0]=-qu,m[1]=qu,u[0]=t[e];for(let v=1,D=0,C=0;v<s;v++){u[v]=t[e+v*n];const P=v*v;do{const F=f[D];C=(u[v]-u[F]+P-F*F)/(v-F)/2}while(C<=m[D]&&--D>-1);D++,f[D]=v,m[D]=C,m[D+1]=qu}for(let v=0,D=0;v<s;v++){for(;m[D+1]<v;)D++;const C=f[D],P=v-C;t[e+v*n]=u[C]+P*P}}const jh={none:0,ideographs:1,all:2};class Wu{constructor(e,n,s){this.requestManager=e,this.localGlyphMode=n,this.localFontFamily=s,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,n){const s=[];for(const u in e)for(const f of e[u])s.push({stack:u,id:f});Jt(s,({stack:u,id:f},m)=>{let v=this.entries[u];v||(v=this.entries[u]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let D=v.glyphs[f];if(void 0!==D)return void m(null,{stack:u,id:f,glyph:D});if(D=this._tinySDF(v,u,f),D)return v.glyphs[f]=D,void m(null,{stack:u,id:f,glyph:D});const C=Math.floor(f/256);if(256*C>65535)return void m(new Error("glyphs > 65535 not supported"));if(v.ranges[C])return void m(null,{stack:u,id:f,glyph:D});let P=v.requests[C];P||(P=v.requests[C]=[],Wu.loadGlyphRange(u,C,this.url,this.requestManager,(F,N)=>{if(N){v.ascender=N.ascender,v.descender=N.descender;for(const $ in N.glyphs)this._doesCharSupportLocalGlyph(+$)||(v.glyphs[+$]=N.glyphs[+$]);v.ranges[C]=!0}for(const $ of P)$(F,N);delete v.requests[C]})),P.push((F,N)=>{F?m(F):N&&m(null,{stack:u,id:f,glyph:N.glyphs[f]||null})})},(u,f)=>{if(u)n(u);else if(f){const m={};for(const{stack:v,id:D,glyph:C}of f)void 0===m[v]&&(m[v]={}),void 0===m[v].glyphs&&(m[v].glyphs={}),m[v].glyphs[D]=C&&{id:C.id,bitmap:C.bitmap.clone(),metrics:C.metrics},m[v].ascender=this.entries[v].ascender,m[v].descender=this.entries[v].descender;n(null,m)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==jh.none&&(this.localGlyphMode===jh.all?!!this.localFontFamily:!!this.localFontFamily&&(di(e)||Iu(e)||Zc(e)||Dc(e)||Ec(e)))}_tinySDF(e,n,s){const u=this.localFontFamily;if(!u||!this._doesCharSupportLocalGlyph(s))return;let f=e.tinySDF;if(!f){let J="400";/bold/i.test(n)?J="900":/medium/i.test(n)?J="500":/light/i.test(n)&&(J="200"),f=e.tinySDF=new Wu.TinySDF({fontFamily:u,fontWeight:J,fontSize:48,buffer:6,radius:16}),f.fontWeight=J}if(this.localGlyphs[f.fontWeight][s])return this.localGlyphs[f.fontWeight][s];const m=String.fromCharCode(s),{data:v,width:D,height:C,glyphWidth:P,glyphHeight:F,glyphLeft:N,glyphTop:$,glyphAdvance:G}=f.draw(m);return this.localGlyphs[f.fontWeight][s]={id:s,bitmap:new ks({width:D,height:C},v),metrics:{width:P/2,height:F/2,left:N/2,top:$/2-27,advance:G/2,localGlyph:!0}}}}function ag(t,e,n,s){const u=[],f=t.image,m=f.pixelRatio,v=f.paddedRect.w-2,D=f.paddedRect.h-2,C=t.right-t.left,P=t.bottom-t.top,F=f.stretchX||[[0,v]],N=f.stretchY||[[0,D]],$=(je,Xe)=>je+Xe[1]-Xe[0],G=F.reduce($,0),J=N.reduce($,0),ie=v-G,ue=D-J;let ge=0,ce=G,pe=0,_e=J,ye=0,Oe=ie,ke=0,Ze=ue;if(f.content&&s){const je=f.content;ge=Ld(F,0,je[0]),pe=Ld(N,0,je[1]),ce=Ld(F,je[0],je[2]),_e=Ld(N,je[1],je[3]),ye=je[0]-ge,ke=je[1]-pe,Oe=je[2]-je[0]-ce,Ze=je[3]-je[1]-_e}const dt=(je,Xe,Ye,st)=>{const ft=kd(je.stretch-ge,ce,C,t.left),Ve=Os(je.fixed-ye,Oe,je.stretch,G),It=kd(Xe.stretch-pe,_e,P,t.top),ln=Os(Xe.fixed-ke,Ze,Xe.stretch,J),Rt=kd(Ye.stretch-ge,ce,C,t.left),Wt=Os(Ye.fixed-ye,Oe,Ye.stretch,G),Mt=kd(st.stretch-pe,_e,P,t.top),un=Os(st.fixed-ke,Ze,st.stretch,J),Fn=new Qe(ft,It),Rn=new Qe(Rt,It),kn=new Qe(Rt,Mt),hn=new Qe(ft,Mt),gr=new Qe(Ve/m,ln/m),En=new Qe(Wt/m,un/m),Bn=e*Math.PI/180;if(Bn){const Ir=Math.sin(Bn),kr=Math.cos(Bn),zr=[kr,-Ir,Ir,kr];Fn._matMult(zr),Rn._matMult(zr),hn._matMult(zr),kn._matMult(zr)}const br=je.stretch+je.fixed,Rr=Xe.stretch+Xe.fixed;return{tl:Fn,tr:Rn,bl:hn,br:kn,tex:{x:f.paddedRect.x+1+br,y:f.paddedRect.y+1+Rr,w:Ye.stretch+Ye.fixed-br,h:st.stretch+st.fixed-Rr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:gr,pixelOffsetBR:En,minFontScaleX:Oe/m/C,minFontScaleY:Ze/m/P,isSDF:n}};if(s&&(f.stretchX||f.stretchY)){const je=lg(F,ie,G),Xe=lg(N,ue,J);for(let Ye=0;Ye<je.length-1;Ye++){const st=je[Ye],ft=je[Ye+1];for(let Ve=0;Ve<Xe.length-1;Ve++)u.push(dt(st,Xe[Ve],ft,Xe[Ve+1]))}}else u.push(dt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:v+1},{fixed:0,stretch:D+1}));return u}function Ld(t,e,n){let s=0;for(const u of t)s+=Math.max(e,Math.min(n,u[1]))-Math.max(e,Math.min(n,u[0]));return s}function lg(t,e,n){const s=[{fixed:-1,stretch:0}];for(const[u,f]of t){const m=s[s.length-1];s.push({fixed:u-m.stretch,stretch:m.stretch}),s.push({fixed:u-m.stretch,stretch:m.stretch+(f-u)})}return s.push({fixed:e+1,stretch:n}),s}function kd(t,e,n,s){return t/e*n+s}function Os(t,e,n,s){return t-e*n/s}function np(t,e,n,s){const u=e+t.positionedLines[s].lineOffset;return 0===s?n+u/2:n+(u+(e+t.positionedLines[s-1].lineOffset))/2}Wu.loadGlyphRange=function(t,e,n,s,u){const f=256*e,m=f+255,v=s.transformRequest(s.normalizeGlyphsURL(n).replace("{fontstack}",t).replace("{range}",`${f}-${m}`),rn.Glyphs);$n(v,(D,C)=>{if(D)u(D);else if(C){const P={},F=new Pc(C).readFields(k_,{});for(const N of F.glyphs)P[N.id]=N;u(null,{glyphs:P,ascender:F.ascender,descender:F.descender})}})},Wu.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:n=8,cutoff:s=.25,fontFamily:u="sans-serif",fontWeight:f="normal",fontStyle:m="normal"}={}){this.buffer=e,this.cutoff=s,this.radius=n;const v=this.size=t+4*e,D=this._createCanvas(v),C=this.ctx=D.getContext("2d",{willReadFrequently:!0});C.font=`${m} ${f} ${t}px ${u}`,C.textBaseline="alphabetic",C.textAlign="left",C.fillStyle="black",this.gridOuter=new Float64Array(v*v),this.gridInner=new Float64Array(v*v),this.f=new Float64Array(v),this.z=new Float64Array(v+1),this.v=new Uint16Array(v)}_createCanvas(t){const e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){const{width:e,actualBoundingBoxAscent:n,actualBoundingBoxDescent:s,actualBoundingBoxLeft:u,actualBoundingBoxRight:f}=this.ctx.measureText(t),m=Math.ceil(n),v=Math.min(this.size-this.buffer,Math.ceil(f-u)),D=Math.min(this.size-this.buffer,m+Math.ceil(s)),C=v+2*this.buffer,P=D+2*this.buffer,F=Math.max(C*P,0),N=new Uint8ClampedArray(F),$={data:N,width:C,height:P,glyphWidth:v,glyphHeight:D,glyphTop:m,glyphLeft:0,glyphAdvance:e};if(0===v||0===D)return $;const{ctx:G,buffer:J,gridInner:ie,gridOuter:ue}=this;G.clearRect(J,J,v,D),G.fillText(t,J,J+m);const ge=G.getImageData(J,J,v,D);ue.fill(qu,0,F),ie.fill(0,0,F);for(let ce=0;ce<D;ce++)for(let pe=0;pe<v;pe++){const _e=ge.data[4*(ce*v+pe)+3]/255;if(0===_e)continue;const ye=(ce+J)*C+pe+J;if(1===_e)ue[ye]=0,ie[ye]=qu;else{const Oe=.5-_e;ue[ye]=Oe>0?Oe*Oe:0,ie[ye]=Oe<0?Oe*Oe:0}}og(ue,0,0,C,P,C,this.f,this.v,this.z),og(ie,J,J,v,D,C,this.f,this.v,this.z);for(let ce=0;ce<F;ce++){const pe=Math.sqrt(ue[ce])-Math.sqrt(ie[ce]);N[ce]=Math.round(255-255*(pe/this.radius+this.cutoff))}return $}};class N_{constructor(e=[],n=U_){if(this.data=e,this.length=this.data.length,this.compare=n,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const e=this.data[0],n=this.data.pop();return this.length--,this.length>0&&(this.data[0]=n,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:n,compare:s}=this,u=n[e];for(;e>0;){const f=e-1>>1,m=n[f];if(s(u,m)>=0)break;n[e]=m,e=f}n[e]=u}_down(e){const{data:n,compare:s}=this,u=this.length>>1,f=n[e];for(;e<u;){let m=1+(e<<1),v=n[m];const D=m+1;if(D<this.length&&s(n[D],v)<0&&(m=D,v=n[D]),s(v,f)>=0)break;n[e]=v,e=m}n[e]=f}}function U_(t,e){return t<e?-1:t>e?1:0}function cg(t,e=1,n=!1){let s=1/0,u=1/0,f=-1/0,m=-1/0;const v=t[0];for(let $=0;$<v.length;$++){const G=v[$];(!$||G.x<s)&&(s=G.x),(!$||G.y<u)&&(u=G.y),(!$||G.x>f)&&(f=G.x),(!$||G.y>m)&&(m=G.y)}const D=Math.min(f-s,m-u);let C=D/2;const P=new N_([],j_);if(0===D)return new Qe(s,u);for(let $=s;$<f;$+=D)for(let G=u;G<m;G+=D)P.push(new Xu($+C,G+C,C,t));let F=function($){let G=0,J=0,ie=0;const ue=$[0];for(let ge=0,ce=ue.length,pe=ce-1;ge<ce;pe=ge++){const _e=ue[ge],ye=ue[pe],Oe=_e.x*ye.y-ye.x*_e.y;J+=(_e.x+ye.x)*Oe,ie+=(_e.y+ye.y)*Oe,G+=3*Oe}return new Xu(J/G,ie/G,0,$)}(t),N=P.length;for(;P.length;){const $=P.pop();($.d>F.d||!F.d)&&(F=$,n&&console.log("found best %d after %d probes",Math.round(1e4*$.d)/1e4,N)),$.max-F.d<=e||(C=$.h/2,P.push(new Xu($.p.x-C,$.p.y-C,C,t)),P.push(new Xu($.p.x+C,$.p.y-C,C,t)),P.push(new Xu($.p.x-C,$.p.y+C,C,t)),P.push(new Xu($.p.x+C,$.p.y+C,C,t)),N+=4)}return n&&(console.log(`num probes: ${N}`),console.log(`best distance: ${F.d}`)),F.p}function j_(t,e){return e.max-t.max}function Xu(t,e,n,s){this.p=new Qe(t,e),this.h=n,this.d=function(u,f){let m=!1,v=1/0;for(let D=0;D<f.length;D++){const C=f[D];for(let P=0,F=C.length,N=F-1;P<F;N=P++){const $=C[P],G=C[N];$.y>u.y!=G.y>u.y&&u.x<(G.x-$.x)*(u.y-$.y)/(G.y-$.y)+$.x&&(m=!m),v=Math.min(v,Yp(u,$,G))}}return(m?1:-1)*Math.sqrt(v)}(this.p,s),this.max=this.d+this.h*Math.SQRT2}const rp=Number.POSITIVE_INFINITY,ip=Math.sqrt(2);function ug(t,[e,n]){let s=0,u=0;if(n===rp){e<0&&(e=0);const f=e/ip;switch(t){case"top-right":case"top-left":u=f-7;break;case"bottom-right":case"bottom-left":u=7-f;break;case"bottom":u=7-e;break;case"top":u=e-7}switch(t){case"top-right":case"bottom-right":s=-f;break;case"top-left":case"bottom-left":s=f;break;case"left":s=e;break;case"right":s=-e}}else{switch(e=Math.abs(e),n=Math.abs(n),t){case"top-right":case"top-left":case"top":u=n-7;break;case"bottom-right":case"bottom-left":case"bottom":u=7-n}switch(t){case"top-right":case"bottom-right":case"right":s=-e;break;case"top-left":case"bottom-left":case"left":s=e}}return[s,u]}function V_(t,e,n,s,u,f,m,v,D,C){t.createArrays(),t.tilePixelRatio=pn/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;const P=t.layers[0].layout,F=t.layers[0]._unevaluatedLayout._values,N={};if("composite"===t.textSizeData.kind){const{minZoom:J,maxZoom:ie}=t.textSizeData;N.compositeTextSizes=[F["text-size"].possiblyEvaluate(new Te(J),v),F["text-size"].possiblyEvaluate(new Te(ie),v)]}if("composite"===t.iconSizeData.kind){const{minZoom:J,maxZoom:ie}=t.iconSizeData;N.compositeIconSizes=[F["icon-size"].possiblyEvaluate(new Te(J),v),F["icon-size"].possiblyEvaluate(new Te(ie),v)]}N.layoutTextSize=F["text-size"].possiblyEvaluate(new Te(D+1),v),N.layoutIconSize=F["icon-size"].possiblyEvaluate(new Te(D+1),v),N.textMaxSize=F["text-size"].possiblyEvaluate(new Te(18),v);const $="map"===P.get("text-rotation-alignment")&&"point"!==P.get("symbol-placement"),G=P.get("text-size");for(const J of t.features){const ie=P.get("text-font").evaluate(J,{},v).join(","),ue=G.evaluate(J,{},v),ge=N.layoutTextSize.evaluate(J,{},v),ce=(N.layoutIconSize.evaluate(J,{},v),{horizontal:{},vertical:void 0}),pe=J.text;let _e,ye=[0,0];if(pe){const Ze=pe.toString(),dt=24*P.get("text-letter-spacing").evaluate(J,{},v),je=24*P.get("text-line-height").evaluate(J,{},v),Xe=A(Ze)?dt:0,Ye=P.get("text-anchor").evaluate(J,{},v),st=P.get("text-variable-anchor");if(!st){const Rt=P.get("text-radial-offset").evaluate(J,{},v);ye=Rt?ug(Ye,[24*Rt,rp]):P.get("text-offset").evaluate(J,{},v).map(Wt=>24*Wt)}let ft=$?"center":P.get("text-justify").evaluate(J,{},v);const Ve="point"===P.get("symbol-placement"),It=Ve?24*P.get("text-max-width").evaluate(J,{},v):1/0,ln=Rt=>{t.allowVerticalPlacement&&S(Ze)&&(ce.vertical=Uh(pe,e,n,u,ie,It,je,Ye,Rt,Xe,ye,$o.vertical,!0,ge,ue))};if(!$&&st){const Rt="auto"===ft?st.map(Mt=>Yu(Mt)):[ft];let Wt=!1;for(let Mt=0;Mt<Rt.length;Mt++){const un=Rt[Mt];if(!ce.horizontal[un])if(Wt)ce.horizontal[un]=ce.horizontal[0];else{const Fn=Uh(pe,e,n,u,ie,It,je,"center",un,Xe,ye,$o.horizontal,!1,ge,ue);Fn&&(ce.horizontal[un]=Fn,Wt=1===Fn.positionedLines.length)}}ln("left")}else{if("auto"===ft&&(ft=Yu(Ye)),Ve||P.get("text-writing-mode").indexOf("horizontal")>=0||!S(Ze)){const Rt=Uh(pe,e,n,u,ie,It,je,Ye,ft,Xe,ye,$o.horizontal,!1,ge,ue);Rt&&(ce.horizontal[ft]=Rt)}ln(Ve?"left":ft)}}let Oe=!1;if(J.icon&&J.icon.name){const Ze=s[J.icon.name];Ze&&(_e=F_(u[J.icon.name],P.get("icon-offset").evaluate(J,{},v),P.get("icon-anchor").evaluate(J,{},v)),Oe=Ze.sdf,void 0===t.sdfIcons?t.sdfIcons=Ze.sdf:t.sdfIcons!==Ze.sdf&&vn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ze.pixelRatio!==t.pixelRatio||0!==P.get("icon-rotate").constantOr(1))&&(t.iconsNeedLinear=!0))}const ke=Od(ce.horizontal)||ce.vertical;t.iconsInText||(t.iconsInText=!!ke&&ke.iconsInText),(ke||_e)&&op(t,J,ce,_e,s,N,ge,0,ye,Oe,m,v,C)}f&&t.generateCollisionDebugBuffers(D,t.collisionBoxArray)}function Yu(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function op(t,e,n,s,u,f,m,v,D,C,P,F,N){let $=f.textMaxSize.evaluate(e,{},F);void 0===$&&($=m);const G=t.layers[0].layout,J=G.get("icon-offset").evaluate(e,{},F),ie=Od(n.horizontal)||n.vertical,ue="globe"===N.name,ge=m/24,ce=t.tilePixelRatio*$/24,pe=(Xe=t.overscaling,t.zoom>18&&Xe>2&&(Xe>>=1),Math.max(pn/(512*Xe),1)*G.get("symbol-spacing")),_e=G.get("text-padding")*t.tilePixelRatio,ye=G.get("icon-padding")*t.tilePixelRatio,Oe=qe(G.get("text-max-angle")),ke="map"===G.get("text-rotation-alignment")&&"point"!==G.get("symbol-placement"),Ze="map"===G.get("icon-rotation-alignment")&&"point"!==G.get("symbol-placement"),dt=G.get("symbol-placement"),je=pe/2;var Xe;const Ye=G.get("icon-text-fit");let st;s&&"none"!==Ye&&(t.allowVerticalPlacement&&n.vertical&&(st=eg(s,n.vertical,Ye,G.get("icon-text-fit-padding"),J,ge)),ie&&(s=eg(s,ie,Ye,G.get("icon-text-fit-padding"),J,ge)));const ft=(Ve,It,ln)=>{if(It.x<0||It.x>=pn||It.y<0||It.y>=pn)return;let Rt=null;if(ue){const{x:Wt,y:Mt,z:un}=N.projectTilePoint(It.x,It.y,ln);Rt={anchor:new zi(Wt,Mt,un,0,void 0),up:N.upVector(ln,It.x,It.y)}}!function(Wt,Mt,un,Fn,Rn,kn,hn,gr,En,Bn,br,Rr,Ir,kr,zr,oi,eo,wr,Ai,wi,dr,Wr,Bi,Er,fi){const Po=Wt.addToLineVertexArray(Mt,Fn);let to,no,Go,ro,lc,yu,hh,dh=0,Dp=0,Tp=0,Cp=0,ef=-1,tf=-1;const Ka={};let Sp=yl.exports("");const kc=un?un.anchor:Mt;let cc=0,Ip=0;if(void 0===En._unevaluatedLayout.getValue("text-radial-offset")?[cc,Ip]=En.layout.get("text-offset").evaluate(dr,{},fi).map(Ho=>24*Ho):(cc=24*En.layout.get("text-radial-offset").evaluate(dr,{},fi),Ip=rp),Wt.allowVerticalPlacement&&Rn.vertical){const Ho=Rn.vertical;if(zr)yu=Fd(Ho),gr&&(hh=Fd(gr));else{const Us=En.layout.get("text-rotate").evaluate(dr,{},fi)+90;Go=sp(Bn,kc,Mt,br,Rr,Ir,Ho,kr,Us,oi),gr&&(ro=sp(Bn,kc,Mt,br,Rr,Ir,gr,wr,Us))}}if(kn){const Ho=En.layout.get("icon-rotate").evaluate(dr,{},fi),Us="none"!==En.layout.get("icon-text-fit"),fh=ag(kn,Ho,Bi,Us),nf=gr?ag(gr,Ho,Bi,Us):void 0;no=sp(Bn,kc,Mt,br,Rr,Ir,kn,wr,Ho),dh=4*fh.length;const Q_=Wt.iconSizeData;let _n=null;"source"===Q_.kind?(_n=[tc*En.layout.get("icon-size").evaluate(dr,{},fi)],_n[0]>Za&&vn(`${Wt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===Q_.kind&&(_n=[tc*Wr.compositeIconSizes[0].evaluate(dr,{},fi),tc*Wr.compositeIconSizes[1].evaluate(dr,{},fi)],(_n[0]>Za||_n[1]>Za)&&vn(`${Wt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Wt.addSymbols(Wt.icon,fh,_n,wi,Ai,dr,!1,un,Mt,Po.lineStartIndex,Po.lineLength,-1,Er,fi),ef=Wt.icon.placedSymbolArray.length-1,nf&&(Dp=4*nf.length,Wt.addSymbols(Wt.icon,nf,_n,wi,Ai,dr,$o.vertical,un,Mt,Po.lineStartIndex,Po.lineLength,-1,Er,fi),tf=Wt.icon.placedSymbolArray.length-1)}for(const Ho in Rn.horizontal){const Us=Rn.horizontal[Ho];to||(Sp=yl.exports(Us.text),zr?lc=Fd(Us):to=sp(Bn,kc,Mt,br,Rr,Ir,Us,kr,En.layout.get("text-rotate").evaluate(dr,{},fi),oi));const fh=1===Us.positionedLines.length;if(Tp+=$_(Wt,un,Mt,Us,hn,En,zr,dr,oi,Po,Rn.vertical?$o.horizontal:$o.horizontalOnly,fh?Object.keys(Rn.horizontal):[Ho],Ka,ef,Wr,Er,fi),fh)break}Rn.vertical&&(Cp+=$_(Wt,un,Mt,Rn.vertical,hn,En,zr,dr,oi,Po,$o.vertical,["vertical"],Ka,tf,Wr,Er,fi));let Oc=-1;const Fc=(Ho,Us)=>Ho?Math.max(Ho,Us):Us;Oc=Fc(lc,Oc),Oc=Fc(yu,Oc),Oc=Fc(hh,Oc);const jy=Oc>-1?1:0;Wt.glyphOffsetArray.length>=sc.MAX_GLYPHS&&vn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==dr.sortKey&&Wt.addToSortKeyRanges(Wt.symbolInstances.length,dr.sortKey),Wt.symbolInstances.emplaceBack(kc.x,kc.y,kc.z,Mt.x,Mt.y,Ka.right>=0?Ka.right:-1,Ka.center>=0?Ka.center:-1,Ka.left>=0?Ka.left:-1,Ka.vertical>=0?Ka.vertical:-1,ef,tf,Sp,void 0!==to?to:Wt.collisionBoxArray.length,void 0!==to?to+1:Wt.collisionBoxArray.length,void 0!==Go?Go:Wt.collisionBoxArray.length,void 0!==Go?Go+1:Wt.collisionBoxArray.length,void 0!==no?no:Wt.collisionBoxArray.length,void 0!==no?no+1:Wt.collisionBoxArray.length,ro||Wt.collisionBoxArray.length,ro?ro+1:Wt.collisionBoxArray.length,br,Tp,Cp,dh,Dp,jy,0,cc,Ip,Oc)}(t,It,Rt,Ve,n,s,u,st,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,_e,ke,D,0,ye,Ze,J,e,f,C,P,F)};if("line"===dt)for(const Ve of ig(e.geometry,0,0,pn,pn)){const It=B_(Ve,pe,Oe,n.vertical||ie,s,24,ce,t.overscaling,pn);for(const ln of It)ie&&hg(t,ie.text,je,ln)||ft(Ve,ln,F)}else if("line-center"===dt){for(const Ve of e.geometry)if(Ve.length>1){const It=ng(Ve,Oe,n.vertical||ie,s,24,ce);It&&ft(Ve,It,F)}}else if("Polygon"===e.type)for(const Ve of xm(e.geometry,0)){const It=cg(Ve,16);ft(Ve[0],new zi(It.x,It.y,0,0,void 0),F)}else if("LineString"===e.type)for(const Ve of e.geometry)ft(Ve,new zi(Ve[0].x,Ve[0].y,0,0,void 0),F);else if("Point"===e.type)for(const Ve of e.geometry)for(const It of Ve)ft([It],new zi(It.x,It.y,0,0,void 0),F)}const Za=32640;function $_(t,e,n,s,u,f,m,v,D,C,P,F,N,$,G,J,ie){const ue=function(pe,_e,ye,Oe,ke,Ze,dt,je){const Xe=[];if(0===_e.positionedLines.length)return Xe;const Ye=Oe.layout.get("text-rotate").evaluate(Ze,{})*Math.PI/180,st=function(Rt){const Wt=Rt[0],Mt=Rt[1],un=Wt*Mt;return un>0?[Wt,-Mt]:un<0?[-Wt,Mt]:0===Wt?[Mt,Wt]:[Mt,-Wt]}(ye);let ft=Math.abs(_e.top-_e.bottom);for(const Rt of _e.positionedLines)ft-=Rt.lineOffset;const Ve=_e.positionedLines.length,It=ft/Ve;let ln=_e.top-ye[1];for(let Rt=0;Rt<Ve;++Rt){const Wt=_e.positionedLines[Rt];ln=np(_e,It,ln,Rt);for(const Mt of Wt.positionedGlyphs){if(!Mt.rect)continue;const un=Mt.rect||{};let Fn=4,Rn=!0,kn=1,hn=0;if(Mt.imageName){const Er=dt[Mt.imageName];if(!Er)continue;if(Er.sdf){vn("SDF images are not supported in formatted text and will be ignored.");continue}Rn=!1,kn=Er.pixelRatio,Fn=1/kn}const gr=(ke||je)&&Mt.vertical,En=Mt.metrics.advance*Mt.scale/2,Bn=Mt.metrics,br=Mt.rect;if(null===br)continue;je&&_e.verticalizable&&(hn=Mt.imageName?En-Mt.metrics.width*Mt.scale/2:0);const Rr=ke?[Mt.x+En,Mt.y]:[0,0];let Ir=[0,0],kr=[0,0],zr=!1;ke||(gr?(kr=[Mt.x+En+st[0],Mt.y+st[1]-hn],zr=!0):Ir=[Mt.x+En+ye[0],Mt.y+ye[1]-hn]);const oi=br.w*Mt.scale/(kn*(Mt.localGlyph?2:1)),eo=br.h*Mt.scale/(kn*(Mt.localGlyph?2:1));let wr,Ai,wi,dr;if(gr){const Er=Mt.y-ln,fi=new Qe(-En,En-Er),Po=-Math.PI/2,to=new Qe(...kr);wr=new Qe(-En+Ir[0],Ir[1]),wr._rotateAround(Po,fi)._add(to),wr.x+=-Er+En,wr.y-=(Bn.left-Fn)*Mt.scale;const no=Mt.imageName?Bn.advance*Mt.scale:24*Mt.scale,Go=String.fromCharCode(Mt.glyph);R_(Go)?wr.x+=(1-Fn)*Mt.scale:Vm(Go)?wr.x+=no-Bn.height*Mt.scale+(-Fn-1)*Mt.scale:wr.x+=Mt.imageName||Bn.width+2*Fn===br.w&&Bn.height+2*Fn===br.h?(no-eo)/2:(no-(Bn.height+2*Fn)*Mt.scale)/2,Ai=new Qe(wr.x,wr.y-oi),wi=new Qe(wr.x+eo,wr.y),dr=new Qe(wr.x+eo,wr.y-oi)}else{const Er=(Bn.left-Fn)*Mt.scale-En+Ir[0],fi=(-Bn.top-Fn)*Mt.scale+Ir[1],Po=Er+oi,to=fi+eo;wr=new Qe(Er,fi),Ai=new Qe(Po,fi),wi=new Qe(Er,to),dr=new Qe(Po,to)}if(Ye){let Er;Er=ke?new Qe(0,0):zr?new Qe(st[0],st[1]):new Qe(ye[0],ye[1]),wr._rotateAround(Ye,Er),Ai._rotateAround(Ye,Er),wi._rotateAround(Ye,Er),dr._rotateAround(Ye,Er)}const Wr=new Qe(0,0),Bi=new Qe(0,0);Xe.push({tl:wr,tr:Ai,bl:wi,br:dr,tex:un,writingMode:_e.writingMode,glyphOffset:Rr,sectionIndex:Mt.sectionIndex,isSDF:Rn,pixelOffsetTL:Wr,pixelOffsetBR:Bi,minFontScaleX:0,minFontScaleY:0})}}return Xe}(0,s,D,f,m,v,u,t.allowVerticalPlacement),ge=t.textSizeData;let ce=null;"source"===ge.kind?(ce=[tc*f.layout.get("text-size").evaluate(v,{},ie)],ce[0]>Za&&vn(`${t.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===ge.kind&&(ce=[tc*G.compositeTextSizes[0].evaluate(v,{},ie),tc*G.compositeTextSizes[1].evaluate(v,{},ie)],(ce[0]>Za||ce[1]>Za)&&vn(`${t.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),t.addSymbols(t.text,ue,ce,D,m,v,P,e,n,C.lineStartIndex,C.lineLength,$,J,ie);for(const pe of F)N[pe]=t.text.placedSymbolArray.length-1;return 4*ue.length}function Od(t){for(const e in t)return t[e];return null}function sp(t,e,n,s,u,f,m,v,D,C){let P=m.top,F=m.bottom,N=m.left,$=m.right;const G=m.collisionPadding;if(G&&(N-=G[0],P-=G[1],$+=G[2],F+=G[3]),D){const J=new Qe(N,P),ie=new Qe($,P),ue=new Qe(N,F),ge=new Qe($,F),ce=qe(D);let pe=new Qe(0,0);C&&(pe=new Qe(C[0],C[1])),J._rotateAround(ce,pe),ie._rotateAround(ce,pe),ue._rotateAround(ce,pe),ge._rotateAround(ce,pe),N=Math.min(J.x,ie.x,ue.x,ge.x),$=Math.max(J.x,ie.x,ue.x,ge.x),P=Math.min(J.y,ie.y,ue.y,ge.y),F=Math.max(J.y,ie.y,ue.y,ge.y)}return t.emplaceBack(e.x,e.y,e.z,n.x,n.y,N,P,$,F,v,s,u,f),t.length-1}function Fd(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);const e=t.bottom-t.top;return e>0?Math.max(10,e):null}function hg(t,e,n,s){const u=t.compareText;if(e in u){const f=u[e];for(let m=f.length-1;m>=0;m--)if(s.dist(f[m])<n)return!0}else u[e]=[];return u[e].push(s),!1}const dg=Ft([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:ap}=dg,zd=Ft([{name:"a_pos_3",components:3,type:"Int16"}]);var Fs=Ft([{name:"a_pos",type:"Int16",components:2}]);const ga=pn/Math.PI/2,Ku=2*da(1,0)*ga*Math.PI,Ju=[64,32,16],zs=-ga,Bs=ga,G_=[new Uo([zs,zs,zs],[Bs,Bs,Bs]),new Uo([zs,zs,zs],[0,0,Bs]),new Uo([0,zs,zs],[Bs,0,Bs]),new Uo([zs,0,zs],[0,Bs,Bs]),new Uo([0,0,zs],[Bs,Bs,Bs])];function fg(t,e,n,s=!0){const u=ys([],t._camera.position,t.worldSize),f=[e,n,1,1];Qc(f,f,t.pixelMatrixInverse),sm(f,f,1/f[3]);const m=Mo([],bl([],f,u)),v=t.globeMatrix,D=[v[12],v[13],v[14]],C=bl([],D,u),P=Sh(C),F=Mo([],C),N=t.worldSize/(2*Math.PI),$=Ha(F,m),G=Math.asin(N/P);if(G<Math.acos($)){if(!s)return null;const dt=[],je=[];ys(dt,m,P/$),Mo(je,bl(je,dt,C)),Mo(m,Yl(m,C,ys(m,je,Math.tan(G)*P)))}const J=[];new Of(u,m).closestPointOnSphere(D,N,J);const ie=Mo([],Wi(v,0)),ue=Mo([],Wi(v,1)),ge=Mo([],Wi(v,2)),ce=Ha(ie,J),pe=Ha(ue,J),_e=Ha(ge,J),ye=Xt(Math.asin(-pe/N));let Oe=Xt(Math.atan2(ce,_e));Oe=t.center.lng+function(dt,je){const Xe=(je-dt+180)%360-180;return Xe<-180?Xe+360:Xe}(t.center.lng,Oe);const ke=Ba(Oe),Ze=tt(Na(ye),0,1);return new Yc(ke,Ze)}class Vh{constructor(e,n,s){this.a=bl([],e,s),this.b=bl([],n,s),this.center=s;const u=Mo([],this.a),f=Mo([],this.b);this.angle=Math.acos(Ha(u,f))}}function lp(t,e){if(0===t.angle)return null;let n;return n=0===t.a[e]?1/t.angle*.5*Math.PI:1/t.angle*Math.atan(t.b[e]/t.a[e]/Math.sin(t.angle)-1/Math.tan(t.angle)),n<0||n>1?null:function(s,u,f,m){const v=Math.sin(f);return s*(Math.sin((1-m)*f)/v)+u*(Math.sin(m*f)/v)}(t.a[e],t.b[e],t.angle,tt(n,0,1))+t.center[e]}function rc(t){if(t.z<=1)return G_[t.z+2*t.y+t.x];const e=cp(Bd(t));return Uo.fromPoints(e)}function cu(t,e,n){return ys(t,t,1-n),Ou(t,t,e,n)}function pg(t,e){const n=nh(e.zoom);if(0===n)return rc(t);const s=Bd(t),u=cp(s),f=Ba(s.getWest())*e.worldSize,m=Ba(s.getEast())*e.worldSize,v=Na(s.getNorth())*e.worldSize,D=Na(s.getSouth())*e.worldSize,C=[f,v,0],P=[m,v,0],F=[f,D,0],N=[m,D,0],$=If([],e.globeMatrix);return bi(C,C,$),bi(P,P,$),bi(F,F,$),bi(N,N,$),u[0]=cu(u[0],F,n),u[1]=cu(u[1],N,n),u[2]=cu(u[2],P,n),u[3]=cu(u[3],C,n),Uo.fromPoints(u)}function mg(t,e,n){for(const s of t)bi(s,s,e),ys(s,s,n)}function Bd({x:t,y:e,z:n}){const s=1/(1<<n),u=new or(fa(t*s),Fi((e+1)*s)),f=new or(fa((t+1)*s),Fi(e*s));return new Ic(u,f)}function cp(t){const e=qe(t.getNorth()),n=qe(t.getSouth()),s=Math.cos(e),u=Math.cos(n),f=Math.sin(e),m=Math.sin(n),v=t.getWest(),D=t.getEast();return[Qu(u,m,v),Qu(u,m,D),Qu(s,f,D),Qu(s,f,v)]}function Qu(t,e,n,s=ga){return n=qe(n),[t*Math.sin(n)*s,-e*s,t*Math.cos(n)*s]}function eh(t,e,n){return Qu(Math.cos(qe(t)),Math.sin(qe(t)),e,n)}function th(t,e,n,s){const u=1<<n.z,f=(t/pn+n.x)/u;return eh(Fi((e/pn+n.y)/u),fa(f),s)}function Nd({min:t,max:e}){return 16383/Math.max(e[0]-t[0],e[1]-t[1],e[2]-t[2])}const Ud=new Float64Array(16);function $h(t){const e=Nd(t),n=n_(Ud,[e,e,e]);return pa(n,n,((s=[])[0]=-(u=t.min)[0],s[1]=-u[1],s[2]=-u[2],s));var s,u}function up(t){const e=(s=t.min,(n=Ud)[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=s[0],n[13]=s[1],n[14]=s[2],n[15]=1,n);var n,s;const u=1/Nd(t);return Ga(e,e,[u,u,u])}function gg(t,e,n,s,u){const f=function(D){const C=pn/(2*Math.PI);return D/(2*Math.PI)/C}(n),m=[t,e,-n/(2*Math.PI)],v=$a(new Float64Array(16));return pa(v,v,m),Ga(v,v,[f,f,f]),Mf(v,v,qe(-u)),Af(v,v,qe(-s)),v}function nh(t){return cn(5,6,t)}function _g(t,e){const n=eh(e.lat,e.lng);return m=(u=Rf([],function(G){const J=eh(G._center.lat,G._center.lng);let ie=im([],ku(0,1,0),J);const ue=r_([],-G.angle,J);ie=bi(ie,ie,ue),r_(ue,-G._pitch,ie);const ge=Mo([],J);return ys(ge,ge,G.cameraToCenterDistance/G.pixelsPerMeter*Ku),bi(ge,ge,ue),Yl([],J,ge)}(t),n))[0],v=u[1],D=u[2],C=(f=n)[0],P=f[1],F=f[2],$=(N=Math.sqrt(m*m+v*v+D*D)*Math.sqrt(C*C+P*P+F*F))&&Ha(u,f)/N,Math.acos(Math.min(Math.max($,-1),1));var u,f,m,v,D,C,P,F,N,$}function hp(t,e){return _g(t,e)>Math.PI/2*1.01}const yg=qe(85),vg=Math.cos(yg),xg=Math.sin(yg);function bg(t,e){const n=t.fovAboveCenter,s=t.elevation?t.elevation.getMinElevationBelowMSL()*e:0,u=(t._camera.position[2]*t.worldSize-s)/Math.cos(t._pitch),f=Math.sin(n)*u/Math.sin(Math.max(Math.PI/2-t._pitch-n,.01)),m=Math.sin(t._pitch)*f+u;return Math.min(1.01*m,u*(1/t._horizonShift))}function rh(t,e){if(!e.isReprojectedInTileSpace)return{scale:1<<t.z,x:t.x,y:t.y,x2:t.x+1,y2:t.y+1,projection:e};const n=Math.pow(2,-t.z),s=t.x*n,u=(t.x+1)*n,f=t.y*n,m=(t.y+1)*n,v=fa(s),D=fa(u),C=Fi(f),P=Fi(m),F=e.project(v,C),N=e.project(D,C),$=e.project(D,P),G=e.project(v,P);let J=Math.min(F.x,N.x,$.x,G.x),ie=Math.min(F.y,N.y,$.y,G.y),ue=Math.max(F.x,N.x,$.x,G.x),ge=Math.max(F.y,N.y,$.y,G.y);const ce=n/16;function pe(ye,Oe,ke,Ze,dt,je){const Xe=(ke+dt)/2,Ye=(Ze+je)/2,st=e.project(fa(Xe),Fi(Ye)),ft=Math.max(0,J-st.x,ie-st.y,st.x-ue,st.y-ge);J=Math.min(J,st.x),ue=Math.max(ue,st.x),ie=Math.min(ie,st.y),ge=Math.max(ge,st.y),ft>ce&&(pe(ye,st,ke,Ze,Xe,Ye),pe(st,Oe,Xe,Ye,dt,je))}pe(F,N,s,f,u,f),pe(N,$,u,f,u,m),pe($,G,u,m,s,m),pe(G,F,s,m,s,f),J-=ce,ie-=ce,ue+=ce,ge+=ce;const _e=1/Math.max(ue-J,ge-ie);return{scale:_e,x:J*_e,y:ie*_e,x2:ue*_e,y2:ge*_e,projection:e}}const wg=$a(new Float32Array(16));class qa{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,n){return{x:0,y:0,z:0}}unproject(e,n){return new or(0,0)}projectTilePoint(e,n,s){return{x:e,y:n,z:0}}locationPoint(e,n,s=!0){return e._coordinatePoint(e.locationCoordinate(n),s)}pixelsPerMeter(e,n){return da(1,e)*n}pixelSpaceConversion(e,n,s){return 1}farthestPixelDistance(e){return bg(e,e.pixelsPerMeter)}pointCoordinate(e,n,s,u){const f=e.horizonLineFromTop(!1),m=new Qe(n,Math.max(f,s));return e.rayIntersectionCoordinate(e.pointRayIntersection(m,u))}pointCoordinate3D(e,n,s){const u=new Qe(n,s);if(e.elevation)return e.elevation.pointCoordinate(u);{const f=this.pointCoordinate(e,u.x,u.y,0);return[f.x,f.y,f.z]}}isPointAboveHorizon(e,n){if(e.elevation)return!this.pointCoordinate3D(e,n.x,n.y);const s=e.horizonLineFromTop();return n.y<s}createInversionMatrix(e,n){return wg}createTileMatrix(e,n,s){let u,f,m;const v=s.canonical,D=$a(new Float64Array(16));if(this.isReprojectedInTileSpace){const C=rh(v,this);u=1,f=C.x+s.wrap*C.scale,m=C.y,Ga(D,D,[u/C.scale,u/C.scale,e.pixelsPerMeter/n])}else u=n/e.zoomScale(v.z),f=(v.x+Math.pow(2,v.z)*s.wrap)*u,m=v.y*u;return pa(D,D,[f,m,0]),Ga(D,D,[u/pn,u/pn,1]),D}upVector(e,n,s){return[0,0,1]}upVectorScale(e,n,s){return{metersToTile:1}}}class uu extends qa{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[n,s]=this.parallels=e.parallels||[29.5,45.5],u=Math.sin(qe(n));this.n=(u+Math.sin(qe(s)))/2,this.c=1+u*(2*this.n-u),this.r0=Math.sqrt(this.c)/this.n}project(e,n){const{n:s,c:u,r0:f}=this,m=qe(e-this.center[0]),v=qe(n),D=Math.sqrt(u-2*s*Math.sin(v))/s;return{x:D*Math.sin(m*s),y:D*Math.cos(m*s)-f,z:0}}unproject(e,n){const{n:s,c:u,r0:f}=this,m=f+n;let v=Math.atan2(e,Math.abs(m))*Math.sign(m);m*s<0&&(v-=Math.PI*Math.sign(e)*Math.sign(m));const D=qe(this.center[0])*s;v=Nn(v,-Math.PI-D,Math.PI-D);const C=tt(Xt(v/s)+this.center[0],-180,180),P=Math.asin(tt((u-(e*e+m*m)*s*s)/(2*s),-1,1)),F=tt(Xt(P),-85.051129,Ua);return new or(C,F)}}const jd=1.340264,Lc=-.081106,Gh=893e-6,Hh=.003796,ih=Math.sqrt(3)/2;class Z_ extends qa{project(e,n){n=n/180*Math.PI,e=e/180*Math.PI;const s=Math.asin(ih*Math.sin(n)),u=s*s,f=u*u*u;return{x:.5*(e*Math.cos(s)/(ih*(jd+3*Lc*u+f*(7*Gh+9*Hh*u)))/Math.PI+.5),y:1-.5*(s*(jd+Lc*u+f*(Gh+Hh*u))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let s=n=(2*(1-n)-1)*Math.PI,u=s*s,f=u*u*u;for(let P,F,N,$=0;$<12&&(F=s*(jd+Lc*u+f*(Gh+Hh*u))-n,N=jd+3*Lc*u+f*(7*Gh+9*Hh*u),P=F/N,s=tt(s-P,-Math.PI/3,Math.PI/3),u=s*s,f=u*u*u,!(Math.abs(P)<1e-12));++$);const m=ih*e*(jd+3*Lc*u+f*(7*Gh+9*Hh*u))/Math.cos(s),v=Math.asin(Math.sin(s)/ih),D=tt(180*m/Math.PI,-180,180),C=tt(180*v/Math.PI,-85.051129,Ua);return new or(D,C)}}class Dl extends qa{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){return{x:.5+e/360,y:.5-n/360,z:0}}unproject(e,n){const s=360*(e-.5),u=tt(360*(.5-n),-85.051129,Ua);return new or(s,u)}}const Tl=Math.PI/2;function Qi(t){return Math.tan((Tl+t)/2)}class hu extends qa{constructor(e){super(e),this.center=e.center||[0,30];const[n,s]=this.parallels=e.parallels||[30,30];let u=qe(n),f=qe(s);this.southernCenter=u+f<0,this.southernCenter&&(u=-u,f=-f);const m=Math.cos(u),v=Qi(u);this.n=u===f?Math.sin(u):Math.log(m/Math.cos(f))/Math.log(Qi(f)/v),this.f=m*Math.pow(Qi(u),this.n)/this.n}project(e,n){n=qe(n),this.southernCenter&&(n=-n),e=qe(e-this.center[0]);const s=1e-6,{n:u,f}=this;f>0?n<-Tl+s&&(n=-Tl+s):n>Tl-s&&(n=Tl-s);const m=f/Math.pow(Qi(n),u);let v=m*Math.sin(u*e),D=f-m*Math.cos(u*e);return v=.5*(v/Math.PI+.5),D=.5*(D/Math.PI+.5),{x:v,y:this.southernCenter?D:1-D,z:0}}unproject(e,n){e=(2*e-.5)*Math.PI,this.southernCenter&&(n=1-n),n=(2*(1-n)-.5)*Math.PI;const{n:s,f:u}=this,f=u-n,m=Math.sign(f),v=Math.sign(s)*Math.sqrt(e*e+f*f);let D=Math.atan2(e,Math.abs(f))*m;f*s<0&&(D-=Math.PI*Math.sign(e)*m);const C=tt(Xt(D/s)+this.center[0],-180,180),P=tt(Xt(2*Math.atan(Math.pow(u/v,1/s))-Tl),-85.051129,Ua);return new or(C,this.southernCenter?-P:P)}}class Zh extends qa{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,n){return{x:Ba(e),y:Na(n),z:0}}unproject(e,n){const s=fa(e),u=Fi(n);return new or(s,u)}}const Ns=qe(Ua);class dp extends qa{project(e,n){const s=(n=qe(n))*n,u=s*s;return{x:.5*((e=qe(e))*(.8707-.131979*s+u*(u*(.003971*s-.001529*u)-.013791))/Math.PI+.5),y:1-.5*(n*(1.007226+s*(.015085+u*(.028874*s-.044475-.005916*u)))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let s=n=(2*(1-n)-1)*Math.PI,u=25,f=0,m=s*s;do{m=s*s;const C=m*m;f=(s*(1.007226+m*(.015085+C*(.028874*m-.044475-.005916*C)))-n)/(1.007226+m*(.045255+C*(.259866*m-.311325-.005916*11*C))),s=tt(s-f,-Ns,Ns)}while(Math.abs(f)>1e-6&&--u>0);m=s*s;const v=tt(Xt(e/(.8707+m*(m*(m*m*m*(.003971-.001529*m)-.013791)-.131979))),-180,180),D=Xt(s);return new or(v,D)}}const du=qe(Ua);class oh extends qa{project(e,n){n=qe(n),e=qe(e);const s=Math.cos(n),u=2/Math.PI,f=Math.acos(s*Math.cos(e/2)),m=Math.sin(f)/f,v=.5*(e*u+2*s*Math.sin(e/2)/m)||0,D=.5*(n+Math.sin(n)/m)||0;return{x:.5*(v/Math.PI+.5),y:1-.5*(D/Math.PI+1),z:0}}unproject(e,n){let s=e=(2*e-.5)*Math.PI,u=n=(2*(1-n)-1)*Math.PI,f=25;const m=1e-6;let v=0,D=0;do{const C=Math.cos(u),P=Math.sin(u),F=2*P*C,N=P*P,$=C*C,G=Math.cos(s/2),J=Math.sin(s/2),ie=2*G*J,ue=J*J,ge=1-$*G*G,ce=ge?1/ge:0,pe=ge?Math.acos(C*G)*Math.sqrt(1/ge):0,_e=.5*(2*pe*C*J+2*s/Math.PI)-e,ye=.5*(pe*P+u)-n,Oe=.5*ce*($*ue+pe*C*G*N)+1/Math.PI,ke=ce*(ie*F/4-pe*P*J),Ze=.125*ce*(F*J-pe*P*$*ie),dt=.5*ce*(N*G+pe*ue*C)+.5,je=ke*Ze-dt*Oe;v=(ye*ke-_e*dt)/je,D=(_e*Ze-ye*Oe)/je,s=tt(s-v,-Math.PI,Math.PI),u=tt(u-D,-du,du)}while((Math.abs(v)>m||Math.abs(D)>m)&&--f>0);return new or(Xt(s),Xt(u))}}class fu extends qa{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(qe(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){const{scale:s,cosPhi:u}=this;return{x:qe(e)*u*s+.5,y:-Math.sin(qe(n))/u*s+.5,z:0}}unproject(e,n){const{scale:s,cosPhi:u}=this,f=-(n-.5)/s,m=tt(Xt((e-.5)/s)/u,-180,180),v=Math.asin(tt(f*u,-1,1)),D=tt(Xt(v),-85.051129,Ua);return new or(m,D)}}class sh extends Zh{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug","custom"],this.range=[3,5]}projectTilePoint(e,n,s){const u=th(e,n,s);return bi(u,u,$h(rc(s))),{x:u[0],y:u[1],z:u[2]}}locationPoint(e,n){const s=eh(n.lat,n.lng),u=Mo([],s),f=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(n),e._centerAltitude):e._centerAltitude;Ou(s,s,u,da(1,0)*pn*f);const m=$a(new Float64Array(16));return Kc(m,e.pixelMatrix,e.globeMatrix),bi(s,s,m),new Qe(s[0],s[1])}pixelsPerMeter(e,n){return da(1,0)*n}pixelSpaceConversion(e,n,s){const u=da(1,e)*n,f=gn(da(1,45)*n,u,s);return this.pixelsPerMeter(e,n)/f}createTileMatrix(e,n,s){const u=up(rc(s.canonical));return Kc(new Float64Array(16),e.globeMatrix,u)}createInversionMatrix(e,n){const{center:s}=e,u=$h(rc(n));return Af(u,u,qe(s.lng)),Mf(u,u,qe(s.lat)),Ga(u,u,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(u)}pointCoordinate(e,n,s,u){return fg(e,n,s,!0)||new Yc(0,0)}pointCoordinate3D(e,n,s){const u=this.pointCoordinate(e,n,s,0);return[u.x,u.y,u.z]}isPointAboveHorizon(e,n){return!fg(e,n.x,n.y,!1)}farthestPixelDistance(e){const n=function(u,f){const m=u.cameraToCenterDistance,v=u._centerAltitude*f,D=u._camera,C=u._camera.forward(),P=Yl([],ys([],C,-m),[0,0,v]),F=u.worldSize/(2*Math.PI),N=[0,0,-F],$=u.width/u.height,G=Math.tan(u.fovAboveCenter),J=ys([],D.up(),G),ie=ys([],D.right(),G*$),ue=Mo([],Yl([],Yl([],C,J),ie)),ge=[];let ce;if(new Of(P,ue).closestPointOnSphere(N,F,ge)){const pe=Yl([],ge,N),_e=bl([],pe,P);ce=Math.cos(u.fovAboveCenter)*Sh(_e)}else{const pe=bl([],P,N),_e=bl([],N,P);Mo(_e,_e);const ye=Sh(pe)-F;ce=Math.sqrt(ye*(ye+2*F));const Oe=Math.acos(ce/(F+ye))-Math.acos(Ha(C,_e));ce*=Math.cos(Oe)}return 1.01*ce}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),s=nh(e.zoom);if(s>0){const u=bg(e,da(1,e.center.lat)*e.worldSize),f=e.worldSize/(2*Math.PI),m=Math.max(e.width,e.height)/e.worldSize*Math.PI;return gn(n,u+f*(1-Math.cos(m)),Math.pow(s,10))}return n}upVector(e,n,s){return th(n,s,e,1)}upVectorScale(e){return{metersToTile:Ku*Nd(rc(e))}}}function pu(t){const e=t.parallels,n=!!e&&Math.abs(e[0]+e[1])<.01;switch(t.name){case"mercator":return new Zh(t);case"equirectangular":return new Dl(t);case"naturalEarth":return new dp(t);case"equalEarth":return new Z_(t);case"winkelTripel":return new oh(t);case"albers":return n?new fu(t):new uu(t);case"lambertConformalConic":return n?new fu(t):new hu(t);case"globe":return new sh(t)}throw new Error(`Invalid projection name: ${t.name}`)}const ah=bd.types,lh=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function ic(t,e,n,s,u,f,m,v,D,C,P,F,N){const $=v?Math.min(Za,Math.round(v[0])):0,G=v?Math.min(Za,Math.round(v[1])):0;t.emplaceBack(e,n,Math.round(32*s),Math.round(32*u),f,m,($<<1)+(D?1:0),G,16*C,16*P,256*F,256*N)}function oc(t,e,n,s,u,f,m){t.emplaceBack(e,n,s,u,f,m)}function qh(t,e,n,s,u){t.emplaceBack(e,n,s,u),t.emplaceBack(e,n,s,u),t.emplaceBack(e,n,s,u),t.emplaceBack(e,n,s,u)}function Eg(t){for(const e of t.sections)if(x(e.text))return!0;return!1}class Vd{constructor(e){this.layoutVertexArray=new Ar,this.indexArray=new Ji,this.programConfigurations=e,this.segments=new xi,this.dynamicLayoutVertexArray=new es,this.opacityVertexArray=new vi,this.placedSymbolArray=new Np,this.globeExtVertexArray=new ir}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(e,n,s,u){this.isEmpty()||(s&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Nm.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,iu.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,lh,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Um.members,!0)),this.opacityVertexBuffer.itemSize=1),(s||u)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}Ot(Vd,"SymbolBuffers");class $d{constructor(e,n,s){this.layoutVertexArray=new e,this.layoutAttributes=n,this.indexArray=new s,this.segments=new xi,this.collisionVertexArray=new Mu,this.collisionVertexArrayExt=new Fa}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,M_.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,Wf.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Ot($d,"CollisionBuffers");class sc{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(m=>m.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=$a([]),this.placementViewportMatrix=$a([]);const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=jm(this.zoom,n["text-size"]),this.iconSizeData=jm(this.zoom,n["icon-size"]);const s=this.layers[0].layout,u=s.get("symbol-sort-key"),f=s.get("symbol-z-order");this.canOverlap=s.get("text-allow-overlap")||s.get("icon-allow-overlap")||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==f&&void 0!==u.constantOr(1),this.sortFeaturesByY=("viewport-y"===f||"auto"===f&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=s.get("text-writing-mode").map(m=>$o[m]),this.stateDependentLayerIds=this.layers.filter(m=>m.isStateDependent()).map(m=>m.id),this.sourceID=e.sourceID,this.projection=e.projection}createArrays(){this.text=new Vd(new Xc(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Vd(new Xc(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new jp,this.lineVertexArray=new Vp,this.symbolInstances=new uf}calculateGlyphDependencies(e,n,s,u,f){for(let m=0;m<e.length;m++)if(n[e.charCodeAt(m)]=!0,u&&f){const v=wl[e.charAt(m)];v&&(n[v.charCodeAt(0)]=!0)}}populate(e,n,s,u){const f=this.layers[0],m=f.layout,v="globe"===this.projection.name,D=m.get("text-font"),C=m.get("text-field"),P=m.get("icon-image"),F=("constant"!==C.value.kind||C.value.value instanceof Gr&&!C.value.value.isEmpty()||C.value.value.toString().length>0)&&("constant"!==D.value.kind||D.value.value.length>0),N="constant"!==P.value.kind||!!P.value.value||Object.keys(P.parameters).length>0,$=m.get("symbol-sort-key");if(this.features=[],!F&&!N)return;const G=n.iconDependencies,J=n.glyphDependencies,ie=n.availableImages,ue=new Te(this.zoom);for(const{feature:ge,id:ce,index:pe,sourceLayerIndex:_e}of e){const ye=f._featureFilter.needGeometry,Oe=Va(ge,ye);if(!f._featureFilter.filter(ue,Oe,s))continue;if(ye||(Oe.geometry=ja(ge,s,u)),v&&1!==ge.type&&s.z<=5){const je=Oe.geometry,Xe=.98078528056,Ye=(st,ft)=>Ha(th(st.x,st.y,s,1),th(ft.x,ft.y,s,1))<Xe;for(let st=0;st<je.length;st++)je[st]=ad(je[st],Ye)}let ke,Ze;if(F){const je=f.getValueAndResolveTokens("text-field",Oe,s,ie),Xe=Gr.factory(je);Eg(Xe)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===be()||this.hasRTLText&&Pe.isParsed())&&(ke=P_(Xe,f,Oe))}if(N){const je=f.getValueAndResolveTokens("icon-image",Oe,s,ie);Ze=je instanceof Xn?je:Xn.fromString(je)}if(!ke&&!Ze)continue;const dt=this.sortFeaturesByKey?$.evaluate(Oe,{},s):void 0;if(this.features.push({id:ce,text:ke,icon:Ze,index:pe,sourceLayerIndex:_e,geometry:Oe.geometry,properties:ge.properties,type:ah[ge.type],sortKey:dt}),Ze&&(G[Ze.name]=!0),ke){const je=D.evaluate(Oe,{},s).join(","),Xe="map"===m.get("text-rotation-alignment")&&"point"!==m.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf($o.vertical)>=0;for(const Ye of ke.sections)if(Ye.image)G[Ye.image.name]=!0;else{const st=S(ke.toString()),ft=Ye.fontStack||je,Ve=J[ft]=J[ft]||{};this.calculateGlyphDependencies(Ye.text,Ve,Xe,this.allowVerticalPlacement,st)}}}"line"===m.get("symbol-placement")&&(this.features=function(ge){const ce={},pe={},_e=[];let ye=0;function Oe(je){_e.push(ge[je]),ye++}function ke(je,Xe,Ye){const st=pe[je];return delete pe[je],pe[Xe]=st,_e[st].geometry[0].pop(),_e[st].geometry[0]=_e[st].geometry[0].concat(Ye[0]),st}function Ze(je,Xe,Ye){const st=ce[Xe];return delete ce[Xe],ce[je]=st,_e[st].geometry[0].shift(),_e[st].geometry[0]=Ye[0].concat(_e[st].geometry[0]),st}function dt(je,Xe,Ye){const st=Ye?Xe[0][Xe[0].length-1]:Xe[0][0];return`${je}:${st.x}:${st.y}`}for(let je=0;je<ge.length;je++){const Xe=ge[je],Ye=Xe.geometry,st=Xe.text?Xe.text.toString():null;if(!st){Oe(je);continue}const ft=dt(st,Ye),Ve=dt(st,Ye,!0);if(ft in pe&&Ve in ce&&pe[ft]!==ce[Ve]){const It=Ze(ft,Ve,Ye),ln=ke(ft,Ve,_e[It].geometry);delete ce[ft],delete pe[Ve],pe[dt(st,_e[ln].geometry,!0)]=ln,_e[It].geometry=null}else ft in pe?ke(ft,Ve,Ye):Ve in ce?Ze(ft,Ve,Ye):(Oe(je),ce[ft]=ye-1,pe[Ve]=ye-1)}return _e.filter(je=>je.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ge,ce)=>ge.sortKey-ce.sortKey)}update(e,n,s,u){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,n,this.layers,s,u),this.icon.programConfigurations.updatePaintArrays(e,n,this.layers,s,u))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=pu(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,n){const s=this.lineVertexArray.length;if(void 0!==e.segment)for(const{x:u,y:f}of n)this.lineVertexArray.emplaceBack(u,f);return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}}addSymbols(e,n,s,u,f,m,v,D,C,P,F,N,$,G){const J=e.indexArray,ie=e.layoutVertexArray,ue=e.globeExtVertexArray,ge=e.segments.prepareSegment(4*n.length,ie,J,this.canOverlap?m.sortKey:void 0),ce=this.glyphOffsetArray.length,pe=ge.vertexLength,_e=this.allowVerticalPlacement&&v===$o.vertical?Math.PI/2:0,ye=m.text&&m.text.sections;for(let ke=0;ke<n.length;ke++){const{tl:Ze,tr:dt,bl:je,br:Xe,tex:Ye,pixelOffsetTL:st,pixelOffsetBR:ft,minFontScaleX:Ve,minFontScaleY:It,glyphOffset:ln,isSDF:Rt,sectionIndex:Wt}=n[ke],Mt=ge.vertexLength,un=ln[1];if(ic(ie,C.x,C.y,Ze.x,un+Ze.y,Ye.x,Ye.y,s,Rt,st.x,st.y,Ve,It),ic(ie,C.x,C.y,dt.x,un+dt.y,Ye.x+Ye.w,Ye.y,s,Rt,ft.x,st.y,Ve,It),ic(ie,C.x,C.y,je.x,un+je.y,Ye.x,Ye.y+Ye.h,s,Rt,st.x,ft.y,Ve,It),ic(ie,C.x,C.y,Xe.x,un+Xe.y,Ye.x+Ye.w,Ye.y+Ye.h,s,Rt,ft.x,ft.y,Ve,It),D){const{x:Fn,y:Rn,z:kn}=D.anchor,[hn,gr,En]=D.up;oc(ue,Fn,Rn,kn,hn,gr,En),oc(ue,Fn,Rn,kn,hn,gr,En),oc(ue,Fn,Rn,kn,hn,gr,En),oc(ue,Fn,Rn,kn,hn,gr,En),qh(e.dynamicLayoutVertexArray,Fn,Rn,kn,_e)}else qh(e.dynamicLayoutVertexArray,C.x,C.y,C.z,_e);J.emplaceBack(Mt,Mt+1,Mt+2),J.emplaceBack(Mt+1,Mt+2,Mt+3),ge.vertexLength+=4,ge.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ln[0]),ke!==n.length-1&&Wt===n[ke+1].sectionIndex||e.programConfigurations.populatePaintArrays(ie.length,m,m.index,{},$,G,ye&&ye[Wt])}const Oe=D?D.anchor:C;e.placedSymbolArray.emplaceBack(Oe.x,Oe.y,Oe.z,C.x,C.y,ce,this.glyphOffsetArray.length-ce,pe,P,F,C.segment,s?s[0]:0,s?s[1]:0,u[0],u[1],v,0,!1,0,N,0)}_commitLayoutVertex(e,n,s,u,f,m,v){e.emplaceBack(n,s,u,f,m,Math.round(v.x),Math.round(v.y))}_addCollisionDebugVertices(e,n,s,u,f,m,v){const D=s.segments.prepareSegment(4,s.layoutVertexArray,s.indexArray),C=D.vertexLength,P=v.tileAnchorX,F=v.tileAnchorY;for(let $=0;$<4;$++)s.collisionVertexArray.emplaceBack(0,0,0,0);s.collisionVertexArrayExt.emplaceBack(n,-e.padding,-e.padding),s.collisionVertexArrayExt.emplaceBack(n,e.padding,-e.padding),s.collisionVertexArrayExt.emplaceBack(n,e.padding,e.padding),s.collisionVertexArrayExt.emplaceBack(n,-e.padding,e.padding),this._commitLayoutVertex(s.layoutVertexArray,u,f,m,P,F,new Qe(e.x1,e.y1)),this._commitLayoutVertex(s.layoutVertexArray,u,f,m,P,F,new Qe(e.x2,e.y1)),this._commitLayoutVertex(s.layoutVertexArray,u,f,m,P,F,new Qe(e.x2,e.y2)),this._commitLayoutVertex(s.layoutVertexArray,u,f,m,P,F,new Qe(e.x1,e.y2)),D.vertexLength+=4;const N=s.indexArray;N.emplaceBack(C,C+1),N.emplaceBack(C+1,C+2),N.emplaceBack(C+2,C+3),N.emplaceBack(C+3,C),D.primitiveLength+=4}_addTextDebugCollisionBoxes(e,n,s,u,f,m){for(let v=u;v<f;v++){const D=s.get(v),C=this.getSymbolInstanceTextSize(e,m,n,v);this._addCollisionDebugVertices(D,C,this.textCollisionBox,D.projectedAnchorX,D.projectedAnchorY,D.projectedAnchorZ,m)}}_addIconDebugCollisionBoxes(e,n,s,u,f,m){for(let v=u;v<f;v++){const D=s.get(v),C=this.getSymbolInstanceIconSize(e,n,m.placedIconSymbolIndex);this._addCollisionDebugVertices(D,C,this.iconCollisionBox,D.projectedAnchorX,D.projectedAnchorY,D.projectedAnchorZ,m)}}generateCollisionDebugBuffers(e,n){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new $d(Lr,Td.members,ha),this.iconCollisionBox=new $d(Lr,Td.members,ha);const s=ou(this.iconSizeData,e),u=ou(this.textSizeData,e);for(let f=0;f<this.symbolInstances.length;f++){const m=this.symbolInstances.get(f);this._addTextDebugCollisionBoxes(u,e,n,m.textBoxStartIndex,m.textBoxEndIndex,m),this._addTextDebugCollisionBoxes(u,e,n,m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m),this._addIconDebugCollisionBoxes(s,e,n,m.iconBoxStartIndex,m.iconBoxEndIndex,m),this._addIconDebugCollisionBoxes(s,e,n,m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex,m)}}getSymbolInstanceTextSize(e,n,s,u){const f=this.text.placedSymbolArray.get(n.rightJustifiedTextSymbolIndex>=0?n.rightJustifiedTextSymbolIndex:n.centerJustifiedTextSymbolIndex>=0?n.centerJustifiedTextSymbolIndex:n.leftJustifiedTextSymbolIndex>=0?n.leftJustifiedTextSymbolIndex:n.verticalPlacedTextSymbolIndex>=0?n.verticalPlacedTextSymbolIndex:u),m=Cd(this.textSizeData,e,f)/24;return this.tilePixelRatio*m}getSymbolInstanceIconSize(e,n,s){const u=this.icon.placedSymbolArray.get(s),f=Cd(this.iconSizeData,e,u);return this.tilePixelRatio*f}_commitDebugCollisionVertexUpdate(e,n,s){e.emplaceBack(n,-s,-s),e.emplaceBack(n,s,-s),e.emplaceBack(n,s,s),e.emplaceBack(n,-s,s)}_updateTextDebugCollisionBoxes(e,n,s,u,f,m){for(let v=u;v<f;v++){const D=s.get(v),C=this.getSymbolInstanceTextSize(e,m,n,v);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,C,D.padding)}}_updateIconDebugCollisionBoxes(e,n,s,u,f,m){for(let v=u;v<f;v++){const D=s.get(v),C=this.getSymbolInstanceIconSize(e,n,m);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,C,D.padding)}}updateCollisionDebugBuffers(e,n){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const s=ou(this.iconSizeData,e),u=ou(this.textSizeData,e);for(let f=0;f<this.symbolInstances.length;f++){const m=this.symbolInstances.get(f);this._updateTextDebugCollisionBoxes(u,e,n,m.textBoxStartIndex,m.textBoxEndIndex,m),this._updateTextDebugCollisionBoxes(u,e,n,m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m),this._updateIconDebugCollisionBoxes(s,e,n,m.iconBoxStartIndex,m.iconBoxEndIndex,m.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(s,e,n,m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex,m.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,n,s,u,f,m,v,D,C){const P={};if(n<s){const{x1:F,y1:N,x2:$,y2:G,padding:J,projectedAnchorX:ie,projectedAnchorY:ue,projectedAnchorZ:ge,tileAnchorX:ce,tileAnchorY:pe,featureIndex:_e}=e.get(n);P.textBox={x1:F,y1:N,x2:$,y2:G,padding:J,projectedAnchorX:ie,projectedAnchorY:ue,projectedAnchorZ:ge,tileAnchorX:ce,tileAnchorY:pe},P.textFeatureIndex=_e}if(u<f){const{x1:F,y1:N,x2:$,y2:G,padding:J,projectedAnchorX:ie,projectedAnchorY:ue,projectedAnchorZ:ge,tileAnchorX:ce,tileAnchorY:pe,featureIndex:_e}=e.get(u);P.verticalTextBox={x1:F,y1:N,x2:$,y2:G,padding:J,projectedAnchorX:ie,projectedAnchorY:ue,projectedAnchorZ:ge,tileAnchorX:ce,tileAnchorY:pe},P.verticalTextFeatureIndex=_e}if(m<v){const{x1:F,y1:N,x2:$,y2:G,padding:J,projectedAnchorX:ie,projectedAnchorY:ue,projectedAnchorZ:ge,tileAnchorX:ce,tileAnchorY:pe,featureIndex:_e}=e.get(m);P.iconBox={x1:F,y1:N,x2:$,y2:G,padding:J,projectedAnchorX:ie,projectedAnchorY:ue,projectedAnchorZ:ge,tileAnchorX:ce,tileAnchorY:pe},P.iconFeatureIndex=_e}if(D<C){const{x1:F,y1:N,x2:$,y2:G,padding:J,projectedAnchorX:ie,projectedAnchorY:ue,projectedAnchorZ:ge,tileAnchorX:ce,tileAnchorY:pe,featureIndex:_e}=e.get(D);P.verticalIconBox={x1:F,y1:N,x2:$,y2:G,padding:J,projectedAnchorX:ie,projectedAnchorY:ue,projectedAnchorZ:ge,tileAnchorX:ce,tileAnchorY:pe},P.verticalIconFeatureIndex=_e}return P}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const s=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,n){const s=e.placedSymbolArray.get(n),u=s.vertexStartIndex+4*s.numGlyphs;for(let f=s.vertexStartIndex;f<u;f+=4)e.indexArray.emplaceBack(f,f+1,f+2),e.indexArray.emplaceBack(f+1,f+2,f+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const n=Math.sin(e),s=Math.cos(e),u=[],f=[],m=[];for(let v=0;v<this.symbolInstances.length;++v){m.push(v);const D=this.symbolInstances.get(v);u.push(0|Math.round(n*D.tileAnchorX+s*D.tileAnchorY)),f.push(D.featureIndex)}return m.sort((v,D)=>u[v]-u[D]||f[D]-f[v]),m}addToSortKeyRanges(e,n){const s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===n?s.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const s=this.symbolInstances.get(n);this.featureSortOrder.push(s.featureIndex);const{rightJustifiedTextSymbolIndex:u,centerJustifiedTextSymbolIndex:f,leftJustifiedTextSymbolIndex:m,verticalPlacedTextSymbolIndex:v,placedIconSymbolIndex:D,verticalPlacedIconSymbolIndex:C}=s;u>=0&&this.addIndicesForPlacedSymbol(this.text,u),f>=0&&f!==u&&this.addIndicesForPlacedSymbol(this.text,f),m>=0&&m!==f&&m!==u&&this.addIndicesForPlacedSymbol(this.text,m),v>=0&&this.addIndicesForPlacedSymbol(this.text,v),D>=0&&this.addIndicesForPlacedSymbol(this.icon,D),C>=0&&this.addIndicesForPlacedSymbol(this.icon,C)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Ot(sc,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),sc.MAX_GLYPHS=65535,sc.addDynamicAttributes=qh;const Dg=new an({"symbol-placement":new Ae(Ge.layout_symbol["symbol-placement"]),"symbol-spacing":new Ae(Ge.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ae(Ge.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Be(Ge.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ae(Ge.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Ae(Ge.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Ae(Ge.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ae(Ge.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ae(Ge.layout_symbol["icon-rotation-alignment"]),"icon-size":new Be(Ge.layout_symbol["icon-size"]),"icon-text-fit":new Ae(Ge.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ae(Ge.layout_symbol["icon-text-fit-padding"]),"icon-image":new Be(Ge.layout_symbol["icon-image"]),"icon-rotate":new Be(Ge.layout_symbol["icon-rotate"]),"icon-padding":new Ae(Ge.layout_symbol["icon-padding"]),"icon-keep-upright":new Ae(Ge.layout_symbol["icon-keep-upright"]),"icon-offset":new Be(Ge.layout_symbol["icon-offset"]),"icon-anchor":new Be(Ge.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ae(Ge.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ae(Ge.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ae(Ge.layout_symbol["text-rotation-alignment"]),"text-field":new Be(Ge.layout_symbol["text-field"]),"text-font":new Be(Ge.layout_symbol["text-font"]),"text-size":new Be(Ge.layout_symbol["text-size"]),"text-max-width":new Be(Ge.layout_symbol["text-max-width"]),"text-line-height":new Be(Ge.layout_symbol["text-line-height"]),"text-letter-spacing":new Be(Ge.layout_symbol["text-letter-spacing"]),"text-justify":new Be(Ge.layout_symbol["text-justify"]),"text-radial-offset":new Be(Ge.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ae(Ge.layout_symbol["text-variable-anchor"]),"text-anchor":new Be(Ge.layout_symbol["text-anchor"]),"text-max-angle":new Ae(Ge.layout_symbol["text-max-angle"]),"text-writing-mode":new Ae(Ge.layout_symbol["text-writing-mode"]),"text-rotate":new Be(Ge.layout_symbol["text-rotate"]),"text-padding":new Ae(Ge.layout_symbol["text-padding"]),"text-keep-upright":new Ae(Ge.layout_symbol["text-keep-upright"]),"text-transform":new Be(Ge.layout_symbol["text-transform"]),"text-offset":new Be(Ge.layout_symbol["text-offset"]),"text-allow-overlap":new Ae(Ge.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Ae(Ge.layout_symbol["text-ignore-placement"]),"text-optional":new Ae(Ge.layout_symbol["text-optional"])});var Gd={paint:new an({"icon-opacity":new Be(Ge.paint_symbol["icon-opacity"]),"icon-color":new Be(Ge.paint_symbol["icon-color"]),"icon-halo-color":new Be(Ge.paint_symbol["icon-halo-color"]),"icon-halo-width":new Be(Ge.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Be(Ge.paint_symbol["icon-halo-blur"]),"icon-translate":new Ae(Ge.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ae(Ge.paint_symbol["icon-translate-anchor"]),"text-opacity":new Be(Ge.paint_symbol["text-opacity"]),"text-color":new Be(Ge.paint_symbol["text-color"],{runtimeType:_r,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new Be(Ge.paint_symbol["text-halo-color"]),"text-halo-width":new Be(Ge.paint_symbol["text-halo-width"]),"text-halo-blur":new Be(Ge.paint_symbol["text-halo-blur"]),"text-translate":new Ae(Ge.paint_symbol["text-translate"]),"text-translate-anchor":new Ae(Ge.paint_symbol["text-translate-anchor"])}),layout:Dg};class fp{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Sn,this.defaultValue=e}evaluate(e){if(e.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(e.formattedSection))return n.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ot(fp,"FormatSectionOverride",{omit:["defaultValue"]});class Wh extends za{constructor(e){super(e,Gd)}recalculate(e,n){super.recalculate(e,n),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const s=this.layout.get("text-writing-mode");if(s){const u=[];for(const f of s)u.indexOf(f)<0&&u.push(f);this.layout._values["text-writing-mode"]=u}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,n,s,u){const f=this.layout.get(e).evaluate(n,{},s,u),m=this._unevaluatedLayout._values[e];return m.isDataDriven()||Hn(m.value)||!f?f:(v=n.properties,f.replace(/{([^{}]+)}/g,(C,P)=>P in v?String(v[P]):""));var v}createBucket(e){return new sc(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of Gd.paint.overridableProperties){if(!Wh.hasPaintOverride(this.layout,e))continue;const n=this.paint.get(e),s=new fp(n),u=new Qn(s,n.property.specification);let f=null;f="constant"===n.value.kind||"source"===n.value.kind?new In("source",u):new jr("composite",u,n.value.zoomStops,n.value._interpolationType),this.paint._values[e]=new Ke(n.property,f,n.parameters)}}_handleOverridablePaintPropertyUpdate(e,n,s){return!(!this.layout||n.isDataDriven()||s.isDataDriven())&&Wh.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,n){const s=e.get("text-field"),u=Gd.paint.properties[n];let f=!1;const m=v=>{for(const D of v)if(u.overrides&&u.overrides.hasOverride(D))return void(f=!0)};if("constant"===s.value.kind&&s.value.value instanceof Gr)m(s.value.value.sections);else if("source"===s.value.kind){const v=C=>{f||(C instanceof Ro&&Hr(C.value)===yr?m(C.value.sections):C instanceof bs?m(C.sections):C.eachChild(v))},D=s.value;D._styleExpression&&v(D._styleExpression.expression)}return f}getProgramConfiguration(e){return new ql(this,e)}}var q_={paint:new an({"background-color":new Ae(Ge.paint_background["background-color"]),"background-pattern":new Ae(Ge.paint_background["background-pattern"]),"background-opacity":new Ae(Ge.paint_background["background-opacity"])})},W_={paint:new an({"raster-opacity":new Ae(Ge.paint_raster["raster-opacity"]),"raster-hue-rotate":new Ae(Ge.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ae(Ge.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ae(Ge.paint_raster["raster-brightness-max"]),"raster-saturation":new Ae(Ge.paint_raster["raster-saturation"]),"raster-contrast":new Ae(Ge.paint_raster["raster-contrast"]),"raster-resampling":new Ae(Ge.paint_raster["raster-resampling"]),"raster-fade-duration":new Ae(Ge.paint_raster["raster-fade-duration"])})};class Tg extends za{constructor(e){super(e,{}),this.implementation=e}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var X_={paint:new an({"sky-type":new Ae(Ge.paint_sky["sky-type"]),"sky-atmosphere-sun":new Ae(Ge.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Ae(Ge.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Ae(Ge.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Ae(Ge.paint_sky["sky-gradient-radius"]),"sky-gradient":new Zt(Ge.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Ae(Ge.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Ae(Ge.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Ae(Ge.paint_sky["sky-opacity"])})};function Hd(t,e,n){const s=[0,0,1],u=Lf([]);return cm(u,u,n?-qe(t)+Math.PI:qe(t)),Ih(u,u,-qe(e)),fd(s,s,u),Mo(s,s)}const pp={circle:class extends za{constructor(t){super(t,em)}createBucket(t){return new Df(t)}queryRadius(t){const e=t;return Lu("circle-radius",this,e)+Lu("circle-stroke-width",this,e)+Dh(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,n,s,u,f,m,v){const D=hd(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),f.angle,t.pixelToTileUnitsFactor),C=this.paint.get("circle-radius").evaluate(e,n)+this.paint.get("circle-stroke-width").evaluate(e,n);return zf(t,s,f,m,v,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),D,C)}getProgramIds(){return["circle"]}getProgramConfiguration(t){return new ql(this,t)}},heatmap:class extends za{createBucket(t){return new dm(t)}constructor(t){super(t,pm),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){"heatmap-color"===t&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=pd({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(t){return Lu("heatmap-radius",this,t)}queryIntersectsFeature(t,e,n,s,u,f,m,v){const D=this.paint.get("heatmap-radius").evaluate(e,n);return zf(t,s,f,m,v,!0,!0,new Qe(0,0),D)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(t){return new ql(this,t)}},hillshade:class extends za{constructor(t){super(t,mm)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends za{constructor(t){super(t,f_)}getProgramIds(){const t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),n=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&n.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),n}getProgramConfiguration(t){return new ql(this,t)}recalculate(t,e){super.recalculate(t,e);const n=this.paint._values["fill-outline-color"];"constant"===n.value.kind&&void 0===n.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new Jl(t)}queryRadius(){return Dh(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,n,s,u,f){return!t.queryGeometry.isAboveHorizon&&Tf(Th(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),f.angle,t.pixelToTileUnitsFactor),s)}isTileClipped(){return!0}},"fill-extrusion":class extends za{constructor(t){super(t,Im)}createBucket(t){return new Uu(t)}queryRadius(){return Dh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(t){return new ql(this,t)}queryIntersectsFeature(t,e,n,s,u,f,m,v,D){const C=hd(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),f.angle,t.pixelToTileUnitsFactor),P=this.paint.get("fill-extrusion-height").evaluate(e,n),F=this.paint.get("fill-extrusion-base").evaluate(e,n),N=[0,0],$=v&&f.elevation,G=f.elevation?f.elevation.exaggeration():1,J=t.tile.getBucket(this);if($&&J instanceof Uu){const pe=J.centroidVertexArray,_e=D+1;_e<pe.length&&(N[0]=pe.geta_centroid_pos0(_e),N[1]=pe.geta_centroid_pos1(_e))}if(0===N[0]&&1===N[1])return!1;"globe"===f.projection.name&&(s=ma([s],[new Qe(0,0),new Qe(pn,pn)],t.tileID.canonical).map(pe=>pe.polygon).flat());const ie=$?v:null,[ue,ge]=(_e=s,ye=F,Oe=P,ke=C,Ze=m,dt=ie,je=N,Xe=G,Ye=f.center.lat,"globe"===(pe=f).projection.name?function(ft,Ve,It,ln,Rt,Wt,Mt,un,Fn,Rn,kn){const hn=[],gr=[],En=ft.projection.upVectorScale(kn,ft.center.lat,ft.worldSize).metersToTile,Bn=[0,0,0,1],br=[0,0,0,1],Rr=(kr,zr,oi,eo)=>{kr[0]=zr,kr[1]=oi,kr[2]=eo,kr[3]=1},Ir=Sm();It>0&&(It+=Ir),ln+=Ir;for(const kr of Ve){const zr=[],oi=[];for(const eo of kr){const wr=eo.x+Rt.x,Ai=eo.y+Rt.y,wi=ft.projection.projectTilePoint(wr,Ai,kn),dr=ft.projection.upVector(kn,eo.x,eo.y);let Wr=It,Bi=ln;if(Mt){const Er=zn(wr,Ai,It,ln,Mt,un,Fn,Rn);Wr+=Er.base,Bi+=Er.top}0!==It?Rr(Bn,wi.x+dr[0]*En*Wr,wi.y+dr[1]*En*Wr,wi.z+dr[2]*En*Wr):Rr(Bn,wi.x,wi.y,wi.z),Rr(br,wi.x+dr[0]*En*Bi,wi.y+dr[1]*En*Bi,wi.z+dr[2]*En*Bi),bi(Bn,Bn,Wt),bi(br,br,Wt),zr.push(new Vu(Bn[0],Bn[1],Bn[2])),oi.push(new Vu(br[0],br[1],br[2]))}hn.push(zr),gr.push(oi)}return[hn,gr]}(pe,_e,ye,Oe,ke,Ze,dt,je,Xe,Ye,t.tileID.canonical):dt?function(ft,Ve,It,ln,Rt,Wt,Mt,un,Fn){const Rn=[],kn=[],hn=[0,0,0,1];for(const gr of ft){const En=[],Bn=[];for(const br of gr){const Rr=br.x+ln.x,Ir=br.y+ln.y,kr=zn(Rr,Ir,Ve,It,Wt,Mt,un,Fn);hn[0]=Rr,hn[1]=Ir,hn[2]=kr.base,hn[3]=1,Qc(hn,hn,Rt),hn[3]=Math.max(hn[3],1e-5);const zr=new Vu(hn[0]/hn[3],hn[1]/hn[3],hn[2]/hn[3]);hn[0]=Rr,hn[1]=Ir,hn[2]=kr.top,hn[3]=1,Qc(hn,hn,Rt),hn[3]=Math.max(hn[3],1e-5);const oi=new Vu(hn[0]/hn[3],hn[1]/hn[3],hn[2]/hn[3]);En.push(zr),Bn.push(oi)}Rn.push(En),kn.push(Bn)}return[Rn,kn]}(_e,ye,Oe,ke,Ze,dt,je,Xe,Ye):function(ft,Ve,It,ln,Rt){const Wt=[],Mt=[],un=Rt[8]*Ve,Fn=Rt[9]*Ve,Rn=Rt[10]*Ve,kn=Rt[11]*Ve,hn=Rt[8]*It,gr=Rt[9]*It,En=Rt[10]*It,Bn=Rt[11]*It;for(const br of ft){const Rr=[],Ir=[];for(const kr of br){const zr=kr.x+ln.x,oi=kr.y+ln.y,eo=Rt[0]*zr+Rt[4]*oi+Rt[12],wr=Rt[1]*zr+Rt[5]*oi+Rt[13],Ai=Rt[2]*zr+Rt[6]*oi+Rt[14],wi=Rt[3]*zr+Rt[7]*oi+Rt[15],dr=eo+un,Wr=wr+Fn,Bi=Ai+Rn,Er=Math.max(wi+kn,1e-5),fi=eo+hn,Po=wr+gr,to=Ai+En,no=Math.max(wi+Bn,1e-5);Rr.push(new Vu(dr/Er,Wr/Er,Bi/Er)),Ir.push(new Vu(fi/no,Po/no,to/no))}Wt.push(Rr),Mt.push(Ir)}return[Wt,Mt]}(_e,ye,Oe,ke,Ze)),ce=t.queryGeometry;var pe,_e,ye,Oe,ke,Ze,dt,je,Xe,Ye;return function(pe,_e,ye){let Oe=1/0;Tf(ye,_e)&&(Oe=Pm(ye,_e[0]));for(let ke=0;ke<_e.length;ke++){const Ze=_e[ke],dt=pe[ke];for(let je=0;je<Ze.length-1;je++){const Xe=Ze[je],Ye=[Xe,Ze[je+1],dt[je+1],dt[je],Xe];Wp(ye,Ye)&&(Oe=Math.min(Oe,Pm(ye,Ye)))}}return Oe!==1/0&&Oe}(ue,ge,ce.isPointQuery()?ce.screenBounds:ce.screenGeometry)}},line:class extends za{constructor(t){super(t,zm),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){if("line-gradient"===t){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Ea,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=Bm.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Dd(t)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(t){return new ql(this,t)}queryRadius(t){const e=t,n=I_(Lu("line-width",this,e),Lu("line-gap-width",this,e)),s=Lu("line-offset",this,e);return n/2+Math.abs(s)+Dh(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,n,s,u,f){if(t.queryGeometry.isAboveHorizon)return!1;const m=Th(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),f.angle,t.pixelToTileUnitsFactor),v=t.pixelToTileUnitsFactor/2*I_(this.paint.get("line-width").evaluate(e,n),this.paint.get("line-gap-width").evaluate(e,n)),D=this.paint.get("line-offset").evaluate(e,n);return D&&(s=function(C,P){const F=[],N=new Qe(0,0);for(let $=0;$<C.length;$++){const G=C[$],J=[];for(let ie=0;ie<G.length;ie++){const ge=G[ie],ce=G[ie+1],pe=0===ie?N:ge.sub(G[ie-1])._unit()._perp(),_e=ie===G.length-1?N:ce.sub(ge)._unit()._perp(),ye=pe._add(_e)._unit();ye._mult(1/(ye.x*_e.x+ye.y*_e.y)),J.push(ye._mult(P)._add(ge))}F.push(J)}return F}(s,D*t.pixelToTileUnitsFactor)),function(C,P,F){for(let N=0;N<P.length;N++){const $=P[N];if(C.length>=3)for(let G=0;G<$.length;G++)if(Ru(C,$[G]))return!0;if(Xp(C,$,F))return!0}return!1}(m,s,v)}isTileClipped(){return!0}},symbol:Wh,background:class extends za{constructor(t){super(t,q_)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends za{constructor(t){super(t,W_)}getProgramIds(){return["raster"]}},sky:class extends za{constructor(t){super(t,X_),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){"sky-gradient"===t?this._updateColorRamp():"sky-atmosphere-sun"!==t&&"sky-atmosphere-halo-color"!==t&&"sky-atmosphere-color"!==t&&"sky-atmosphere-sun-intensity"!==t||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=pd({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(t,e){if("atmosphere"===this.paint.get("sky-type")){const s=this.paint.get("sky-atmosphere-sun"),u=!s,f=t.style.light,m=f.properties.get("position");return u&&"viewport"===f.properties.get("anchor")&&vn("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),u?Hd(m.azimuthal,90-m.polar,e):Hd(s[0],90-s[1],e)}const n=this.paint.get("sky-gradient-center");return Hd(n[0],90-n[1],e)}is3D(){return!1}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const t=this.paint.get("sky-type");return"atmosphere"===t?["skyboxCapture","skybox"]:"gradient"===t?["skyboxGradient"]:null}}};class mu{constructor(e,n,s,u){this.context=e,this.format=s,this.texture=e.gl.createTexture(),this.update(n,u)}update(e,n,s){const{width:u,height:f}=e,{context:m}=this,{gl:v}=m,{HTMLImageElement:D,HTMLCanvasElement:C,HTMLVideoElement:P,ImageData:F,ImageBitmap:N}=Ee;if(v.bindTexture(v.TEXTURE_2D,this.texture),m.pixelStoreUnpackFlipY.set(!1),m.pixelStoreUnpack.set(1),m.pixelStoreUnpackPremultiplyAlpha.set(this.format===v.RGBA&&(!n||!1!==n.premultiply)),s||this.size&&this.size[0]===u&&this.size[1]===f){const{x:$,y:G}=s||{x:0,y:0};e instanceof D||e instanceof C||e instanceof P||e instanceof F||N&&e instanceof N?v.texSubImage2D(v.TEXTURE_2D,0,$,G,v.RGBA,v.UNSIGNED_BYTE,e):v.texSubImage2D(v.TEXTURE_2D,0,$,G,u,f,v.RGBA,v.UNSIGNED_BYTE,e.data)}else this.size=[u,f],e instanceof D||e instanceof C||e instanceof P||e instanceof F||N&&e instanceof N?v.texImage2D(v.TEXTURE_2D,0,this.format,this.format,v.UNSIGNED_BYTE,e):v.texImage2D(v.TEXTURE_2D,0,this.format,u,f,0,this.format,v.UNSIGNED_BYTE,e.data);this.useMipmap=Boolean(n&&n.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&v.generateMipmap(v.TEXTURE_2D)}bind(e,n){const{context:s}=this,{gl:u}=s;u.bindTexture(u.TEXTURE_2D,this.texture),e!==this.filter&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,e),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,this.useMipmap?e===u.NEAREST?u.NEAREST_MIPMAP_NEAREST:u.LINEAR_MIPMAP_NEAREST:e),this.filter=e),n!==this.wrap&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,n),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,n),this.wrap=n)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Y_{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class Zd{constructor(){this.tasks={},this.taskQueue=[],qn(["process"],this),this.invoker=new Y_(this.process),this.nextId=0}add(e,n){const s=this.nextId++,u=function({type:f,isSymbolTile:m,zoom:v}){return v=v||0,"message"===f?0:"maybePrepare"!==f||m?"parseTile"!==f||m?"parseTile"===f&&m?300-v:"maybePrepare"===f&&m?400-v:500:200-v:100-v}(n);if(0===u){Xr();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[s]={fn:e,metadata:n,priority:u,id:s},this.taskQueue.push(s),this.invoker.trigger(),{cancel:()=>{delete this.tasks[s]}}}process(){Xr();try{if(this.taskQueue=this.taskQueue.filter(s=>!!this.tasks[s]),!this.taskQueue.length)return;const e=this.pick();if(null===e)return;const n=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!n)return;n.fn()}finally{}}pick(){let e=null,n=1/0;for(let u=0;u<this.taskQueue.length;u++){const f=this.tasks[this.taskQueue[u]];f.priority<n&&(n=f.priority,e=u)}if(null===e)return null;const s=this.taskQueue[e];return this.taskQueue.splice(e,1),s}remove(){this.invoker.remove()}}class Xh{constructor(e){this._stringToNumber={},this._numberToString=[];for(let n=0;n<e.length;n++){const s=e[n];this._stringToNumber[s]=n,this._numberToString[n]=s}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const mp=["tile","layer","source","sourceLayer","state"];class Cg{constructor(e,n,s,u,f){this.type="Feature",this._vectorTileFeature=e,this._z=n,this._x=s,this._y=u,this.properties=e.properties,this.id=f}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",geometry:this.geometry,properties:this.properties};void 0!==this.id&&(e.id=this.id);for(const n of mp)void 0!==this[n]&&(e[n]=this[n]);return e}}const ac=new Uint16Array(8184);for(let t=0;t<2046;t++){let e=t+2,n=0,s=0,u=0,f=0,m=0,v=0;for(1&e?u=f=m=32:n=s=v=32;(e>>=1)>1;){const C=n+u>>1,P=s+f>>1;1&e?(u=n,f=s,n=m,s=v):(n=u,s=f,u=m,f=v),m=C,v=P}const D=4*t;ac[D+0]=n,ac[D+1]=s,ac[D+2]=u,ac[D+3]=f}const Wa=new Uint16Array(2178),Cl=new Uint8Array(1089),Yh=new Uint16Array(1089);function gp(t){return 0===t?-.03125:32===t?.03125:0}var qd=Ft([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const _p={type:2,extent:pn,loadGeometry:()=>[[new Qe(0,0),new Qe(8193,0),new Qe(8193,8193),new Qe(0,8193),new Qe(0,0)]]};class yp{constructor(e,n,s,u,f){this.tileID=e,this.uid=ht(),this.uses=0,this.tileSize=n,this.tileZoom=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=f,this.expiredRequestCount=0,this.state="loading",u&&u.transform&&(this.projection=u.transform.projection)}registerFadeDuration(e){const n=e+this.timeAdded;n<Kt.now()||this.fadeEndTime&&n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=rh(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,n,s){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(u,f){const m={};if(!f)return m;for(const v of u){const D=v.layerIds.map(C=>f.getLayer(C)).filter(Boolean);if(0!==D.length){v.layers=D,v.stateDependentLayerIds&&(v.stateDependentLayers=v.stateDependentLayerIds.map(C=>D.filter(P=>P.id===C)[0]));for(const C of D)m[C.id]=v}}return m}(e.buckets,n.style),this.hasSymbolBuckets=!1;for(const u in this.buckets){const f=this.buckets[u];if(f instanceof sc){if(this.hasSymbolBuckets=!0,!s)break;f.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const u in this.buckets){const f=this.buckets[u];if(f instanceof sc&&f.hasRTLText){this.hasRTLText=!0,Pe.isLoading()||Pe.isLoaded()||"deferred"!==be()||Le();break}}this.queryPadding=0;for(const u in this.buckets){const f=this.buckets[u];this.queryPadding=Math.max(this.queryPadding,n.style.getLayer(u).queryRadius(f))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new vh}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const s in this.buckets){const u=this.buckets[s];u.uploadPending()&&u.upload(e)}const n=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new mu(e,this.imageAtlas.image,n.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new mu(e,this.glyphAtlasImage,n.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new mu(e,this.lineAtlas.image,n.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,n,s,u,f,m,v,D){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:u,pixelPosMatrix:v,transform:m,params:f,tileTransform:this.tileTransform},e,n,s):{}}querySourceFeatures(e,n){const s=this.latestFeatureIndex;if(!s||!s.rawTileData)return;const u=s.loadVTLayers(),f=n?n.sourceLayer:"",m=u._geojsonTileLayer||u[f];if(!m)return;const v=sa(n&&n.filter),{z:D,x:C,y:P}=this.tileID.canonical,F={z:D,x:C,y:P};for(let N=0;N<m.length;N++){const $=m.feature(N);if(v.needGeometry){const ie=Va($,!0);if(!v.filter(new Te(this.tileID.overscaledZ),ie,this.tileID.canonical))continue}else if(!v.filter(new Te(this.tileID.overscaledZ),$))continue;const G=s.getId($,f),J=new Cg($,D,C,P,G);J.tile=F,e.push(J)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const n=this.expirationTime;if(e.cacheControl){const s=ni(e.cacheControl);s["max-age"]&&(this.expirationTime=Date.now()+1e3*s["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const s=Date.now();let u=!1;if(this.expirationTime>s)u=!1;else if(n)if(this.expirationTime<n)u=!0;else{const f=this.expirationTime-n;f?this.expirationTime=s+Math.max(f,3e4):u=!0}else u=!0;u?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(e,n){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(e).length||!n)return;const s=this.latestFeatureIndex.loadVTLayers(),u=n.style.listImages();for(const f in this.buckets){if(!n.style.hasLayer(f))continue;const m=this.buckets[f],v=m.layers[0].sourceLayer||"_geojsonTileLayer",D=s[v],C=e[v];if(!D||!C||0===Object.keys(C).length)continue;if(m.update(C,D,u,this.imageAtlas&&this.imageAtlas.patternPositions||{}),m instanceof Dd||m instanceof Jl){const F=n.style._getSourceCache(m.layers[0].source);n._terrain&&n._terrain.enabled&&F&&m.programConfigurations.needsUpload&&n._terrain._clearRenderCacheForTile(F.id,this.tileID)}const P=n&&n.style&&n.style.getLayer(f);P&&(this.queryPadding=Math.max(this.queryPadding,P.queryRadius(m)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Kt.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=Kt.now()+e}setTexture(e,n){const s=n.context,u=s.gl;this.texture=this.texture||n.getTileTexture(e.width),this.texture?this.texture.update(e,{useMipmap:!0}):(this.texture=new mu(s,e,u.RGBA,{useMipmap:!0}),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE),s.extTextureFilterAnisotropic&&u.texParameterf(u.TEXTURE_2D,s.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,s.extTextureFilterAnisotropicMax))}setDependencies(e,n){const s={};for(const u of n)s[u]=!0;this.dependencies[e]=s}hasDependency(e,n){for(const s of e){const u=this.dependencies[s];if(u)for(const f of n)if(u[f])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,n){if(!n||"mercator"===n.name||this._tileDebugBuffer)return;const s=ja(_p,this.tileID.canonical,this.tileTransform)[0],u=new hr,f=new yh;for(let m=0;m<s.length;m++){const{x:v,y:D}=s[m];u.emplaceBack(v,D),f.emplaceBack(m)}f.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(f),this._tileDebugBuffer=e.createVertexBuffer(u,Fs.members),this._tileDebugSegments=xi.simpleSegment(0,0,u.length,f.length)}_makeTileBoundsBuffers(e,n){if(this._tileBoundsBuffer||!n||"mercator"===n.name)return;const s=ja(_p,this.tileID.canonical,this.tileTransform)[0];let u,f;if(this.isRaster){const m=function(v,D){const C=rh(v,D),P=Math.pow(2,v.z);for(let ie=0;ie<33;ie++)for(let ue=0;ue<33;ue++){const ge=fa((v.x+(ue+gp(ue))/32)/P),ce=Fi((v.y+(ie+gp(ie))/32)/P),pe=D.project(ge,ce),_e=33*ie+ue;Wa[2*_e+0]=Math.round((pe.x*C.scale-C.x)*pn),Wa[2*_e+1]=Math.round((pe.y*C.scale-C.y)*pn)}Cl.fill(0),Yh.fill(0);for(let ie=2045;ie>=0;ie--){const ue=4*ie,ge=ac[ue+0],ce=ac[ue+1],pe=ac[ue+2],_e=ac[ue+3],ye=ge+pe>>1,Oe=ce+_e>>1,ke=ye+Oe-ce,Ze=Oe+ge-ye,dt=33*ce+ge,je=33*_e+pe,Xe=33*Oe+ye,Ye=Math.hypot((Wa[2*dt+0]+Wa[2*je+0])/2-Wa[2*Xe+0],(Wa[2*dt+1]+Wa[2*je+1])/2-Wa[2*Xe+1])>=16;Cl[Xe]=Cl[Xe]||(Ye?1:0),ie<1022&&(Cl[Xe]=Cl[Xe]||Cl[33*(ce+Ze>>1)+(ge+ke>>1)]||Cl[33*(_e+Ze>>1)+(pe+ke>>1)])}const F=new xr,N=new Ji;let $=0;function G(ie,ue){const ge=33*ue+ie;return 0===Yh[ge]&&(F.emplaceBack(Wa[2*ge+0],Wa[2*ge+1],ie*pn/32,ue*pn/32),Yh[ge]=++$),Yh[ge]-1}function J(ie,ue,ge,ce,pe,_e){const ye=ie+ge>>1,Oe=ue+ce>>1;if(Math.abs(ie-pe)+Math.abs(ue-_e)>1&&Cl[33*Oe+ye])J(pe,_e,ie,ue,ye,Oe),J(ge,ce,pe,_e,ye,Oe);else{const ke=G(ie,ue),Ze=G(ge,ce),dt=G(pe,_e);N.emplaceBack(ke,Ze,dt)}}return J(0,0,32,32,32,0),J(32,32,0,0,0,32),{vertices:F,indices:N}}(this.tileID.canonical,n);u=m.vertices,f=m.indices}else{u=new xr,f=new Ji;for(const{x:v,y:D}of s)u.emplaceBack(v,D,0,0);const m=Fu.exports(u.int16,void 0,4);for(let v=0;v<m.length;v+=3)f.emplaceBack(m[v],m[v+1],m[v+2])}this._tileBoundsBuffer=e.createVertexBuffer(u,qd.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(f),this._tileBoundsSegments=xi.simpleSegment(0,0,u.length,f.length)}_makeGlobeTileDebugBuffers(e,n){const s=n.projection;if(!s||"globe"!==s.name||n.freezeTileCoverage)return;const u=this.tileID.canonical,f=$h(pg(u,n)),m=nh(n.zoom);let v;m>0&&(v=If(new Float64Array(16),n.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,u,n,f,v,m),this._makeGlobeTileDebugTextBuffer(e,u,n,f,v,m)}_globePoint(e,n,s,u,f,m,v){let D=th(e,n,s);if(m){const C=1<<s.z,P=Ba(u.center.lng),F=Na(u.center.lat),N=(s.x+.5)/C-P;let $=0;N>.5?$=-1:N<-.5&&($=1);let G=(e/pn+s.x)/C+$,J=(n/pn+s.y)/C;G=(G-P)*u._pixelsPerMercatorPixel+P,J=(J-F)*u._pixelsPerMercatorPixel+F;const ie=[G*u.worldSize,J*u.worldSize,0];bi(ie,ie,m),D=cu(D,ie,v)}return bi(D,D,f)}_makeGlobeTileDebugBorderBuffer(e,n,s,u,f,m){const v=new hr,D=new yh,C=new Mr,P=(N,$,G,J,ie)=>{const ue=(G-N)/(ie-1),ge=(J-$)/(ie-1),ce=v.length;for(let pe=0;pe<ie;pe++){const _e=N+pe*ue,ye=$+pe*ge;v.emplaceBack(_e,ye);const Oe=this._globePoint(_e,ye,n,s,u,f,m);C.emplaceBack(Oe[0],Oe[1],Oe[2]),D.emplaceBack(ce+pe)}},F=pn;P(0,0,F,0,16),P(F,0,F,F,16),P(F,F,0,F,16),P(0,F,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(D),this._tileDebugBuffer=e.createVertexBuffer(v,Fs.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(C,zd.members),this._tileDebugSegments=xi.simpleSegment(0,0,v.length,D.length)}_makeGlobeTileDebugTextBuffer(e,n,s,u,f,m){const v=new hr,D=new Ji,C=new Mr,P=25;D.reserve(32),v.reserve(P),C.reserve(P);const F=(N,$)=>P*N+$;for(let N=0;N<P;N++){const $=2048*N;for(let G=0;G<P;G++){const J=2048*G;v.emplaceBack(J,$);const ie=this._globePoint(J,$,n,s,u,f,m);C.emplaceBack(ie[0],ie[1],ie[2])}}for(let N=0;N<4;N++)for(let $=0;$<4;$++){const G=F(N,$),J=F(N,$+1),ie=F(N+1,$),ue=F(N+1,$+1);D.emplaceBack(G,J,ie),D.emplaceBack(ie,J,ue)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(D),this._tileDebugTextBuffer=e.createVertexBuffer(v,Fs.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(C,zd.members),this._tileDebugTextSegments=xi.simpleSegment(0,0,P,32)}}class Sg{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,n,s){const u=String(n);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][u]=this.stateChanges[e][u]||{},Ue(this.stateChanges[e][u],s),null===this.deletedStates[e]){this.deletedStates[e]={};for(const f in this.state[e])f!==u&&(this.deletedStates[e][f]=null)}else if(this.deletedStates[e]&&null===this.deletedStates[e][u]){this.deletedStates[e][u]={};for(const f in this.state[e][u])s[f]||(this.deletedStates[e][u][f]=null)}else for(const f in s)this.deletedStates[e]&&this.deletedStates[e][u]&&null===this.deletedStates[e][u][f]&&delete this.deletedStates[e][u][f]}removeFeatureState(e,n,s){if(null===this.deletedStates[e])return;const u=String(n);if(this.deletedStates[e]=this.deletedStates[e]||{},s&&void 0!==n)null!==this.deletedStates[e][u]&&(this.deletedStates[e][u]=this.deletedStates[e][u]||{},this.deletedStates[e][u][s]=null);else if(void 0!==n)if(this.stateChanges[e]&&this.stateChanges[e][u])for(s in this.deletedStates[e][u]={},this.stateChanges[e][u])this.deletedStates[e][u][s]=null;else this.deletedStates[e][u]=null;else this.deletedStates[e]=null}getState(e,n){const s=String(n),u=Ue({},(this.state[e]||{})[s],(this.stateChanges[e]||{})[s]);if(null===this.deletedStates[e])return{};if(this.deletedStates[e]){const f=this.deletedStates[e][n];if(null===f)return{};for(const m in f)delete u[m]}return u}initializeTileState(e,n){e.setFeatureState(this.state,n)}coalesceChanges(e,n){const s={};for(const u in this.stateChanges){this.state[u]=this.state[u]||{};const f={};for(const m in this.stateChanges[u])this.state[u][m]||(this.state[u][m]={}),Ue(this.state[u][m],this.stateChanges[u][m]),f[m]=this.state[u][m];s[u]=f}for(const u in this.deletedStates){this.state[u]=this.state[u]||{};const f={};if(null===this.deletedStates[u])for(const m in this.state[u])f[m]={},this.state[u][m]={};else for(const m in this.deletedStates[u]){if(null===this.deletedStates[u][m])this.state[u][m]={};else for(const v of Object.keys(this.deletedStates[u][m]))delete this.state[u][m][v];f[m]=this.state[u][m]}s[u]=s[u]||{},Ue(s[u],f)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(s).length)for(const u in e)e[u].setFeatureState(s,n)}}class vp{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,n){const s=this.toIdx(e,n);return{min:this.minimums[s],max:this.maximums[s]}}isLeaf(e,n){return this.leaves[this.toIdx(e,n)]}toIdx(e,n){return n*this.size+e}}function xp(t,e,n,s){let u=0,f=Number.MAX_VALUE;for(let m=0;m<3;m++)if(Math.abs(s[m])<1e-15){if(n[m]<t[m]||n[m]>e[m])return null}else{const v=1/s[m];let D=(t[m]-n[m])*v,C=(e[m]-n[m])*v;if(D>C){const P=D;D=C,C=P}if(D>u&&(u=D),C<f&&(f=C),u>f)return null}return u}function bp(t,e,n,s,u,f,m,v,D,C,P){const F=s-t,N=u-e,$=f-n,G=m-t,J=v-e,ie=D-n,ue=P[1]*ie-P[2]*J,ge=P[2]*G-P[0]*ie,ce=P[0]*J-P[1]*G,pe=F*ue+N*ge+$*ce;if(Math.abs(pe)<1e-15)return null;const _e=1/pe,ye=C[0]-t,Oe=C[1]-e,ke=C[2]-n,Ze=(ye*ue+Oe*ge+ke*ce)*_e;if(Ze<0||Ze>1)return null;const dt=Oe*$-ke*N,je=ke*F-ye*$,Xe=ye*N-Oe*F,Ye=(P[0]*dt+P[1]*je+P[2]*Xe)*_e;return Ye<0||Ze+Ye>1?null:(G*dt+J*je+ie*Xe)*_e}function Ig(t,e,n){return(t-e)/(n-e)}function Mg(t,e,n,s,u,f,m,v,D){const C=1<<n,P=f-s,F=m-u,N=(t+1)/C*P+s,$=(e+0)/C*F+u,G=(e+1)/C*F+u;v[0]=(t+0)/C*P+s,v[1]=$,D[0]=N,D[1]=G}class Ag{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const n=function(f){const m=Math.ceil(Math.log2(f.dim/8)),v=[];let D=Math.ceil(Math.pow(2,m));const C=1/D,P=($,G,J,ie,ue)=>{const ge=ie?1:0,ce=($+1)*J-ge,pe=G*J,_e=(G+1)*J-ge;ue[0]=$*J,ue[1]=pe,ue[2]=ce,ue[3]=_e};let F=new vp(D);const N=[];for(let $=0;$<D*D;$++){P($%D,Math.floor($/D),C,!1,N);const G=Sl(N[0],N[1],f),J=Sl(N[2],N[1],f),ie=Sl(N[2],N[3],f),ue=Sl(N[0],N[3],f);F.minimums.push(Math.min(G,J,ie,ue)),F.maximums.push(Math.max(G,J,ie,ue)),F.leaves.push(1)}for(v.push(F),D/=2;D>=1;D/=2){const $=v[v.length-1];F=new vp(D);for(let G=0;G<D*D;G++){P(G%D,Math.floor(G/D),2,!0,N);const J=$.getElevation(N[0],N[1]),ie=$.getElevation(N[2],N[1]),ue=$.getElevation(N[2],N[3]),ge=$.getElevation(N[0],N[3]),ce=$.isLeaf(N[0],N[1]),pe=$.isLeaf(N[2],N[1]),_e=$.isLeaf(N[2],N[3]),ye=$.isLeaf(N[0],N[3]),Oe=Math.min(J.min,ie.min,ue.min,ge.min),ke=Math.max(J.max,ie.max,ue.max,ge.max),Ze=ce&&pe&&_e&&ye;F.maximums.push(ke),F.minimums.push(Oe),F.leaves.push(ke-Oe<=5&&Ze?1:0)}v.push(F)}return v}(this.dem),s=n.length-1,u=n[s];this._addNode(u.minimums[0],u.maximums[0],u.leaves[0]),this._construct(n,0,0,s,0)}raycastRoot(e,n,s,u,f,m,v=1){return xp([e,n,-100],[s,u,this.maximums[0]*v],f,m)}raycast(e,n,s,u,f,m,v=1){if(!this.nodeCount)return null;const D=this.raycastRoot(e,n,s,u,f,m,v);if(null==D)return null;const C=[],P=[],F=[],N=[],$=[{idx:0,t:D,nodex:0,nodey:0,depth:0}];for(;$.length>0;){const{idx:G,t:J,nodex:ie,nodey:ue,depth:ge}=$.pop();if(this.leaves[G]){Mg(ie,ue,ge,e,n,s,u,F,N);const pe=1<<ge,_e=(ie+0)/pe,ye=(ie+1)/pe,Oe=(ue+0)/pe,ke=(ue+1)/pe,Ze=Sl(_e,Oe,this.dem)*v,dt=Sl(ye,Oe,this.dem)*v,je=Sl(ye,ke,this.dem)*v,Xe=Sl(_e,ke,this.dem)*v,Ye=bp(F[0],F[1],Ze,N[0],F[1],dt,N[0],N[1],je,f,m),st=bp(N[0],N[1],je,F[0],N[1],Xe,F[0],F[1],Ze,f,m),ft=Math.min(null!==Ye?Ye:Number.MAX_VALUE,null!==st?st:Number.MAX_VALUE);if(ft!==Number.MAX_VALUE)return ft;{const Ve=Ou([],f,m,J);if(wp(Ze,dt,Xe,je,Ig(Ve[0],F[0],N[0]),Ig(Ve[1],F[1],N[1]))>=Ve[2])return J}continue}let ce=0;for(let pe=0;pe<this._siblingOffset.length;pe++){Mg((ie<<1)+this._siblingOffset[pe][0],(ue<<1)+this._siblingOffset[pe][1],ge+1,e,n,s,u,F,N),F[2]=-100,N[2]=this.maximums[this.childOffsets[G]+pe]*v;const _e=xp(F,N,f,m);if(null!=_e){const ye=_e;C[pe]=ye;let Oe=!1;for(let ke=0;ke<ce&&!Oe;ke++)ye>=C[P[ke]]&&(P.splice(ke,0,pe),Oe=!0);Oe||(P[ce]=pe),ce++}}for(let pe=0;pe<ce;pe++){const _e=P[pe];$.push({idx:this.childOffsets[G]+_e,t:C[_e],nodex:(ie<<1)+this._siblingOffset[_e][0],nodey:(ue<<1)+this._siblingOffset[_e][1],depth:ge+1})}}return null}_addNode(e,n,s){return this.minimums.push(e),this.maximums.push(n),this.leaves.push(s),this.childOffsets.push(0),this.nodeCount++}_construct(e,n,s,u,f){if(1===e[u].isLeaf(n,s))return;this.childOffsets[f]||(this.childOffsets[f]=this.nodeCount);const m=u-1,v=e[m];let D=0,C=0;for(let P=0;P<this._siblingOffset.length;P++){const F=2*n+this._siblingOffset[P][0],N=2*s+this._siblingOffset[P][1],$=v.getElevation(F,N),G=v.isLeaf(F,N),J=this._addNode($.min,$.max,G);G&&(D|=1<<P),C||(C=J)}for(let P=0;P<this._siblingOffset.length;P++)D&1<<P||this._construct(e,2*n+this._siblingOffset[P][0],2*s+this._siblingOffset[P][1],m,C+P)}}function wp(t,e,n,s,u,f){return gn(gn(t,n,f),gn(e,s,f),u)}function Sl(t,e,n){const s=n.dim,u=tt(t*s-.5,0,s-1),f=tt(e*s-.5,0,s-1),m=Math.floor(u),v=Math.floor(f),D=Math.min(m+1,s-1),C=Math.min(v+1,s-1);return wp(n.get(m,v),n.get(D,v),n.get(m,C),n.get(D,C),u-m,f-v)}const Ep={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class Kh{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,n,s,u=!1,f=!1){if(this.uid=e,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(s&&"mapbox"!==s&&"terrarium"!==s)return vn(`"${s}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=n.height;const m=this.dim=n.height-2,v=new Uint32Array(n.data.buffer);if(this.pixels=new Uint8Array(n.data.buffer),this.encoding=s||"mapbox",this.borderReady=u,!u){for(let D=0;D<m;D++)v[this._idx(-1,D)]=v[this._idx(0,D)],v[this._idx(m,D)]=v[this._idx(m-1,D)],v[this._idx(D,-1)]=v[this._idx(D,0)],v[this._idx(D,m)]=v[this._idx(D,m-1)];v[this._idx(-1,-1)]=v[this._idx(0,0)],v[this._idx(m,-1)]=v[this._idx(m-1,0)],v[this._idx(-1,m)]=v[this._idx(0,m-1)],v[this._idx(m,m)]=v[this._idx(m-1,m-1)],f&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new Ag(this)}get(e,n,s=!1){s&&(e=tt(e,-1,this.dim),n=tt(n,-1,this.dim));const u=4*this._idx(e,n);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(this.pixels[u],this.pixels[u+1],this.pixels[u+2])}static getUnpackVector(e){return Ep[e]}get unpackVector(){return Ep[this.encoding]}_idx(e,n){if(e<-1||e>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(e+1)}_unpackMapbox(e,n,s){return(256*e*256+256*n+s)/10-1e4}_unpackTerrarium(e,n,s){return 256*e+n+s/256-32768}static pack(e,n){const s=[0,0,0,0],u=Kh.getUnpackVector(n);let f=Math.floor((e+u[3])/u[2]);return s[2]=f%256,f=Math.floor(f/256),s[1]=f%256,f=Math.floor(f/256),s[0]=f,s}getPixels(){return new jo({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,n,s){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let u=n*this.dim,f=n*this.dim+this.dim,m=s*this.dim,v=s*this.dim+this.dim;switch(n){case-1:u=f-1;break;case 1:f=u+1}switch(s){case-1:m=v-1;break;case 1:v=m+1}const D=-n*this.dim,C=-s*this.dim;for(let P=m;P<v;P++)for(let F=u;F<f;F++){const N=4*this._idx(F,P),$=4*this._idx(F+D,P+C);this.pixels[N+0]=e.pixels[$+0],this.pixels[N+1]=e.pixels[$+1],this.pixels[N+2]=e.pixels[$+2],this.pixels[N+3]=e.pixels[$+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Ot(Kh,"DEMData"),Ot(Ag,"DemMinMaxQuadTree",{omit:["dem"]});class Pg{constructor(e,n){this.max=e,this.onRemove=n,this.reset()}reset(){for(const e in this.data)for(const n of this.data[e])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(e,n,s){const u=e.wrapped().key;void 0===this.data[u]&&(this.data[u]=[]);const f={value:n,timeout:void 0};if(void 0!==s&&(f.timeout=setTimeout(()=>{this.remove(e,f)},s)),this.data[u].push(f),this.order.push(u),this.order.length>this.max){const m=this._getAndRemoveByKey(this.order[0]);m&&this.onRemove(m)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const n=this.data[e].shift();return n.timeout&&clearTimeout(n.timeout),0===this.data[e].length&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),n.value}getByKey(e){const n=this.data[e];return n?n[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,n){if(!this.has(e))return this;const s=e.wrapped().key,u=void 0===n?0:this.data[s].indexOf(n),f=this.data[s][u];return this.data[s].splice(u,1),f.timeout&&clearTimeout(f.timeout),0===this.data[s].length&&delete this.data[s],this.onRemove(f.value),this.order.splice(this.order.indexOf(s),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(e){const n=[];for(const s in this.data)for(const u of this.data[s])e(u.value)||n.push(u);for(const s of n)this.remove(s.value.tileID,s)}}class gu{constructor(e,n,s){this.func=e,this.mask=n,this.range=s}}gu.ReadOnly=!1,gu.ReadWrite=!0,gu.disabled=new gu(519,gu.ReadOnly,[0,1]);class Xd{constructor(e,n,s,u,f,m){this.test=e,this.ref=n,this.mask=s,this.fail=u,this.depthFail=f,this.pass=m}}Xd.disabled=new Xd({func:519,mask:0},0,0,7680,7680,7680);class Xa{constructor(e,n,s){this.blendFunction=e,this.blendColor=n,this.mask=s}}Xa.Replace=[1,0],Xa.disabled=new Xa(Xa.Replace,Wn.transparent,[!1,!1,!1,!1]),Xa.unblended=new Xa(Xa.Replace,Wn.transparent,[!0,!0,!0,!0]),Xa.alphaBlended=new Xa([1,771],Wn.transparent,[!0,!0,!0,!0]);class _o{constructor(e,n,s){this.enable=e,this.mode=n,this.frontFace=s}}_o.disabled=new _o(!1,1029,2305),_o.backCCW=new _o(!0,1029,2305),_o.backCW=new _o(!0,1029,2304),_o.frontCW=new _o(!0,1028,2304),_o.frontCCW=new _o(!0,1028,2305);class _u extends Di{constructor(e,n,s){super(),this.id=e,this._onlySymbols=s,n.on("data",u=>{"source"===u.dataType&&"metadata"===u.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===u.dataType&&"content"===u.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),n.on("error",()=>{this._sourceErrored=!0}),this._source=n,this._tiles={},this._cache=new Pg(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=n.minTileCacheSize,this._maxTileCacheSize=n.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new Sg,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(e){this.map=e,this._minTileCacheSize=void 0===this._minTileCacheSize&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const n=this._tiles[e];if("loaded"!==n.state&&"errored"!==n.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,n){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,n)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const n in this._tiles){const s=this._tiles[n];s.upload(e),s.prepare(this.map.style.imageManager)}}getIds(){return We(this._tiles).map(e=>e.tileID).sort(Rg).map(e=>e.key)}getRenderableIds(e){const n=[];for(const s in this._tiles)this._isIdRenderable(+s,e)&&n.push(this._tiles[s]);return e?n.sort((s,u)=>{const f=s.tileID,m=u.tileID,v=new Qe(f.canonical.x,f.canonical.y)._rotate(this.transform.angle),D=new Qe(m.canonical.x,m.canonical.y)._rotate(this.transform.angle);return f.overscaledZ-m.overscaledZ||D.y-v.y||D.x-v.x}).map(s=>s.tileID.key):n.map(s=>s.tileID).sort(Rg).map(s=>s.key)}hasRenderableParent(e){const n=this.findLoadedParent(e,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(e,n){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(n||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)"errored"!==this._tiles[e].state&&this._reloadTile(+e,"reloading")}}_reloadTile(e,n){const s=this._tiles[e];s&&("loading"!==s.state&&(s.state=n),this._loadTile(s,this._tileLoaded.bind(this,s,e,n)))}_tileLoaded(e,n,s,u){if(u)if(e.state="errored",404!==u.status)this._source.fire(new os(u,{tile:e}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const f=this.map.painter.terrain;this.update(this.transform,f.getScaledDemTileSize(),!0),f.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=Kt.now(),"expired"===s&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(n,e),"raster-dem"===this._source.type&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new mi("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const n=this.getRenderableIds();for(let u=0;u<n.length;u++){const f=n[u];if(e.neighboringTiles&&e.neighboringTiles[f]){const m=this.getTileByID(f);s(e,m),s(m,e)}}function s(u,f){if(!u.dem||u.dem.borderReady)return;u.needsHillshadePrepare=!0,u.needsDEMTextureUpload=!0;let m=f.tileID.canonical.x-u.tileID.canonical.x;const v=f.tileID.canonical.y-u.tileID.canonical.y,D=Math.pow(2,u.tileID.canonical.z),C=f.tileID.key;0===m&&0===v||Math.abs(v)>1||(Math.abs(m)>1&&(1===Math.abs(m+D)?m+=D:1===Math.abs(m-D)&&(m-=D)),f.dem&&u.dem&&(u.dem.backfillBorder(f.dem,m,v),u.neighboringTiles&&u.neighboringTiles[C]&&(u.neighboringTiles[C].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,n,s,u){for(const f in this._tiles){let m=this._tiles[f];if(u[f]||!m.hasData()||m.tileID.overscaledZ<=n||m.tileID.overscaledZ>s)continue;let v=m.tileID;for(;m&&m.tileID.overscaledZ>n+1;){const C=m.tileID.scaledTo(m.tileID.overscaledZ-1);m=this._tiles[C.key],m&&m.hasData()&&(v=C)}let D=v;for(;D.overscaledZ>n;)if(D=D.scaledTo(D.overscaledZ-1),e[D.key]){u[v.key]=v;break}}}findLoadedParent(e,n){if(e.key in this._loadedParentTiles){const s=this._loadedParentTiles[e.key];return s&&s.tileID.overscaledZ>=n?s:null}for(let s=e.overscaledZ-1;s>=n;s--){const u=e.scaledTo(s),f=this._getLoadedTile(u);if(f)return f}}_getLoadedTile(e){const n=this._tiles[e.key];return n&&n.hasData()?n:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,n){n=n||this._source.tileSize;const s=Math.ceil(e.width/n)+1,u=Math.ceil(e.height/n)+1,f=Math.floor(s*u*5),m="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,f):f,v="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,m):m;this._cache.setMaxSize(v)}handleWrapJump(e){const n=Math.round((e-(void 0===this._prevLng?e:this._prevLng))/360);if(this._prevLng=e,n){const s={};for(const u in this._tiles){const f=this._tiles[u];f.tileID=f.tileID.unwrapTo(f.tileID.wrap+n),s[f.tileID.key]=f}this._tiles=s;for(const u in this._timers)clearTimeout(this._timers[u]),delete this._timers[u];for(const u in this._tiles)this._setTileReloadTimer(+u,this._tiles[u])}}update(e,n,s){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!s)return;let u;this.updateCacheSize(e,n),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?u=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(v=>new Vo(v.canonical.z,v.wrap,v.canonical.z,v.canonical.x,v.canonical.y)):(u=e.coveringTiles({tileSize:n||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!s,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(u=u.filter(v=>this._source.hasTile(v)))):u=[];const f=this._updateRetainedTiles(u);if(Kd(this._source.type)&&0!==u.length){const v={},D={},C=Object.keys(f);for(const F of C){const N=f[F],$=this._tiles[F];if(!$||$.fadeEndTime&&$.fadeEndTime<=Kt.now())continue;const G=this.findLoadedParent(N,Math.max(N.overscaledZ-_u.maxOverzooming,this._source.minzoom));G&&(this._addTile(G.tileID),v[G.tileID.key]=G.tileID),D[F]=N}const P=u[u.length-1].overscaledZ;for(const F in this._tiles){const N=this._tiles[F];if(f[F]||!N.hasData())continue;let $=N.tileID;for(;$.overscaledZ>P;){$=$.scaledTo($.overscaledZ-1);const G=this._tiles[$.key];if(G&&G.hasData()&&D[$.key]){f[F]=N.tileID;break}}}for(const F in v)f[F]||(this._coveredTiles[F]=!0,f[F]=v[F])}for(const v in f)this._tiles[v].clearFadeHold();const m=function(v,D){const C=[];for(const P in v)P in D||C.push(P);return C}(this._tiles,f);for(const v of m){const D=this._tiles[v];D.hasSymbolBuckets&&!D.holdingForFade()?D.setHoldDuration(this.map._fadeDuration):D.hasSymbolBuckets&&!D.symbolFadeFinished()||this._removeTile(+v)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const n={};if(0===e.length)return n;const s={},u=e.reduce((C,P)=>Math.min(C,P.overscaledZ),1/0),f=e[0].overscaledZ,m=Math.max(f-_u.maxOverzooming,this._source.minzoom),v=Math.max(f+_u.maxUnderzooming,this._source.minzoom),D={};for(const C of e){const P=this._addTile(C);n[C.key]=C,P.hasData()||u<this._source.maxzoom&&(D[C.key]=C)}this._retainLoadedChildren(D,u,v,n);for(const C of e){let P=this._tiles[C.key];if(P.hasData())continue;if(C.canonical.z>=this._source.maxzoom){const N=C.children(this._source.maxzoom)[0],$=this.getTile(N);if($&&$.hasData()){n[N.key]=N;continue}}else{const N=C.children(this._source.maxzoom);if(n[N[0].key]&&n[N[1].key]&&n[N[2].key]&&n[N[3].key])continue}let F=P.wasRequested();for(let N=C.overscaledZ-1;N>=m;--N){const $=C.scaledTo(N);if(s[$.key]||(s[$.key]=!0,P=this.getTile($),!P&&F&&(P=this._addTile($)),P&&(n[$.key]=$,F=P.wasRequested(),P.hasData())))break}}return n}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const n=[];let s,u=this._tiles[e].tileID;for(;u.overscaledZ>0;){if(u.key in this._loadedParentTiles){s=this._loadedParentTiles[u.key];break}n.push(u.key);const f=u.scaledTo(u.overscaledZ-1);if(s=this._getLoadedTile(f),s)break;u=f}for(const f of n)this._loadedParentTiles[f]=s}}_addTile(e){let n=this._tiles[e.key];if(n)return n;n=this._cache.getAndRemove(e),n&&(this._setTileReloadTimer(e.key,n),n.tileID=e,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,n)));const s=Boolean(n);if(!s){const u=this.map?this.map.painter:null;n=new yp(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,u,this._isRaster),this._loadTile(n,this._tileLoaded.bind(this,n,e.key,n.state))}return n?(n.uses++,this._tiles[e.key]=n,s||this._source.fire(new mi("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n):null}_setTileReloadTimer(e,n){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const s=n.getExpiryTimeout();s&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},s))}_removeTile(e){const n=this._tiles[e];n&&(n.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),n.uses>0||(n.hasData()&&"reloading"!==n.state?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,n,s){const u=[],f=this.transform;if(!f)return u;const m="globe"===f.projection.name,v=Ba(f.center.lng);for(const D in this._tiles){const C=this._tiles[D];if(s&&C.clearQueryDebugViz(),C.holdingForFade())continue;let P;if(m){const F=C.tileID.canonical;if(0===F.z){const N=[Math.abs(tt(v,...Ya(F,-1))-v),Math.abs(tt(v,...Ya(F,1))-v)];P=[0,2*N.indexOf(Math.min(...N))-1]}else{const N=[Math.abs(tt(v,...Ya(F,-1))-v),Math.abs(tt(v,...Ya(F,0))-v),Math.abs(tt(v,...Ya(F,1))-v)];P=[N.indexOf(Math.min(...N))-1]}}else P=[0];for(const F of P){const N=e.containsTile(C,f,n,F);N&&u.push(N)}}return u}getVisibleCoordinates(e){const n=this.getRenderableIds(e).map(s=>this._tiles[s].tileID);for(const s of n)s.projMatrix=this.transform.calculateProjMatrix(s.toUnwrapped());return n}hasTransition(){if(this._source.hasTransition())return!0;if(Kd(this._source.type))for(const e in this._tiles){const n=this._tiles[e];if(void 0!==n.fadeEndTime&&n.fadeEndTime>=Kt.now())return!0}return!1}setFeatureState(e,n,s){this._state.updateState(e=e||"_geojsonTileLayer",n,s)}removeFeatureState(e,n,s){this._state.removeFeatureState(e=e||"_geojsonTileLayer",n,s)}getFeatureState(e,n){return this._state.getState(e=e||"_geojsonTileLayer",n)}setDependencies(e,n,s){const u=this._tiles[e];u&&u.setDependencies(n,s)}reloadTilesForDependencies(e,n){for(const s in this._tiles)this._tiles[s].hasDependency(e,n)&&this._reloadTile(+s,"reloading");this._cache.filter(s=>!s.hasDependency(e,n))}_preloadTiles(e,n){const s=new Map,u=Array.isArray(e)?e:[e],f=this.map.painter.terrain,m=this.usedForTerrain&&f?f.getScaledDemTileSize():this._source.tileSize;for(const v of u){const D=v.coveringTiles({tileSize:m,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const C of D)s.set(C.key,C);this.usedForTerrain&&v.updateElevation(!1)}Jt(Array.from(s.values()),(v,D)=>{const C=new yp(v,this._source.tileSize*v.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(C,P=>{"raster-dem"===this._source.type&&C.dem&&this._backfillDEM(C),D(P,C)})},n)}}function Rg(t,e){const n=Math.abs(2*t.wrap)-+(t.wrap<0),s=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||s-n||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function Kd(t){return"raster"===t||"image"===t||"video"===t||"custom"===t}function Ya(t,e){const n=1<<t.z;return[t.x/n+e,(t.x+1)/n+e]}_u.maxOverzooming=10,_u.maxUnderzooming=3;class uh{constructor(e,n,s){this._demTile=e,this._dem=this._demTile.dem,this._scale=n,this._offset=s}static create(e,n,s){const u=s||e.findDEMTileFor(n);if(!u||!u.dem)return;const f=u.dem,m=u.tileID,v=1<<n.canonical.z-m.canonical.z;return new uh(u,u.tileSize/pn/v,[(n.canonical.x/v-m.canonical.x)*f.dim,(n.canonical.y/v-m.canonical.y)*f.dim])}tileCoordToPixel(e,n){const s=n*this._scale+this._offset[1],u=Math.floor(e*this._scale+this._offset[0]),f=Math.floor(s);return new Qe(u,f)}getElevationAt(e,n,s,u){const f=e*this._scale+this._offset[0],m=n*this._scale+this._offset[1],v=Math.floor(f),D=Math.floor(m),C=this._dem;return u=!!u,s?gn(gn(C.get(v,D,u),C.get(v,D+1,u),m-D),gn(C.get(v+1,D,u),C.get(v+1,D+1,u),m-D),f-v):C.get(v,D,u)}getElevationAtPixel(e,n,s){return this._dem.get(e,n,!!s)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*da(1,e)*this._dem.stride}}class Lg{constructor(e,n){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new ca(pn,16,0),this.featureIndexArray=new ed,this.promoteId=n}insert(e,n,s,u,f,m=0){const v=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,u,f,m);const D=this.grid;for(let C=0;C<n.length;C++){const P=n[C],F=[1/0,1/0,-1/0,-1/0];for(let N=0;N<P.length;N++){const $=P[N];F[0]=Math.min(F[0],$.x),F[1]=Math.min(F[1],$.y),F[2]=Math.max(F[2],$.x),F[3]=Math.max(F[3],$.y)}F[0]<pn&&F[1]<pn&&F[2]>=0&&F[3]>=0&&D.insert(v,F[0],F[1],F[2],F[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Hf(new Pc(this.rawTileData)).layers,this.sourceLayerCoder=new Xh(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,n,s,u){this.loadVTLayers();const f=e.params||{},m=sa(f.filter),v=e.tileResult,D=e.transform,C=v.bufferedTilespaceBounds,P=this.grid.query(C.min.x,C.min.y,C.max.x,C.max.y,(G,J,ie,ue)=>Jp(v.bufferedTilespaceGeometry,G,J,ie,ue));P.sort(Uy);let F=null;D.elevation&&P.length>0&&(F=uh.create(D.elevation,this.tileID));const N={};let $;for(let G=0;G<P.length;G++){const J=P[G];if(J===$)continue;$=J;const ie=this.featureIndexArray.get(J);let ue=null;this.loadMatchingFeature(N,ie,m,f.layers,f.availableImages,n,s,u,(ge,ce,pe,_e=0)=>(ue||(ue=ja(ge,this.tileID.canonical,e.tileTransform)),ce.queryIntersectsFeature(v,ge,pe,ue,this.z,e.transform,e.pixelPosMatrix,F,_e)))}return N}loadMatchingFeature(e,n,s,u,f,m,v,D,C){const{featureIndex:P,bucketIndex:F,sourceLayerIndex:N,layoutVertexArrayOffset:$}=n,G=this.bucketLayerIDs[F];if(u&&!function(ge,ce){for(let pe=0;pe<ge.length;pe++)if(ce.indexOf(ge[pe])>=0)return!0;return!1}(u,G))return;const J=this.sourceLayerCoder.decode(N),ie=this.vtLayers[J].feature(P);if(s.needGeometry){const ge=Va(ie,!0);if(!s.filter(new Te(this.tileID.overscaledZ),ge,this.tileID.canonical))return}else if(!s.filter(new Te(this.tileID.overscaledZ),ie))return;const ue=this.getId(ie,J);for(let ge=0;ge<G.length;ge++){const ce=G[ge];if(u&&u.indexOf(ce)<0)continue;const pe=m[ce];if(!pe)continue;let _e={};void 0!==ue&&D&&(_e=D.getState(pe.sourceLayer||"_geojsonTileLayer",ue));const ye=Ue({},v[ce]);ye.paint=Jd(ye.paint,pe.paint,ie,_e,f),ye.layout=Jd(ye.layout,pe.layout,ie,_e,f);const Oe=!C||C(ie,pe,_e,$);if(!Oe)continue;const ke=new Cg(ie,this.z,this.x,this.y,ue);ke.layer=ye;let Ze=e[ce];void 0===Ze&&(Ze=e[ce]=[]),Ze.push({featureIndex:P,feature:ke,intersectionZ:Oe})}}lookupSymbolFeatures(e,n,s,u,f,m,v,D){const C={};this.loadVTLayers();const P=sa(f);for(const F of e)this.loadMatchingFeature(C,{bucketIndex:s,sourceLayerIndex:u,featureIndex:F,layoutVertexArrayOffset:0},P,m,v,D,n);return C}loadFeature(e){const{featureIndex:n,sourceLayerIndex:s}=e;this.loadVTLayers();const u=this.sourceLayerCoder.decode(s),f=this.vtFeatures[u];if(f[n])return f[n];const m=this.vtLayers[u].feature(n);return f[n]=m,m}hasLayer(e){for(const n of this.bucketLayerIDs)for(const s of n)if(e===s)return!0;return!1}getId(e,n){let s=e.id;if(this.promoteId){const u="string"==typeof this.promoteId?this.promoteId:this.promoteId[n];null!=u&&(s=e.properties[u]),"boolean"==typeof s&&(s=Number(s))}return s}}function Jd(t,e,n,s,u){return en(t,(f,m)=>{const v=e instanceof vt?e.get(m):null;return v&&v.evaluate?v.evaluate(n,s,u):v})}function Uy(t,e){return e-t}Ot(Lg,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class K_{constructor(e,n){this.width=e,this.height=n,this.nextRow=0,this.image=new ks({width:e,height:n}),this.positions={},this.uploaded=!1}getDash(e,n){const s=this.getKey(e,n);return this.positions[s]}trim(){const e=this.width,n=this.height=at(this.nextRow);this.image.resize({width:e,height:n})}getKey(e,n){return e.join(",")+n}getDashRanges(e,n,s){const u=[];let f=e.length%2==1?-e[e.length-1]*s:0,m=e[0]*s,v=!0;u.push({left:f,right:m,isDash:v,zeroLength:0===e[0]});let D=e[0];for(let C=1;C<e.length;C++){v=!v;const P=e[C];f=D*s,D+=P,m=D*s,u.push({left:f,right:m,isDash:v,zeroLength:0===P})}return u}addRoundDash(e,n,s){const u=n/2;for(let f=-s;f<=s;f++){const m=this.width*(this.nextRow+s+f);let v=0,D=e[v];for(let C=0;C<this.width;C++){C/D.right>1&&(D=e[++v]);const P=Math.abs(C-D.left),F=Math.abs(C-D.right),N=Math.min(P,F);let $;const G=f/s*(u+1);if(D.isDash){const J=u-Math.abs(G);$=Math.sqrt(N*N+J*J)}else $=u-Math.sqrt(N*N+G*G);this.image.data[m+C]=Math.max(0,Math.min(255,$+128))}}}addRegularDash(e,n){for(let D=e.length-1;D>=0;--D){const C=e[D],P=e[D+1];C.zeroLength?e.splice(D,1):P&&P.isDash===C.isDash&&(P.left=C.left,e.splice(D,1))}const s=e[0],u=e[e.length-1];s.isDash===u.isDash&&(s.left=u.left-this.width,u.right=s.right+this.width);const f=this.width*this.nextRow;let m=0,v=e[m];for(let D=0;D<this.width;D++){D/v.right>1&&(v=e[++m]);const C=Math.abs(D-v.left),P=Math.abs(D-v.right),F=Math.min(C,P);this.image.data[f+D]=Math.max(0,Math.min(255,(v.isDash?F:-F)+n+128))}}addDash(e,n){const s=this.getKey(e,n);if(this.positions[s])return this.positions[s];const u="round"===n,f=u?7:0,m=2*f+1;if(this.nextRow+m>this.height)return vn("LineAtlas out of space"),null;0===e.length&&e.push(1);let v=0;for(let P=0;P<e.length;P++)e[P]<0&&(vn("Negative value is found in line dasharray, replacing values with 0"),e[P]=0),v+=e[P];if(0!==v){const P=this.width/v,F=this.getDashRanges(e,this.width,P);u?this.addRoundDash(F,P,f):this.addRegularDash(F,"square"===n?.5*P:0)}const D=this.nextRow+f;this.nextRow+=m;const C={tl:[D,f],br:[v,0]};return this.positions[s]=C,C}}Ot(K_,"LineAtlas");class kg{constructor(e){const n={},s=[];for(const v in e){const D=e[v],C=n[v]={};for(const P in D.glyphs){const F=D.glyphs[+P];if(!F||0===F.bitmap.width||0===F.bitmap.height)continue;const N=F.metrics.localGlyph?2:1,$={x:0,y:0,w:F.bitmap.width+2*N,h:F.bitmap.height+2*N};s.push($),C[P]=$}}const{w:u,h:f}=Nh(s),m=new ks({width:u||1,height:f||1});for(const v in e){const D=e[v];for(const C in D.glyphs){const P=D.glyphs[+C];if(!P||0===P.bitmap.width||0===P.bitmap.height)continue;const F=n[v][C],N=P.metrics.localGlyph?2:1;ks.copy(P.bitmap,m,{x:0,y:0},{x:F.x+N,y:F.y+N},P.bitmap)}}this.image=m,this.positions=n}}Ot(kg,"GlyphAtlas");class J_{constructor(e){this.tileID=new Vo(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=rh(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,n,s,u,f){this.status="parsing",this.data=e,this.collisionBoxArray=new vh;const m=new Xh(Object.keys(e.layers).sort()),v=new Lg(this.tileID,this.promoteId);v.bucketLayerIDs=[];const D={},C=new K_(256,256),P={featureIndex:v,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:C,availableImages:s},F=n.familiesBySource[this.source];for(const _e in F){const ye=e.layers[_e];if(!ye)continue;let Oe=!1,ke=!1;for(const je of F[_e])"symbol"===je[0].type?Oe=!0:ke=!0;if(!0===this.isSymbolTile&&!Oe||!1===this.isSymbolTile&&!ke)continue;1===ye.version&&vn(`Vector tile source "${this.source}" layer "${_e}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ze=m.encode(_e),dt=[];for(let je=0;je<ye.length;je++){const Xe=ye.feature(je),Ye=v.getId(Xe,_e);dt.push({feature:Xe,id:Ye,index:je,sourceLayerIndex:Ze})}for(const je of F[_e]){const Xe=je[0];void 0!==this.isSymbolTile&&"symbol"===Xe.type!==this.isSymbolTile||Xe.minzoom&&this.zoom<Math.floor(Xe.minzoom)||Xe.maxzoom&&this.zoom>=Xe.maxzoom||"none"!==Xe.visibility&&(Qd(je,this.zoom,s),(D[Xe.id]=Xe.createBucket({index:v.bucketLayerIDs.length,layers:je,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ze,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:s})).populate(dt,P,this.tileID.canonical,this.tileTransform),v.bucketLayerIDs.push(je.map(Ye=>Ye.id)))}}let N,$,G,J;C.trim();const ie={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},ue=en(P.glyphDependencies,_e=>Object.keys(_e).map(Number));Object.keys(ue).length?u.send("getGlyphs",{uid:this.uid,stacks:ue},(_e,ye)=>{N||(N=_e,$=ye,pe.call(this))},void 0,!1,ie):$={};const ge=Object.keys(P.iconDependencies);ge.length?u.send("getImages",{icons:ge,source:this.source,tileID:this.tileID,type:"icons"},(_e,ye)=>{N||(N=_e,G=ye,pe.call(this))},void 0,!1,ie):G={};const ce=Object.keys(P.patternDependencies);function pe(){if(N)return f(N);if($&&G&&J){const _e=new kg($),ye=new Md(G,J);for(const Oe in D){const ke=D[Oe];ke instanceof sc?(Qd(ke.layers,this.zoom,s),V_(ke,$,_e.positions,G,ye.iconPositions,this.showCollisionBoxes,s,this.tileID.canonical,this.tileZoom,this.projection)):ke.hasPattern&&(ke instanceof Dd||ke instanceof Jl||ke instanceof Uu)&&(Qd(ke.layers,this.zoom,s),ke.addFeatures(P,this.tileID.canonical,ye.patternPositions,s,this.tileTransform))}this.status="done",f(null,{buckets:We(D).filter(Oe=>!Oe.isEmpty()),featureIndex:v,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:_e.image,lineAtlas:C,imageAtlas:ye,glyphMap:this.returnDependencies?$:null,iconMap:this.returnDependencies?G:null,glyphPositions:this.returnDependencies?_e.positions:null})}}ce.length?u.send("getImages",{icons:ce,source:this.source,tileID:this.tileID,type:"patterns"},(_e,ye)=>{N||(N=_e,J=ye,pe.call(this))},void 0,!1,ie):J={},pe.call(this)}}function Qd(t,e,n){const s=new Te(e);for(const u of t)u.recalculate(s,n)}class Og{constructor(e){this.entries={},this.scheduler=e}request(e,n,s,u){const f=this.entries[e]=this.entries[e]||{callbacks:[]};if(f.result){const[m,v]=f.result;return this.scheduler?this.scheduler.add(()=>{u(m,v)},n):u(m,v),()=>{}}return f.callbacks.push(u),f.cancel||(f.cancel=s((m,v)=>{f.result=[m,v];for(const D of f.callbacks)this.scheduler?this.scheduler.add(()=>{D(m,v)},n):D(m,v);setTimeout(()=>delete this.entries[e],3e3)})),()=>{f.result||(f.callbacks=f.callbacks.filter(m=>m!==u),f.callbacks.length||(f.cancel(),delete this.entries[e]))}}}function Zi(t,e,n){const s=JSON.stringify(t.request);return t.data&&(this.deduped.entries[s]={result:[null,t.data]}),this.deduped.request(s,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},u=>{const f=$n(t.request,(m,v,D,C)=>{m?u(m):v&&u(null,{vectorTile:n?void 0:new Hf(new Pc(v)),rawData:v,cacheControl:D,expires:C})});return()=>{f.cancel(),u()}},e)}c.ARRAY_TYPE=ns,c.AUTH_ERR_MSG=Gn,c.Aabb=Uo,c.Actor=class{constructor(t,e,n){this.target=t,this.parent=e,this.mapId=n,this.callbacks={},this.cancelCallbacks={},qn(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=Xr()?t:Ee,this.scheduler=new Zd}send(t,e,n,s,u=!1,f){const m=Math.round(1e18*Math.random()).toString(36).substring(0,10);n&&(n.metadata=f,this.callbacks[m]=n);const v=Vn(this.globalScope)?void 0:[];return this.target.postMessage({id:m,type:t,hasCallback:!!n,targetMapId:s,mustQueue:u,sourceMapId:this.mapId,data:Ki(e,v)},v),{cancel:()=>{n&&delete this.callbacks[m],this.target.postMessage({id:m,type:"<cancel>",targetMapId:s,sourceMapId:this.mapId})}}}receive(t){const e=t.data,n=e.id;if(n&&(!e.targetMapId||this.mapId===e.targetMapId))if("<cancel>"===e.type){const s=this.cancelCallbacks[n];delete this.cancelCallbacks[n],s&&s.cancel()}else if(e.mustQueue||Xr()){const s=this.callbacks[n];this.cancelCallbacks[n]=this.scheduler.add(()=>this.processTask(n,e),s&&s.metadata||{type:"message"})}else this.processTask(n,e)}processTask(t,e){if("<response>"===e.type){const n=this.callbacks[t];delete this.callbacks[t],n&&(e.error?n(Jo(e.error)):n(null,Jo(e.data)))}else{const n=Vn(this.globalScope)?void 0:[],s=e.hasCallback?(f,m)=>{delete this.cancelCallbacks[t],this.target.postMessage({id:t,type:"<response>",sourceMapId:this.mapId,error:f?Ki(f):null,data:Ki(m,n)},n)}:f=>{},u=Jo(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,u,s);else if(this.parent.getWorkerSource){const f=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,f[0],u.source)[f[1]](u,s)}else s(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},c.CanonicalTileID=Ed,c.Color=Wn,c.ColorMode=Xa,c.CullFaceMode=_o,c.DEMData=Kh,c.DataConstantProperty=Ae,c.DedupedRequest=Og,c.DepthMode=gu,c.EXTENT=pn,c.Elevation=class{isDataAvailableAtPoint(t){const e=this._source();if(this.isUsingMockSource()||!e||t.y<0||t.y>1)return!1;const n=e.getSource().maxzoom,s=1<<n,u=Math.floor(t.x),f=Math.floor((t.x-u)*s),m=Math.floor(t.y*s),v=this.findDEMTileFor(new Vo(n,u,n,f,m));return!(!v||!v.dem)}getAtPointOrZero(t,e=0){return this.getAtPoint(t,e)||0}getAtPoint(t,e,n=!0){if(this.isUsingMockSource())return null;null==e&&(e=null);const s=this._source();if(!s||t.y<0||t.y>1)return e;const u=s.getSource().maxzoom,f=1<<u,m=Math.floor(t.x),v=t.x-m,D=new Vo(u,m,u,Math.floor(v*f),Math.floor(t.y*f)),C=this.findDEMTileFor(D);if(!C||!C.dem)return e;const P=C.dem,F=1<<C.tileID.canonical.z,N=(v*F-C.tileID.canonical.x)*P.dim,$=(t.y*F-C.tileID.canonical.y)*P.dim,G=Math.floor(N),J=Math.floor($);return(n?this.exaggeration():1)*gn(gn(P.get(G,J),P.get(G,J+1),$-J),gn(P.get(G+1,J),P.get(G+1,J+1),$-J),N-G)}getAtTileOffset(t,e,n){const s=1<<t.canonical.z;return this.getAtPointOrZero(new Yc(t.wrap+(t.canonical.x+e/pn)/s,(t.canonical.y+n/pn)/s))}getAtTileOffsetFunc(t,e,n,s){return u=>{const f=this.getAtTileOffset(t,u.x,u.y),m=s.upVector(t.canonical,u.x,u.y);return ys(m,m,f*s.upVectorScale(t.canonical,e,n).metersToTile),m}}getForTilePoints(t,e,n,s){if(this.isUsingMockSource())return!1;const u=uh.create(this,t,s);return!!u&&(e.forEach(f=>{f[2]=this.exaggeration()*u.getElevationAt(f[0],f[1],n)}),!0)}getMinMaxForTile(t){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(t);if(!e||!e.dem)return null;const n=e.dem.tree,s=e.tileID,u=1<<t.canonical.z-s.canonical.z;let f=t.canonical.x/u-s.canonical.x,m=t.canonical.y/u-s.canonical.y,v=0;for(let D=0;D<t.canonical.z-s.canonical.z&&!n.leaves[v];D++){f*=2,m*=2;const C=2*Math.floor(m)+Math.floor(f);v=n.childOffsets[v]+C,f%=1,m%=1}return{min:this.exaggeration()*n.minimums[v],max:this.exaggeration()*n.maximums[v]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,e,n){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},c.ErrorEvent=os,c.EvaluationParameters=Te,c.Event=mi,c.Evented=Di,c.FillExtrusionBucket=Uu,c.Frustum=Ff,c.FrustumCorners=Mi,c.GLOBE_METERS_TO_ECEF=Ku,c.GLOBE_RADIUS=ga,c.GLOBE_SCALE_MATCH_LATITUDE=45,c.GLOBE_ZOOM_THRESHOLD_MAX=6,c.GLOBE_ZOOM_THRESHOLD_MIN=5,c.GlobeSharedBuffers=class{constructor(t){this._createGrid(t),this._createPoles(t)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const t of this._poleSegments)t.destroy();for(const t of this._gridSegments)t.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const t of this._wireframeSegments)t.destroy()}}_createGrid(t){const e=new hr,n=new Ji,s=65;for(let u=0;u<s;u++)for(let f=0;f<s;f++)e.emplaceBack(f,u);this._gridSegments=[];for(let u=0,f=0;u<Ju.length;u++){const m=Ju[u];for(let D=0;D<m;D++)for(let C=0;C<64;C++){const P=D*s+C;n.emplaceBack(P+1,P,P+s),n.emplaceBack(P+s,P+s+1,P+1)}const v=64*m*2;this._gridSegments.push(xi.simpleSegment(0,f,(m+1)*s,v)),f+=v}this._gridBuffer=t.createVertexBuffer(e,Fs.members),this._gridIndexBuffer=t.createIndexBuffer(n,!0)}_createPoles(t){const e=new Ji;for(let u=0;u<=64;u++)e.emplaceBack(0,u+1,u+2);this._poleIndexBuffer=t.createIndexBuffer(e,!0);const n=new Cc,s=new Cc;this._poleSegments=[];for(let u=0,f=0;u<5;u++){const m=360/(1<<u);n.emplaceBack(0,-ga,0,.5,0),s.emplaceBack(0,-ga,0,.5,1);for(let v=0;v<=64;v++){const D=v/64,C=gn(0,m,D),[P,F,N]=Qu(vg,xg,C,ga);n.emplaceBack(P,F,N,D,0),s.emplaceBack(P,F,N,D,1)}this._poleSegments.push(xi.simpleSegment(f,0,66,64)),f+=66}this._poleNorthVertexBuffer=t.createVertexBuffer(n,ap,!1),this._poleSouthVertexBuffer=t.createVertexBuffer(s,ap,!1)}getGridBuffers(t){return[this._gridBuffer,this._gridIndexBuffer,this._gridSegments[t]]}getPoleBuffers(t){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[t]]}getWirefameBuffers(t,e){if(!this._wireframeSegments){const n=new ha,s=64,u=s+1;this._wireframeSegments=[];for(let f=0,m=0;f<Ju.length;f++){const v=Ju[f];for(let C=0;C<v;C++)for(let P=0;P<s;P++){const F=C*u+P;n.emplaceBack(F,F+1),n.emplaceBack(F,F+u),n.emplaceBack(F,F+u+1)}const D=v*s*3;this._wireframeSegments.push(xi.simpleSegment(0,m,(v+1)*u,D)),m+=D}this._wireframeIndexBuffer=t.createIndexBuffer(n)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[e]]}},c.GlyphManager=Wu,c.ImagePosition=lu,c.LivePerformanceUtils=ve,c.LngLat=or,c.LngLatBounds=Ic,c.LocalGlyphMode=jh,c.MAX_MERCATOR_LATITUDE=Ua,c.MercatorCoordinate=Yc,c.ONE_EM=24,c.OverscaledTileID=Vo,c.PerformanceMarkers=Q,c.Properties=an,c.RGBAImage=jo,c.Ray=Of,c.RequestManager=class{constructor(t,e,n){this._transformRequestFn=t,this._customAccessToken=e,this._silenceAuthErrors=!!n,this._createSkuToken()}_createSkuToken(){const t=function(){let e="";for(let n=0;n<10;n++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Qt,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}normalizeStyleURL(t,e){if(!Kr(t))return t;const n=Ei(t);return n.path=`/styles/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeGlyphsURL(t,e){if(!Kr(t))return t;const n=Ei(t);return n.path=`/fonts/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeSourceURL(t,e,n,s){if(!Kr(t))return t;const u=Ei(t);return u.path=`/v4/${u.authority}.json`,u.params.push("secure"),n&&u.params.push(`language=${n}`),s&&u.params.push(`worldview=${s}`),this._makeAPIURL(u,this._customAccessToken||e)}normalizeSpriteURL(t,e,n,s){const u=Ei(t);return Kr(t)?(u.path=`/styles/v1${u.path}/sprite${e}${n}`,this._makeAPIURL(u,this._customAccessToken||s)):(u.path+=`${e}${n}`,pi(u))}normalizeTileURL(t,e,n){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!Kr(t))return t;const s=Ei(t);s.path=s.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||n&&"raster"!==s.authority&&512===n?"@2x":""}${bt.supported?".webp":"$1"}`),"raster"===s.authority?s.path=`/${kt.RASTER_URL_PREFIX}${s.path}`:(s.path=s.path.replace(/^.+\/v4\//,"/"),s.path=`/${kt.TILE_URL_VERSION}${s.path}`);const u=this._customAccessToken||function(f){for(const m of f){const v=m.match(/^access_token=(.*)$/);if(v)return v[1]}return null}(s.params)||kt.ACCESS_TOKEN;return kt.REQUIRE_ACCESS_TOKEN&&u&&this._skuToken&&s.params.push(`sku=${this._skuToken}`),this._makeAPIURL(s,u)}canonicalizeTileURL(t,e){const n=Ei(t);if(!n.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!n.path.match(/\.[\w]+$/))return t;let s="mapbox://";n.path.match(/^\/raster\/v1\//)?s+=`raster/${n.path.replace(`/${kt.RASTER_URL_PREFIX}/`,"")}`:s+=`tiles/${n.path.replace(`/${kt.TILE_URL_VERSION}/`,"")}`;let u=n.params;return e&&(u=u.filter(f=>!f.match(/^access_token=/))),u.length&&(s+=`?${u.join("&")}`),s}canonicalizeTileset(t,e){const n=!!e&&Kr(e),s=[];for(const u of t.tiles||[])so(u)?s.push(this.canonicalizeTileURL(u,n)):s.push(u);return s}_makeAPIURL(t,e){const n="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",s=Ei(kt.API_URL);if(t.protocol=s.protocol,t.authority=s.authority,"http"===t.protocol){const u=t.params.indexOf("secure");u>=0&&t.params.splice(u,1)}if("/"!==s.path&&(t.path=`${s.path}${t.path}`),!kt.REQUIRE_ACCESS_TOKEN)return pi(t);if(e=e||kt.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${n}`);if("s"===e[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${n}`)}return t.params=t.params.filter(u=>-1===u.indexOf("access_token")),t.params.push(`access_token=${e||""}`),pi(t)}},c.ResourceType=rn,c.SegmentVector=xi,c.SourceCache=_u,c.StencilMode=Xd,c.StructArrayLayout1ui2=yh,c.StructArrayLayout2f1f2i16=Fo,c.StructArrayLayout2i4=hr,c.StructArrayLayout2ui4=ha,c.StructArrayLayout3f12=Fa,c.StructArrayLayout3ui6=Ji,c.StructArrayLayout4i8=xr,c.StructArrayLayout5f20=Cc,c.Texture=mu,c.Tile=yp,c.Transitionable=He,c.Uniform1f=nd,c.Uniform1i=class extends Zl{constructor(t){super(t),this.current=0}set(t,e,n){this.fetchUniformLocation(t,e)&&this.current!==n&&(this.current=n,this.gl.uniform1i(this.location,n))}},c.Uniform2f=class extends Zl{constructor(t){super(t),this.current=[0,0]}set(t,e,n){this.fetchUniformLocation(t,e)&&(n[0]===this.current[0]&&n[1]===this.current[1]||(this.current=n,this.gl.uniform2f(this.location,n[0],n[1])))}},c.Uniform3f=class extends Zl{constructor(t){super(t),this.current=[0,0,0]}set(t,e,n){this.fetchUniformLocation(t,e)&&(n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]||(this.current=n,this.gl.uniform3f(this.location,n[0],n[1],n[2])))}},c.Uniform4f=rd,c.UniformColor=id,c.UniformMatrix2f=class extends Zl{constructor(t){super(t),this.current=Kg}set(t,e,n){if(this.fetchUniformLocation(t,e))for(let s=0;s<4;s++)if(n[s]!==this.current[s]){this.current=n,this.gl.uniformMatrix2fv(this.location,!1,n);break}}},c.UniformMatrix3f=class extends Zl{constructor(t){super(t),this.current=bh}set(t,e,n){if(this.fetchUniformLocation(t,e))for(let s=0;s<9;s++)if(n[s]!==this.current[s]){this.current=n,this.gl.uniformMatrix3fv(this.location,!1,n);break}}},c.UniformMatrix4f=class extends Zl{constructor(t){super(t),this.current=Yg}set(t,e,n){if(this.fetchUniformLocation(t,e)){if(n[12]!==this.current[12]||n[0]!==this.current[0])return this.current=n,void this.gl.uniformMatrix4fv(this.location,!1,n);for(let s=1;s<16;s++)if(n[s]!==this.current[s]){this.current=n,this.gl.uniformMatrix4fv(this.location,!1,n);break}}}},c.UnwrappedTileID=Am,c.ValidationError=St,c.VectorTileFeature=bd,c.VectorTileWorkerSource=class extends Di{constructor(t,e,n,s,u){super(),this.actor=t,this.layerIndex=e,this.availableImages=n,this.loadVectorData=u||Zi,this.loading={},this.loaded={},this.deduped=new Og(t.scheduler),this.isSpriteLoaded=s,this.scheduler=t.scheduler}loadTile(t,e){const n=t.uid,s=t&&t.request,u=s&&s.collectResourceTiming,f=this.loading[n]=new J_(t);f.abort=this.loadVectorData(t,(m,v)=>{const D=!this.loading[n];if(delete this.loading[n],D||m||!v)return f.status="done",D||(this.loaded[n]=f),e(m);const C=v.rawData,P={};v.expires&&(P.expires=v.expires),v.cacheControl&&(P.cacheControl=v.cacheControl),f.vectorTile=v.vectorTile||new Hf(new Pc(C));const F=()=>{f.parse(f.vectorTile,this.layerIndex,this.availableImages,this.actor,(N,$)=>{if(N||!$)return e(N);const G={};if(u){const J=mt(s);J.length>0&&(G.resourceTiming=JSON.parse(JSON.stringify(J)))}e(null,Ue({rawTileData:C.slice(0)},$,P,G))})};this.isSpriteLoaded?F():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(F,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom}):F()}),this.loaded=this.loaded||{},this.loaded[n]=f})}reloadTile(t,e){const n=this.loaded,s=t.uid,u=this;if(n&&n[s]){const f=n[s];f.showCollisionBoxes=t.showCollisionBoxes,f.enableTerrain=!!t.enableTerrain,f.projection=t.projection,f.tileTransform=rh(t.tileID.canonical,t.projection);const m=(v,D)=>{const C=f.reloadCallback;C&&(delete f.reloadCallback,f.parse(f.vectorTile,u.layerIndex,this.availableImages,u.actor,C)),e(v,D)};"parsing"===f.status?f.reloadCallback=m:"done"===f.status&&(f.vectorTile?f.parse(f.vectorTile,this.layerIndex,this.availableImages,this.actor,m):m())}}abortTile(t,e){const n=t.uid,s=this.loading[n];s&&(s.abort&&s.abort(),delete this.loading[n]),e()}removeTile(t,e){const n=this.loaded,s=t.uid;n&&n[s]&&delete n[s],e()}},c.WritingMode=$o,c.add=Yl,c.addDynamicAttributes=qh,c.adjoint=function(t,e){var n=e[0],s=e[1],u=e[2],f=e[3],m=e[4],v=e[5],D=e[6],C=e[7],P=e[8];return t[0]=m*P-v*C,t[1]=u*C-s*P,t[2]=s*v-u*m,t[3]=v*D-f*P,t[4]=n*P-u*D,t[5]=u*f-n*v,t[6]=f*C-m*D,t[7]=s*D-n*C,t[8]=n*m-s*f,t},c.asyncAll=Jt,c.bezier=Bt,c.bindAll=qn,c.boundsAttributes=qd,c.bufferConvexPolygon=function(t,e){const n=[];for(let s=0;s<t.length;s++){const u=Nn(s-1,-1,t.length-1),f=Nn(s+1,-1,t.length-1),m=t[s],v=t[f],D=t[u].sub(m).unit(),C=v.sub(m).unit(),P=C.angleWithSep(D.x,D.y),F=D.add(C).unit().mult(-1*e/Math.sin(P/2));n.push(m.add(F))}return n},c.cacheEntryPossiblyAdded=function(t){fr++,fr>Vs&&(t.getActor().send("enforceCacheSizeLimit",rs),fr=0)},c.calculateGlobeLabelMatrix=function(t,e){const{x:n,y:s}=t.point,u=gg(n,s,t.worldSize/t._pixelsPerMercatorPixel,0,0);return Kc(u,u,up(rc(e)))},c.calculateGlobeMatrix=function(t){const{x:e,y:n}=t.point,{lng:s,lat:u}=t._center;return gg(e,n,t.worldSize,s,u)},c.calculateGlobeMercatorMatrix=function(t){const e=t.pixelsPerMeter,n=e/da(1,t.center.lat),s=$a(new Float64Array(16));return pa(s,s,[t.point.x,t.point.y,0]),Ga(s,s,[n,n,e]),Float32Array.from(s)},c.circumferenceAtLatitude=Wl,c.clamp=tt,c.clearTileCache=function(t){if(!vo())return;const e=Ee.caches.delete(Br);t&&e.catch(t).then(()=>t())},c.clipLine=ig,c.clone=function(t){var e=new ns(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},c.clone$1=Ln,c.collisionCircleLayout=A_,c.config=kt,c.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},c.create=function(){var t=new ns(16);return ns!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},c.create$1=tm,c.createExpression=Zn,c.createLayout=Ft,c.createStyleLayer=function(t){return"custom"===t.type?new Tg(t):new pp[t.type](t)},c.cross=im,c.degToRad=qe,c.distance=function(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2])},c.div=function(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t},c.dot=Ha,c.earthRadius=sd,c.ease=wt,c.easeCubicInOut=ut,c.ecefToLatLng=function([t,e,n]){const s=Math.hypot(t,e,n),u=Math.atan2(t,n),f=.5*Math.PI-Math.acos(-e/s);return new or(Xt(u),Xt(f))},c.emitValidationErrors=$l,c.endsWith=Un,c.enforceCacheSizeLimit=function(t){ai(),Vr&&Vr.then(e=>{e.keys().then(n=>{for(let s=0;s<n.length-t;s++)e.delete(n[s])})})},c.evaluateSizeForFeature=Cd,c.evaluateSizeForZoom=ou,c.evaluateVariableOffset=ug,c.evented=he,c.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},c.exactEquals$1=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},c.exported=Kt,c.exported$1=bt,c.extend=Ue,c.extend$1=wo,c.fillExtrusionHeightLift=Sm,c.filterObject=jn,c.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},c.fromQuat=function(t,e){var n=e[0],s=e[1],u=e[2],f=e[3],m=n+n,v=s+s,D=u+u,C=n*m,P=s*m,F=s*v,N=u*m,$=u*v,G=u*D,J=f*m,ie=f*v,ue=f*D;return t[0]=1-F-G,t[1]=P+ue,t[2]=N-ie,t[3]=0,t[4]=P-ue,t[5]=1-C-G,t[6]=$+J,t[7]=0,t[8]=N+ie,t[9]=$-J,t[10]=1-C-F,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},c.fromRotation=function(t,e){var n=Math.sin(e),s=Math.cos(e);return t[0]=s,t[1]=n,t[2]=0,t[3]=-n,t[4]=s,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},c.fromScaling=n_,c.furthestTileCorner=function(t){const e=Math.round((t+45+360)%360/90)%4;return ar[e]},c.getAABBPointSquareDist=function(t,e,n){let s=0;for(let u=0;u<2;++u){const f=n?n[u]:0;t[u]>f&&(s+=(t[u]-f)*(t[u]-f)),e[u]<f&&(s+=(f-e[u])*(f-e[u]))}return s},c.getAnchorAlignment=Pd,c.getAnchorJustification=Yu,c.getBounds=function(t){let e=1/0,n=1/0,s=-1/0,u=-1/0;for(const f of t)e=Math.min(e,f.x),n=Math.min(n,f.y),s=Math.max(s,f.x),u=Math.max(u,f.y);return{min:new Qe(e,n),max:new Qe(s,u)}},c.getColumn=Wi,c.getGridMatrix=function(t,e,n,s){const u=e.getNorth(),f=e.getSouth(),m=e.getWest(),v=e.getEast(),D=1<<t.z,C=v-m,P=u-f,F=C/64,N=-P/Ju[n],$=[0,F,0,N,0,0,u,m,0];if(t.z>0){const G=180/s;nm($,$,[G/C+1,0,0,0,G/P+1,0,-.5*G/F,.5*G/N,1])}return $[2]=D,$[5]=t.x,$[8]=t.y,$},c.getImage=Nr,c.getJSON=function(t,e){return Yr(Ue(t,{type:"json"}),e)},c.getLatitudinalLod=function(t){const e=80.051129;t=tt(t,-80.051129,e)/e*90;const n=Math.pow(Math.abs(Math.sin(qe(t))),3);return Math.round(n*(Ju.length-1))},c.getMapSessionAPI=re,c.getPerformanceMeasurement=mt,c.getProjection=pu,c.getRTLTextPluginStatus=be,c.getReferrer=xo,c.getTilePoint=function(t,{x:e,y:n},s=0){return new Qe(((e-s)*t.scale-t.x)*pn,(n*t.scale-t.y)*pn)},c.getTileVec3=function(t,e,n=0){return ku(((e.x-n)*t.scale-t.x)*pn,(e.y*t.scale-t.y)*pn,qp(e.z,e.y))},c.getVideo=function(t,e){const n=Ee.document.createElement("video");n.muted=!0,n.onloadstart=function(){e(null,n)};for(let s=0;s<t.length;s++){const u=Ee.document.createElement("source");oo(t[s])||(n.crossOrigin="Anonymous"),u.src=t[s],n.appendChild(u)}return{cancel:()=>{}}},c.globeCenterToScreenPoint=function(t){const e=[0,0,0],n=$a(new Float64Array(16));return Kc(n,t.pixelMatrix,t.globeMatrix),bi(e,e,n),new Qe(e[0],e[1])},c.globeDenormalizeECEF=up,c.globeECEFOrigin=function(t,e){const n=[0,0,0];return bi(n,n,$h(rc(e.canonical))),bi(n,n,t),n},c.globeNormalizeECEF=$h,c.globePixelsToTileUnits=function(t,e){return pn/(512*Math.pow(2,t))*Nd(rc(e))},c.globePoleMatrixForTile=function(t,e,n){const s=$a(new Float64Array(16)),u=(e/(1<<t)-.5)*Math.PI*2;return Af(s,n.globeMatrix,u),Float32Array.from(s)},c.globeTileBounds=rc,c.globeTiltAtLngLat=_g,c.globeToMercatorTransition=nh,c.globeUseCustomAntiAliasing=function(t,e,n){const s=nh(n.zoom),u=t.style.map._antialias,f=!!e.extStandardDerivatives,m=e.extStandardDerivativesForceOff||t.terrain&&t.terrain.exaggeration()>0;return 0===s&&!u&&!m&&f},c.identity=$a,c.identity$1=Lf,c.invert=If,c.isFullscreen=function(){return!!Ee.document.fullscreenElement||!!Ee.document.webkitFullscreenElement},c.isLngLatBehindGlobe=hp,c.isMapAuthenticated=function(t){return ne.has(t)},c.isMapboxURL=Kr,c.isSafariWithAntialiasingBug=function(t){const e=t.navigator?t.navigator.userAgent:null;return!!Vn(t)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},c.latFromMercatorY=Fi,c.latLngToECEF=eh,c.len=om,c.length=Sh,c.length$1=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},c.lngFromMercatorX=fa,c.loadVectorTile=Zi,c.makeRequest=Yr,c.mapValue=function(t,e,n,s,u){return tt((t-e)/(n-e)*(u-s)+s,s,u)},c.mercatorScale=bf,c.mercatorXfromLng=Ba,c.mercatorYfromLat=Na,c.mercatorZfromAltitude=da,c.mul=ky,c.mul$1=Oy,c.multiply=Kc,c.multiply$1=nm,c.multiply$2=dd,c.nextPowerOfTwo=at,c.normalize=Mo,c.normalize$1=kf,c.normalize$2=am,c.number=gn,c.ortho=function(t,e,n,s,u,f,m){var v=1/(e-n),D=1/(s-u),C=1/(f-m);return t[0]=-2*v,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*D,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*C,t[11]=0,t[12]=(e+n)*v,t[13]=(u+s)*D,t[14]=(m+f)*C,t[15]=1,t},c.pbf=Pc,c.perspective=function(t,e,n,s,u){var f,m=1/Math.tan(e/2);return t[0]=m/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=m,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=u&&u!==1/0?(t[10]=(u+s)*(f=1/(s-u)),t[14]=2*u*s*f):(t[10]=-1,t[14]=-2*s),t},c.pick=function(t,e){const n={};for(let s=0;s<e.length;s++){const u=e[s];u in t&&(n[u]=t[u])}return n},c.plugin=Pe,c.pointGeometry=Qe,c.polesInViewport=function(t){const e=$a(new Float64Array(16));Kc(e,t.pixelMatrix,t.globeMatrix);const n=[0,zs,0],s=[0,Bs,0];return bi(n,n,e),bi(s,s,e),[n[0]>0&&n[0]<=t.width&&n[1]>0&&n[1]<=t.height&&!hp(t,new or(t.center.lat,90)),s[0]>0&&s[0]<=t.width&&s[1]>0&&s[1]<=t.height&&!hp(t,new or(t.center.lat,-90))]},c.polygonContainsPoint=Ru,c.polygonIntersectsBox=Jp,c.polygonIntersectsPolygon=Wp,c.polygonizeBounds=function(t,e,n=0,s=!0){const u=new Qe(n,n),f=t.sub(u),m=e.add(u),v=[f,new Qe(m.x,f.y),m,new Qe(f.x,m.y)];return s&&v.push(f.clone()),v},c.posAttributes=Fs,c.postMapLoadEvent=fe,c.postPerformanceEvent=Se,c.postTurnstileEvent=X,c.potpack=Nh,c.prevPowerOfTwo=function(t){return t<=1?1:Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},c.radToDeg=Xt,c.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],c.registerForPluginStateChange=function(t){return t({pluginStatus:Z,pluginURL:Y}),he.on("pluginStateChange",t),t},c.removeAuthState=function(t){ne.delete(t)},c.renderColorRamp=pd,c.resample=wf,c.rotateX=Mf,c.rotateX$1=Ih,c.rotateY=Af,c.rotateY$1=cm,c.rotateZ=function(t,e,n){var s=Math.sin(n),u=Math.cos(n),f=e[0],m=e[1],v=e[2],D=e[3],C=e[4],P=e[5],F=e[6],N=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=f*u+C*s,t[1]=m*u+P*s,t[2]=v*u+F*s,t[3]=D*u+N*s,t[4]=C*u-f*s,t[5]=P*u-m*s,t[6]=F*u-v*s,t[7]=N*u-D*s,t},c.rotateZ$1=function(t,e,n){n*=.5;var s=e[0],u=e[1],f=e[2],m=e[3],v=Math.sin(n),D=Math.cos(n);return t[0]=s*D+u*v,t[1]=u*D-s*v,t[2]=f*D+m*v,t[3]=m*D-f*v,t},c.scale=Ga,c.scale$1=sm,c.scale$2=ys,c.scaleAndAdd=Ou,c.set=function(t,e,n,s){return t[0]=e,t[1]=n,t[2]=s,t},c.setCacheLimits=function(t,e){rs=t,Vs=e},c.setColumn=function(t,e,n){t[4*e+0]=n[0],t[4*e+1]=n[1],t[4*e+2]=n[2],t[4*e+3]=n[3]},c.setRTLTextPlugin=function(t,e,n=!1){if(Z===T||Z===M||Z===L)throw new Error("setRTLTextPlugin cannot be called multiple times.");Y=Kt.resolveURL(t),Z=T,O=e,se(),n||Le()},c.smoothstep=cn,c.spec=Ge,c.squaredLength=function(t){var e=t[0],n=t[1],s=t[2];return e*e+n*n+s*s},c.storeAuthState=function(t,e){e?ne.add(t):ne.delete(t)},c.sub=bl,c.subtract=Rf,c.symbolSize=zy,c.tileAABB=function(t,e,n,s,u,f,m,v,D){if("globe"===D.name)return function H_(t,e,n){const s=e/t.worldSize,u=t.globeMatrix;if(n.z<=1){const ke=rc(n).getCorners();return mg(ke,u,s),Uo.fromPoints(ke)}const f=Bd(n),m=cp(f);mg(m,u,s);const v=Number.MAX_VALUE,D=[-v,-v,-v],C=[v,v,v];if(f.contains(t.center)){for(const dt of m)Ls(C,C,dt),Kl(D,D,dt);D[2]=0;const ke=t.point,Ze=[ke.x*s,ke.y*s,0];return Ls(C,C,Ze),Kl(D,D,Ze),new Uo(C,D)}const P=[u[12]*s,u[13]*s,u[14]*s],F=f.getCenter(),N=tt(t.center.lat,-85.051129,Ua),$=tt(F.lat,-85.051129,Ua),G=Ba(t.center.lng),J=Na(N);let ie=G-Ba(F.lng);const ue=J-Na($);ie>.5?ie-=1:ie<-.5&&(ie+=1);let ge=0;Math.abs(ie)>Math.abs(ue)?ge=ie>=0?1:3:(ge=ue>=0?0:2,Ou(P,P,[u[4]*s,u[5]*s,u[6]*s],-Math.sin(qe(ue>=0?f.getSouth():f.getNorth()))*ga));const ce=m[ge],pe=m[(ge+1)%4],_e=new Vh(ce,pe,P),ye=[lp(_e,0)||ce[0],lp(_e,1)||ce[1],lp(_e,2)||ce[2]],Oe=nh(t.zoom);if(Oe>0){const ke=function({x:dt,y:je,z:Xe},Ye,st,ft,Ve){const It=1/(1<<Xe);let ln=dt*It,Rt=ln+It,Wt=je*It,Mt=Wt+It,un=0;const Fn=(ln+Rt)/2-ft;return Fn>.5?un=-1:Fn<-.5&&(un=1),ln=((ln+un)*Ye-(ft*=Ye))*st+ft,Rt=((Rt+un)*Ye-ft)*st+ft,Wt=(Wt*Ye-(Ve*=Ye))*st+Ve,Mt=(Mt*Ye-Ve)*st+Ve,[[ln,Mt,0],[Rt,Mt,0],[Rt,Wt,0],[ln,Wt,0]]}(n,e,t._pixelsPerMercatorPixel,G,J);for(let dt=0;dt<m.length;dt++)cu(m[dt],ke[dt],Oe);const Ze=Yl([],ke[ge],ke[(ge+1)%4]);ys(Ze,Ze,.5),cu(ye,Ze,Oe)}for(const ke of m)Ls(C,C,ke),Kl(D,D,ke);return C[2]=Math.min(ce[2],pe[2]),Ls(C,C,ye),Kl(D,D,ye),new Uo(C,D)}(t,e,new Ed(n,s,u));const C=rh({z:n,x:s,y:u},D);return new Uo([(f+C.x/C.scale)*e,e*(C.y/C.scale),m],[(f+C.x2/C.scale)*e,e*(C.y2/C.scale),v])},c.tileCornersToBounds=Bd,c.tileTransform=rh,c.transformMat3=function(t,e,n){var s=e[0],u=e[1],f=e[2];return t[0]=s*n[0]+u*n[3]+f*n[6],t[1]=s*n[1]+u*n[4]+f*n[7],t[2]=s*n[2]+u*n[5]+f*n[8],t},c.transformMat4=bi,c.transformMat4$1=Qc,c.transformQuat=fd,c.transitionTileAABBinECEF=pg,c.translate=pa,c.transpose=function(t,e){if(t===e){var n=e[1],s=e[2],u=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=s,t[7]=u}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},c.triggerPluginCompletionEvent=oe,c.uniqueId=ht,c.updateGlobeVertexNormal=function(t,e,n,s,u){const f=5*e+2;t.float32[f+0]=n,t.float32[f+1]=s,t.float32[f+2]=u},c.validateCustomStyleLayer=function(t){const e=[],n=t.id;return void 0===n&&e.push({message:`layers.${n}: missing required property "id"`}),void 0===t.render&&e.push({message:`layers.${n}: missing required method "render"`}),t.renderingMode&&"2d"!==t.renderingMode&&"3d"!==t.renderingMode&&e.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),e},c.validateFilter=t=>go(pl(t)),c.validateFog=t=>go(jc(t)),c.validateLayer=t=>go(Ul(t)),c.validateLight=t=>go(gl(t)),c.validateSource=t=>go(Du(t)),c.validateStyle=$c,c.validateTerrain=t=>go(Vl(t)),c.values=We,c.vectorTile=Oh,c.version=Ht,c.warnOnce=vn,c.window=Ee,c.wrap=Nn}),Ie(0,function(c){function Ee(le){if("number"==typeof le||"boolean"==typeof le||"string"==typeof le||null==le)return JSON.stringify(le);if(Array.isArray(le)){let X="[";for(const ae of le)X+=`${Ee(ae)},`;return`${X}]`}let H="{";for(const X of Object.keys(le).sort())H+=`${X}:${Ee(le[X])},`;return`${H}}`}function Ht(le){let H="";for(const X of c.refProperties)H+=`/${Ee(le[X])}`;return H}class Vt{constructor(H){this.keyCache={},H&&this.replace(H)}replace(H){this._layerConfigs={},this._layers={},this.update(H,[])}update(H,X){for(const fe of H)this._layerConfigs[fe.id]=fe,(this._layers[fe.id]=c.createStyleLayer(fe)).compileFilter(),this.keyCache[fe.id]&&delete this.keyCache[fe.id];for(const fe of X)delete this.keyCache[fe],delete this._layerConfigs[fe],delete this._layers[fe];this.familiesBySource={};const ae=function(fe,xe){const Se={};for(let re=0;re<fe.length;re++){const ne=xe&&xe[fe[re].id]||Ht(fe[re]);xe&&(xe[fe[re].id]=ne);let Q=Se[ne];Q||(Q=Se[ne]=[]),Q.push(fe[re])}const Ce=[];for(const re in Se)Ce.push(Se[re]);return Ce}(c.values(this._layerConfigs),this.keyCache);for(const fe of ae){const xe=fe.map(ve=>this._layers[ve.id]),Se=xe[0];if("none"===Se.visibility)continue;const Ce=Se.source||"";let re=this.familiesBySource[Ce];re||(re=this.familiesBySource[Ce]={});const ne=Se.sourceLayer||"_geojsonTileLayer";let Q=re[ne];Q||(Q=re[ne]=[]),Q.push(xe)}}}class kt{loadTile(H,X){const{uid:ae,encoding:fe,rawImageData:xe,padding:Se,buildQuadTree:Ce}=H,re=c.window.ImageBitmap&&xe instanceof c.window.ImageBitmap?this.getImageData(xe,Se):xe;X(null,new c.DEMData(ae,re,fe,Se<1,Ce))}getImageData(H,X){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(H.width,H.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=H.width,this.offscreenCanvas.height=H.height,this.offscreenCanvasContext.drawImage(H,0,0,H.width,H.height);const ae=this.offscreenCanvasContext.getImageData(-X,-X,H.width+2*X,H.height+2*X);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ae}}var bt=function le(H,X){var ae,fe=H&&H.type;if("FeatureCollection"===fe)for(ae=0;ae<H.features.length;ae++)le(H.features[ae],X);else if("GeometryCollection"===fe)for(ae=0;ae<H.geometries.length;ae++)le(H.geometries[ae],X);else if("Feature"===fe)le(H.geometry,X);else if("Polygon"===fe)gt(H.coordinates,X);else if("MultiPolygon"===fe)for(ae=0;ae<H.coordinates.length;ae++)gt(H.coordinates[ae],X);return H};function gt(le,H){if(0!==le.length){Je(le[0],H);for(var X=1;X<le.length;X++)Je(le[X],!H)}}function Je(le,H){for(var X=0,ae=0,fe=0,xe=le.length,Se=xe-1;fe<xe;Se=fe++){var Ce=(le[fe][0]-le[Se][0])*(le[Se][1]+le[fe][1]),re=X+Ce;ae+=Math.abs(X)>=Math.abs(Ce)?X-re+Ce:Ce-re+X,X=re}X+ae>=0!=!!H&&le.reverse()}const Pt=c.VectorTileFeature.prototype.toGeoJSON;class sn{constructor(H){this._feature=H,this.extent=c.EXTENT,this.type=H.type,this.properties=H.tags,"id"in H&&!isNaN(H.id)&&(this.id=parseInt(H.id,10))}loadGeometry(){if(1===this._feature.type){const H=[];for(const X of this._feature.geometry)H.push([new c.pointGeometry(X[0],X[1])]);return H}{const H=[];for(const X of this._feature.geometry){const ae=[];for(const fe of X)ae.push(new c.pointGeometry(fe[0],fe[1]));H.push(ae)}return H}}toGeoJSON(H,X,ae){return Pt.call(this,H,X,ae)}}class _t{constructor(H){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=c.EXTENT,this.length=H.length,this._features=H}feature(H){return new sn(this._features[H])}}var Qt={exports:{}},nn=c.pointGeometry,Ut=c.vectorTile.VectorTileFeature,Qe=sr;function sr(le,H){this.options=H||{},this.features=le,this.length=le.length}function jt(le,H){this.id="number"==typeof le.id?le.id:void 0,this.type=le.type,this.rawGeometry=1===le.type?[le.geometry]:le.geometry,this.properties=le.tags,this.extent=H||4096}sr.prototype.feature=function(le){return new jt(this.features[le],this.options.extent)},jt.prototype.loadGeometry=function(){var le=this.rawGeometry;this.geometry=[];for(var H=0;H<le.length;H++){for(var X=le[H],ae=[],fe=0;fe<X.length;fe++)ae.push(new nn(X[fe][0],X[fe][1]));this.geometry.push(ae)}return this.geometry},jt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var le=this.geometry,H=1/0,X=-1/0,ae=1/0,fe=-1/0,xe=0;xe<le.length;xe++)for(var Se=le[xe],Ce=0;Ce<Se.length;Ce++){var re=Se[Ce];H=Math.min(H,re.x),X=Math.max(X,re.x),ae=Math.min(ae,re.y),fe=Math.max(fe,re.y)}return[H,ae,X,fe]},jt.prototype.toGeoJSON=Ut.prototype.toGeoJSON;var $t=c.pbf,qe=Qe;function Xt(le){var H=new $t;return function(X,ae){for(var fe in X.layers)ae.writeMessage(3,ar,X.layers[fe])}(le,H),H.finish()}function ar(le,H){var X;H.writeVarintField(15,le.version||1),H.writeStringField(1,le.name||""),H.writeVarintField(5,le.extent||4096);var ae={keys:[],values:[],keycache:{},valuecache:{}};for(X=0;X<le.length;X++)ae.feature=le.feature(X),H.writeMessage(2,ut,ae);var fe=ae.keys;for(X=0;X<fe.length;X++)H.writeStringField(3,fe[X]);var xe=ae.values;for(X=0;X<xe.length;X++)H.writeMessage(4,Nn,xe[X])}function ut(le,H){var X=le.feature;void 0!==X.id&&H.writeVarintField(1,X.id),H.writeMessage(2,Bt,le),H.writeVarintField(3,X.type),H.writeMessage(4,cn,X)}function Bt(le,H){var X=le.feature,ae=le.keys,fe=le.values,xe=le.keycache,Se=le.valuecache;for(var Ce in X.properties){var re=X.properties[Ce],ne=xe[Ce];if(null!==re){void 0===ne&&(ae.push(Ce),xe[Ce]=ne=ae.length-1),H.writeVarint(ne);var Q=typeof re;"string"!==Q&&"boolean"!==Q&&"number"!==Q&&(re=JSON.stringify(re));var ve=Q+":"+re,we=Se[ve];void 0===we&&(fe.push(re),Se[ve]=we=fe.length-1),H.writeVarint(we)}}}function wt(le,H){return(H<<3)+(7&le)}function tt(le){return le<<1^le>>31}function cn(le,H){for(var X=le.loadGeometry(),ae=le.type,fe=0,xe=0,Se=X.length,Ce=0;Ce<Se;Ce++){var re=X[Ce],ne=1;1===ae&&(ne=re.length),H.writeVarint(wt(1,ne));for(var Q=3===ae?re.length-1:re.length,ve=0;ve<Q;ve++){1===ve&&1!==ae&&H.writeVarint(wt(2,Q-1));var we=re[ve].x-fe,lt=re[ve].y-xe;H.writeVarint(tt(we)),H.writeVarint(tt(lt)),fe+=we,xe+=lt}3===ae&&H.writeVarint(wt(7,1))}}function Nn(le,H){var X=typeof le;"string"===X?H.writeStringField(1,le):"boolean"===X?H.writeBooleanField(7,le):"number"===X&&(le%1!=0?H.writeDoubleField(3,le):le<0?H.writeSVarintField(6,le):H.writeVarintField(5,le))}function Jt(le,H,X,ae,fe,xe){if(fe-ae<=X)return;const Se=ae+fe>>1;We(le,H,Se,ae,fe,xe%2),Jt(le,H,X,ae,Se-1,xe+1),Jt(le,H,X,Se+1,fe,xe+1)}function We(le,H,X,ae,fe,xe){for(;fe>ae;){if(fe-ae>600){const ne=fe-ae+1,Q=X-ae+1,ve=Math.log(ne),we=.5*Math.exp(2*ve/3),lt=.5*Math.sqrt(ve*we*(ne-we)/ne)*(Q-ne/2<0?-1:1);We(le,H,X,Math.max(ae,Math.floor(X-Q*we/ne+lt)),Math.min(fe,Math.floor(X+(ne-Q)*we/ne+lt)),xe)}const Se=H[2*X+xe];let Ce=ae,re=fe;for(Ue(le,H,ae,X),H[2*fe+xe]>Se&&Ue(le,H,ae,fe);Ce<re;){for(Ue(le,H,Ce,re),Ce++,re--;H[2*Ce+xe]<Se;)Ce++;for(;H[2*re+xe]>Se;)re--}H[2*ae+xe]===Se?Ue(le,H,ae,re):(re++,Ue(le,H,re,fe)),re<=X&&(ae=re+1),X<=re&&(fe=re-1)}}function Ue(le,H,X,ae){it(le,X,ae),it(H,2*X,2*ae),it(H,2*X+1,2*ae+1)}function it(le,H,X){const ae=le[H];le[H]=le[X],le[X]=ae}function ht(le,H,X,ae){const fe=le-X,xe=H-ae;return fe*fe+xe*xe}Qt.exports=Xt,Qt.exports.fromVectorTileJs=Xt,Qt.exports.fromGeojsonVt=function(le,H){H=H||{};var X={};for(var ae in le)X[ae]=new qe(le[ae].features,H),X[ae].name=ae,X[ae].version=H.version,X[ae].extent=H.extent;return Xt({layers:X})},Qt.exports.GeoJSONWrapper=qe;const Lt=le=>le[0],at=le=>le[1];class dn{constructor(H,X=Lt,ae=at,fe=64,xe=Float64Array){this.nodeSize=fe,this.points=H;const Se=H.length<65536?Uint16Array:Uint32Array,Ce=this.ids=new Se(H.length),re=this.coords=new xe(2*H.length);for(let ne=0;ne<H.length;ne++)Ce[ne]=ne,re[2*ne]=X(H[ne]),re[2*ne+1]=ae(H[ne]);Jt(Ce,re,fe,0,Ce.length-1,0)}range(H,X,ae,fe){return function(xe,Se,Ce,re,ne,Q,ve){const we=[0,xe.length-1,0],lt=[];let mt,Ct;for(;we.length;){const yt=we.pop(),xn=we.pop(),On=we.pop();if(xn-On<=ve){for(let Kn=On;Kn<=xn;Kn++)mt=Se[2*Kn],Ct=Se[2*Kn+1],mt>=Ce&&mt<=ne&&Ct>=re&&Ct<=Q&&lt.push(xe[Kn]);continue}const Kt=Math.floor((On+xn)/2);mt=Se[2*Kt],Ct=Se[2*Kt+1],mt>=Ce&&mt<=ne&&Ct>=re&&Ct<=Q&&lt.push(xe[Kt]);const lr=(yt+1)%2;(0===yt?Ce<=mt:re<=Ct)&&(we.push(On),we.push(Kt-1),we.push(lr)),(0===yt?ne>=mt:Q>=Ct)&&(we.push(Kt+1),we.push(xn),we.push(lr))}return lt}(this.ids,this.coords,H,X,ae,fe,this.nodeSize)}within(H,X,ae){return function(fe,xe,Se,Ce,re,ne){const Q=[0,fe.length-1,0],ve=[],we=re*re;for(;Q.length;){const lt=Q.pop(),mt=Q.pop(),Ct=Q.pop();if(mt-Ct<=ne){for(let lr=Ct;lr<=mt;lr++)ht(xe[2*lr],xe[2*lr+1],Se,Ce)<=we&&ve.push(fe[lr]);continue}const yt=Math.floor((Ct+mt)/2),xn=xe[2*yt],On=xe[2*yt+1];ht(xn,On,Se,Ce)<=we&&ve.push(fe[yt]);const Kt=(lt+1)%2;(0===lt?Se-re<=xn:Ce-re<=On)&&(Q.push(Ct),Q.push(yt-1),Q.push(Kt)),(0===lt?Se+re>=xn:Ce+re>=On)&&(Q.push(yt+1),Q.push(mt),Q.push(Kt))}return ve}(this.ids,this.coords,H,X,ae,this.nodeSize)}}const qn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:le=>le},Un=Math.fround||(en=new Float32Array(1),le=>(en[0]=+le,en[0]));var en;class jn{constructor(H){this.options=si(Object.create(qn),H),this.trees=new Array(this.options.maxZoom+1)}load(H){const{log:X,minZoom:ae,maxZoom:fe,nodeSize:xe}=this.options;X&&console.time("total time");const Se=`prepare ${H.length} points`;X&&console.time(Se),this.points=H;let Ce=[];for(let re=0;re<H.length;re++)H[re].geometry&&Ce.push(tr(H[re],re));this.trees[fe+1]=new dn(Ce,Vn,Ni,xe,Float32Array),X&&console.timeEnd(Se);for(let re=fe;re>=ae;re--){const ne=+Date.now();Ce=this._cluster(Ce,re),this.trees[re]=new dn(Ce,Vn,Ni,xe,Float32Array),X&&console.log("z%d: %d clusters in %dms",re,Ce.length,+Date.now()-ne)}return X&&console.timeEnd("total time"),this}getClusters(H,X){let ae=((H[0]+180)%360+360)%360-180;const fe=Math.max(-90,Math.min(90,H[1]));let xe=180===H[2]?180:((H[2]+180)%360+360)%360-180;const Se=Math.max(-90,Math.min(90,H[3]));if(H[2]-H[0]>=360)ae=-180,xe=180;else if(ae>xe){const Q=this.getClusters([ae,fe,180,Se],X),ve=this.getClusters([-180,fe,xe,Se],X);return Q.concat(ve)}const Ce=this.trees[this._limitZoom(X)],re=Ce.range(zt(ae),Xr(Se),zt(xe),Xr(fe)),ne=[];for(const Q of re){const ve=Ce.points[Q];ne.push(ve.numPoints?vn(ve):this.points[ve.index])}return ne}getChildren(H){const X=this._getOriginId(H),ae=this._getOriginZoom(H),fe="No cluster with the specified id.",xe=this.trees[ae];if(!xe)throw new Error(fe);const Se=xe.points[X];if(!Se)throw new Error(fe);const Ce=this.options.radius/(this.options.extent*Math.pow(2,ae-1)),re=xe.within(Se.x,Se.y,Ce),ne=[];for(const Q of re){const ve=xe.points[Q];ve.parentId===H&&ne.push(ve.numPoints?vn(ve):this.points[ve.index])}if(0===ne.length)throw new Error(fe);return ne}getLeaves(H,X,ae){const fe=[];return this._appendLeaves(fe,H,X=X||10,ae=ae||0,0),fe}getTile(H,X,ae){const fe=this.trees[this._limitZoom(H)],xe=Math.pow(2,H),{extent:Se,radius:Ce}=this.options,re=Ce/Se,ne=(ae-re)/xe,Q=(ae+1+re)/xe,ve={features:[]};return this._addTileFeatures(fe.range((X-re)/xe,ne,(X+1+re)/xe,Q),fe.points,X,ae,xe,ve),0===X&&this._addTileFeatures(fe.range(1-re/xe,ne,1,Q),fe.points,xe,ae,xe,ve),X===xe-1&&this._addTileFeatures(fe.range(0,ne,re/xe,Q),fe.points,-1,ae,xe,ve),ve.features.length?ve:null}getClusterExpansionZoom(H){let X=this._getOriginZoom(H)-1;for(;X<=this.options.maxZoom;){const ae=this.getChildren(H);if(X++,1!==ae.length)break;H=ae[0].properties.cluster_id}return X}_appendLeaves(H,X,ae,fe,xe){const Se=this.getChildren(X);for(const Ce of Se){const re=Ce.properties;if(re&&re.cluster?xe+re.point_count<=fe?xe+=re.point_count:xe=this._appendLeaves(H,re.cluster_id,ae,fe,xe):xe<fe?xe++:H.push(Ce),H.length===ae)break}return xe}_addTileFeatures(H,X,ae,fe,xe,Se){for(const Ce of H){const re=X[Ce],ne=re.numPoints;let Q,ve,we;if(ne)Q=nr(re),ve=re.x,we=re.y;else{const Ct=this.points[re.index];Q=Ct.properties,ve=zt(Ct.geometry.coordinates[0]),we=Xr(Ct.geometry.coordinates[1])}const lt={type:1,geometry:[[Math.round(this.options.extent*(ve*xe-ae)),Math.round(this.options.extent*(we*xe-fe))]],tags:Q};let mt;ne?mt=re.id:this.options.generateId?mt=re.index:this.points[re.index].id&&(mt=this.points[re.index].id),void 0!==mt&&(lt.id=mt),Se.features.push(lt)}}_limitZoom(H){return Math.max(this.options.minZoom,Math.min(Math.floor(+H),this.options.maxZoom+1))}_cluster(H,X){const ae=[],{radius:fe,extent:xe,reduce:Se,minPoints:Ce}=this.options,re=fe/(xe*Math.pow(2,X));for(let ne=0;ne<H.length;ne++){const Q=H[ne];if(Q.zoom<=X)continue;Q.zoom=X;const ve=this.trees[X+1],we=ve.within(Q.x,Q.y,re),lt=Q.numPoints||1;let mt=lt;for(const Ct of we){const yt=ve.points[Ct];yt.zoom>X&&(mt+=yt.numPoints||1)}if(mt>lt&&mt>=Ce){let Ct=Q.x*lt,yt=Q.y*lt,xn=Se&&lt>1?this._map(Q,!0):null;const On=(ne<<5)+(X+1)+this.points.length;for(const Kt of we){const lr=ve.points[Kt];if(lr.zoom<=X)continue;lr.zoom=X;const Kn=lr.numPoints||1;Ct+=lr.x*Kn,yt+=lr.y*Kn,lr.parentId=On,Se&&(xn||(xn=this._map(Q,!0)),Se(xn,this._map(lr)))}Q.parentId=On,ae.push(Ln(Ct/mt,yt/mt,On,mt,xn))}else if(ae.push(Q),mt>1)for(const Ct of we){const yt=ve.points[Ct];yt.zoom<=X||(yt.zoom=X,ae.push(yt))}}return ae}_getOriginId(H){return H-this.points.length>>5}_getOriginZoom(H){return(H-this.points.length)%32}_map(H,X){if(H.numPoints)return X?si({},H.properties):H.properties;const ae=this.points[H.index].properties,fe=this.options.map(ae);return X&&fe===ae?si({},fe):fe}}function Ln(le,H,X,ae,fe){return{x:Un(le),y:Un(H),zoom:1/0,id:X,parentId:-1,numPoints:ae,properties:fe}}function tr(le,H){const[X,ae]=le.geometry.coordinates;return{x:Un(zt(X)),y:Un(Xr(ae)),zoom:1/0,index:H,parentId:-1}}function vn(le){return{type:"Feature",id:le.id,properties:nr(le),geometry:{type:"Point",coordinates:[(H=le.x,360*(H-.5)),ni(le.y)]}};var H}function nr(le){const H=le.numPoints,X=H>=1e4?`${Math.round(H/1e3)}k`:H>=1e3?Math.round(H/100)/10+"k":H;return si(si({},le.properties),{cluster:!0,cluster_id:le.id,point_count:H,point_count_abbreviated:X})}function zt(le){return le/360+.5}function Xr(le){const H=Math.sin(le*Math.PI/180),X=.5-.25*Math.log((1+H)/(1-H))/Math.PI;return X<0?0:X>1?1:X}function ni(le){const H=(180-360*le)*Math.PI/180;return 360*Math.atan(Math.exp(H))/Math.PI-90}function si(le,H){for(const X in H)le[X]=H[X];return le}function Vn(le){return le.x}function Ni(le){return le.y}function Wi(le,H,X,ae){for(var fe,xe=ae,Se=X-H>>1,Ce=X-H,re=le[H],ne=le[H+1],Q=le[X],ve=le[X+1],we=H+3;we<X;we+=3){var lt=Br(le[we],le[we+1],re,ne,Q,ve);if(lt>xe)fe=we,xe=lt;else if(lt===xe){var mt=Math.abs(we-Se);mt<Ce&&(fe=we,Ce=mt)}}xe>ae&&(fe-H>3&&Wi(le,H,fe,ae),le[fe+2]=xe,X-fe>3&&Wi(le,fe,X,ae))}function Br(le,H,X,ae,fe,xe){var Se=fe-X,Ce=xe-ae;if(0!==Se||0!==Ce){var re=((le-X)*Se+(H-ae)*Ce)/(Se*Se+Ce*Ce);re>1?(X=fe,ae=xe):re>0&&(X+=Se*re,ae+=Ce*re)}return(Se=le-X)*Se+(Ce=H-ae)*Ce}function Vr(le,H,X,ae){var fe={id:void 0===le?null:le,type:H,geometry:X,tags:ae,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(xe){var Se=xe.geometry,Ce=xe.type;if("Point"===Ce||"MultiPoint"===Ce||"LineString"===Ce)yo(xe,Se);else if("Polygon"===Ce||"MultiLineString"===Ce)for(var re=0;re<Se.length;re++)yo(xe,Se[re]);else if("MultiPolygon"===Ce)for(re=0;re<Se.length;re++)for(var ne=0;ne<Se[re].length;ne++)yo(xe,Se[re][ne])}(fe),fe}function yo(le,H){for(var X=0;X<H.length;X+=3)le.minX=Math.min(le.minX,H[X]),le.minY=Math.min(le.minY,H[X+1]),le.maxX=Math.max(le.maxX,H[X]),le.maxY=Math.max(le.maxY,H[X+1])}function rs(le,H,X,ae){if(H.geometry){var fe=H.geometry.coordinates,xe=H.geometry.type,Se=Math.pow(X.tolerance/((1<<X.maxZoom)*X.extent),2),Ce=[],re=H.id;if(X.promoteId?re=H.properties[X.promoteId]:X.generateId&&(re=ae||0),"Point"===xe)Vs(fe,Ce);else if("MultiPoint"===xe)for(var ne=0;ne<fe.length;ne++)Vs(fe[ne],Ce);else if("LineString"===xe)vo(fe,Ce,Se,!1);else if("MultiLineString"===xe){if(X.lineMetrics){for(ne=0;ne<fe.length;ne++)vo(fe[ne],Ce=[],Se,!1),le.push(Vr(re,"LineString",Ce,H.properties));return}ai(fe,Ce,Se,!1)}else if("Polygon"===xe)ai(fe,Ce,Se,!0);else{if("MultiPolygon"!==xe){if("GeometryCollection"===xe){for(ne=0;ne<H.geometry.geometries.length;ne++)rs(le,{id:re,geometry:H.geometry.geometries[ne],properties:H.properties},X,ae);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ne=0;ne<fe.length;ne++){var Q=[];ai(fe[ne],Q,Se,!0),Ce.push(Q)}}le.push(Vr(re,xe,Ce,H.properties))}}function Vs(le,H){H.push(yn(le[0])),H.push(fr(le[1])),H.push(0)}function vo(le,H,X,ae){for(var fe,xe,Se=0,Ce=0;Ce<le.length;Ce++){var re=yn(le[Ce][0]),ne=fr(le[Ce][1]);H.push(re),H.push(ne),H.push(0),Ce>0&&(Se+=ae?(fe*ne-re*xe)/2:Math.sqrt(Math.pow(re-fe,2)+Math.pow(ne-xe,2))),fe=re,xe=ne}var Q=H.length-3;H[2]=1,Wi(H,0,Q,X),H[Q+2]=1,H.size=Math.abs(Se),H.start=0,H.end=H.size}function ai(le,H,X,ae){for(var fe=0;fe<le.length;fe++){var xe=[];vo(le[fe],xe,X,ae),H.push(xe)}}function yn(le){return le/360+.5}function fr(le){var H=Math.sin(le*Math.PI/180),X=.5-.25*Math.log((1+H)/(1-H))/Math.PI;return X<0?0:X>1?1:X}function rn(le,H,X,ae,fe,xe,Se,Ce){if(ae/=H,xe>=(X/=H)&&Se<ae)return le;if(Se<X||xe>=ae)return null;for(var re=[],ne=0;ne<le.length;ne++){var Q=le[ne],ve=Q.geometry,we=Q.type,lt=0===fe?Q.minX:Q.minY,mt=0===fe?Q.maxX:Q.maxY;if(lt>=X&&mt<ae)re.push(Q);else if(!(mt<X||lt>=ae)){var Ct=[];if("Point"===we||"MultiPoint"===we)Et(ve,Ct,X,ae,fe);else if("LineString"===we)xo(ve,Ct,X,ae,fe,!1,Ce.lineMetrics);else if("MultiLineString"===we)$n(ve,Ct,X,ae,fe,!1);else if("Polygon"===we)$n(ve,Ct,X,ae,fe,!0);else if("MultiPolygon"===we)for(var yt=0;yt<ve.length;yt++){var xn=[];$n(ve[yt],xn,X,ae,fe,!0),xn.length&&Ct.push(xn)}if(Ct.length){if(Ce.lineMetrics&&"LineString"===we){for(yt=0;yt<Ct.length;yt++)re.push(Vr(Q.id,we,Ct[yt],Q.tags));continue}"LineString"!==we&&"MultiLineString"!==we||(1===Ct.length?(we="LineString",Ct=Ct[0]):we="MultiLineString"),"Point"!==we&&"MultiPoint"!==we||(we=3===Ct.length?"Point":"MultiPoint"),re.push(Vr(Q.id,we,Ct,Q.tags))}}}return re.length?re:null}function Et(le,H,X,ae,fe){for(var xe=0;xe<le.length;xe+=3){var Se=le[xe+fe];Se>=X&&Se<=ae&&(H.push(le[xe]),H.push(le[xe+1]),H.push(le[xe+2]))}}function xo(le,H,X,ae,fe,xe,Se){for(var Ce,re,ne=Yr(le),Q=0===fe?li:mr,ve=le.start,we=0;we<le.length-3;we+=3){var lt=le[we],mt=le[we+1],Ct=le[we+2],yt=le[we+3],xn=le[we+4],On=0===fe?lt:mt,Kt=0===fe?yt:xn,lr=!1;Se&&(Ce=Math.sqrt(Math.pow(lt-yt,2)+Math.pow(mt-xn,2))),On<X?Kt>X&&(re=Q(ne,lt,mt,yt,xn,X),Se&&(ne.start=ve+Ce*re)):On>ae?Kt<ae&&(re=Q(ne,lt,mt,yt,xn,ae),Se&&(ne.start=ve+Ce*re)):oo(ne,lt,mt,Ct),Kt<X&&On>=X&&(re=Q(ne,lt,mt,yt,xn,X),lr=!0),Kt>ae&&On<=ae&&(re=Q(ne,lt,mt,yt,xn,ae),lr=!0),!xe&&lr&&(Se&&(ne.end=ve+Ce*re),H.push(ne),ne=Yr(le)),Se&&(ve+=Ce)}var Kn=le.length-3;lt=le[Kn],mt=le[Kn+1],Ct=le[Kn+2],(On=0===fe?lt:mt)>=X&&On<=ae&&oo(ne,lt,mt,Ct),Kn=ne.length-3,xe&&Kn>=3&&(ne[Kn]!==ne[0]||ne[Kn+1]!==ne[1])&&oo(ne,ne[0],ne[1],ne[2]),ne.length&&H.push(ne)}function Yr(le){var H=[];return H.size=le.size,H.start=le.start,H.end=le.end,H}function $n(le,H,X,ae,fe,xe){for(var Se=0;Se<le.length;Se++)xo(le[Se],H,X,ae,fe,xe,!1)}function oo(le,H,X,ae){le.push(H),le.push(X),le.push(ae)}function li(le,H,X,ae,fe,xe){var Se=(xe-H)/(ae-H);return le.push(xe),le.push(X+(fe-X)*Se),le.push(1),Se}function mr(le,H,X,ae,fe,xe){var Se=(xe-X)/(fe-X);return le.push(H+(ae-H)*Se),le.push(xe),le.push(1),Se}function Dr(le,H){for(var X=[],ae=0;ae<le.length;ae++){var fe,xe=le[ae],Se=xe.type;if("Point"===Se||"MultiPoint"===Se||"LineString"===Se)fe=Nr(xe.geometry,H);else if("MultiLineString"===Se||"Polygon"===Se){fe=[];for(var Ce=0;Ce<xe.geometry.length;Ce++)fe.push(Nr(xe.geometry[Ce],H))}else if("MultiPolygon"===Se)for(fe=[],Ce=0;Ce<xe.geometry.length;Ce++){for(var re=[],ne=0;ne<xe.geometry[Ce].length;ne++)re.push(Nr(xe.geometry[Ce][ne],H));fe.push(re)}X.push(Vr(xe.id,Se,fe,xe.tags))}return X}function Nr(le,H){var X=[];X.size=le.size,void 0!==le.start&&(X.start=le.start,X.end=le.end);for(var ae=0;ae<le.length;ae+=3)X.push(le[ae]+H,le[ae+1],le[ae+2]);return X}function Gn(le,H){if(le.transformed)return le;var X,ae,fe,xe=1<<le.z,Se=le.x,Ce=le.y;for(X=0;X<le.features.length;X++){var re=le.features[X],ne=re.geometry,Q=re.type;if(re.geometry=[],1===Q)for(ae=0;ae<ne.length;ae+=2)re.geometry.push(Kr(ne[ae],ne[ae+1],H,xe,Se,Ce));else for(ae=0;ae<ne.length;ae++){var ve=[];for(fe=0;fe<ne[ae].length;fe+=2)ve.push(Kr(ne[ae][fe],ne[ae][fe+1],H,xe,Se,Ce));re.geometry.push(ve)}}return le.transformed=!0,le}function Kr(le,H,X,ae,fe,xe){return[Math.round(X*(le*ae-fe)),Math.round(X*(H*ae-xe))]}function so(le,H,X,ae,fe){for(var xe=H===fe.maxZoom?0:fe.tolerance/((1<<H)*fe.extent),Se={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:X,y:ae,z:H,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Ce=0;Ce<le.length;Ce++){Se.numFeatures++,Zo(Se,le[Ce],xe,fe);var re=le[Ce].minX,ne=le[Ce].minY,Q=le[Ce].maxX,ve=le[Ce].maxY;re<Se.minX&&(Se.minX=re),ne<Se.minY&&(Se.minY=ne),Q>Se.maxX&&(Se.maxX=Q),ve>Se.maxY&&(Se.maxY=ve)}return Se}function Zo(le,H,X,ae){var fe=H.geometry,xe=H.type,Se=[];if("Point"===xe||"MultiPoint"===xe)for(var Ce=0;Ce<fe.length;Ce+=3)Se.push(fe[Ce]),Se.push(fe[Ce+1]),le.numPoints++,le.numSimplified++;else if("LineString"===xe)bo(Se,fe,le,X,!1,!1);else if("MultiLineString"===xe||"Polygon"===xe)for(Ce=0;Ce<fe.length;Ce++)bo(Se,fe[Ce],le,X,"Polygon"===xe,0===Ce);else if("MultiPolygon"===xe)for(var re=0;re<fe.length;re++){var ne=fe[re];for(Ce=0;Ce<ne.length;Ce++)bo(Se,ne[Ce],le,X,!0,0===Ce)}if(Se.length){var Q=H.tags||null;if("LineString"===xe&&ae.lineMetrics){for(var ve in Q={},H.tags)Q[ve]=H.tags[ve];Q.mapbox_clip_start=fe.start/fe.size,Q.mapbox_clip_end=fe.end/fe.size}var we={geometry:Se,type:"Polygon"===xe||"MultiPolygon"===xe?3:"LineString"===xe||"MultiLineString"===xe?2:1,tags:Q};null!==H.id&&(we.id=H.id),le.features.push(we)}}function bo(le,H,X,ae,fe,xe){var Se=ae*ae;if(ae>0&&H.size<(fe?Se:ae))X.numPoints+=H.length/3;else{for(var Ce=[],re=0;re<H.length;re+=3)(0===ae||H[re+2]>Se)&&(X.numSimplified++,Ce.push(H[re]),Ce.push(H[re+1])),X.numPoints++;fe&&function(ne,Q){for(var ve=0,we=0,lt=ne.length,mt=lt-2;we<lt;mt=we,we+=2)ve+=(ne[we]-ne[mt])*(ne[we+1]+ne[mt+1]);if(ve>0===Q)for(we=0,lt=ne.length;we<lt/2;we+=2){var Ct=ne[we],yt=ne[we+1];ne[we]=ne[lt-2-we],ne[we+1]=ne[lt-1-we],ne[lt-2-we]=Ct,ne[lt-1-we]=yt}}(Ce,xe),le.push(Ce)}}function is(le,H){var X=(H=this.options=function(fe,xe){for(var Se in xe)fe[Se]=xe[Se];return fe}(Object.create(this.options),H)).debug;if(X&&console.time("preprocess data"),H.maxZoom<0||H.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(H.promoteId&&H.generateId)throw new Error("promoteId and generateId cannot be used together.");var fe,xe,Se,Ce,re,ne,ae=function(fe,xe){var Se=[];if("FeatureCollection"===fe.type)for(var Ce=0;Ce<fe.features.length;Ce++)rs(Se,fe.features[Ce],xe,Ce);else rs(Se,"Feature"===fe.type?fe:{geometry:fe},xe);return Se}(le,H);this.tiles={},this.tileCoords=[],X&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",H.indexMaxZoom,H.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Ce=fe=ae,re=rn(fe,1,-1-(Se=(xe=H).buffer/xe.extent),Se,0,-1,2,xe),ne=rn(fe,1,1-Se,2+Se,0,-1,2,xe),(re||ne)&&(Ce=rn(fe,1,-Se,1+Se,0,-1,2,xe)||[],re&&(Ce=Dr(re,1).concat(Ce)),ne&&(Ce=Ce.concat(Dr(ne,-1)))),(ae=Ce).length&&this.splitTile(ae,0,0,0),X&&(ae.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function qo(le,H,X){return 32*((1<<le)*X+H)+le}function Ei(le,H){const X=le.tileID.canonical;if(!this._geoJSONIndex)return H(null,null);const ae=this._geoJSONIndex.getTile(X.z,X.x,X.y);if(!ae)return H(null,null);const fe=new _t(ae.features);let xe=Qt.exports(fe);0===xe.byteOffset&&xe.byteLength===xe.buffer.byteLength||(xe=new Uint8Array(xe)),H(null,{vectorTile:fe,rawData:xe.buffer})}is.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},is.prototype.splitTile=function(le,H,X,ae,fe,xe,Se){for(var Ce=[le,H,X,ae],re=this.options,ne=re.debug;Ce.length;){ae=Ce.pop(),X=Ce.pop(),H=Ce.pop(),le=Ce.pop();var Q=1<<H,ve=qo(H,X,ae),we=this.tiles[ve];if(!we&&(ne>1&&console.time("creation"),we=this.tiles[ve]=so(le,H,X,ae,re),this.tileCoords.push({z:H,x:X,y:ae}),ne)){ne>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",H,X,ae,we.numFeatures,we.numPoints,we.numSimplified),console.timeEnd("creation"));var lt="z"+H;this.stats[lt]=(this.stats[lt]||0)+1,this.total++}if(we.source=le,fe){if(H===re.maxZoom||H===fe)continue;var mt=1<<fe-H;if(X!==Math.floor(xe/mt)||ae!==Math.floor(Se/mt))continue}else if(H===re.indexMaxZoom||we.numPoints<=re.indexMaxPoints)continue;if(we.source=null,0!==le.length){ne>1&&console.time("clipping");var Ct,yt,xn,On,Kt,lr,Kn=.5*re.buffer/re.extent,mi=.5-Kn,os=.5+Kn,Di=1+Kn;Ct=yt=xn=On=null,Kt=rn(le,Q,X-Kn,X+os,0,we.minX,we.maxX,re),lr=rn(le,Q,X+mi,X+Di,0,we.minX,we.maxX,re),le=null,Kt&&(Ct=rn(Kt,Q,ae-Kn,ae+os,1,we.minY,we.maxY,re),yt=rn(Kt,Q,ae+mi,ae+Di,1,we.minY,we.maxY,re),Kt=null),lr&&(xn=rn(lr,Q,ae-Kn,ae+os,1,we.minY,we.maxY,re),On=rn(lr,Q,ae+mi,ae+Di,1,we.minY,we.maxY,re),lr=null),ne>1&&console.timeEnd("clipping"),Ce.push(Ct||[],H+1,2*X,2*ae),Ce.push(yt||[],H+1,2*X,2*ae+1),Ce.push(xn||[],H+1,2*X+1,2*ae),Ce.push(On||[],H+1,2*X+1,2*ae+1)}}},is.prototype.getTile=function(le,H,X){var ae=this.options,fe=ae.extent,xe=ae.debug;if(le<0||le>24)return null;var Se=1<<le,Ce=qo(le,H=(H%Se+Se)%Se,X);if(this.tiles[Ce])return Gn(this.tiles[Ce],fe);xe>1&&console.log("drilling down to z%d-%d-%d",le,H,X);for(var re,ne=le,Q=H,ve=X;!re&&ne>0;)ne--,Q=Math.floor(Q/2),ve=Math.floor(ve/2),re=this.tiles[qo(ne,Q,ve)];return re&&re.source?(xe>1&&console.log("found parent tile z%d-%d-%d",ne,Q,ve),xe>1&&console.time("drilling down"),this.splitTile(re.source,ne,Q,ve,le,H,X),xe>1&&console.timeEnd("drilling down"),this.tiles[Ce]?Gn(this.tiles[Ce],fe):null):null};class pi extends c.VectorTileWorkerSource{constructor(H,X,ae,fe,xe){super(H,X,ae,fe,Ei),xe&&(this.loadGeoJSON=xe)}loadData(H,X){const ae=H&&H.request,fe=ae&&ae.collectResourceTiming;this.loadGeoJSON(H,(xe,Se)=>{if(xe||!Se)return X(xe);if("object"!=typeof Se)return X(new Error(`Input data given to '${H.source}' is not a valid GeoJSON object.`));{bt(Se,!0);try{if(H.filter){const re=c.createExpression(H.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===re.result)throw new Error(re.value.map(Q=>`${Q.key}: ${Q.message}`).join(", "));Se={type:"FeatureCollection",features:Se.features.filter(Q=>re.value.evaluate({zoom:0},Q))}}this._geoJSONIndex=H.cluster?new jn(function({superclusterOptions:re,clusterProperties:ne}){if(!ne||!re)return re;const Q={},ve={},we={accumulated:null,zoom:0},lt={properties:null},mt=Object.keys(ne);for(const Ct of mt){const[yt,xn]=ne[Ct],On=c.createExpression(xn),Kt=c.createExpression("string"==typeof yt?[yt,["accumulated"],["get",Ct]]:yt);Q[Ct]=On.value,ve[Ct]=Kt.value}return re.map=Ct=>{lt.properties=Ct;const yt={};for(const xn of mt)yt[xn]=Q[xn].evaluate(we,lt);return yt},re.reduce=(Ct,yt)=>{lt.properties=yt;for(const xn of mt)we.accumulated=Ct[xn],Ct[xn]=ve[xn].evaluate(we,lt)},re}(H)).load(Se.features):new is(re=Se,H.geojsonVtOptions)}catch(re){return X(re)}this.loaded={};const Ce={};if(fe){const re=c.getPerformanceMeasurement(ae);re&&(Ce.resourceTiming={},Ce.resourceTiming[H.source]=JSON.parse(JSON.stringify(re)))}X(null,Ce)}var re})}reloadTile(H,X){const ae=this.loaded;return ae&&ae[H.uid]?super.reloadTile(H,X):this.loadTile(H,X)}loadGeoJSON(H,X){if(H.request)c.getJSON(H.request,X);else{if("string"!=typeof H.data)return X(new Error(`Input data given to '${H.source}' is not a valid GeoJSON object.`));try{return X(null,JSON.parse(H.data))}catch{return X(new Error(`Input data given to '${H.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(H,X){try{X(null,this._geoJSONIndex.getClusterExpansionZoom(H.clusterId))}catch(ae){X(ae)}}getClusterChildren(H,X){try{X(null,this._geoJSONIndex.getChildren(H.clusterId))}catch(ae){X(ae)}}getClusterLeaves(H,X){try{X(null,this._geoJSONIndex.getLeaves(H.clusterId,H.limit,H.offset))}catch(ae){X(ae)}}}class Ui{constructor(H){this.self=H,this.actor=new c.Actor(H,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=c.getProjection({name:"mercator"}),this.workerSourceTypes={vector:c.VectorTileWorkerSource,geojson:pi},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(X,ae)=>{if(this.workerSourceTypes[X])throw new Error(`Worker source with name "${X}" already registered.`);this.workerSourceTypes[X]=ae},this.self.registerRTLTextPlugin=X=>{if(c.plugin.isParsed())throw new Error("RTL text plugin already registered.");c.plugin.applyArabicShaping=X.applyArabicShaping,c.plugin.processBidirectionalText=X.processBidirectionalText,c.plugin.processStyledBidirectionalText=X.processStyledBidirectionalText}}clearCaches(H,X,ae){delete this.layerIndexes[H],delete this.availableImages[H],delete this.workerSources[H],delete this.demWorkerSources[H],ae()}checkIfReady(H,X,ae){ae()}setReferrer(H,X){this.referrer=X}spriteLoaded(H,X){this.isSpriteLoaded[H]=X;for(const ae in this.workerSources[H]){const fe=this.workerSources[H][ae];for(const xe in fe)fe[xe]instanceof c.VectorTileWorkerSource&&(fe[xe].isSpriteLoaded=X,fe[xe].fire(new c.Event("isSpriteLoaded")))}}setImages(H,X,ae){this.availableImages[H]=X;for(const fe in this.workerSources[H]){const xe=this.workerSources[H][fe];for(const Se in xe)xe[Se].availableImages=X}ae()}enableTerrain(H,X,ae){this.terrain=X,ae()}setProjection(H,X){this.projections[H]=c.getProjection(X)}setLayers(H,X,ae){this.getLayerIndex(H).replace(X),ae()}updateLayers(H,X,ae){this.getLayerIndex(H).update(X.layers,X.removedIds),ae()}loadTile(H,X,ae){const fe=this.enableTerrain?c.extend({enableTerrain:this.terrain},X):X;fe.projection=this.projections[H]||this.defaultProjection,this.getWorkerSource(H,X.type,X.source).loadTile(fe,ae)}loadDEMTile(H,X,ae){const fe=this.enableTerrain?c.extend({buildQuadTree:this.terrain},X):X;this.getDEMWorkerSource(H,X.source).loadTile(fe,ae)}reloadTile(H,X,ae){const fe=this.enableTerrain?c.extend({enableTerrain:this.terrain},X):X;fe.projection=this.projections[H]||this.defaultProjection,this.getWorkerSource(H,X.type,X.source).reloadTile(fe,ae)}abortTile(H,X,ae){this.getWorkerSource(H,X.type,X.source).abortTile(X,ae)}removeTile(H,X,ae){this.getWorkerSource(H,X.type,X.source).removeTile(X,ae)}removeSource(H,X,ae){if(!this.workerSources[H]||!this.workerSources[H][X.type]||!this.workerSources[H][X.type][X.source])return;const fe=this.workerSources[H][X.type][X.source];delete this.workerSources[H][X.type][X.source],void 0!==fe.removeSource?fe.removeSource(X,ae):ae()}loadWorkerSource(H,X,ae){try{this.self.importScripts(X.url),ae()}catch(fe){ae(fe.toString())}}syncRTLPluginState(H,X,ae){try{c.plugin.setState(X);const fe=c.plugin.getPluginURL();if(c.plugin.isLoaded()&&!c.plugin.isParsed()&&null!=fe){this.self.importScripts(fe);const xe=c.plugin.isParsed();ae(xe?void 0:new Error(`RTL Text Plugin failed to import scripts from ${fe}`),xe)}}catch(fe){ae(fe.toString())}}getAvailableImages(H){let X=this.availableImages[H];return X||(X=[]),X}getLayerIndex(H){let X=this.layerIndexes[H];return X||(X=this.layerIndexes[H]=new Vt),X}getWorkerSource(H,X,ae){return this.workerSources[H]||(this.workerSources[H]={}),this.workerSources[H][X]||(this.workerSources[H][X]={}),this.workerSources[H][X][ae]||(this.workerSources[H][X][ae]=new this.workerSourceTypes[X]({send:(xe,Se,Ce,re,ne,Q)=>{this.actor.send(xe,Se,Ce,H,ne,Q)},scheduler:this.actor.scheduler},this.getLayerIndex(H),this.getAvailableImages(H),this.isSpriteLoaded[H])),this.workerSources[H][X][ae]}getDEMWorkerSource(H,X){return this.demWorkerSources[H]||(this.demWorkerSources[H]={}),this.demWorkerSources[H][X]||(this.demWorkerSources[H][X]=new kt),this.demWorkerSources[H][X]}enforceCacheSizeLimit(H,X){c.enforceCacheSizeLimit(X)}getWorkerPerformanceMetrics(H,X,ae){ae(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Ui(self)),Ui}),Ie(0,function(c){function Ee(h,r){if(Array.isArray(h)){if(!Array.isArray(r)||h.length!==r.length)return!1;for(let l=0;l<h.length;l++)if(!Ee(h[l],r[l]))return!1;return!0}if("object"==typeof h&&null!==h&&null!==r){if("object"!=typeof r||Object.keys(h).length!==Object.keys(r).length)return!1;for(const l in h)if(!Ee(h[l],r[l]))return!1;return!0}return h===r}var Ht=Vt;function Vt(h){return r=h,!(typeof window>"u"||typeof document>"u"||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var p,_,b=new Blob([""],{type:"text/javascript"}),S=URL.createObjectURL(b);try{_=new Worker(S),p=!0}catch{p=!1}return _&&_.terminate(),URL.revokeObjectURL(S),p}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var p=document.createElement("canvas");p.width=p.height=1;var _=p.getContext("2d");if(!_)return!1;var b=_.getImageData(0,0,1,1);return b&&b.width===p.width}()||(void 0===kt[l=r&&r.failIfMajorPerformanceCaveat]&&(kt[l]=function(p){var _,S,A,R,b=(S=p,A=document.createElement("canvas"),(R=Object.create(Vt.webGLContextAttributes)).failIfMajorPerformanceCaveat=S,A.getContext("webgl",R)||A.getContext("experimental-webgl",R));if(!b)return!1;try{_=b.createShader(b.VERTEX_SHADER)}catch{return!1}return!(!_||b.isContextLost())&&(b.shaderSource(_,"void main() {}"),b.compileShader(_),!0===b.getShaderParameter(_,b.COMPILE_STATUS))}(l)),!kt[l]||document.documentMode));var r,l}var kt={};function bt(h,r,l){const p=c.window.document.createElement(h);return void 0!==r&&(p.className=r),l&&l.appendChild(p),p}function gt(h,r,l){const p=c.window.document.createElementNS("http://www.w3.org/2000/svg",h);for(const _ of Object.keys(r))p.setAttributeNS(null,_,r[_]);return l&&l.appendChild(p),p}Vt.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const Je=c.window.document&&c.window.document.documentElement.style,Pt=Je&&void 0!==Je.userSelect?"userSelect":"WebkitUserSelect";let sn;function _t(){Je&&Pt&&(sn=Je[Pt],Je[Pt]="none")}function Qt(){Je&&Pt&&(Je[Pt]=sn)}function nn(h){h.preventDefault(),h.stopPropagation(),c.window.removeEventListener("click",nn,!0)}function Ut(){c.window.addEventListener("click",nn,!0),c.window.setTimeout(()=>{c.window.removeEventListener("click",nn,!0)},0)}function Qe(h,r){const l=h.getBoundingClientRect();return $t(h,l,r)}function sr(h,r){const l=h.getBoundingClientRect(),p=[];for(let _=0;_<r.length;_++)p.push($t(h,l,r[_]));return p}function jt(h){return void 0!==c.window.InstallTrigger&&2===h.button&&h.ctrlKey&&c.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:h.button}function $t(h,r,l){const p=h.offsetWidth===r.width?1:h.offsetWidth/r.width;return new c.pointGeometry((l.clientX-r.left)*p,(l.clientY-r.top)*p)}function qe(h,r){var l=r[0],p=r[1],_=r[2],b=r[3],S=l*b-_*p;return S?(h[0]=b*(S=1/S),h[1]=-p*S,h[2]=-_*S,h[3]=l*S,h):null}function Xt(h){const{userImage:r}=h;return!!(r&&r.render&&r.render())&&(h.data.replace(new Uint8Array(r.data.buffer)),!0)}class ar extends c.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new c.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(r){if(this.loaded!==r&&(this.loaded=r,r)){for(const{ids:l,callback:p}of this.requestors)this._notify(l,p);this.requestors=[]}}hasImage(r){return!!this.getImage(r)}getImage(r){return this.images[r]}addImage(r,l){this._validate(r,l)&&(this.images[r]=l)}_validate(r,l){let p=!0;return this._validateStretch(l.stretchX,l.data&&l.data.width)||(this.fire(new c.ErrorEvent(new Error(`Image "${r}" has invalid "stretchX" value`))),p=!1),this._validateStretch(l.stretchY,l.data&&l.data.height)||(this.fire(new c.ErrorEvent(new Error(`Image "${r}" has invalid "stretchY" value`))),p=!1),this._validateContent(l.content,l)||(this.fire(new c.ErrorEvent(new Error(`Image "${r}" has invalid "content" value`))),p=!1),p}_validateStretch(r,l){if(!r)return!0;let p=0;for(const _ of r){if(_[0]<p||_[1]<_[0]||l<_[1])return!1;p=_[1]}return!0}_validateContent(r,l){return!(r&&(4!==r.length||r[0]<0||l.data.width<r[0]||r[1]<0||l.data.height<r[1]||r[2]<0||l.data.width<r[2]||r[3]<0||l.data.height<r[3]||r[2]<r[0]||r[3]<r[1]))}updateImage(r,l){l.version=this.images[r].version+1,this.images[r]=l,this.updatedImages[r]=!0}removeImage(r){const l=this.images[r];delete this.images[r],delete this.patterns[r],l.userImage&&l.userImage.onRemove&&l.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(r,l){let p=!0;if(!this.isLoaded())for(const _ of r)this.images[_]||(p=!1);this.isLoaded()||p?this._notify(r,l):this.requestors.push({ids:r,callback:l})}_notify(r,l){const p={};for(const _ of r){this.images[_]||this.fire(new c.Event("styleimagemissing",{id:_}));const b=this.images[_];b?p[_]={data:b.data.clone(),pixelRatio:b.pixelRatio,sdf:b.sdf,version:b.version,stretchX:b.stretchX,stretchY:b.stretchY,content:b.content,hasRenderCallback:Boolean(b.userImage&&b.userImage.render)}:c.warnOnce(`Image "${_}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}l(null,p)}getPixelSize(){const{width:r,height:l}=this.atlasImage;return{width:r,height:l}}getPattern(r){const l=this.patterns[r],p=this.getImage(r);if(!p)return null;if(l&&l.position.version===p.version)return l.position;if(l)l.position.version=p.version;else{const _={w:p.data.width+2,h:p.data.height+2,x:0,y:0},b=new c.ImagePosition(_,p);this.patterns[r]={bin:_,position:b}}return this._updatePatternAtlas(),this.patterns[r].position}bind(r){const l=r.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new c.Texture(r,this.atlasImage,l.RGBA),this.atlasTexture.bind(l.LINEAR,l.CLAMP_TO_EDGE)}_updatePatternAtlas(){const r=[];for(const b in this.patterns)r.push(this.patterns[b].bin);const{w:l,h:p}=c.potpack(r),_=this.atlasImage;_.resize({width:l||1,height:p||1});for(const b in this.patterns){const{bin:S}=this.patterns[b],A=S.x+1,R=S.y+1,V=this.images[b].data,j=V.width,y=V.height;c.RGBAImage.copy(V,_,{x:0,y:0},{x:A,y:R},{width:j,height:y}),c.RGBAImage.copy(V,_,{x:0,y:y-1},{x:A,y:R-1},{width:j,height:1}),c.RGBAImage.copy(V,_,{x:0,y:0},{x:A,y:R+y},{width:j,height:1}),c.RGBAImage.copy(V,_,{x:j-1,y:0},{x:A-1,y:R},{width:1,height:y}),c.RGBAImage.copy(V,_,{x:0,y:0},{x:A+j,y:R},{width:1,height:y})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(r){for(const l of r){if(this.callbackDispatchedThisFrame[l])continue;this.callbackDispatchedThisFrame[l]=!0;const p=this.images[l];Xt(p)&&this.updateImage(l,p)}}}const ut=new c.Properties({anchor:new c.DataConstantProperty(c.spec.light.anchor),position:new class{constructor(){this.specification=c.spec.light.position}possiblyEvaluate(h,r){return function([l,p,_]){const b=c.degToRad(p+90),S=c.degToRad(_);return{x:l*Math.cos(b)*Math.sin(S),y:l*Math.sin(b)*Math.sin(S),z:l*Math.cos(S),azimuthal:p,polar:_}}(h.expression.evaluate(r))}interpolate(h,r,l){return{x:c.number(h.x,r.x,l),y:c.number(h.y,r.y,l),z:c.number(h.z,r.z,l),azimuthal:c.number(h.azimuthal,r.azimuthal,l),polar:c.number(h.polar,r.polar,l)}}},color:new c.DataConstantProperty(c.spec.light.color),intensity:new c.DataConstantProperty(c.spec.light.intensity)}),Bt="-transition";class wt extends c.Evented{constructor(r){super(),this._transitionable=new c.Transitionable(ut),this.setLight(r),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(r,l={}){if(!this._validate(c.validateLight,r,l))for(const p in r){const _=r[p];c.endsWith(p,Bt)?this._transitionable.setTransition(p.slice(0,-Bt.length),_):this._transitionable.setValue(p,_)}}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,l,p){return(!p||!1!==p.validate)&&c.emitValidationErrors(this,r.call(c.validateStyle,c.extend({value:l,style:{glyphs:!0,sprite:!0},styleSpec:c.spec})))}}const tt=new c.Properties({source:new c.DataConstantProperty(c.spec.terrain.source),exaggeration:new c.DataConstantProperty(c.spec.terrain.exaggeration)}),cn="-transition";class Nn extends c.Evented{constructor(r,l){super(),this._transitionable=new c.Transitionable(tt),this.set(r),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=l}get(){return this._transitionable.serialize()}set(r){for(const l in r){const p=r[l];c.endsWith(l,cn)?this._transitionable.setTransition(l.slice(0,-cn.length),p):this._transitionable.setValue(l,p)}}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}}function Jt(h,r,l,p){const _=c.smoothstep(45,65,l),[b,S]=We(h,p),A=c.length(r);let R=1-Math.min(1,Math.exp((A-b)/(S-b)*-6));return R*=R*R,R=Math.min(1,1.00747*R),R*_*h.alpha}function We(h,r){const l=.5/Math.tan(.5*r);return[h.range[0]+l,h.range[1]+l]}const Ue=new c.Properties({range:new c.DataConstantProperty(c.spec.fog.range),color:new c.DataConstantProperty(c.spec.fog.color),"high-color":new c.DataConstantProperty(c.spec.fog["high-color"]),"space-color":new c.DataConstantProperty(c.spec.fog["space-color"]),"horizon-blend":new c.DataConstantProperty(c.spec.fog["horizon-blend"]),"star-intensity":new c.DataConstantProperty(c.spec.fog["star-intensity"])}),it="-transition";class ht extends c.Evented{constructor(r,l){super(),this._transitionable=new c.Transitionable(Ue),this.set(r),this._transitioning=this._transitionable.untransitioned(),this._transform=l}get state(){const r=this._transform,l="globe"===r.projection.name,p=c.globeToMercatorTransition(r.zoom),_=this.properties.get("range"),b=[.5,3];return{range:l?[c.number(b[0],_[0],p),c.number(b[1],_[1],p)]:_,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(r,l={}){if(!this._validate(c.validateFog,r,l)){for(const p of Object.keys(c.spec.fog))r&&void 0===r[p]&&(r[p]=c.spec.fog[p].default);for(const p in r){const _=r[p];c.endsWith(p,it)?this._transitionable.setTransition(p.slice(0,-it.length),_):this._transitionable.setValue(p,_)}}}getOpacity(r){if(!this._transform.projection.supportsFog)return 0;const l=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:c.smoothstep(45,65,r))*l.a}getOpacityAtLatLng(r,l){return this._transform.projection.supportsFog?function(p,_,b){const S=c.MercatorCoordinate.fromLngLat(_),A=b.elevation?b.elevation.getAtPointOrZero(S):0,R=[S.x,S.y,A];return c.transformMat4(R,R,b.mercatorFogMatrix),Jt(p,R,b.pitch,b._fov)}(this.state,r,l):0}getFovAdjustedRange(r){return this._transform.projection.supportsFog?We(this.state,r):[0,1]}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,l,p){return(!p||!1!==p.validate)&&c.emitValidationErrors(this,r.call(c.validateStyle,c.extend({value:l,style:{glyphs:!0,sprite:!0},styleSpec:c.spec})))}}class Lt{constructor(r,l){this.workerPool=r,this.actors=[],this.currentActor=0,this.id=c.uniqueId();const p=this.workerPool.acquire(this.id);for(let _=0;_<p.length;_++){const b=new Lt.Actor(p[_],l,this.id);b.name=`Worker ${_}`,this.actors.push(b)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(r,l,p){c.asyncAll(this.actors,(_,b)=>{_.send(r,l,b)},p=p||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(r=>{r.remove()}),this.actors=[],this.workerPool.release(this.id)}}function at(h,r,l){return r*(c.EXTENT/(h.tileSize*Math.pow(2,l-h.tileID.overscaledZ)))}Lt.Actor=c.Actor;class dn{constructor(r,l,p,_){this.screenBounds=r,this.cameraPoint=l,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=p,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,_)}static createFromScreenPoints(r,l){let p,_;if(r instanceof c.pointGeometry||"number"==typeof r[0]){const b=c.pointGeometry.convert(r);p=[b],_=l.isPointAboveHorizon(b)}else{const b=c.pointGeometry.convert(r[0]),S=c.pointGeometry.convert(r[1]);p=[b,S],_=c.polygonizeBounds(b,S).every(A=>l.isPointAboveHorizon(A))}return new dn(p,l.getCameraPoint(),_,l)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(r){return c.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],r)}bufferedCameraGeometry(r){const l=this.screenBounds[0],p=1===this.screenBounds.length?this.screenBounds[0].add(new c.pointGeometry(1,1)):this.screenBounds[1],_=c.polygonizeBounds(l,p,0,!1);return this.cameraPoint.y>p.y&&(this.cameraPoint.x>l.x&&this.cameraPoint.x<p.x?_.splice(3,0,this.cameraPoint):this.cameraPoint.x>=p.x?_[2]=this.cameraPoint:this.cameraPoint.x<=l.x&&(_[3]=this.cameraPoint)),c.bufferConvexPolygon(_,r)}bufferedCameraGeometryGlobe(r){const l=this.screenBounds[0],p=1===this.screenBounds.length?this.screenBounds[0].add(new c.pointGeometry(1,1)):this.screenBounds[1],_=c.polygonizeBounds(l,p,r),b=this.cameraPoint.clone();switch(3*((b.y>l.y)+(b.y>p.y))+((b.x>l.x)+(b.x>p.x))){case 0:_[0]=b,_[4]=b.clone();break;case 1:_.splice(1,0,b);break;case 2:_[1]=b;break;case 3:_.splice(4,0,b);break;case 5:_.splice(2,0,b);break;case 6:_[3]=b;break;case 7:_.splice(3,0,b);break;case 8:_[2]=b}return _}containsTile(r,l,p,_=0){const b=r.queryPadding/l._pixelsPerMercatorPixel+1,S=p?this._bufferedCameraMercator(b,l):this._bufferedScreenMercator(b,l);let A=r.tileID.wrap+(S.unwrapped?_:0);const R=S.polygon.map(L=>c.getTilePoint(r.tileTransform,L,A));if(!c.polygonIntersectsBox(R,0,0,c.EXTENT,c.EXTENT))return;A=r.tileID.wrap+(this.screenGeometryMercator.unwrapped?_:0);const V=this.screenGeometryMercator.polygon.map(L=>c.getTileVec3(r.tileTransform,L,A)),j=V.map(L=>new c.pointGeometry(L[0],L[1])),y=l.getFreeCameraOptions().position||new c.MercatorCoordinate(0,0,0),E=c.getTileVec3(r.tileTransform,y,A),x=V.map(L=>{const O=c.sub(L,L,E);return c.normalize(O,O),new c.Ray(E,O)}),T=at(r,1,l.zoom)*l._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:j,tilespaceRays:x,bufferedTilespaceGeometry:R,bufferedTilespaceBounds:(M=c.getBounds(R),M.min.x=c.clamp(M.min.x,0,c.EXTENT),M.min.y=c.clamp(M.min.y,0,c.EXTENT),M.max.x=c.clamp(M.max.x,0,c.EXTENT),M.max.y=c.clamp(M.max.y,0,c.EXTENT),M),tile:r,tileID:r.tileID,pixelToTileUnitsFactor:T};var M}_bufferedScreenMercator(r,l){const p=en(r);if(this._screenRaycastCache[p])return this._screenRaycastCache[p];{let _;return _="globe"===l.projection.name?this._projectAndResample(this.bufferedScreenGeometry(r),l):{polygon:this.bufferedScreenGeometry(r).map(b=>l.pointCoordinate3D(b)),unwrapped:!0},this._screenRaycastCache[p]=_,_}}_bufferedCameraMercator(r,l){const p=en(r);if(this._cameraRaycastCache[p])return this._cameraRaycastCache[p];{let _;return _="globe"===l.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(r),l):{polygon:this.bufferedCameraGeometry(r).map(b=>l.pointCoordinate3D(b)),unwrapped:!0},this._cameraRaycastCache[p]=_,_}}_projectAndResample(r,l){const p=function(b,S){const A=c.multiply([],S.pixelMatrix,S.globeMatrix),R=[0,-c.GLOBE_RADIUS,0,1],V=[0,c.GLOBE_RADIUS,0,1],j=[0,0,0,1];c.transformMat4$1(R,R,A),c.transformMat4$1(V,V,A),c.transformMat4$1(j,j,A);const y=new c.pointGeometry(R[0]/R[3],R[1]/R[3]),E=new c.pointGeometry(V[0]/V[3],V[1]/V[3]),x=c.polygonContainsPoint(b,y)&&R[3]<j[3],T=c.polygonContainsPoint(b,E)&&V[3]<j[3];if(!x&&!T)return null;const M=function(be,Le,Pe){for(let Te=1;Te<be.length;Te++){const et=Un(Le.pointCoordinate3D(be[Te-1]).x),Re=Un(Le.pointCoordinate3D(be[Te]).x);if(Pe<0){if(et<Re)return{idx:Te,t:-et/(Re-1-et)}}else if(Re<et)return{idx:Te,t:(1-et)/(Re+1-et)}}return null}(b,S,x?-1:1);if(!M)return null;const{idx:L,t:O}=M;let Z=L>1?qn(b.slice(0,L),S):[],Y=L<b.length?qn(b.slice(L),S):[];Z=Z.map(be=>new c.pointGeometry(Un(be.x),be.y)),Y=Y.map(be=>new c.pointGeometry(Un(be.x),be.y));const oe=[...Z];0===oe.length&&oe.push(Y[Y.length-1]);const se=c.number(oe[oe.length-1].y,(0===Y.length?Z[0]:Y[0]).y,O);let he;return he=x?[new c.pointGeometry(0,se),new c.pointGeometry(0,0),new c.pointGeometry(1,0),new c.pointGeometry(1,se)]:[new c.pointGeometry(1,se),new c.pointGeometry(1,1),new c.pointGeometry(0,1),new c.pointGeometry(0,se)],oe.push(...he),0===Y.length?oe.push(Z[0]):oe.push(...Y),{polygon:oe.map(be=>new c.MercatorCoordinate(be.x,be.y)),unwrapped:!1}}(r,l);if(p)return p;const _=function(b,S){let A=!1,R=-1/0,V=0;for(let y=0;y<b.length-1;y++)b[y].x>R&&(R=b[y].x,V=y);for(let y=0;y<b.length-1;y++){const E=(V+y)%(b.length-1),x=b[E],T=b[E+1];Math.abs(x.x-T.x)>.5&&(x.x<T.x?(x.x+=1,0===E&&(b[b.length-1].x+=1)):(T.x+=1,E+1===b.length-1&&(b[0].x+=1)),A=!0)}const j=c.mercatorXfromLng(S.center.lng);return A&&j<Math.abs(j-1)&&b.forEach(y=>{y.x-=1}),{polygon:b,unwrapped:A}}(qn(r,l).map(b=>new c.pointGeometry(Un(b.x),b.y)),l);return{polygon:_.polygon.map(b=>new c.MercatorCoordinate(b.x,b.y)),unwrapped:_.unwrapped}}}function qn(h,r){return c.resample(h,l=>{const p=r.pointCoordinate3D(l);l.x=p.x,l.y=p.y},1/256)}function Un(h){return h<0?1+h%1:h%1}function en(h){return 100*h|0}function jn(h,r,l,p,_){const b=function(S,A){if(S)return _(S);if(A){h.url&&A.tiles&&h.tiles&&delete h.tiles;const R=c.pick(c.extend(A,h),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);A.vector_layers&&(R.vectorLayers=A.vector_layers,R.vectorLayerIds=R.vectorLayers.map(V=>V.id)),R.tiles=r.canonicalizeTileset(R,h.url),_(null,R)}};return h.url?c.getJSON(r.transformRequest(r.normalizeSourceURL(h.url,null,l,p),c.ResourceType.Source),b):c.exported.frame(()=>b(null,h))}class Ln{constructor(r,l,p){this.bounds=c.LngLatBounds.convert(this.validateBounds(r)),this.minzoom=l||0,this.maxzoom=p||24}validateBounds(r){return Array.isArray(r)&&4===r.length?[Math.max(-180,r[0]),Math.max(-90,r[1]),Math.min(180,r[2]),Math.min(90,r[3])]:[-180,-90,180,90]}contains(r){const l=Math.pow(2,r.z),p=Math.floor(c.mercatorXfromLng(this.bounds.getWest())*l),_=Math.floor(c.mercatorYfromLat(this.bounds.getNorth())*l),b=Math.ceil(c.mercatorXfromLng(this.bounds.getEast())*l),S=Math.ceil(c.mercatorYfromLat(this.bounds.getSouth())*l);return r.x>=p&&r.x<b&&r.y>=_&&r.y<S}}class tr{constructor(r,l,p){this.context=r;const _=r.gl;this.buffer=_.createBuffer(),this.dynamicDraw=Boolean(p),this.context.unbindVAO(),r.bindElementBuffer.set(this.buffer),_.bufferData(_.ELEMENT_ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||l.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(r){const l=this.context.gl;this.context.unbindVAO(),this.bind(),l.bufferSubData(l.ELEMENT_ARRAY_BUFFER,0,r.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const vn={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class nr{constructor(r,l,p,_){this.length=l.length,this.attributes=p,this.itemSize=l.bytesPerElement,this.dynamicDraw=_,this.context=r;const b=r.gl;this.buffer=b.createBuffer(),r.bindVertexBuffer.set(this.buffer),b.bufferData(b.ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||l.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(r){const l=this.context.gl;this.bind(),l.bufferSubData(l.ARRAY_BUFFER,0,r.arrayBuffer)}enableAttributes(r,l){for(let p=0;p<this.attributes.length;p++){const _=l.attributes[this.attributes[p].name];void 0!==_&&r.enableVertexAttribArray(_)}}setVertexAttribPointers(r,l,p){for(let _=0;_<this.attributes.length;_++){const b=this.attributes[_],S=l.attributes[b.name];void 0!==S&&r.vertexAttribPointer(S,b.components,r[vn[b.type]],!1,this.itemSize,b.offset+this.itemSize*(p||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class zt{constructor(r){this.gl=r.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(r){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Xr extends zt{getDefault(){return c.Color.transparent}set(r){const l=this.current;(r.r!==l.r||r.g!==l.g||r.b!==l.b||r.a!==l.a||this.dirty)&&(this.gl.clearColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class ni extends zt{getDefault(){return 1}set(r){(r!==this.current||this.dirty)&&(this.gl.clearDepth(r),this.current=r,this.dirty=!1)}}class si extends zt{getDefault(){return 0}set(r){(r!==this.current||this.dirty)&&(this.gl.clearStencil(r),this.current=r,this.dirty=!1)}}class Vn extends zt{getDefault(){return[!0,!0,!0,!0]}set(r){const l=this.current;(r[0]!==l[0]||r[1]!==l[1]||r[2]!==l[2]||r[3]!==l[3]||this.dirty)&&(this.gl.colorMask(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class Ni extends zt{getDefault(){return!0}set(r){(r!==this.current||this.dirty)&&(this.gl.depthMask(r),this.current=r,this.dirty=!1)}}class Wi extends zt{getDefault(){return 255}set(r){(r!==this.current||this.dirty)&&(this.gl.stencilMask(r),this.current=r,this.dirty=!1)}}class Br extends zt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(r){const l=this.current;(r.func!==l.func||r.ref!==l.ref||r.mask!==l.mask||this.dirty)&&(this.gl.stencilFunc(r.func,r.ref,r.mask),this.current=r,this.dirty=!1)}}class Vr extends zt{getDefault(){const r=this.gl;return[r.KEEP,r.KEEP,r.KEEP]}set(r){const l=this.current;(r[0]!==l[0]||r[1]!==l[1]||r[2]!==l[2]||this.dirty)&&(this.gl.stencilOp(r[0],r[1],r[2]),this.current=r,this.dirty=!1)}}class yo extends zt{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;r?l.enable(l.STENCIL_TEST):l.disable(l.STENCIL_TEST),this.current=r,this.dirty=!1}}class rs extends zt{getDefault(){return[0,1]}set(r){const l=this.current;(r[0]!==l[0]||r[1]!==l[1]||this.dirty)&&(this.gl.depthRange(r[0],r[1]),this.current=r,this.dirty=!1)}}class Vs extends zt{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;r?l.enable(l.DEPTH_TEST):l.disable(l.DEPTH_TEST),this.current=r,this.dirty=!1}}class vo extends zt{getDefault(){return this.gl.LESS}set(r){(r!==this.current||this.dirty)&&(this.gl.depthFunc(r),this.current=r,this.dirty=!1)}}class ai extends zt{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;r?l.enable(l.BLEND):l.disable(l.BLEND),this.current=r,this.dirty=!1}}class yn extends zt{getDefault(){const r=this.gl;return[r.ONE,r.ZERO]}set(r){const l=this.current;(r[0]!==l[0]||r[1]!==l[1]||this.dirty)&&(this.gl.blendFunc(r[0],r[1]),this.current=r,this.dirty=!1)}}class fr extends zt{getDefault(){return c.Color.transparent}set(r){const l=this.current;(r.r!==l.r||r.g!==l.g||r.b!==l.b||r.a!==l.a||this.dirty)&&(this.gl.blendColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class rn extends zt{getDefault(){return this.gl.FUNC_ADD}set(r){(r!==this.current||this.dirty)&&(this.gl.blendEquation(r),this.current=r,this.dirty=!1)}}class Et extends zt{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;r?l.enable(l.CULL_FACE):l.disable(l.CULL_FACE),this.current=r,this.dirty=!1}}class xo extends zt{getDefault(){return this.gl.BACK}set(r){(r!==this.current||this.dirty)&&(this.gl.cullFace(r),this.current=r,this.dirty=!1)}}class Yr extends zt{getDefault(){return this.gl.CCW}set(r){(r!==this.current||this.dirty)&&(this.gl.frontFace(r),this.current=r,this.dirty=!1)}}class $n extends zt{getDefault(){return null}set(r){(r!==this.current||this.dirty)&&(this.gl.useProgram(r),this.current=r,this.dirty=!1)}}class oo extends zt{getDefault(){return this.gl.TEXTURE0}set(r){(r!==this.current||this.dirty)&&(this.gl.activeTexture(r),this.current=r,this.dirty=!1)}}class li extends zt{getDefault(){const r=this.gl;return[0,0,r.drawingBufferWidth,r.drawingBufferHeight]}set(r){const l=this.current;(r[0]!==l[0]||r[1]!==l[1]||r[2]!==l[2]||r[3]!==l[3]||this.dirty)&&(this.gl.viewport(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class mr extends zt{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.bindFramebuffer(l.FRAMEBUFFER,r),this.current=r,this.dirty=!1}}class Dr extends zt{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.bindRenderbuffer(l.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class Nr extends zt{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.bindTexture(l.TEXTURE_2D,r),this.current=r,this.dirty=!1}}class Gn extends zt{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.bindBuffer(l.ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class Kr extends zt{getDefault(){return null}set(r){const l=this.gl;l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class so extends zt{constructor(r){super(r),this.vao=r.extVertexArrayObject}getDefault(){return null}set(r){this.vao&&(r!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(r),this.current=r,this.dirty=!1)}}class Zo extends zt{getDefault(){return 4}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_ALIGNMENT,r),this.current=r,this.dirty=!1}}class bo extends zt{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r),this.current=r,this.dirty=!1}}class is extends zt{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,r),this.current=r,this.dirty=!1}}class qo extends zt{constructor(r,l){super(r),this.context=r,this.parent=l}getDefault(){return null}}class Ei extends qo{setDirty(){this.dirty=!0}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class pi extends qo{attachment(){return this.gl.DEPTH_ATTACHMENT}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferRenderbuffer(l.FRAMEBUFFER,this.attachment(),l.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class Ui extends pi{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class le{constructor(r,l,p,_){this.context=r,this.width=l,this.height=p;const b=this.framebuffer=r.gl.createFramebuffer();this.colorAttachment=new Ei(r,b),_&&(this.depthAttachment=new pi(r,b))}destroy(){const r=this.context.gl,l=this.colorAttachment.get();if(l&&r.deleteTexture(l),this.depthAttachment){const p=this.depthAttachment.get();p&&r.deleteRenderbuffer(p)}r.deleteFramebuffer(this.framebuffer)}}class H{constructor(r){this.gl=r,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Xr(this),this.clearDepth=new ni(this),this.clearStencil=new si(this),this.colorMask=new Vn(this),this.depthMask=new Ni(this),this.stencilMask=new Wi(this),this.stencilFunc=new Br(this),this.stencilOp=new Vr(this),this.stencilTest=new yo(this),this.depthRange=new rs(this),this.depthTest=new Vs(this),this.depthFunc=new vo(this),this.blend=new ai(this),this.blendFunc=new yn(this),this.blendColor=new fr(this),this.blendEquation=new rn(this),this.cullFace=new Et(this),this.cullFaceSide=new xo(this),this.frontFace=new Yr(this),this.program=new $n(this),this.activeTexture=new oo(this),this.viewport=new li(this),this.bindFramebuffer=new mr(this),this.bindRenderbuffer=new Dr(this),this.bindTexture=new Nr(this),this.bindVertexBuffer=new Gn(this),this.bindElementBuffer=new Kr(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new so(this),this.pixelStoreUnpack=new Zo(this),this.pixelStoreUnpackPremultiplyAlpha=new bo(this),this.pixelStoreUnpackFlipY=new is(this),this.extTextureFilterAnisotropic=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=r.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=r.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=r.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=r.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.extTextureHalfFloat=r.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(r.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=r.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=r.getExtension("OES_standard_derivatives"),this.extTimerQuery=r.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(r,l){return new tr(this,r,l)}createVertexBuffer(r,l,p){return new nr(this,r,l,p)}createRenderbuffer(r,l,p){const _=this.gl,b=_.createRenderbuffer();return this.bindRenderbuffer.set(b),_.renderbufferStorage(_.RENDERBUFFER,r,l,p),this.bindRenderbuffer.set(null),b}createFramebuffer(r,l,p){return new le(this,r,l,p)}clear({color:r,depth:l,stencil:p}){const _=this.gl;let b=0;r&&(b|=_.COLOR_BUFFER_BIT,this.clearColor.set(r),this.colorMask.set([!0,!0,!0,!0])),void 0!==l&&(b|=_.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(l),this.depthMask.set(!0)),void 0!==p&&(b|=_.STENCIL_BUFFER_BIT,this.clearStencil.set(p),this.stencilMask.set(255)),_.clear(b)}setCullFace(r){!1===r.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(r.mode),this.frontFace.set(r.frontFace))}setDepthMode(r){r.func!==this.gl.ALWAYS||r.mask?(this.depthTest.set(!0),this.depthFunc.set(r.func),this.depthMask.set(r.mask),this.depthRange.set(r.range)):this.depthTest.set(!1)}setStencilMode(r){r.test.func!==this.gl.ALWAYS||r.mask?(this.stencilTest.set(!0),this.stencilMask.set(r.mask),this.stencilOp.set([r.fail,r.depthFail,r.pass]),this.stencilFunc.set({func:r.test.func,ref:r.ref,mask:r.test.mask})):this.stencilTest.set(!1)}setColorMode(r){Ee(r.blendFunction,c.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(r.blendFunction),this.blendColor.set(r.blendColor)),this.colorMask.set(r.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class X extends c.Evented{constructor(r,l,p,_){super(),this.id=r,this.dispatcher=p,this.setEventedParent(_),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=c.extend({type:"raster"},l),c.extend(this,c.pick(l,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new c.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=jn(this._options,this.map._requestManager,null,null,(r,l)=>{this._tileJSONRequest=null,this._loaded=!0,r?this.fire(new c.ErrorEvent(r)):l&&(c.extend(this,l),l.bounds&&(this.tileBounds=new Ln(l.bounds,this.minzoom,this.maxzoom)),c.postTurnstileEvent(l.tiles),this.fire(new c.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(r){this.map=r,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return c.extend({},this._options)}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}loadTile(r,l){const p=c.exported.devicePixelRatio>=2,_=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme),p,this.tileSize);r.request=c.getImage(this.map._requestManager.transformRequest(_,c.ResourceType.Tile),(b,S,A,R)=>(delete r.request,r.aborted?(r.state="unloaded",l(null)):b?(r.state="errored",l(b)):S?(this.map._refreshExpiredTiles&&r.setExpiryData({cacheControl:A,expires:R}),r.setTexture(S,this.map.painter),r.state="loaded",c.cacheEntryPossiblyAdded(this.dispatcher),void l(null)):l(null)))}static loadTileData(r,l,p){r.setTexture(l,p)}static unloadTileData(r,l){r.texture&&l.saveTileTexture(r.texture)}abortTile(r,l){r.request&&(r.request.cancel(),delete r.request),l()}unloadTile(r,l){r.texture&&this.map.painter.saveTileTexture(r.texture),l()}hasTransition(){return!1}}let ae;function fe(h,r,l,p,_,b,S,A){const R=[h,l,_,r,p,b,1,1,1],V=[S,A,1],j=c.adjoint([],R),[y,E,x]=c.transformMat3(V,V,c.transpose(j,j));return c.multiply$1(R,[y,0,0,0,E,0,0,0,x],R)}class xe extends c.Evented{constructor(r,l,p,_){super(),this.id=r,this.dispatcher=p,this.coordinates=l.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(_),this.options=l,this._dirty=!1}load(r,l){this._loaded=l||!1,this.fire(new c.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=c.getImage(this.map._requestManager.transformRequest(this.url,c.ResourceType.Image),(p,_)=>{if(this._imageRequest=null,this._loaded=!0,p)this.fire(new c.ErrorEvent(p));else if(_){const{HTMLImageElement:b}=c.window;this.image=_ instanceof b?c.exported.getImageData(_):_,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,r&&(this.coordinates=r),this._finishLoading()}})}loaded(){return this._loaded}updateImage(r){return this.image&&r.url?(this._imageRequest&&r.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=r.url,this.load(r.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new c.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(r){this.map=r,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(r){this.coordinates=r,this._boundsArray=void 0;const l=r.map(c.MercatorCoordinate.fromLngLat);return this.tileID=function(p){let _=1/0,b=1/0,S=-1/0,A=-1/0;for(const y of p)_=Math.min(_,y.x),b=Math.min(b,y.y),S=Math.max(S,y.x),A=Math.max(A,y.y);const R=Math.max(S-_,A-b),V=Math.max(0,Math.floor(-Math.log(R)/Math.LN2)),j=Math.pow(2,V);return new c.CanonicalTileID(V,Math.floor((_+S)/2*j),Math.floor((b+A)/2*j))}(l),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new c.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(r){for(const R in this.tiles){const V=this.tiles[R];"loaded"!==V.state&&(V.state="loaded",V.texture=this.texture)}if(this._boundsArray)return;const l=c.tileTransform(this.tileID,this.map.transform.projection),[p,_,b,S]=this.coordinates.map(R=>{const V=l.projection.project(R[0],R[1]);return c.getTilePoint(l,V)._round()});this.perspectiveTransform=function(R,V,j,y,E,x,T,M,L,O){const Z=fe(0,0,R,0,0,V,R,V),Y=fe(j,y,E,x,T,M,L,O);return c.multiply$1(Y,c.adjoint(Z,Z),Y),[Y[6]/Y[8]*R/c.EXTENT,Y[7]/Y[8]*V/c.EXTENT]}(this.width,this.height,p.x,p.y,_.x,_.y,S.x,S.y,b.x,b.y);const A=this._boundsArray=new c.StructArrayLayout4i8;A.emplaceBack(p.x,p.y,0,0),A.emplaceBack(_.x,_.y,c.EXTENT,0),A.emplaceBack(S.x,S.y,0,c.EXTENT),A.emplaceBack(b.x,b.y,c.EXTENT,c.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=r.createVertexBuffer(A,c.boundsAttributes.members),this.boundsSegments=c.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const r=this.map.painter.context,l=r.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new c.Texture(r,this.image,l.RGBA),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(r)}loadTile(r,l){this.tileID&&this.tileID.equals(r.tileID.canonical)?(this.tiles[String(r.tileID.wrap)]=r,r.buckets={},l(null)):(r.state="errored",l(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const Se={vector:class extends c.Evented{constructor(h,r,l,p){if(super(),this.id=h,this.dispatcher=l,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,c.extend(this,c.pick(r,["url","scheme","tileSize","promoteId"])),this._options=c.extend({type:"vector"},r),this._collectResourceTiming=r.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(p),this._tileWorkers={},this._deduped=new c.DedupedRequest}load(h){this._loaded=!1,this.fire(new c.Event("dataloading",{dataType:"source"}));const r=Array.isArray(this.map._language)?this.map._language.join():this.map._language,l=this.map._worldview;this._tileJSONRequest=jn(this._options,this.map._requestManager,r,l,(p,_)=>{this._tileJSONRequest=null,this._loaded=!0,p?(r&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${r}`),l&&2!==l.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${l}`),this.fire(new c.ErrorEvent(p))):_&&(c.extend(this,_),_.bounds&&(this.tileBounds=new Ln(_.bounds,this.minzoom,this.maxzoom)),c.postTurnstileEvent(_.tiles,this.map._requestManager._customAccessToken),this.fire(new c.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.Event("data",{dataType:"source",sourceDataType:"content"}))),h&&h(p)})}loaded(){return this._loaded}hasTile(h){return!this.tileBounds||this.tileBounds.contains(h.canonical)}onAdd(h){this.map=h,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>{const h=this.map.style._getSourceCaches(this.id);for(const r of h)r.clearTiles()})}setSourceProperty(h){h(),this.reload()}setTiles(h){return this._options.tiles=h,this.reload(),this}setUrl(h){return this.url=h,this._options.url=h,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return c.extend({},this._options)}loadTile(h,r){const l=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme)),p={request:this.map._requestManager.transformRequest(l,c.ResourceType.Tile),data:void 0,uid:h.uid,tileID:h.tileID,tileZoom:h.tileZoom,zoom:h.tileID.overscaledZ,tileSize:this.tileSize*h.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:c.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:h.isSymbolTile};if(p.request.collectResourceTiming=this._collectResourceTiming,h.actor&&"expired"!==h.state)"loading"===h.state?h.reloadCallback=r:h.request=h.actor.send("reloadTile",p,_.bind(this));else if(h.actor=this._tileWorkers[l]=this._tileWorkers[l]||this.dispatcher.getActor(),this.dispatcher.ready)h.request=h.actor.send("loadTile",p,_.bind(this),void 0,!0);else{const b=c.loadVectorTile.call({deduped:this._deduped},p,(S,A)=>{S||!A?_.call(this,S):(p.data={cacheControl:A.cacheControl,expires:A.expires,rawData:A.rawData.slice(0)},h.actor&&h.actor.send("loadTile",p,_.bind(this),void 0,!0))},!0);h.request={cancel:b}}function _(b,S){return delete h.request,h.aborted?r(null):b&&404!==b.status?r(b):(S&&S.resourceTiming&&(h.resourceTiming=S.resourceTiming),this.map._refreshExpiredTiles&&S&&h.setExpiryData(S),h.loadVectorData(S,this.map.painter),c.cacheEntryPossiblyAdded(this.dispatcher),r(null),void(h.reloadCallback&&(this.loadTile(h,h.reloadCallback),h.reloadCallback=null)))}}abortTile(h){h.request&&(h.request.cancel(),delete h.request),h.actor&&h.actor.send("abortTile",{uid:h.uid,type:this.type,source:this.id})}unloadTile(h){h.unloadVectorData(),h.actor&&h.actor.send("removeTile",{uid:h.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}},raster:X,"raster-dem":class extends X{constructor(h,r,l,p){super(h,r,l,p),this.type="raster-dem",this.maxzoom=22,this._options=c.extend({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox"}loadTile(h,r){const l=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function p(_,b){_&&(h.state="errored",r(_)),b&&(h.dem=b,h.dem.onDeserialize(),h.needsHillshadePrepare=!0,h.needsDEMTextureUpload=!0,h.state="loaded",r(null))}h.request=c.getImage(this.map._requestManager.transformRequest(l,c.ResourceType.Tile),function(_,b,S,A){if(delete h.request,h.aborted)h.state="unloaded",r(null);else if(_)h.state="errored",r(_);else if(b){this.map._refreshExpiredTiles&&h.setExpiryData({cacheControl:S,expires:A});const R=c.window.ImageBitmap&&b instanceof c.window.ImageBitmap&&(null==ae&&(ae=c.window.OffscreenCanvas&&new c.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof c.window.createImageBitmap),ae),V=1-(b.width-c.prevPowerOfTwo(b.width))/2;V<1||h.neighboringTiles||(h.neighboringTiles=this._getNeighboringTiles(h.tileID));const j=R?b:c.exported.getImageData(b,V),y={uid:h.uid,coord:h.tileID,source:this.id,rawImageData:j,encoding:this.encoding,padding:V};h.actor&&"expired"!==h.state||(h.actor=this.dispatcher.getActor(),h.actor.send("loadDEMTile",y,p.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(h){const r=h.canonical,l=Math.pow(2,r.z),p=(r.x-1+l)%l,_=0===r.x?h.wrap-1:h.wrap,b=(r.x+1+l)%l,S=r.x+1===l?h.wrap+1:h.wrap,A={};return A[new c.OverscaledTileID(h.overscaledZ,_,r.z,p,r.y).key]={backfilled:!1},A[new c.OverscaledTileID(h.overscaledZ,S,r.z,b,r.y).key]={backfilled:!1},r.y>0&&(A[new c.OverscaledTileID(h.overscaledZ,_,r.z,p,r.y-1).key]={backfilled:!1},A[new c.OverscaledTileID(h.overscaledZ,h.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},A[new c.OverscaledTileID(h.overscaledZ,S,r.z,b,r.y-1).key]={backfilled:!1}),r.y+1<l&&(A[new c.OverscaledTileID(h.overscaledZ,_,r.z,p,r.y+1).key]={backfilled:!1},A[new c.OverscaledTileID(h.overscaledZ,h.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},A[new c.OverscaledTileID(h.overscaledZ,S,r.z,b,r.y+1).key]={backfilled:!1}),A}unloadTile(h){h.demTexture&&this.map.painter.saveTileTexture(h.demTexture),h.fbo&&(h.fbo.destroy(),delete h.fbo),h.dem&&delete h.dem,delete h.neighboringTiles,h.state="unloaded"}},geojson:class extends c.Evented{constructor(h,r,l,p){super(),this.id=h,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=l.getActor(),this.setEventedParent(p),this._data=r.data,this._options=c.extend({},r),this._collectResourceTiming=r.collectResourceTiming,void 0!==r.maxzoom&&(this.maxzoom=r.maxzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId;const _=c.EXTENT/this.tileSize;this.workerOptions=c.extend({source:this.id,cluster:r.cluster||!1,geojsonVtOptions:{buffer:(void 0!==r.buffer?r.buffer:128)*_,tolerance:(void 0!==r.tolerance?r.tolerance:.375)*_,extent:c.EXTENT,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:void 0!==r.clusterMaxZoom?r.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,r.clusterMinPoints||2),extent:c.EXTENT,radius:(void 0!==r.clusterRadius?r.clusterRadius:50)*_,log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter},r.workerOptions)}onAdd(h){this.map=h,this.setData(this._data)}setData(h){return this._data=h,this._updateWorkerData(),this}getClusterExpansionZoom(h,r){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:h,source:this.id},r),this}getClusterChildren(h,r){return this.actor.send("geojson.getClusterChildren",{clusterId:h,source:this.id},r),this}getClusterLeaves(h,r,l,p){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:h,limit:r,offset:l},p),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new c.Event("dataloading",{dataType:"source"})),this._loaded=!1;const h=c.extend({},this.workerOptions),r=this._data;"string"==typeof r?(h.request=this.map._requestManager.transformRequest(c.exported.resolveURL(r),c.ResourceType.Source),h.request.collectResourceTiming=this._collectResourceTiming):h.data=JSON.stringify(r),this._pendingLoad=this.actor.send(`${this.type}.loadData`,h,(l,p)=>{if(this._loaded=!0,this._pendingLoad=null,l)this.fire(new c.ErrorEvent(l));else{const _={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&p&&p.resourceTiming&&p.resourceTiming[this.id]&&(_.resourceTiming=p.resourceTiming[this.id]),this.fire(new c.Event("data",_)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(h,r){const l=h.actor?"reloadTile":"loadTile";h.actor=this.actor,h.request=this.actor.send(l,{type:this.type,uid:h.uid,tileID:h.tileID,tileZoom:h.tileZoom,zoom:h.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:c.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(p,_)=>(delete h.request,h.unloadVectorData(),h.aborted?r(null):p?r(p):(h.loadVectorData(_,this.map.painter,"reloadTile"===l),r(null))),void 0,"loadTile"===l)}abortTile(h){h.request&&(h.request.cancel(),delete h.request),h.aborted=!0}unloadTile(h){h.unloadVectorData(),this.actor.send("removeTile",{uid:h.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return c.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends xe{constructor(h,r,l,p){super(h,r,l,p),this.roundZoom=!0,this.type="video",this.options=r}load(){this._loaded=!1;const h=this.options;this.urls=[];for(const r of h.urls)this.urls.push(this.map._requestManager.transformRequest(r,c.ResourceType.Source).url);c.getVideo(this.urls,(r,l)=>{this._loaded=!0,r?this.fire(new c.ErrorEvent(r)):l&&(this.video=l,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(h){if(this.video){const r=this.video.seekable;h<r.start(0)||h>r.end(0)?this.fire(new c.ErrorEvent(new c.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${r.start(0)} and ${r.end(0)}-second mark.`))):this.video.currentTime=h}}getVideo(){return this.video}onAdd(h){this.map||(this.map=h,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const h=this.map.painter.context,r=h.gl;this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new c.Texture(h,this.video,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(h)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:xe,canvas:class extends xe{constructor(h,r,l,p){super(h,r,l,p),r.coordinates?Array.isArray(r.coordinates)&&4===r.coordinates.length&&!r.coordinates.some(_=>!Array.isArray(_)||2!==_.length||_.some(b=>"number"!=typeof b))||this.fire(new c.ErrorEvent(new c.ValidationError(`sources.${h}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new c.ErrorEvent(new c.ValidationError(`sources.${h}`,null,'missing required property "coordinates"'))),r.animate&&"boolean"!=typeof r.animate&&this.fire(new c.ErrorEvent(new c.ValidationError(`sources.${h}`,null,'optional "animate" property must be a boolean value'))),r.canvas?"string"==typeof r.canvas||r.canvas instanceof c.window.HTMLCanvasElement||this.fire(new c.ErrorEvent(new c.ValidationError(`sources.${h}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new c.ErrorEvent(new c.ValidationError(`sources.${h}`,null,'missing required property "canvas"'))),this.options=r,this.animate=void 0===r.animate||r.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof c.window.HTMLCanvasElement?this.options.canvas:c.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new c.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(h){this.map=h,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let h=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,h=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,h=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const r=this.map.painter.context;this.texture?(h||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new c.Texture(r,this.canvas,r.gl.RGBA,{premultiply:!0}),this._prepareData(r)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const h of[this.canvas.width,this.canvas.height])if(isNaN(h)||h<=0)return!0;return!1}},custom:class extends c.Evented{constructor(h,r,l,p){super(),this.id=h,this.type="custom",this._dataType="raster",this._dispatcher=l,this._implementation=r,this.setEventedParent(p),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new c.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new c.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Ln(this._implementation.bounds,this.minzoom,this.maxzoom)),r.update=this._update.bind(this),r.clearTiles=this._clearTiles.bind(this),r.coveringTiles=this._coveringTiles.bind(this),c.extend(this,c.pick(r,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return c.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new c.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(h){this._map=h,this._loaded=!1,this.fire(new c.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(h),this.load()}onRemove(h){this._implementation.onRemove&&this._implementation.onRemove(h)}hasTile(h){if(this._implementation.hasTile){const{x:r,y:l,z:p}=h.canonical;return this._implementation.hasTile({x:r,y:l,z:p})}return!this.tileBounds||this.tileBounds.contains(h.canonical)}loadTile(h,r){const{x:l,y:p,z:_}=h.tileID.canonical,b=new c.window.AbortController;h.request=Promise.resolve(this._implementation.loadTile({x:l,y:p,z:_},{signal:b.signal})).then(function(S){return delete h.request,h.aborted?(h.state="unloaded",r(null)):void 0===S?(h.state="errored",r(null)):null===S?(this.loadTileData(h,{width:this.tileSize,height:this.tileSize,data:null}),h.state="loaded",r(null)):(A=S)instanceof c.window.ImageData||A instanceof c.window.HTMLCanvasElement||A instanceof c.window.ImageBitmap||A instanceof c.window.HTMLImageElement?(this.loadTileData(h,S),h.state="loaded",void r(null)):(h.state="errored",r(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)));var A}.bind(this)).catch(S=>{20!==S.code&&(h.state="errored",r(S))}),h.request.cancel=()=>b.abort()}loadTileData(h,r){X.loadTileData(h,r,this._map.painter)}unloadTileData(h){X.unloadTileData(h,this._map.painter)}unloadTile(h,r){if(this.unloadTileData(h),this._implementation.unloadTile){const{x:l,y:p,z:_}=h.tileID.canonical;this._implementation.unloadTile({x:l,y:p,z:_})}r()}abortTile(h,r){h.request&&h.request.cancel&&(h.request.cancel(),delete h.request),r()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(h=>({x:h.canonical.x,y:h.canonical.y,z:h.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new c.Event("data",{dataType:"source",sourceDataType:"content"}))}}},Ce=function(h,r,l,p){const _=new Se[r.type](h,r,l,p);if(_.id!==h)throw new Error(`Expected Source id to be ${h} instead of ${_.id}`);return c.bindAll(["load","abort","unload","serialize","prepare"],_),_};function re(h,r){const l=c.identity([]);return c.scale(l,l,[.5*h.width,.5*-h.height,1]),c.translate(l,l,[1,-1,0]),c.multiply(l,l,h.calculateProjMatrix(r.toUnwrapped())),Float32Array.from(l)}function ne(h,r,l,p,_,b,S,A=!1){const R=h.tilesIn(p,S,A);R.sort(ve);const V=[];for(const y of R)V.push({wrappedTileID:y.tile.tileID.wrapped().key,queryResults:y.tile.queryRenderedFeatures(r,l,h._state,y,_,b,re(h.transform,y.tile.tileID),A)});const j=function(y){const E={},x={};for(const T of y){const M=T.queryResults,L=T.wrappedTileID,O=x[L]=x[L]||{};for(const Z in M){const Y=M[Z],oe=O[Z]=O[Z]||{},se=E[Z]=E[Z]||[];for(const he of Y)oe[he.featureIndex]||(oe[he.featureIndex]=!0,se.push(he))}}return E}(V);for(const y in j)j[y].forEach(E=>{const x=E.feature,T=x.layer;T&&"background"!==T.type&&"sky"!==T.type&&(x.source=T.source,T["source-layer"]&&(x.sourceLayer=T["source-layer"]),x.state=void 0!==x.id?h.getFeatureState(T["source-layer"],x.id):{})});return j}function Q(h,r){const l=h.getRenderableIds().map(b=>h.getTileByID(b)),p=[],_={};for(let b=0;b<l.length;b++){const S=l[b],A=S.tileID.canonical.key;_[A]||(_[A]=!0,S.querySourceFeatures(p,r))}return p}function ve(h,r){const l=h.tileID,p=r.tileID;return l.overscaledZ-p.overscaledZ||l.canonical.y-p.canonical.y||l.wrap-p.wrap||l.canonical.x-p.canonical.x}function we(){return null!=Oi.workerClass?new Oi.workerClass:new c.window.Worker(Oi.workerUrl)}const lt="mapboxgl_preloaded_worker_pool";class mt{constructor(){this.active={}}acquire(r){if(!this.workers)for(this.workers=[];this.workers.length<mt.workerCount;)this.workers.push(new we);return this.active[r]=!0,this.workers.slice()}release(r){delete this.active[r],0===this.numActive()&&(this.workers.forEach(l=>{l.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[lt]}numActive(){return Object.keys(this.active).length}}let Ct;function yt(){return Ct||(Ct=new mt),Ct}function xn(h,r){const l={};for(const p in h)"ref"!==p&&(l[p]=h[p]);return c.refProperties.forEach(p=>{p in r&&(l[p]=r[p])}),l}function On(h){h=h.slice();const r=Object.create(null);for(let l=0;l<h.length;l++)r[h[l].id]=h[l];for(let l=0;l<h.length;l++)"ref"in h[l]&&(h[l]=xn(h[l],r[h[l].ref]));return h}mt.workerCount=2;const Kt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function lr(h,r,l){l.push({command:Kt.addSource,args:[h,r[h]]})}function Kn(h,r,l){r.push({command:Kt.removeSource,args:[h]}),l[h]=!0}function mi(h,r,l,p){Kn(h,l,p),lr(h,r,l)}function os(h,r,l){let p;for(p in h[l])if(h[l].hasOwnProperty(p)&&"data"!==p&&!Ee(h[l][p],r[l][p]))return!1;for(p in r[l])if(r[l].hasOwnProperty(p)&&"data"!==p&&!Ee(h[l][p],r[l][p]))return!1;return!0}function Di(h,r,l,p,_,b){let S;for(S in r=r||{},h=h||{})h.hasOwnProperty(S)&&(Ee(h[S],r[S])||l.push({command:b,args:[p,S,r[S],_]}));for(S in r)r.hasOwnProperty(S)&&!h.hasOwnProperty(S)&&(Ee(h[S],r[S])||l.push({command:b,args:[p,S,r[S],_]}))}function Ge(h){return h.id}function wo(h,r){return h[r.id]=r,h}class $r{constructor(r,l){this.reset(r,l)}reset(r,l){this.points=r||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(l||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(r){if(1===this.points.length)return this.points[0];r=c.clamp(r,0,1);let l=1,p=this._distances[l];const _=r*this.paddedLength+this.padding;for(;p<_&&l<this._distances.length;)p=this._distances[++l];const b=l-1,S=this._distances[b],A=p-S,R=A>0?(_-S)/A:0;return this.points[b].mult(1-R).add(this.points[l].mult(R))}}class ao{constructor(r,l,p){const _=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(r/p),this.yCellCount=Math.ceil(l/p);for(let S=0;S<this.xCellCount*this.yCellCount;S++)_.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=r,this.height=l,this.xScale=this.xCellCount/r,this.yScale=this.yCellCount/l,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(r,l,p,_,b){this._forEachCell(l,p,_,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(l),this.bboxes.push(p),this.bboxes.push(_),this.bboxes.push(b)}insertCircle(r,l,p,_){this._forEachCell(l-_,p-_,l+_,p+_,this._insertCircleCell,this.circleUid++),this.circleKeys.push(r),this.circles.push(l),this.circles.push(p),this.circles.push(_)}_insertBoxCell(r,l,p,_,b,S){this.boxCells[b].push(S)}_insertCircleCell(r,l,p,_,b,S){this.circleCells[b].push(S)}_query(r,l,p,_,b,S){if(p<0||r>this.width||_<0||l>this.height)return!b&&[];const A=[];if(r<=0&&l<=0&&this.width<=p&&this.height<=_){if(b)return!0;for(let R=0;R<this.boxKeys.length;R++)A.push({key:this.boxKeys[R],x1:this.bboxes[4*R],y1:this.bboxes[4*R+1],x2:this.bboxes[4*R+2],y2:this.bboxes[4*R+3]});for(let R=0;R<this.circleKeys.length;R++){const V=this.circles[3*R],j=this.circles[3*R+1],y=this.circles[3*R+2];A.push({key:this.circleKeys[R],x1:V-y,y1:j-y,x2:V+y,y2:j+y})}return S?A.filter(S):A}return this._forEachCell(r,l,p,_,this._queryCell,A,{hitTest:b,seenUids:{box:{},circle:{}}},S),b?A.length>0:A}_queryCircle(r,l,p,_,b){const S=r-p,A=r+p,R=l-p,V=l+p;if(A<0||S>this.width||V<0||R>this.height)return!_&&[];const j=[];return this._forEachCell(S,R,A,V,this._queryCellCircle,j,{hitTest:_,circle:{x:r,y:l,radius:p},seenUids:{box:{},circle:{}}},b),_?j.length>0:j}query(r,l,p,_,b){return this._query(r,l,p,_,!1,b)}hitTest(r,l,p,_,b){return this._query(r,l,p,_,!0,b)}hitTestCircle(r,l,p,_){return this._queryCircle(r,l,p,!0,_)}_queryCell(r,l,p,_,b,S,A,R){const V=A.seenUids,j=this.boxCells[b];if(null!==j){const E=this.bboxes;for(const x of j)if(!V.box[x]){V.box[x]=!0;const T=4*x;if(r<=E[T+2]&&l<=E[T+3]&&p>=E[T+0]&&_>=E[T+1]&&(!R||R(this.boxKeys[x]))){if(A.hitTest)return S.push(!0),!0;S.push({key:this.boxKeys[x],x1:E[T],y1:E[T+1],x2:E[T+2],y2:E[T+3]})}}}const y=this.circleCells[b];if(null!==y){const E=this.circles;for(const x of y)if(!V.circle[x]){V.circle[x]=!0;const T=3*x;if(this._circleAndRectCollide(E[T],E[T+1],E[T+2],r,l,p,_)&&(!R||R(this.circleKeys[x]))){if(A.hitTest)return S.push(!0),!0;{const M=E[T],L=E[T+1],O=E[T+2];S.push({key:this.circleKeys[x],x1:M-O,y1:L-O,x2:M+O,y2:L+O})}}}}}_queryCellCircle(r,l,p,_,b,S,A,R){const V=A.circle,j=A.seenUids,y=this.boxCells[b];if(null!==y){const x=this.bboxes;for(const T of y)if(!j.box[T]){j.box[T]=!0;const M=4*T;if(this._circleAndRectCollide(V.x,V.y,V.radius,x[M+0],x[M+1],x[M+2],x[M+3])&&(!R||R(this.boxKeys[T])))return S.push(!0),!0}}const E=this.circleCells[b];if(null!==E){const x=this.circles;for(const T of E)if(!j.circle[T]){j.circle[T]=!0;const M=3*T;if(this._circlesCollide(x[M],x[M+1],x[M+2],V.x,V.y,V.radius)&&(!R||R(this.circleKeys[T])))return S.push(!0),!0}}}_forEachCell(r,l,p,_,b,S,A,R){const V=this._convertToXCellCoord(r),j=this._convertToYCellCoord(l),y=this._convertToXCellCoord(p),E=this._convertToYCellCoord(_);for(let x=V;x<=y;x++)for(let T=j;T<=E;T++)if(b.call(this,r,l,p,_,this.xCellCount*T+x,S,A,R))return}_convertToXCellCoord(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}_convertToYCellCoord(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}_circlesCollide(r,l,p,_,b,S){const A=_-r,R=b-l,V=p+S;return V*V>A*A+R*R}_circleAndRectCollide(r,l,p,_,b,S,A){const R=(S-_)/2,V=Math.abs(r-(_+R));if(V>R+p)return!1;const j=(A-b)/2,y=Math.abs(l-(b+j));if(y>j+p)return!1;if(V<=R||y<=j)return!0;const E=V-R,x=y-j;return E*E+x*x<=p*p}}const Ja=Math.tan(85*Math.PI/180);function Ti(h,r,l,p,_,b,S){const A=c.create();if(l)if("globe"===b.name){const R=c.calculateGlobeLabelMatrix(_,r);c.multiply(A,A,R)}else{const R=qe([],S);A[0]=R[0],A[1]=R[1],A[4]=R[2],A[5]=R[3],p||c.rotateZ(A,A,_.angle)}else c.multiply(A,_.labelPlaneMatrix,h);return A}function lo(h,r,l,p,_,b,S){const A=Ti(h,r,l,p,_,b,S);return"globe"===b.name&&l||(A[2]=A[6]=A[10]=A[14]=0),A}function ya(h,r,l,p,_,b,S){if(l){if("globe"===b.name){const A=Ti(h,r,l,p,_,b,S);return c.invert(A,A),c.multiply(A,h,A),A}{const A=c.clone(h),R=c.identity([]);return R[0]=S[0],R[1]=S[1],R[4]=S[2],R[5]=S[3],c.multiply(A,A,R),p||c.rotateZ(A,A,-_.angle),A}}return _.glCoordMatrix}function Sn(h,r,l,p){const _=[h,r,l,1];l?c.transformMat4$1(_,_,p):Mn(_,_,p);const b=_[3];return _[0]/=b,_[1]/=b,_[2]/=b,_}function xt(h,r){return Math.min(.5+h/r*.5,1.5)}function fn(h,r){const l=h[0]/h[3],p=h[1]/h[3];return l>=-r[0]&&l<=r[0]&&p>=-r[1]&&p<=r[1]}function Tn(h,r,l,p,_,b,S,A,R,V){const j=l.transform,y=p?h.textSizeData:h.iconSizeData,E=c.evaluateSizeForZoom(y,l.transform.zoom),x="globe"===j.projection.name,T=[256/l.width*2+1,256/l.height*2+1],M=p?h.text.dynamicLayoutVertexArray:h.icon.dynamicLayoutVertexArray;M.clear();let L=null;x&&(L=p?h.text.globeExtVertexArray:h.icon.globeExtVertexArray);const O=h.lineVertexArray,Z=p?h.text.placedSymbolArray:h.icon.placedSymbolArray,Y=l.transform.width/l.transform.height;let oe,se=!1;for(let he=0;he<Z.length;he++){const be=Z.get(he),{numGlyphs:Le,writingMode:Pe}=be;if(Pe!==c.WritingMode.vertical||se||oe===c.WritingMode.horizontal||(se=!0),oe=Pe,(be.hidden||Pe===c.WritingMode.vertical)&&!se){pr(Le,M);continue}se=!1;const Te=new c.pointGeometry(be.tileAnchorX,be.tileAnchorY);let{x:et,y:Re,z:He}=j.projection.projectTilePoint(Te.x,Te.y,V.canonical);if(R){const[an,qt,mn]=R(Te);et+=an,Re+=qt,He+=mn}const ze=[et,Re,He,1];if(c.transformMat4$1(ze,ze,r),!fn(ze,T)){pr(Le,M);continue}const ct=xt(l.transform.cameraToCenterDistance,ze[3]),Ne=c.evaluateSizeForFeature(y,E,be),Ke=S?Ne/ct:Ne*ct,vt=Sn(et,Re,He,_);if(vt[3]<=0){pr(Le,M);continue}let Ae={};const Be=S?null:R,Zt=ot(be,Ke,!1,A,r,_,b,h.glyphOffsetArray,O,M,L,vt,Te,Ae,Y,Be,j.projection,V,S);se=Zt.useVertical,Be&&Zt.needsFlipping&&(Ae={}),(Zt.notEnoughRoom||se||Zt.needsFlipping&&ot(be,Ke,!0,A,r,_,b,h.glyphOffsetArray,O,M,L,vt,Te,Ae,Y,Be,j.projection,V,S).notEnoughRoom)&&pr(Le,M)}p?(h.text.dynamicLayoutVertexBuffer.updateData(M),L&&h.text.globeExtVertexBuffer.updateData(L)):(h.icon.dynamicLayoutVertexBuffer.updateData(M),L&&h.icon.globeExtVertexBuffer.updateData(L))}function _r(h,r,l,p,_,b,S,A,R,V,j,y,E,x,T,M){const{lineStartIndex:L,glyphStartIndex:O,segment:Z}=A,Y=O+A.numGlyphs,oe=L+A.lineLength,se=r.getoffsetX(O),he=r.getoffsetX(Y-1),be=Qr(h*se,l,p,_,b,S,Z,L,oe,R,V,j,y,E,!0,x,T,M);if(!be)return null;const Le=Qr(h*he,l,p,_,b,S,Z,L,oe,R,V,j,y,E,!0,x,T,M);return Le?{first:be,last:Le}:null}function Jr(h,r,l,p){return h===c.WritingMode.horizontal&&Math.abs(p)>Math.abs(l)?{useVertical:!0}:h===c.WritingMode.vertical?p>0?{needsFlipping:!0}:null:0!==r&&(0===(_=l)||Math.abs(p/_)>Ja)?1===r?{needsFlipping:!0}:null:l<0?{needsFlipping:!0}:null;var _}function ot(h,r,l,p,_,b,S,A,R,V,j,y,E,x,T,M,L,O,Z){const Y=r/24,oe=h.lineOffsetX*Y,se=h.lineOffsetY*Y,{lineStartIndex:he,glyphStartIndex:be,numGlyphs:Le,segment:Pe,writingMode:Te,flipState:et}=h,Re=he+h.lineLength,He=ze=>{if(j){const[vt,Ae,Be]=ze.up,Zt=V.length;c.updateGlobeVertexNormal(j,Zt+0,vt,Ae,Be),c.updateGlobeVertexNormal(j,Zt+1,vt,Ae,Be),c.updateGlobeVertexNormal(j,Zt+2,vt,Ae,Be),c.updateGlobeVertexNormal(j,Zt+3,vt,Ae,Be)}const[ct,Ne,Ke]=ze.point;c.addDynamicAttributes(V,ct,Ne,Ke,ze.angle)};if(Le>1){const ze=_r(Y,A,oe,se,l,y,E,h,R,b,x,M,!1,L,O,Z);if(!ze)return{notEnoughRoom:!0};if(p&&!l){let[ct,Ne,Ke]=ze.first.point,[vt,Ae,Be]=ze.last.point;[ct,Ne]=Sn(ct,Ne,Ke,S),[vt,Ae]=Sn(vt,Ae,Be,S);const Zt=Jr(Te,et,(vt-ct)*T,Ae-Ne);if(h.flipState=Zt&&Zt.needsFlipping?1:2,Zt)return Zt}He(ze.first);for(let ct=be+1;ct<be+Le-1;ct++){const Ne=Qr(Y*A.getoffsetX(ct),oe,se,l,y,E,Pe,he,Re,R,b,x,M,!1,!1,L,O,Z);if(!Ne)return V.length-=4*(ct-be),{notEnoughRoom:!0};He(Ne)}He(ze.last)}else{if(p&&!l){const ct=Sn(E.x,E.y,0,_),Ne=he+Pe+1,Ke=new c.pointGeometry(R.getx(Ne),R.gety(Ne)),vt=Sn(Ke.x,Ke.y,0,_),Ae=vt[3]>0?vt:yr(E,Ke,ct,1,_,void 0,L,O.canonical),Be=Jr(Te,et,(Ae[0]-ct[0])*T,Ae[1]-ct[1]);if(h.flipState=Be&&Be.needsFlipping?1:2,Be)return Be}const ze=Qr(Y*A.getoffsetX(be),oe,se,l,y,E,Pe,he,Re,R,b,x,M,!1,!1,L,O,Z);if(!ze)return{notEnoughRoom:!0};He(ze)}return{}}function Cn(h,r,l,p,_){const{x:b,y:S,z:A}=p.projectTilePoint(h.x,h.y,r);if(!_)return Sn(b,S,A,l);const[R,V,j]=_(h);return Sn(b+R,S+V,A+j,l)}function yr(h,r,l,p,_,b,S,A){const R=Cn(h.sub(r)._unit()._add(h),A,_,S,b);return c.sub(R,l,R),c.normalize(R,R),c.scaleAndAdd(R,l,R,p)}function Qr(h,r,l,p,_,b,S,A,R,V,j,y,E,x,T,M,L,O){const Z=p?h-r:h+r;let Y=Z>0?1:-1,oe=0;p&&(Y*=-1,oe=Math.PI),Y<0&&(oe+=Math.PI);let se=A+S+(Y>0?0:1)|0,he=_,be=_,Le=0,Pe=0;const Te=Math.abs(Z),et=[],Re=[];let He=b,ze=He;const ct=()=>yr(ze,He,be,Te-Le+1,j,E,M,L.canonical);for(;Le+Pe<=Te;){if(se+=Y,se<A||se>=R)return null;if(be=he,ze=He,et.push(be),x&&Re.push(ze),He=new c.pointGeometry(V.getx(se),V.gety(se)),he=y[se],!he){const mn=Cn(He,L.canonical,j,M,E);he=mn[3]>0?y[se]=mn:ct()}Le+=Pe,Pe=c.distance(be,he)}T&&E&&(y[se]&&(he=ct(),Pe=c.distance(be,he)),y[se]=he);const Ne=(Te-Le)/Pe,Ke=He.sub(ze)._mult(Ne)._add(ze),vt=c.sub([],he,be),Ae=c.scaleAndAdd([],be,vt,Ne);let Be=[0,0,1],Zt=vt[0],an=vt[1];if(O&&(Be=M.upVector(L.canonical,Ke.x,Ke.y),0!==Be[0]||0!==Be[1]||1!==Be[2])){const mn=[Be[2],0,-Be[0]],Pn=c.cross([],Be,mn);c.normalize(mn,mn),c.normalize(Pn,Pn),Zt=c.dot(vt,mn),an=c.dot(vt,Pn)}if(l){const mn=c.cross([],Be,vt);c.normalize(mn,mn),c.scaleAndAdd(Ae,Ae,mn,l*Y)}const qt=oe+Math.atan2(an,Zt);return et.push(Ae),x&&Re.push(Ke),{point:Ae,angle:qt,path:et,tilePath:Re,up:Be}}function pr(h,r){const l=r.length,p=l+4*h;r.resize(p),r.float32.fill(-1/0,4*l,4*p)}function Mn(h,r,l){const p=r[0],_=r[1];return h[0]=l[0]*p+l[4]*_+l[12],h[1]=l[1]*p+l[5]*_+l[13],h[3]=l[3]*p+l[7]*_+l[15],h}const Ri=100;class Tr{constructor(r,l,p=new ao(r.width+200,r.height+200,25),_=new ao(r.width+200,r.height+200,25)){this.transform=r,this.grid=p,this.ignoredGrid=_,this.pitchfactor=Math.cos(r._pitch)*r.cameraToCenterDistance,this.screenRightBoundary=r.width+Ri,this.screenBottomBoundary=r.height+Ri,this.gridRightBoundary=r.width+200,this.gridBottomBoundary=r.height+200,this.fogState=l}placeCollisionBox(r,l,p,_,b,S,A,R){let V=p.projectedAnchorX,j=p.projectedAnchorY,y=p.projectedAnchorZ;const E=p.elevation,x=p.tileID,T=r.getProjection();if(E&&x){const[he,be,Le]=T.upVector(x.canonical,p.tileAnchorX,p.tileAnchorY),Pe=T.upVectorScale(x.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;V+=he*E*Pe,j+=be*E*Pe,y+=Le*E*Pe}const M=this.projectAndGetPerspectiveRatio(A,V,j,y,p.tileID,"globe"===T.name||!!E||this.transform.pitch>0,T),L=S*M.perspectiveRatio,O=(p.x1*l+_.x-p.padding)*L+M.point.x,Z=(p.y1*l+_.y-p.padding)*L+M.point.y,Y=(p.x2*l+_.x+p.padding)*L+M.point.x,oe=(p.y2*l+_.y+p.padding)*L+M.point.y,se=M.perspectiveRatio<=.55||M.occluded;return!this.isInsideGrid(O,Z,Y,oe)||!b&&this.grid.hitTest(O,Z,Y,oe,R)||se?{box:[],offscreen:!1,occluded:M.occluded}:{box:[O,Z,Y,oe],offscreen:this.isOffscreen(O,Z,Y,oe),occluded:!1}}placeCollisionCircles(r,l,p,_,b,S,A,R,V,j,y,E,x,T,M){const L=[],O=this.transform.elevation,Z=r.getProjection(),Y=O?O.getAtTileOffsetFunc(M,this.transform.center.lat,this.transform.worldSize,Z):null,oe=new c.pointGeometry(p.tileAnchorX,p.tileAnchorY);let{x:se,y:he,z:be}=Z.projectTilePoint(oe.x,oe.y,M.canonical);if(Y){const[Ke,vt,Ae]=Y(oe);se+=Ke,he+=vt,be+=Ae}const Le="globe"===Z.name,Pe=this.projectAndGetPerspectiveRatio(A,se,he,be,M,Le||!!O||this.transform.pitch>0,Z),{perspectiveRatio:Te}=Pe,et=(y?S/Te:S*Te)/c.ONE_EM,Re=Sn(se,he,be,R),He=Pe.signedDistanceFromCamera>0?_r(et,b,p.lineOffsetX*et,p.lineOffsetY*et,!1,Re,oe,p,_,R,{},O&&!y?Y:null,y&&!!O,Z,M,y):null;let ze=!1,ct=!1,Ne=!0;if(He&&!Pe.occluded){const Ke=.5*x*Te+T,vt=new c.pointGeometry(-100,-100),Ae=new c.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),Be=new $r,{first:Zt,last:an}=He,qt=Zt.path.length;let mn=[];for(let Ft=qt-1;Ft>=1;Ft--)mn.push(Zt.path[Ft]);for(let Ft=1;Ft<an.path.length;Ft++)mn.push(an.path[Ft]);const Pn=2.5*Ke;V&&(mn=mn.map(([Ft,vr,hr],Mr)=>(Y&&!Le&&(hr=Y(Mr<qt-1?Zt.tilePath[qt-1-Mr]:an.tilePath[Mr-qt+2])[2]),Sn(Ft,vr,hr,V))),mn.some(Ft=>Ft[3]<=0)&&(mn=[]));let tn=[];if(mn.length>0){let Ft=1/0,vr=-1/0,hr=1/0,Mr=-1/0;for(const xr of mn)Ft=Math.min(Ft,xr[0]),hr=Math.min(hr,xr[1]),vr=Math.max(vr,xr[0]),Mr=Math.max(Mr,xr[1]);vr>=vt.x&&Ft<=Ae.x&&Mr>=vt.y&&hr<=Ae.y&&(tn=[mn.map(xr=>new c.pointGeometry(xr[0],xr[1]))],(Ft<vt.x||vr>Ae.x||hr<vt.y||Mr>Ae.y)&&(tn=c.clipLine(tn,vt.x,vt.y,Ae.x,Ae.y)))}for(const Ft of tn){Be.reset(Ft,.25*Ke);let vr=0;vr=Be.length<=.5*Ke?1:Math.ceil(Be.paddedLength/Pn)+1;for(let hr=0;hr<vr;hr++){const Mr=hr/Math.max(vr-1,1),xr=Be.lerp(Mr),Qo=xr.x+Ri,es=xr.y+Ri;L.push(Qo,es,Ke,0);const Co=Qo-Ke,_s=es-Ke,Or=Qo+Ke,Ar=es+Ke;if(Ne=Ne&&this.isOffscreen(Co,_s,Or,Ar),ct=ct||this.isInsideGrid(Co,_s,Or,Ar),!l&&this.grid.hitTestCircle(Qo,es,Ke,E)&&(ze=!0,!j))return{circles:[],offscreen:!1,collisionDetected:ze,occluded:!1}}}}return{circles:!j&&ze||!ct?[]:L,offscreen:Ne,collisionDetected:ze,occluded:Pe.occluded}}queryRenderedSymbols(r){if(0===r.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const l=[];let p=1/0,_=1/0,b=-1/0,S=-1/0;for(const j of r){const y=new c.pointGeometry(j.x+Ri,j.y+Ri);p=Math.min(p,y.x),_=Math.min(_,y.y),b=Math.max(b,y.x),S=Math.max(S,y.y),l.push(y)}const A=this.grid.query(p,_,b,S).concat(this.ignoredGrid.query(p,_,b,S)),R={},V={};for(const j of A){const y=j.key;if(void 0===R[y.bucketInstanceId]&&(R[y.bucketInstanceId]={}),R[y.bucketInstanceId][y.featureIndex])continue;const E=[new c.pointGeometry(j.x1,j.y1),new c.pointGeometry(j.x2,j.y1),new c.pointGeometry(j.x2,j.y2),new c.pointGeometry(j.x1,j.y2)];c.polygonIntersectsPolygon(l,E)&&(R[y.bucketInstanceId][y.featureIndex]=!0,void 0===V[y.bucketInstanceId]&&(V[y.bucketInstanceId]=[]),V[y.bucketInstanceId].push(y.featureIndex))}return V}insertCollisionBox(r,l,p,_,b){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:_,collisionGroupID:b},r[0],r[1],r[2],r[3])}insertCollisionCircles(r,l,p,_,b){const S=l?this.ignoredGrid:this.grid,A={bucketInstanceId:p,featureIndex:_,collisionGroupID:b};for(let R=0;R<r.length;R+=4)S.insertCircle(A,r[R],r[R+1],r[R+2])}projectAndGetPerspectiveRatio(r,l,p,_,b,S,A){const R=[l,p,_,1];let V=!1;_||this.transform.pitch>0?(c.transformMat4$1(R,R,r),this.fogState&&b&&"globe"!==A.name&&(V=function(x,T,M,L,O,Z){const Y=Z.calculateFogTileMatrix(O),oe=[T,M,L];return c.transformMat4(oe,oe,Y),Jt(x,oe,Z.pitch,Z._fov)}(this.fogState,l,p,_,b.toUnwrapped(),this.transform)>.9)):Mn(R,R,r);const j=R[3];return{point:new c.pointGeometry((R[0]/j+1)/2*this.transform.width+Ri,(-R[1]/j+1)/2*this.transform.height+Ri),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(A)/j*.5,1.5),signedDistanceFromCamera:j,occluded:S&&R[2]>j||V}}isOffscreen(r,l,p,_){return p<Ri||r>=this.screenRightBoundary||_<Ri||l>this.screenBottomBoundary}isInsideGrid(r,l,p,_){return p>=0&&r<this.gridRightBoundary&&_>=0&&l<this.gridBottomBoundary}getViewportMatrix(){const r=c.identity([]);return c.translate(r,r,[-100,-100,0]),r}}function xs(h,r,l){const p=r.createTileMatrix(h,h.worldSize,l.toUnwrapped());return c.multiply(new Float32Array(16),h.projMatrix,p)}function Eo(h,r,l){if(r.projection.name===l.projection.name)return h.projMatrix;const p=l.clone();return p.setProjection(r.projection),xs(p,r.getProjection(),h)}function bn(h,r,l){return r.name===l.projection.name?h.projMatrix:xs(l,r,h)}class $s{constructor(r,l,p,_){this.opacity=r?Math.max(0,Math.min(1,r.opacity+(r.placed?l:-l))):_&&p?1:0,this.placed=p}isHidden(){return 0===this.opacity&&!this.placed}}class Xi{constructor(r,l,p,_,b,S=!1){this.text=new $s(r?r.text:null,l,p,b),this.icon=new $s(r?r.icon:null,l,_,b),this.clipped=S}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class va{constructor(r,l,p,_=!1){this.text=r,this.icon=l,this.skipFade=p,this.clipped=_}}class ei{constructor(){this.invProjMatrix=c.create(),this.viewportMatrix=c.create(),this.circles=[]}}class ri{constructor(r,l,p,_,b){this.bucketInstanceId=r,this.featureIndex=l,this.sourceLayerIndex=p,this.bucketIndex=_,this.tileID=b}}class Ur{constructor(r){this.crossSourceCollisions=r,this.maxGroupID=0,this.collisionGroups={}}get(r){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[r]){const l=++this.maxGroupID;this.collisionGroups[r]={ID:l,predicate:p=>p.collisionGroupID===l}}return this.collisionGroups[r]}}function Wn(h,r,l,p,_){const{horizontalAlign:b,verticalAlign:S}=c.getAnchorAlignment(h),A=-(b-.5)*r,R=-(S-.5)*l,V=c.evaluateVariableOffset(h,p);return new c.pointGeometry(A+V[0]*_,R+V[1]*_)}function Ci(h,r,l,p,_){const b=new c.pointGeometry(h,r);return l&&b._rotate(p?_:-_),b}class Yi{constructor(r,l,p,_,b){this.transform=r.clone(),this.projection=r.projection.name,this.collisionIndex=new Tr(this.transform,b),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=l,this.retainedQueryData={},this.collisionGroups=new Ur(p),this.collisionCircleArrays={},this.prevPlacement=_,_&&(_.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(r,l,p,_){const b=p.getBucket(l),S=p.latestFeatureIndex;if(!b||!S||l.id!==b.layerIds[0])return;const A=b.layers[0].layout,R=p.collisionBoxArray,V=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),j=p.tileSize/c.EXTENT,y=p.tileID.toUnwrapped();this.transform.setProjection(b.projection);const E=(x=p.tileID,T=b.getProjection(),M=this.transform,T.name===this.projection?M.calculateProjMatrix(x.toUnwrapped()):xs(M,T,x));var x,T,M;const L="map"===A.get("text-pitch-alignment"),O="map"===A.get("text-rotation-alignment");l.compileFilter();const Z=l.dynamicFilter(),Y=l.dynamicFilterNeedsFeature(),oe=this.transform.calculatePixelsToTileUnitsMatrix(p),se=lo(E,p.tileID.canonical,L,O,this.transform,b.getProjection(),oe);let he=null;if(L){const Pe=ya(E,p.tileID.canonical,L,O,this.transform,b.getProjection(),oe);he=c.multiply([],this.transform.labelPlaneMatrix,Pe)}let be=null;Z&&p.latestFeatureIndex&&(be={unwrappedTileID:y,dynamicFilter:Z,dynamicFilterNeedsFeature:Y,featureIndex:p.latestFeatureIndex}),this.retainedQueryData[b.bucketInstanceId]=new ri(b.bucketInstanceId,S,b.sourceLayerIndex,b.index,p.tileID);const Le={bucket:b,layout:A,posMatrix:E,textLabelPlaneMatrix:se,labelToScreenMatrix:he,clippingData:be,scale:V,textPixelRatio:j,holdingForFade:p.holdingForFade(),collisionBoxArray:R,partiallyEvaluatedTextSize:c.evaluateSizeForZoom(b.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:c.evaluateSizeForZoom(b.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(b.sourceID)};if(_)for(const Pe of b.sortKeyRanges){const{sortKey:Te,symbolInstanceStart:et,symbolInstanceEnd:Re}=Pe;r.push({sortKey:Te,symbolInstanceStart:et,symbolInstanceEnd:Re,parameters:Le})}else r.push({symbolInstanceStart:0,symbolInstanceEnd:b.symbolInstances.length,parameters:Le})}attemptAnchorPlacement(r,l,p,_,b,S,A,R,V,j,y,E,x,T,M,L,O,Z){const{textOffset0:Y,textOffset1:oe,crossTileID:se}=E,he=[Y,oe],be=Wn(r,p,_,he,b),Le=this.collisionIndex.placeCollisionBox(T,b,l,Ci(be.x,be.y,S,A,this.transform.angle),y,R,V,j.predicate);if(L){const Pe=T.getSymbolInstanceIconSize(Z,this.transform.zoom,E.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(T,Pe,L,Ci(be.x,be.y,S,A,this.transform.angle),y,R,V,j.predicate).box.length)return}if(Le.box.length>0){let Pe;return this.prevPlacement&&this.prevPlacement.variableOffsets[se]&&this.prevPlacement.placements[se]&&this.prevPlacement.placements[se].text&&(Pe=this.prevPlacement.variableOffsets[se].anchor),this.variableOffsets[se]={textOffset:he,width:p,height:_,anchor:r,textScale:b,prevAnchor:Pe},this.markUsedJustification(T,r,E,M),T.allowVerticalPlacement&&(this.markUsedOrientation(T,M,E),this.placedOrientations[se]=M),{shift:be,placedGlyphBoxes:Le}}}placeLayerBucketPart(r,l,p,_){const{bucket:b,layout:S,posMatrix:A,textLabelPlaneMatrix:R,labelToScreenMatrix:V,clippingData:j,textPixelRatio:y,holdingForFade:E,collisionBoxArray:x,partiallyEvaluatedTextSize:T,partiallyEvaluatedIconSize:M,collisionGroup:L}=r.parameters,O=S.get("text-optional"),Z=S.get("icon-optional"),Y=S.get("text-allow-overlap"),oe=S.get("icon-allow-overlap"),se="map"===S.get("text-rotation-alignment"),he="map"===S.get("text-pitch-alignment"),be="none"!==S.get("icon-text-fit"),Le="viewport-y"===S.get("symbol-z-order");this.transform.setProjection(b.projection);let Pe=Y&&(oe||!b.hasIconData()||Z),Te=oe&&(Y||!b.hasTextData()||O);!b.collisionArrays&&x&&b.deserializeCollisionBoxes(x),p&&_&&b.updateCollisionDebugBuffers(this.transform.zoom,x);const et=(Re,He,ze)=>{const{crossTileID:ct,numVerticalGlyphVertices:Ne}=Re;if(j){const Or={zoom:this.transform.zoom,pitch:this.transform.pitch};let Ar=null;if(j.dynamicFilterNeedsFeature){const ir=this.retainedQueryData[b.bucketInstanceId];Ar=j.featureIndex.loadFeature({featureIndex:Re.featureIndex,bucketIndex:ir.bucketIndex,sourceLayerIndex:ir.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,j.dynamicFilter)(Or,Ar,this.retainedQueryData[b.bucketInstanceId].tileID.canonical,new c.pointGeometry(Re.tileAnchorX,Re.tileAnchorY),this.transform.calculateDistanceTileData(j.unwrappedTileID)))return this.placements[ct]=new va(!1,!1,!1,!0),void(l[ct]=!0)}if(l[ct])return;if(E)return void(this.placements[ct]=new va(!1,!1,!1));let Ke=!1,vt=!1,Ae=!0,Be=!1,Zt=!1,an=null,qt={box:null,offscreen:null,occluded:null},mn={box:null,offscreen:null,occluded:null},Pn=null,tn=null,Ft=null,vr=0,hr=0,Mr=0;ze.textFeatureIndex?vr=ze.textFeatureIndex:Re.useRuntimeCollisionCircles&&(vr=Re.featureIndex),ze.verticalTextFeatureIndex&&(hr=ze.verticalTextFeatureIndex);const xr=Or=>{Or.tileID=this.retainedQueryData[b.bucketInstanceId].tileID;const Ar=this.transform.elevation;(Ar||Or.elevation)&&(Or.elevation=Ar?Ar.getAtTileOffset(Or.tileID,Or.tileAnchorX,Or.tileAnchorY):0)},Qo=ze.textBox;if(Qo){xr(Qo);const Or=ir=>{let vi=c.WritingMode.horizontal;if(b.allowVerticalPlacement&&!ir&&this.prevPlacement){const So=this.prevPlacement.placedOrientations[ct];So&&(this.placedOrientations[ct]=So,vi=So,this.markUsedOrientation(b,vi,Re))}return vi},Ar=(ir,vi)=>{if(b.allowVerticalPlacement&&Ne>0&&ze.verticalTextBox){for(const So of b.writingModes)if(So===c.WritingMode.vertical?(qt=vi(),mn=qt):qt=ir(),qt&&qt.box&&qt.box.length)break}else qt=ir()};if(S.get("text-variable-anchor")){let ir=S.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[ct]){const Lr=this.prevPlacement.variableOffsets[ct];ir.indexOf(Lr.anchor)>0&&(ir=ir.filter(Fo=>Fo!==Lr.anchor),ir.unshift(Lr.anchor))}const vi=(Lr,Fo,Mu)=>{const Fa=b.getSymbolInstanceTextSize(T,Re,this.transform.zoom,He),Ji=(Lr.x2-Lr.x1)*Fa+2*Lr.padding,zo=(Lr.y2-Lr.y1)*Fa+2*Lr.padding,Ps=be&&!oe?Fo:null;Ps&&xr(Ps);let Rs={box:[],offscreen:!1,occluded:!1};const Cc=Y?2*ir.length:ir.length;for(let Io=0;Io<Cc;++Io){const ha=this.attemptAnchorPlacement(ir[Io%ir.length],Lr,Ji,zo,Fa,se,he,y,A,L,Io>=ir.length,Re,He,b,Mu,Ps,T,M);if(ha&&(Rs=ha.placedGlyphBoxes,Rs&&Rs.box&&Rs.box.length)){Ke=!0,an=ha.shift;break}}return Rs};Ar(()=>vi(Qo,ze.iconBox,c.WritingMode.horizontal),()=>{const Lr=ze.verticalTextBox;return Lr&&xr(Lr),b.allowVerticalPlacement&&!(qt&&qt.box&&qt.box.length)&&Ne>0&&Lr?vi(Lr,ze.verticalIconBox,c.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),qt&&(Ke=qt.box,Ae=qt.offscreen,Be=qt.occluded);const So=Or(qt&&qt.box);if(!Ke&&this.prevPlacement){const Lr=this.prevPlacement.variableOffsets[ct];Lr&&(this.variableOffsets[ct]=Lr,this.markUsedJustification(b,Lr.anchor,Re,So))}}else{const ir=(vi,So)=>{const Lr=b.getSymbolInstanceTextSize(T,Re,this.transform.zoom,He),Fo=this.collisionIndex.placeCollisionBox(b,Lr,vi,new c.pointGeometry(0,0),Y,y,A,L.predicate);return Fo&&Fo.box&&Fo.box.length&&(this.markUsedOrientation(b,So,Re),this.placedOrientations[ct]=So),Fo};Ar(()=>ir(Qo,c.WritingMode.horizontal),()=>{const vi=ze.verticalTextBox;return b.allowVerticalPlacement&&Ne>0&&vi?(xr(vi),ir(vi,c.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),Or(qt&&qt.box&&qt.box.length)}}if(Pn=qt,Ke=Pn&&Pn.box&&Pn.box.length>0,Ae=Pn&&Pn.offscreen,Be=Pn&&Pn.occluded,Re.useRuntimeCollisionCircles){const Or=b.text.placedSymbolArray.get(Re.centerJustifiedTextSymbolIndex>=0?Re.centerJustifiedTextSymbolIndex:Re.verticalPlacedTextSymbolIndex),Ar=c.evaluateSizeForFeature(b.textSizeData,T,Or),ir=S.get("text-padding");tn=this.collisionIndex.placeCollisionCircles(b,Y,Or,b.lineVertexArray,b.glyphOffsetArray,Ar,A,R,V,p,he,L.predicate,Re.collisionCircleDiameter*Ar/c.ONE_EM,ir,this.retainedQueryData[b.bucketInstanceId].tileID),Ke=Y||tn.circles.length>0&&!tn.collisionDetected,Ae=Ae&&tn.offscreen,Be=tn.occluded}if(ze.iconFeatureIndex&&(Mr=ze.iconFeatureIndex),ze.iconBox){const Or=Ar=>{xr(Ar);const ir=be&&an?Ci(an.x,an.y,se,he,this.transform.angle):new c.pointGeometry(0,0),vi=b.getSymbolInstanceIconSize(M,this.transform.zoom,Re.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(b,vi,Ar,ir,oe,y,A,L.predicate)};mn&&mn.box&&mn.box.length&&ze.verticalIconBox?(Ft=Or(ze.verticalIconBox),vt=Ft.box.length>0):(Ft=Or(ze.iconBox),vt=Ft.box.length>0),Ae=Ae&&Ft.offscreen,Zt=Ft.occluded}const es=O||0===Re.numHorizontalGlyphVertices&&0===Ne,Co=Z||0===Re.numIconVertices;if(es||Co?Co?es||(vt=vt&&Ke):Ke=vt&&Ke:vt=Ke=vt&&Ke,Ke&&Pn&&Pn.box&&this.collisionIndex.insertCollisionBox(Pn.box,S.get("text-ignore-placement"),b.bucketInstanceId,mn&&mn.box&&hr?hr:vr,L.ID),vt&&Ft&&this.collisionIndex.insertCollisionBox(Ft.box,S.get("icon-ignore-placement"),b.bucketInstanceId,Mr,L.ID),tn&&(Ke&&this.collisionIndex.insertCollisionCircles(tn.circles,S.get("text-ignore-placement"),b.bucketInstanceId,vr,L.ID),p)){const Or=b.bucketInstanceId;let Ar=this.collisionCircleArrays[Or];void 0===Ar&&(Ar=this.collisionCircleArrays[Or]=new ei);for(let ir=0;ir<tn.circles.length;ir+=4)Ar.circles.push(tn.circles[ir+0]),Ar.circles.push(tn.circles[ir+1]),Ar.circles.push(tn.circles[ir+2]),Ar.circles.push(tn.collisionDetected?1:0)}const _s="globe"!==b.projection.name;Pe=Pe&&(_s||!Be),Te=Te&&(_s||!Zt),this.placements[ct]=new va(Ke||Pe,vt||Te,Ae||b.justReloaded),l[ct]=!0};if(Le){const Re=b.getSortedSymbolIndexes(this.transform.angle);for(let He=Re.length-1;He>=0;--He){const ze=Re[He];et(b.symbolInstances.get(ze),ze,b.collisionArrays[ze])}}else for(let Re=r.symbolInstanceStart;Re<r.symbolInstanceEnd;Re++)et(b.symbolInstances.get(Re),Re,b.collisionArrays[Re]);if(p&&b.bucketInstanceId in this.collisionCircleArrays){const Re=this.collisionCircleArrays[b.bucketInstanceId];c.invert(Re.invProjMatrix,A),Re.viewportMatrix=this.collisionIndex.getViewportMatrix()}b.justReloaded=!1}markUsedJustification(r,l,p,_){const{leftJustifiedTextSymbolIndex:b,centerJustifiedTextSymbolIndex:S,rightJustifiedTextSymbolIndex:A,verticalPlacedTextSymbolIndex:R,crossTileID:V}=p,j=c.getAnchorJustification(l),y=_===c.WritingMode.vertical?R:"left"===j?b:"center"===j?S:"right"===j?A:-1;b>=0&&(r.text.placedSymbolArray.get(b).crossTileID=y>=0&&b!==y?0:V),S>=0&&(r.text.placedSymbolArray.get(S).crossTileID=y>=0&&S!==y?0:V),A>=0&&(r.text.placedSymbolArray.get(A).crossTileID=y>=0&&A!==y?0:V),R>=0&&(r.text.placedSymbolArray.get(R).crossTileID=y>=0&&R!==y?0:V)}markUsedOrientation(r,l,p){const _=l===c.WritingMode.horizontal||l===c.WritingMode.horizontalOnly?l:0,b=l===c.WritingMode.vertical?l:0,{leftJustifiedTextSymbolIndex:S,centerJustifiedTextSymbolIndex:A,rightJustifiedTextSymbolIndex:R,verticalPlacedTextSymbolIndex:V}=p,j=r.text.placedSymbolArray;S>=0&&(j.get(S).placedOrientation=_),A>=0&&(j.get(A).placedOrientation=_),R>=0&&(j.get(R).placedOrientation=_),V>=0&&(j.get(V).placedOrientation=b)}commit(r){this.commitTime=r,this.zoomAtLastRecencyCheck=this.transform.zoom;const l=this.prevPlacement;let p=!1;this.prevZoomAdjustment=l?l.zoomAdjustment(this.transform.zoom):0;const _=l?l.symbolFadeChange(r):1,b=l?l.opacities:{},S=l?l.variableOffsets:{},A=l?l.placedOrientations:{};for(const R in this.placements){const V=this.placements[R],j=b[R];j?(this.opacities[R]=new Xi(j,_,V.text,V.icon,null,V.clipped),p=p||V.text!==j.text.placed||V.icon!==j.icon.placed):(this.opacities[R]=new Xi(null,_,V.text,V.icon,V.skipFade,V.clipped),p=p||V.text||V.icon)}for(const R in b){const V=b[R];if(!this.opacities[R]){const j=new Xi(V,_,!1,!1);j.isHidden()||(this.opacities[R]=j,p=p||V.text.placed||V.icon.placed)}}for(const R in S)this.variableOffsets[R]||!this.opacities[R]||this.opacities[R].isHidden()||(this.variableOffsets[R]=S[R]);for(const R in A)this.placedOrientations[R]||!this.opacities[R]||this.opacities[R].isHidden()||(this.placedOrientations[R]=A[R]);p?this.lastPlacementChangeTime=r:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=l?l.lastPlacementChangeTime:r)}updateLayerOpacities(r,l){const p={};for(const _ of l){const b=_.getBucket(r);b&&_.latestFeatureIndex&&r.id===b.layerIds[0]&&this.updateBucketOpacities(b,p,_.collisionBoxArray)}}updateBucketOpacities(r,l,p){r.hasTextData()&&r.text.opacityVertexArray.clear(),r.hasIconData()&&r.icon.opacityVertexArray.clear(),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexArray.clear(),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexArray.clear();const _=r.layers[0].layout,b=!!r.layers[0].dynamicFilter(),S=new Xi(null,0,!1,!1,!0),A=_.get("text-allow-overlap"),R=_.get("icon-allow-overlap"),V=_.get("text-variable-anchor"),j="map"===_.get("text-rotation-alignment"),y="map"===_.get("text-pitch-alignment"),E="none"!==_.get("icon-text-fit"),x=new Xi(null,0,A&&(R||!r.hasIconData()||_.get("icon-optional")),R&&(A||!r.hasTextData()||_.get("text-optional")),!0);!r.collisionArrays&&p&&(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData())&&r.deserializeCollisionBoxes(p);const T=(L,O,Z)=>{for(let Y=0;Y<O/4;Y++)L.opacityVertexArray.emplaceBack(Z)};let M=0;for(let L=0;L<r.symbolInstances.length;L++){const O=r.symbolInstances.get(L),{numHorizontalGlyphVertices:Z,numVerticalGlyphVertices:Y,crossTileID:oe,numIconVertices:se}=O;let he=this.opacities[oe];l[oe]?he=S:he||(he=x,this.opacities[oe]=he),l[oe]=!0;const be=Z>0||Y>0,Le=se>0,Pe=this.placedOrientations[oe],Te=Pe===c.WritingMode.vertical,et=Pe===c.WritingMode.horizontal||Pe===c.WritingMode.horizontalOnly;if(!be&&!Le||he.isHidden()||M++,be){const Re=ur(he.text);T(r.text,Z,Te?xa:Re),T(r.text,Y,et?xa:Re);const He=he.text.isHidden(),{leftJustifiedTextSymbolIndex:ze,centerJustifiedTextSymbolIndex:ct,rightJustifiedTextSymbolIndex:Ne,verticalPlacedTextSymbolIndex:Ke}=O,vt=r.text.placedSymbolArray,Ae=He||Te?1:0;ze>=0&&(vt.get(ze).hidden=Ae),ct>=0&&(vt.get(ct).hidden=Ae),Ne>=0&&(vt.get(Ne).hidden=Ae),Ke>=0&&(vt.get(Ke).hidden=He||et?1:0);const Be=this.variableOffsets[oe];Be&&this.markUsedJustification(r,Be.anchor,O,Pe);const Zt=this.placedOrientations[oe];Zt&&(this.markUsedJustification(r,"left",O,Zt),this.markUsedOrientation(r,Zt,O))}if(Le){const Re=ur(he.icon),{placedIconSymbolIndex:He,verticalPlacedIconSymbolIndex:ze}=O,ct=r.icon.placedSymbolArray,Ne=he.icon.isHidden()?1:0;He>=0&&(T(r.icon,se,Te?xa:Re),ct.get(He).hidden=Ne),ze>=0&&(T(r.icon,O.numVerticalIconVertices,et?xa:Re),ct.get(ze).hidden=Ne)}if(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData()){const Re=r.collisionArrays[L];if(Re){let He=new c.pointGeometry(0,0),ze=!0;if(Re.textBox||Re.verticalTextBox){if(V){const Ne=this.variableOffsets[oe];Ne?(He=Wn(Ne.anchor,Ne.width,Ne.height,Ne.textOffset,Ne.textScale),j&&He._rotate(y?this.transform.angle:-this.transform.angle)):ze=!1}b&&(ze=!he.clipped),Re.textBox&&Gr(r.textCollisionBox.collisionVertexArray,he.text.placed,!ze||Te,He.x,He.y),Re.verticalTextBox&&Gr(r.textCollisionBox.collisionVertexArray,he.text.placed,!ze||et,He.x,He.y)}const ct=ze&&Boolean(!et&&Re.verticalIconBox);Re.iconBox&&Gr(r.iconCollisionBox.collisionVertexArray,he.icon.placed,ct,E?He.x:0,E?He.y:0),Re.verticalIconBox&&Gr(r.iconCollisionBox.collisionVertexArray,he.icon.placed,!ct,E?He.x:0,E?He.y:0)}}}if(r.fullyClipped=0===M,r.sortFeatures(this.transform.angle),this.retainedQueryData[r.bucketInstanceId]&&(this.retainedQueryData[r.bucketInstanceId].featureSortOrder=r.featureSortOrder),r.hasTextData()&&r.text.opacityVertexBuffer&&r.text.opacityVertexBuffer.updateData(r.text.opacityVertexArray),r.hasIconData()&&r.icon.opacityVertexBuffer&&r.icon.opacityVertexBuffer.updateData(r.icon.opacityVertexArray),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexBuffer&&r.iconCollisionBox.collisionVertexBuffer.updateData(r.iconCollisionBox.collisionVertexArray),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexBuffer&&r.textCollisionBox.collisionVertexBuffer.updateData(r.textCollisionBox.collisionVertexArray),r.bucketInstanceId in this.collisionCircleArrays){const L=this.collisionCircleArrays[r.bucketInstanceId];r.placementInvProjMatrix=L.invProjMatrix,r.placementViewportMatrix=L.viewportMatrix,r.collisionCircleArray=L.circles,delete this.collisionCircleArrays[r.bucketInstanceId]}}symbolFadeChange(r){return 0===this.fadeDuration?1:(r-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(r){return Math.max(0,(this.transform.zoom-r)/1.5)}hasTransitions(r){return this.stale||r-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(r,l){const p=this.zoomAtLastRecencyCheck===l?1-this.zoomAdjustment(l):1;return this.zoomAtLastRecencyCheck=l,this.commitTime+this.fadeDuration*p>r}setStale(){this.stale=!0}}function Gr(h,r,l,p,_){h.emplaceBack(r?1:0,l?1:0,p||0,_||0),h.emplaceBack(r?1:0,l?1:0,p||0,_||0),h.emplaceBack(r?1:0,l?1:0,p||0,_||0),h.emplaceBack(r?1:0,l?1:0,p||0,_||0)}const Xn=Math.pow(2,25),hc=Math.pow(2,24),Gs=Math.pow(2,17),Hr=Math.pow(2,16),ss=Math.pow(2,9),Hs=Math.pow(2,8),Ro=Math.pow(2,1);function ur(h){if(0===h.opacity&&!h.placed)return 0;if(1===h.opacity&&h.placed)return 4294967295;const r=h.placed?1:0,l=Math.floor(127*h.opacity);return l*Xn+r*hc+l*Gs+r*Hr+l*ss+r*Hs+l*Ro+r}const xa=0;class Li{constructor(r){this._sortAcrossTiles="viewport-y"!==r.layout.get("symbol-z-order")&&void 0!==r.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(r,l,p,_,b){const S=this._bucketParts;for(;this._currentTileIndex<r.length;)if(l.getBucketParts(S,_,r[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,S.sort((A,R)=>A.sortKey-R.sortKey));this._currentPartIndex<S.length;){const A=S[this._currentPartIndex];if(l.placeLayerBucketPart(A,this._seenCrossTileIDs,p,0===A.symbolInstanceStart),this._currentPartIndex++,b())return!0}return!1}}class ii{constructor(r,l,p,_,b,S,A,R){this.placement=new Yi(r,b,S,A,R),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=p,this._showCollisionBoxes=_,this._done=!1}isDone(){return this._done}continuePlacement(r,l,p){const _=c.exported.now(),b=()=>{const S=c.exported.now()-_;return!this._forceFullPlacement&&S>2};for(;this._currentPlacementIndex>=0;){const S=l[r[this._currentPlacementIndex]],A=this.placement.collisionIndex.transform.zoom;if("symbol"===S.type&&(!S.minzoom||S.minzoom<=A)&&(!S.maxzoom||S.maxzoom>A)){if(this._inProgressLayer||(this._inProgressLayer=new Li(S)),this._inProgressLayer.continuePlacement(p[S.source],this.placement,this._showCollisionBoxes,S,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(r){return this.placement.commit(r),this.placement}}const bs=512/c.EXTENT/2;class as{constructor(r,l,p){this.tileID=r,this.indexedSymbolInstances={},this.bucketInstanceId=p;for(let _=0;_<l.length;_++){const b=l.get(_),S=b.key;this.indexedSymbolInstances[S]||(this.indexedSymbolInstances[S]=[]),this.indexedSymbolInstances[S].push({crossTileID:b.crossTileID,coord:this.getScaledCoordinates(b,r)})}}getScaledCoordinates(r,l){const p=bs/Math.pow(2,l.canonical.z-this.tileID.canonical.z);return{x:Math.floor((l.canonical.x*c.EXTENT+r.tileAnchorX)*p),y:Math.floor((l.canonical.y*c.EXTENT+r.tileAnchorY)*p)}}findMatches(r,l,p){const _=this.tileID.canonical.z<l.canonical.z?1:Math.pow(2,this.tileID.canonical.z-l.canonical.z);for(let b=0;b<r.length;b++){const S=r.get(b);if(S.crossTileID)continue;const A=this.indexedSymbolInstances[S.key];if(!A)continue;const R=this.getScaledCoordinates(S,l);for(const V of A)if(Math.abs(V.coord.x-R.x)<=_&&Math.abs(V.coord.y-R.y)<=_&&!p[V.crossTileID]){p[V.crossTileID]=!0,S.crossTileID=V.crossTileID;break}}}}class Zs{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class ji{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(r){const l=Math.round((r-this.lng)/360);if(0!==l)for(const p in this.indexes){const _=this.indexes[p],b={};for(const S in _){const A=_[S];A.tileID=A.tileID.unwrapTo(A.tileID.wrap+l),b[A.tileID.key]=A}this.indexes[p]=b}this.lng=r}addBucket(r,l,p){if(this.indexes[r.overscaledZ]&&this.indexes[r.overscaledZ][r.key]){if(this.indexes[r.overscaledZ][r.key].bucketInstanceId===l.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(r.overscaledZ,this.indexes[r.overscaledZ][r.key])}for(let b=0;b<l.symbolInstances.length;b++)l.symbolInstances.get(b).crossTileID=0;this.usedCrossTileIDs[r.overscaledZ]||(this.usedCrossTileIDs[r.overscaledZ]={});const _=this.usedCrossTileIDs[r.overscaledZ];for(const b in this.indexes){const S=this.indexes[b];if(Number(b)>r.overscaledZ)for(const A in S){const R=S[A];R.tileID.isChildOf(r)&&R.findMatches(l.symbolInstances,r,_)}else{const A=S[r.scaledTo(Number(b)).key];A&&A.findMatches(l.symbolInstances,r,_)}}for(let b=0;b<l.symbolInstances.length;b++){const S=l.symbolInstances.get(b);S.crossTileID||(S.crossTileID=p.generate(),_[S.crossTileID]=!0)}return void 0===this.indexes[r.overscaledZ]&&(this.indexes[r.overscaledZ]={}),this.indexes[r.overscaledZ][r.key]=new as(r,l.symbolInstances,l.bucketInstanceId),!0}removeBucketCrossTileIDs(r,l){for(const p in l.indexedSymbolInstances)for(const _ of l.indexedSymbolInstances[p])delete this.usedCrossTileIDs[r][_.crossTileID]}removeStaleBuckets(r){let l=!1;for(const p in this.indexes){const _=this.indexes[p];for(const b in _)r[_[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,_[b]),delete _[b],l=!0)}return l}}class qs{constructor(){this.layerIndexes={},this.crossTileIDs=new Zs,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(r,l,p,_){let b=this.layerIndexes[r.id];void 0===b&&(b=this.layerIndexes[r.id]=new ji);let S=!1;const A={};"globe"!==_.name&&b.handleWrapJump(p);for(const R of l){const V=R.getBucket(r);V&&r.id===V.layerIds[0]&&(V.bucketInstanceId||(V.bucketInstanceId=++this.maxBucketInstanceId),b.addBucket(R.tileID,V,this.crossTileIDs)&&(S=!0),A[V.bucketInstanceId]=!0)}return b.removeStaleBuckets(A)&&(S=!0),S}pruneUnusedLayers(r){const l={};r.forEach(p=>{l[p]=!0});for(const p in this.layerIndexes)l[p]||delete this.layerIndexes[p]}}const Ml=(h,r)=>c.emitValidationErrors(h,r&&r.filter(l=>"source.canvas"!==l.identifier)),Al=c.pick(Kt,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),ls=c.pick(Kt,["setCenter","setZoom","setBearing","setPitch"]),ws={version:8,layers:[],sources:{}},Qa={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class ci extends c.Evented{constructor(r,l={}){super(),this.map=r,this.dispatcher=new Lt(yt(),this),this.imageManager=new ar,this.imageManager.setEventedParent(this),this.glyphManager=new c.GlyphManager(r._requestManager,l.localFontFamily?c.LocalGlyphMode.all:l.localIdeographFontFamily?c.LocalGlyphMode.ideographs:c.LocalGlyphMode.none,l.localFontFamily||l.localIdeographFontFamily),this.crossTileSymbolIndex=new qs,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",c.getReferrer());const p=this;this._rtlTextPluginCallback=ci.registerForPluginStateChange(_=>{p.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:_.pluginStatus,pluginURL:_.pluginURL},(b,S)=>{if(c.triggerPluginCompletionEvent(b),S&&S.every(A=>A))for(const A in p._sourceCaches){const R=p._sourceCaches[A],V=R.getSource().type;"vector"!==V&&"geojson"!==V||R.reload()}})}),this.on("data",_=>{if("source"!==_.dataType||"metadata"!==_.sourceDataType)return;const b=this.getSource(_.sourceId);if(b&&b.vectorLayerIds)for(const S in this._layers){const A=this._layers[S];A.source===b.id&&this._validateLayer(A)}})}loadURL(r,l={}){this.fire(new c.Event("dataloading",{dataType:"style"}));const p="boolean"==typeof l.validate?l.validate:!c.isMapboxURL(r);r=this.map._requestManager.normalizeStyleURL(r,l.accessToken);const _=this.map._requestManager.transformRequest(r,c.ResourceType.Style);this._request=c.getJSON(_,(b,S)=>{this._request=null,b?this.fire(new c.ErrorEvent(b)):S&&this._load(S,p)})}loadJSON(r,l={}){this.fire(new c.Event("dataloading",{dataType:"style"})),this._request=c.exported.frame(()=>{this._request=null,this._load(r,!1!==l.validate)})}loadEmpty(){this.fire(new c.Event("dataloading",{dataType:"style"})),this._load(ws,!1)}_updateLayerCount(r,l){const p=l?1:-1;r.is3D()&&(this._num3DLayers+=p),"circle"===r.type&&(this._numCircleLayers+=p),"symbol"===r.type&&(this._numSymbolLayers+=p)}_load(r,l){if(l&&Ml(this,c.validateStyle(r)))return;this._loaded=!0,this.stylesheet=c.clone$1(r),this._updateMapProjection();for(const _ in r.sources)this.addSource(_,r.sources[_],{validate:!1});this._changed=!1,r.sprite?this._loadSprite(r.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(r.glyphs);const p=On(this.stylesheet.layers);this._order=p.map(_=>_.id),this._layers={},this._serializedLayers={};for(let _ of p)_=c.createStyleLayer(_),_.setEventedParent(this,{layer:{id:_.id}}),this._layers[_.id]=_,this._serializedLayers[_.id]=_.serialize(),this._updateLayerCount(_,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new wt(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new c.Event("data",{dataType:"style"})),this.fire(new c.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}setProjection(r){r?this.stylesheet.projection=r:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(r){this._spriteRequest=function(l,p,_){let b,S,A;const R=c.exported.devicePixelRatio>1?"@2x":"";let V=c.getJSON(p.transformRequest(p.normalizeSpriteURL(l,R,".json"),c.ResourceType.SpriteJSON),(E,x)=>{V=null,A||(A=E,b=x,y())}),j=c.getImage(p.transformRequest(p.normalizeSpriteURL(l,R,".png"),c.ResourceType.SpriteImage),(E,x)=>{j=null,A||(A=E,S=x,y())});function y(){if(A)_(A);else if(b&&S){const E=c.exported.getImageData(S),x={};for(const T in b){const{width:M,height:L,x:O,y:Z,sdf:Y,pixelRatio:oe,stretchX:se,stretchY:he,content:be}=b[T],Le=new c.RGBAImage({width:M,height:L});c.RGBAImage.copy(E,Le,{x:O,y:Z},{x:0,y:0},{width:M,height:L}),x[T]={data:Le,pixelRatio:oe,sdf:Y,stretchX:se,stretchY:he,content:be}}_(null,x)}}return{cancel(){V&&(V.cancel(),V=null),j&&(j.cancel(),j=null)}}}(r,this.map._requestManager,(l,p)=>{if(this._spriteRequest=null,l)this.fire(new c.ErrorEvent(l));else if(p)for(const _ in p)this.imageManager.addImage(_,p[_]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new c.Event("data",{dataType:"style"}))})}_validateLayer(r){const l=this.getSource(r.source);if(!l)return;const p=r.sourceLayer;p&&("geojson"===l.type||l.vectorLayerIds&&-1===l.vectorLayerIds.indexOf(p))&&this.fire(new c.ErrorEvent(new Error(`Source layer "${p}" does not exist on source "${l.id}" as specified by style layer "${r.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const r in this._sourceCaches)if(!this._sourceCaches[r].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(r){const l=[];for(const p of r){const _=this._layers[p];"custom"!==_.type&&l.push(_.serialize())}return l}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const r in this._sourceCaches)if(this._sourceCaches[r].hasTransition())return!0;for(const r in this._layers)if(this._layers[r].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(r){return!!this.terrain&&Qa[r.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(r){if(!this._loaded)return;const l=this._changed;if(this._changed){const _=Object.keys(this._updatedLayers),b=Object.keys(this._removedLayers);(_.length||b.length)&&this._updateWorkerLayers(_,b);for(const S in this._updatedSources){const A=this._updatedSources[S];"reload"===A?this._reloadSource(S):"clear"===A&&this._clearSource(S)}this._updateTilesForChangedImages();for(const S in this._updatedPaintProps)this._layers[S].updateTransitions(r);this.light.updateTransitions(r),this.fog&&this.fog.updateTransitions(r),this._resetUpdates()}const p={};for(const _ in this._sourceCaches){const b=this._sourceCaches[_];p[_]=b.used,b.used=!1}for(const _ of this._order){const b=this._layers[_];if(b.recalculate(r,this._availableImages),!b.isHidden(r.zoom)){const A=this._getLayerSourceCache(b);A&&(A.used=!0)}const S=this.map.painter;if(S){const A=b.getProgramIds();if(!A)continue;const R=b.getProgramConfiguration(r.zoom);for(const V of A)S.useProgram(V,R)}}for(const _ in p){const b=this._sourceCaches[_];p[_]!==b.used&&b.getSource().fire(new c.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:b.getSource().id}))}this.light.recalculate(r),this.terrain&&this.terrain.recalculate(r),this.fog&&this.fog.recalculate(r),this.z=r.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),l&&this.fire(new c.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const r=Object.keys(this._changedImages);if(r.length){for(const l in this._sourceCaches)this._sourceCaches[l].reloadTilesForDependencies(["icons","patterns"],r);this._changedImages={}}}_updateWorkerLayers(r,l){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(r),removedIds:l})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(r){if(this._checkLoaded(),Ml(this,c.validateStyle(r)))return!1;(r=c.clone$1(r)).layers=On(r.layers);const l=function(_,b){if(!_)return[{command:Kt.setStyle,args:[b]}];let S=[];try{if(!Ee(_.version,b.version))return[{command:Kt.setStyle,args:[b]}];Ee(_.center,b.center)||S.push({command:Kt.setCenter,args:[b.center]}),Ee(_.zoom,b.zoom)||S.push({command:Kt.setZoom,args:[b.zoom]}),Ee(_.bearing,b.bearing)||S.push({command:Kt.setBearing,args:[b.bearing]}),Ee(_.pitch,b.pitch)||S.push({command:Kt.setPitch,args:[b.pitch]}),Ee(_.sprite,b.sprite)||S.push({command:Kt.setSprite,args:[b.sprite]}),Ee(_.glyphs,b.glyphs)||S.push({command:Kt.setGlyphs,args:[b.glyphs]}),Ee(_.transition,b.transition)||S.push({command:Kt.setTransition,args:[b.transition]}),Ee(_.light,b.light)||S.push({command:Kt.setLight,args:[b.light]}),Ee(_.fog,b.fog)||S.push({command:Kt.setFog,args:[b.fog]}),Ee(_.projection,b.projection)||S.push({command:Kt.setProjection,args:[b.projection]});const A={},R=[];!function(y,E,x,T){let M;for(M in E=E||{},y=y||{})y.hasOwnProperty(M)&&(E.hasOwnProperty(M)||Kn(M,x,T));for(M in E)E.hasOwnProperty(M)&&(y.hasOwnProperty(M)?Ee(y[M],E[M])||("geojson"===y[M].type&&"geojson"===E[M].type&&os(y,E,M)?x.push({command:Kt.setGeoJSONSourceData,args:[M,E[M].data]}):mi(M,E,x,T)):lr(M,E,x))}(_.sources,b.sources,R,A);const V=[];_.layers&&_.layers.forEach(y=>{y.source&&A[y.source]?S.push({command:Kt.removeLayer,args:[y.id]}):V.push(y)});let j=_.terrain;j&&A[j.source]&&(S.push({command:Kt.setTerrain,args:[void 0]}),j=void 0),S=S.concat(R),Ee(j,b.terrain)||S.push({command:Kt.setTerrain,args:[b.terrain]}),function(y,E,x){E=E||[];const T=(y=y||[]).map(Ge),M=E.map(Ge),L=y.reduce(wo,{}),O=E.reduce(wo,{}),Z=T.slice(),Y=Object.create(null);let oe,se,he,be,Le,Pe,Te;for(oe=0,se=0;oe<T.length;oe++)he=T[oe],O.hasOwnProperty(he)?se++:(x.push({command:Kt.removeLayer,args:[he]}),Z.splice(Z.indexOf(he,se),1));for(oe=0,se=0;oe<M.length;oe++)he=M[M.length-1-oe],Z[Z.length-1-oe]!==he&&(L.hasOwnProperty(he)?(x.push({command:Kt.removeLayer,args:[he]}),Z.splice(Z.lastIndexOf(he,Z.length-se),1)):se++,Pe=Z[Z.length-oe],x.push({command:Kt.addLayer,args:[O[he],Pe]}),Z.splice(Z.length-oe,0,he),Y[he]=!0);for(oe=0;oe<M.length;oe++)if(he=M[oe],be=L[he],Le=O[he],!Y[he]&&!Ee(be,Le))if(Ee(be.source,Le.source)&&Ee(be["source-layer"],Le["source-layer"])&&Ee(be.type,Le.type)){for(Te in Di(be.layout,Le.layout,x,he,null,Kt.setLayoutProperty),Di(be.paint,Le.paint,x,he,null,Kt.setPaintProperty),Ee(be.filter,Le.filter)||x.push({command:Kt.setFilter,args:[he,Le.filter]}),Ee(be.minzoom,Le.minzoom)&&Ee(be.maxzoom,Le.maxzoom)||x.push({command:Kt.setLayerZoomRange,args:[he,Le.minzoom,Le.maxzoom]}),be)be.hasOwnProperty(Te)&&"layout"!==Te&&"paint"!==Te&&"filter"!==Te&&"metadata"!==Te&&"minzoom"!==Te&&"maxzoom"!==Te&&(0===Te.indexOf("paint.")?Di(be[Te],Le[Te],x,he,Te.slice(6),Kt.setPaintProperty):Ee(be[Te],Le[Te])||x.push({command:Kt.setLayerProperty,args:[he,Te,Le[Te]]}));for(Te in Le)Le.hasOwnProperty(Te)&&!be.hasOwnProperty(Te)&&"layout"!==Te&&"paint"!==Te&&"filter"!==Te&&"metadata"!==Te&&"minzoom"!==Te&&"maxzoom"!==Te&&(0===Te.indexOf("paint.")?Di(be[Te],Le[Te],x,he,Te.slice(6),Kt.setPaintProperty):Ee(be[Te],Le[Te])||x.push({command:Kt.setLayerProperty,args:[he,Te,Le[Te]]}))}else x.push({command:Kt.removeLayer,args:[he]}),Pe=Z[Z.lastIndexOf(he)+1],x.push({command:Kt.addLayer,args:[Le,Pe]})}(V,b.layers,S)}catch(A){console.warn("Unable to compute style diff:",A),S=[{command:Kt.setStyle,args:[b]}]}return S}(this.serialize(),r).filter(_=>!(_.command in ls));if(0===l.length)return!1;const p=l.filter(_=>!(_.command in Al));if(p.length>0)throw new Error(`Unimplemented: ${p.map(_=>_.command).join(", ")}.`);return l.forEach(_=>{"setTransition"!==_.command&&"setProjection"!==_.command&&this[_.command].apply(this,_.args)}),this.stylesheet=r,this._updateMapProjection(),!0}addImage(r,l){return this.getImage(r)?this.fire(new c.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(r,l),this._afterImageUpdated(r),this)}updateImage(r,l){this.imageManager.updateImage(r,l)}getImage(r){return this.imageManager.getImage(r)}removeImage(r){return this.getImage(r)?(this.imageManager.removeImage(r),this._afterImageUpdated(r),this):this.fire(new c.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(r){this._availableImages=this.imageManager.listImages(),this._changedImages[r]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new c.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(r,l,p={}){if(this._checkLoaded(),void 0!==this.getSource(r))throw new Error("There is already a source with this ID");if(!l.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(l).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(l.type)>=0&&this._validate(c.validateSource,`sources.${r}`,l,null,p))return;this.map&&this.map._collectResourceTiming&&(l.collectResourceTiming=!0);const _=Ce(r,l,this.dispatcher,this);_.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(r),source:_.serialize(),sourceId:r}));const b=S=>{const A=(S?"symbol:":"other:")+r,R=this._sourceCaches[A]=new c.SourceCache(A,_,S);(S?this._symbolSourceCaches:this._otherSourceCaches)[r]=R,R.style=this,R.onAdd(this.map)};b(!1),"vector"!==l.type&&"geojson"!==l.type||b(!0),_.onAdd&&_.onAdd(this.map),this._changed=!0}removeSource(r){this._checkLoaded();const l=this.getSource(r);if(!l)throw new Error("There is no source with this ID");for(const _ in this._layers)if(this._layers[_].source===r)return this.fire(new c.ErrorEvent(new Error(`Source "${r}" cannot be removed while layer "${_}" is using it.`)));if(this.terrain&&this.terrain.get().source===r)return this.fire(new c.ErrorEvent(new Error(`Source "${r}" cannot be removed while terrain is using it.`)));const p=this._getSourceCaches(r);for(const _ of p)delete this._sourceCaches[_.id],delete this._updatedSources[_.id],_.fire(new c.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:_.getSource().id})),_.setEventedParent(null),_.clearTiles();return delete this._otherSourceCaches[r],delete this._symbolSourceCaches[r],l.setEventedParent(null),l.onRemove&&l.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(r,l){this._checkLoaded(),this.getSource(r).setData(l),this._changed=!0}getSource(r){const l=this._getSourceCache(r);return l&&l.getSource()}_getSources(){const r=[];for(const l in this._otherSourceCaches){const p=this._getSourceCache(l);p&&r.push(p.getSource())}return r}addLayer(r,l,p={}){this._checkLoaded();const _=r.id;if(this.getLayer(_))return void this.fire(new c.ErrorEvent(new Error(`Layer with id "${_}" already exists on this map`)));let b;if("custom"===r.type){if(Ml(this,c.validateCustomStyleLayer(r)))return;b=c.createStyleLayer(r)}else{if("object"==typeof r.source&&(this.addSource(_,r.source),r=c.clone$1(r),r=c.extend(r,{source:_})),this._validate(c.validateLayer,`layers.${_}`,r,{arrayIndex:-1},p))return;b=c.createStyleLayer(r),this._validateLayer(b),b.setEventedParent(this,{layer:{id:_}}),this._serializedLayers[b.id]=b.serialize(),this._updateLayerCount(b,!0)}const S=l?this._order.indexOf(l):this._order.length;if(l&&-1===S)return void this.fire(new c.ErrorEvent(new Error(`Layer with id "${l}" does not exist on this map.`)));this._order.splice(S,0,_),this._layerOrderChanged=!0,this._layers[_]=b;const A=this._getLayerSourceCache(b);if(this._removedLayers[_]&&b.source&&A&&"custom"!==b.type){const R=this._removedLayers[_];delete this._removedLayers[_],R.type!==b.type?this._updatedSources[b.source]="clear":(this._updatedSources[b.source]="reload",A.pause())}this._updateLayer(b),b.onAdd&&b.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(r,l){if(this._checkLoaded(),this._changed=!0,!this._layers[r])return void this.fire(new c.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be moved.`)));if(r===l)return;const p=this._order.indexOf(r);this._order.splice(p,1);const _=l?this._order.indexOf(l):this._order.length;l&&-1===_?this.fire(new c.ErrorEvent(new Error(`Layer with id "${l}" does not exist on this map.`))):(this._order.splice(_,0,r),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(r){this._checkLoaded();const l=this._layers[r];if(!l)return void this.fire(new c.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be removed.`)));l.setEventedParent(null),this._updateLayerCount(l,!1);const p=this._order.indexOf(r);this._order.splice(p,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[r]=l,delete this._layers[r],delete this._serializedLayers[r],delete this._updatedLayers[r],delete this._updatedPaintProps[r],l.onRemove&&l.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(r){return this._layers[r]}hasLayer(r){return r in this._layers}hasLayerType(r){for(const l in this._layers)if(this._layers[l].type===r)return!0;return!1}setLayerZoomRange(r,l,p){this._checkLoaded();const _=this.getLayer(r);_?_.minzoom===l&&_.maxzoom===p||(null!=l&&(_.minzoom=l),null!=p&&(_.maxzoom=p),this._updateLayer(_)):this.fire(new c.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(r,l,p={}){this._checkLoaded();const _=this.getLayer(r);if(_){if(!Ee(_.filter,l))return null==l?(_.filter=void 0,void this._updateLayer(_)):void(this._validate(c.validateFilter,`layers.${_.id}.filter`,l,{layerType:_.type},p)||(_.filter=c.clone$1(l),this._updateLayer(_)))}else this.fire(new c.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be filtered.`)))}getFilter(r){const l=this.getLayer(r);return l&&c.clone$1(l.filter)}setLayoutProperty(r,l,p,_={}){this._checkLoaded();const b=this.getLayer(r);b?Ee(b.getLayoutProperty(l),p)||(b.setLayoutProperty(l,p,_),this._updateLayer(b)):this.fire(new c.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(r,l){const p=this.getLayer(r);if(p)return p.getLayoutProperty(l);this.fire(new c.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style.`)))}setPaintProperty(r,l,p,_={}){this._checkLoaded();const b=this.getLayer(r);b?Ee(b.getPaintProperty(l),p)||(b.setPaintProperty(l,p,_)&&this._updateLayer(b),this._changed=!0,this._updatedPaintProps[r]=!0):this.fire(new c.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(r,l){const p=this.getLayer(r);return p&&p.getPaintProperty(l)}setFeatureState(r,l){this._checkLoaded();const p=r.source,_=r.sourceLayer,b=this.getSource(p);if(!b)return void this.fire(new c.ErrorEvent(new Error(`The source '${p}' does not exist in the map's style.`)));const S=b.type;if("geojson"===S&&_)return void this.fire(new c.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===S&&!_)return void this.fire(new c.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===r.id&&this.fire(new c.ErrorEvent(new Error("The feature id parameter must be provided.")));const A=this._getSourceCaches(p);for(const R of A)R.setFeatureState(_,r.id,l)}removeFeatureState(r,l){this._checkLoaded();const p=r.source,_=this.getSource(p);if(!_)return void this.fire(new c.ErrorEvent(new Error(`The source '${p}' does not exist in the map's style.`)));const b=_.type,S="vector"===b?r.sourceLayer:void 0;if("vector"===b&&!S)return void this.fire(new c.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(l&&"string"!=typeof r.id&&"number"!=typeof r.id)return void this.fire(new c.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const A=this._getSourceCaches(p);for(const R of A)R.removeFeatureState(S,r.id,l)}getFeatureState(r){this._checkLoaded();const l=r.source,p=r.sourceLayer,_=this.getSource(l);if(_){if("vector"!==_.type||p)return void 0===r.id&&this.fire(new c.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(l)[0].getFeatureState(p,r.id);this.fire(new c.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new c.ErrorEvent(new Error(`The source '${l}' does not exist in the map's style.`)))}getTransition(){return c.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const r={};for(const l in this._sourceCaches){const p=this._sourceCaches[l].getSource();r[p.id]||(r[p.id]=p.serialize())}return c.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:r,layers:this._serializeLayers(this._order)},l=>void 0!==l)}_updateLayer(r){this._updatedLayers[r.id]=!0;const l=this._getLayerSourceCache(r);r.source&&!this._updatedSources[r.source]&&l&&"raster"!==l.getSource().type&&(this._updatedSources[r.source]="reload",l.pause()),this._changed=!0,r.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(r){const l=S=>"fill-extrusion"===this._layers[S].type,p={},_=[];for(let S=this._order.length-1;S>=0;S--){const A=this._order[S];if(l(A)){p[A]=S;for(const R of r){const V=R[A];if(V)for(const j of V)_.push(j)}}}_.sort((S,A)=>A.intersectionZ-S.intersectionZ);const b=[];for(let S=this._order.length-1;S>=0;S--){const A=this._order[S];if(l(A))for(let R=_.length-1;R>=0;R--){const V=_[R].feature;if(p[V.layer.id]<S)break;b.push(V),_.pop()}else for(const R of r){const V=R[A];if(V)for(const j of V)b.push(j.feature)}}return b}queryRenderedFeatures(r,l,p){l&&l.filter&&this._validate(c.validateFilter,"queryRenderedFeatures.filter",l.filter,null,l);const _={};if(l&&l.layers){if(!Array.isArray(l.layers))return this.fire(new c.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const R of l.layers){const V=this._layers[R];if(!V)return this.fire(new c.ErrorEvent(new Error(`The layer '${R}' does not exist in the map's style and cannot be queried for features.`))),[];_[V.source]=!0}}const b=[];l.availableImages=this._availableImages;const S=l&&l.layers?l.layers.some(R=>{const V=this.getLayer(R);return V&&V.is3D()}):this.has3DLayers(),A=dn.createFromScreenPoints(r,p);for(const R in this._sourceCaches){const V=this._sourceCaches[R].getSource().id;l.layers&&!_[V]||b.push(ne(this._sourceCaches[R],this._layers,this._serializedLayers,A,l,p,S,!!this.map._showQueryGeometry))}return this.placement&&b.push(function(R,V,j,y,E,x,T){const M={},L=x.queryRenderedSymbols(y),O=[];for(const Z of Object.keys(L).map(Number))O.push(T[Z]);O.sort(ve);for(const Z of O){const Y=Z.featureIndex.lookupSymbolFeatures(L[Z.bucketInstanceId],V,Z.bucketIndex,Z.sourceLayerIndex,E.filter,E.layers,E.availableImages,R);for(const oe in Y){const se=M[oe]=M[oe]||[],he=Y[oe];he.sort((be,Le)=>{const Pe=Z.featureSortOrder;if(Pe){const Te=Pe.indexOf(be.featureIndex);return Pe.indexOf(Le.featureIndex)-Te}return Le.featureIndex-be.featureIndex});for(const be of he)se.push(be)}}for(const Z in M)M[Z].forEach(Y=>{const oe=Y.feature,se=j(R[Z]).getFeatureState(oe.layer["source-layer"],oe.id);oe.source=oe.layer.source,oe.layer["source-layer"]&&(oe.sourceLayer=oe.layer["source-layer"]),oe.state=se});return M}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),A.screenGeometry,l,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(b)}querySourceFeatures(r,l){l&&l.filter&&this._validate(c.validateFilter,"querySourceFeatures.filter",l.filter,null,l);const p=this._getSourceCaches(r);let _=[];for(const b of p)_=_.concat(Q(b,l));return _}addSourceType(r,l,p){return ci.getSourceType(r)?p(new Error(`A source type called "${r}" already exists.`)):(ci.setSourceType(r,l),l.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:r,url:l.workerSourceURL},p):p(null,null))}getLight(){return this.light.getLight()}setLight(r,l={}){this._checkLoaded();const p=this.light.getLight();let _=!1;for(const S in r)if(!Ee(r[S],p[S])){_=!0;break}if(!_)return;const b=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(r,l),this.light.updateTransitions(b)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(r,l=1){if(this._checkLoaded(),!r)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(1===l){if("object"==typeof r.source){const p="terrain-dem-src";this.addSource(p,r.source),r=c.clone$1(r),r=c.extend(r,{source:p})}if(this._validate(c.validateTerrain,"terrain",r))return}if(!this.terrain||this.terrain&&l!==this.terrain.drapeRenderMode)this._createTerrain(r,l);else{const p=this.terrain,_=p.get();for(const b of Object.keys(c.spec.terrain))!r.hasOwnProperty(b)&&c.spec.terrain[b].default&&(r[b]=c.spec.terrain[b].default);for(const b in r)if(!Ee(r[b],_[b])){p.set(r),this.stylesheet.terrain=r;const S=this._setTransitionParameters({duration:0});p.updateTransitions(S);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(r){const l=this.fog=new ht(r,this.map.transform);this.stylesheet.fog=r;const p=this._setTransitionParameters({duration:0});l.updateTransitions(p)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const r of this.map._markers)r._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(r){if(this._checkLoaded(),!r)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const l=this.fog,p=l.get();0===Object.keys(r).length&&l.set(r);for(const _ in r)if(!Ee(r[_],p[_])){l.set(r),this.stylesheet.fog=r;const b=this._setTransitionParameters({duration:0});l.updateTransitions(b);break}}else this._createFog(r);this._markersNeedUpdate=!0}_setTransitionParameters(r){return{now:c.exported.now(),transition:c.extend(r,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const r=this._order.filter(p=>this.isLayerDraped(this._layers[p])),l=this._order.filter(p=>!this.isLayerDraped(this._layers[p]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...r),this._drapedFirstOrder.push(...l)}_createTerrain(r,l){const p=this.terrain=new Nn(r,l);this.stylesheet.terrain=r,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const _=this._setTransitionParameters({duration:0});p.updateTransitions(_)}_force3DLayerUpdate(){for(const r in this._layers){const l=this._layers[r];"fill-extrusion"===l.type&&this._updateLayer(l)}}_forceSymbolLayerUpdate(){for(const r in this._layers){const l=this._layers[r];"symbol"===l.type&&this._updateLayer(l)}}_validate(r,l,p,_,b={}){return(!b||!1!==b.validate)&&Ml(this,r.call(c.validateStyle,c.extend({key:l,style:this.serialize(),value:p,styleSpec:c.spec},_)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),c.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const r in this._layers)this._layers[r].setEventedParent(null);for(const r in this._sourceCaches)this._sourceCaches[r].clearTiles(),this._sourceCaches[r].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(r){const l=this._getSourceCaches(r);for(const p of l)p.clearTiles()}_reloadSource(r){const l=this._getSourceCaches(r);for(const p of l)p.resume(),p.reload()}_reloadSources(){for(const r of this._getSources())r.reload&&r.reload()}_updateSources(r){for(const l in this._sourceCaches)this._sourceCaches[l].update(r)}_generateCollisionBoxes(){for(const r in this._sourceCaches){const l=this._sourceCaches[r];l.resume(),l.reload()}}_updatePlacement(r,l,p,_,b=!1){let S=!1,A=!1;const R={};for(const V of this._order){const j=this._layers[V];if("symbol"!==j.type)continue;if(!R[j.source]){const E=this._getLayerSourceCache(j);if(!E)continue;R[j.source]=E.getRenderableIds(!0).map(x=>E.getTileByID(x)).sort((x,T)=>T.tileID.overscaledZ-x.tileID.overscaledZ||(x.tileID.isLessThan(T.tileID)?-1:1))}const y=this.crossTileSymbolIndex.addLayer(j,R[j.source],r.center.lng,r.projection);S=S||y}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),b=b||this._layerOrderChanged||0===p,this._layerOrderChanged&&this.fire(new c.Event("neworder")),(b||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(c.exported.now(),r.zoom))&&(this.pauseablePlacement=new ii(r,this._order,b,l,p,_,this.placement,this.fog&&r.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,R),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(c.exported.now()),A=!0),S&&this.pauseablePlacement.placement.setStale()),A||S)for(const V of this._order){const j=this._layers[V];"symbol"===j.type&&this.placement.updateLayerOpacities(j,R[j.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(c.exported.now())}_releaseSymbolFadeTiles(){for(const r in this._sourceCaches)this._sourceCaches[r].releaseSymbolFadeTiles()}getImages(r,l,p){this.imageManager.getImages(l.icons,p),this._updateTilesForChangedImages();const _=b=>{b&&b.setDependencies(l.tileID.key,l.type,l.icons)};_(this._otherSourceCaches[l.source]),_(this._symbolSourceCaches[l.source])}getGlyphs(r,l,p){this.glyphManager.getGlyphs(l.stacks,p)}getResource(r,l,p){return c.makeRequest(l,p)}_getSourceCache(r){return this._otherSourceCaches[r]}_getLayerSourceCache(r){return"symbol"===r.type?this._symbolSourceCaches[r.source]:this._otherSourceCaches[r.source]}_getSourceCaches(r){const l=[];return this._otherSourceCaches[r]&&l.push(this._otherSourceCaches[r]),this._symbolSourceCaches[r]&&l.push(this._symbolSourceCaches[r]),l}_isSourceCacheLoaded(r){const l=this._getSourceCaches(r);return 0===l.length?(this.fire(new c.ErrorEvent(new Error(`There is no source with ID '${r}'`))),!1):l.every(p=>p.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}ci.getSourceType=function(h){return Se[h]},ci.setSourceType=function(h,r){Se[h]=r},ci.registerForPluginStateChange=c.registerForPluginStateChange;var co="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#define HALF_PI PI/2.0\n#define QUARTER_PI PI/4.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0",Wo="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",dc="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\nhighp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",fc="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",pc="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif";let ba={},Pl={};const Rl=[];us(co,Rl),us(dc,Rl),us(fc,Rl),us(pc,Rl),ba=rr("",dc),Pl=rr(pc,fc);const el=rr("\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}","\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),tl=co,cs="\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif";var nl={background:rr("uniform vec4 u_color;uniform float u_opacity;\n#ifdef LIGHTING_3D_MODE\nvarying vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#ifdef LIGHTING_3D_MODE\nuniform vec4 u_color;varying vec4 v_color;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(u_color);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:rr("uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:rr("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:rr("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:rr("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:rr("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:rr("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:rr("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:rr("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}"),fill:rr("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:rr("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:rr("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:rr("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:rr("varying vec4 v_color;\n#ifdef RENDER_SHADOWS\nvarying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\nvoid main() {\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvec3 normal=v_normal;\n#endif\nfloat z;vec4 color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);\n#else\ncolor=v_color;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef ZERO_ROOF_RADIUS\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#endif\ncolor.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec4 v_color;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nv_normal=normal;\n#endif\nbase=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele;vec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);\n#ifdef RENDER_SHADOWS\nv_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(color,NdotL);\n#else\nv_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_color*=u_opacity;\n#ifdef ZERO_ROOF_RADIUS\nv_roof_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef LIGHTING_3D_MODE\nv_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));\n#else\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:rr("uniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,v_NdotL)*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_NdotL=NdotL;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif \n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:rr("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:rr("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\ngl_FragColor=apply_lighting(gl_FragColor);\n#endif\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:rr("uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\nuniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture2D(u_gradient_image,v_uv.xy);\n#else\nout_color=color;\n#endif\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef RENDER_LINE_ALPHA_DISCARD\nif (alpha < u_alpha_discard_threshold) {discard;}\n#endif\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);\n#ifdef RENDER_LINE_BORDER_AUTO\nfloat Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}\n#else\nout_color.rgb=mix(u_border_color.rgb,out_color.rgb,smoothAlpha);\n#endif\n}\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nattribute highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:rr("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting(color);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:rr("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:rr("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:rr("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:rr("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:rr("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nvarying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef RENDER_SHADOWS\ncolor.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nconst float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=u_skirt_height*u_skirt_height*wireframeOffset;\n#endif\nvec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;\n#endif\n}"),terrainDepth:rr("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:rr("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Wo),skyboxGradient:rr("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Wo),skyboxCapture:rr("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:rr("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#else\ncolor=texture2D(u_image0,v_pos0);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;\n#ifdef GLOBE_POLES\nattribute vec3 a_globe_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;\n#endif\nvarying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 latLng=u_grid_matrix*vec3(a_pos,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;\n#ifdef GLOBE_POLES\nvec3 up_vector=normalize(globe_pos)*u_tile_up_scale;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);\n#ifdef TERRAIN_WIREFRAME\nheight+=wireframeOffset;\n#endif\nglobe_pos+=up_vector*height;\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}"),globeAtmosphere:rr("uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:\n(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:\nuv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}","attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}")};function us(h,r){const l=h.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let p of l)if(p=p.trim(),"#"===p[0]&&p.includes("if")&&!p.includes("endif")){p=p.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const _=p.split(" ");for(const b of _)r.includes(b)||r.push(b)}}function rr(h,r){const l=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,p=r.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),_={},b=[...Rl];return us(h,b),us(r,b),{fragmentSource:h=h.replace(l,(S,A,R,V,j)=>(_[j]=!0,"define"===A?`\n#ifndef HAS_UNIFORM_u_${j}\nvarying ${R} ${V} ${j};\n#else\nuniform ${R} ${V} u_${j};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${j}\n    ${R} ${V} ${j} = u_${j};\n#endif\n`)),vertexSource:r=r.replace(l,(S,A,R,V,j)=>{const y="float"===V?"vec2":"vec4",E=j.match(/color/)?"color":y;return _[j]?"define"===A?`\n#ifndef HAS_UNIFORM_u_${j}\nuniform lowp float u_${j}_t;\nattribute ${R} ${y} a_${j};\nvarying ${R} ${V} ${j};\n#else\nuniform ${R} ${V} u_${j};\n#endif\n`:"vec4"===E?`\n#ifndef HAS_UNIFORM_u_${j}\n    ${j} = a_${j};\n#else\n    ${R} ${V} ${j} = u_${j};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${j}\n    ${j} = unpack_mix_${E}(a_${j}, u_${j}_t);\n#else\n    ${R} ${V} ${j} = u_${j};\n#endif\n`:"define"===A?`\n#ifndef HAS_UNIFORM_u_${j}\nuniform lowp float u_${j}_t;\nattribute ${R} ${y} a_${j};\n#else\nuniform ${R} ${V} u_${j};\n#endif\n`:"vec4"===E?`\n#ifndef HAS_UNIFORM_u_${j}\n    ${R} ${V} ${j} = a_${j};\n#else\n    ${R} ${V} ${j} = u_${j};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${j}\n    ${R} ${V} ${j} = unpack_mix_${E}(a_${j}, u_${j}_t);\n#else\n    ${R} ${V} ${j} = u_${j};\n#endif\n`}),staticAttributes:p,usedDefines:b}}class hs{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(r,l,p,_,b,S,A){this.context=r;let R=this.boundPaintVertexBuffers.length!==_.length;for(let j=0;!R&&j<_.length;j++)this.boundPaintVertexBuffers[j]!==_[j]&&(R=!0);let V=this.boundDynamicVertexBuffers.length!==A.length;for(let j=0;!V&&j<A.length;j++)this.boundDynamicVertexBuffers[j]!==A[j]&&(V=!0);if(!r.extVertexArrayObject||!this.vao||this.boundProgram!==l||this.boundLayoutVertexBuffer!==p||R||V||this.boundIndexBuffer!==b||this.boundVertexOffset!==S)this.freshBind(l,p,_,b,S,A);else{r.bindVertexArrayOES.set(this.vao);for(const j of A)j&&j.bind();b&&b.dynamicDraw&&b.bind()}}freshBind(r,l,p,_,b,S){let A;const R=r.numAttributes,V=this.context,j=V.gl;if(V.extVertexArrayObject)this.vao&&this.destroy(),this.vao=V.extVertexArrayObject.createVertexArrayOES(),V.bindVertexArrayOES.set(this.vao),A=0,this.boundProgram=r,this.boundLayoutVertexBuffer=l,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=_,this.boundVertexOffset=b,this.boundDynamicVertexBuffers=S;else{A=V.currentNumAttributes||0;for(let y=R;y<A;y++)j.disableVertexAttribArray(y)}l.enableAttributes(j,r),l.bind(),l.setVertexAttribPointers(j,r,b);for(const y of p)y.enableAttributes(j,r),y.bind(),y.setVertexAttribPointers(j,r,b);for(const y of S)y&&(y.enableAttributes(j,r),y.bind(),y.setVertexAttribPointers(j,r,b));_&&_.bind(),V.currentNumAttributes=R}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function ds(h,r){const l=Math.pow(2,r.canonical.z),p=r.canonical.y;return[new c.MercatorCoordinate(0,p/l).toLngLat().lat,new c.MercatorCoordinate(0,(p+1)/l).toLngLat().lat]}function Es(h,r,l,p,_,b,S){const A=h.context,R=A.gl,V=l.fbo;if(!V)return;h.prepareDrawTile();const j=h.useProgram("hillshade");A.activeTexture.set(R.TEXTURE0),R.bindTexture(R.TEXTURE_2D,V.colorAttachment.get());const y=((M,L,O,Z)=>{const Y=O.paint.get("hillshade-shadow-color"),oe=O.paint.get("hillshade-highlight-color"),se=O.paint.get("hillshade-accent-color");let he=O.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===O.paint.get("hillshade-illumination-anchor")&&(he-=M.transform.angle);const be=!M.options.moving;return{u_matrix:Z||M.transform.calculateProjMatrix(L.tileID.toUnwrapped(),be),u_image:0,u_latrange:ds(0,L.tileID),u_light:[O.paint.get("hillshade-exaggeration"),he],u_shadow:Y,u_highlight:oe,u_accent:se}})(h,l,p,h.terrain?r.projMatrix:null);h.prepareDrawProgram(A,j,r.toUnwrapped());const{tileBoundsBuffer:E,tileBoundsIndexBuffer:x,tileBoundsSegments:T}=h.getTileBoundsBuffers(l);j.draw(A,R.TRIANGLES,_,b,S,c.CullFaceMode.disabled,y,p.id,E,x,T)}function Ws(h,r,l){if(!r.needsDEMTextureUpload)return;const p=h.context,_=p.gl;p.pixelStoreUnpackPremultiplyAlpha.set(!1),r.demTexture=r.demTexture||h.getTileTexture(l.stride);const b=l.getPixels();r.demTexture?r.demTexture.update(b,{premultiply:!1}):r.demTexture=new c.Texture(p,b,_.RGBA,{premultiply:!1}),r.needsDEMTextureUpload=!1}function Xs(h,r,l,p,_,b){const S=h.context,A=S.gl;if(!r.dem)return;const R=r.dem;if(S.activeTexture.set(A.TEXTURE1),Ws(h,r,R),!r.demTexture)return;r.demTexture.bind(A.NEAREST,A.CLAMP_TO_EDGE);const V=R.dim;S.activeTexture.set(A.TEXTURE0);let j=r.fbo;if(!j){const T=new c.Texture(S,{width:V,height:V,data:null},A.RGBA);T.bind(A.LINEAR,A.CLAMP_TO_EDGE),j=r.fbo=S.createFramebuffer(V,V,!0),j.colorAttachment.set(T.texture)}S.bindFramebuffer.set(j.framebuffer),S.viewport.set([0,0,V,V]);const{tileBoundsBuffer:y,tileBoundsIndexBuffer:E,tileBoundsSegments:x}=h.getMercatorTileBoundsBuffers();h.useProgram("hillshadePrepare").draw(S,A.TRIANGLES,p,_,b,c.CullFaceMode.disabled,((T,M)=>{const L=M.stride,O=c.create();return c.ortho(O,0,c.EXTENT,-c.EXTENT,0,0,1),c.translate(O,O,[0,-c.EXTENT,0]),{u_matrix:O,u_image:1,u_dimension:[L,L],u_zoom:T.overscaledZ,u_unpack:M.unpackVector}})(r.tileID,R),l.id,y,E,x),r.needsHillshadePrepare=!1}const Ys=h=>({u_matrix:new c.UniformMatrix4f(h),u_image0:new c.Uniform1i(h),u_skirt_height:new c.Uniform1f(h)}),Ks=(h,r)=>({u_matrix:h,u_image0:0,u_skirt_height:r}),Js=(h,r,l,p,_,b,S,A,R,V,j,y,E,x)=>({u_proj_matrix:Float32Array.from(h),u_globe_matrix:r,u_normalize_matrix:Float32Array.from(p),u_merc_matrix:l,u_zoom_transition:_,u_merc_center:b,u_image0:0,u_frustum_tl:S,u_frustum_tr:A,u_frustum_br:R,u_frustum_bl:V,u_globe_pos:j,u_globe_radius:y,u_viewport:E,u_grid_matrix:x?Float32Array.from(x):new Float32Array(9)});function wa(h,r){return null!=h&&null!=r&&!(!h.hasData()||!r.hasData())&&null!=h.demTexture&&null!=r.demTexture&&h.tileID.key!==r.tileID.key}const uo=new class{constructor(){this.operations={}}newMorphing(h,r,l,p,_){if(h in this.operations){const b=this.operations[h];b.to.tileID.key!==l.tileID.key&&(b.queued=l)}else this.operations[h]={startTime:p,phase:0,duration:_,from:r,to:l,queued:null}}getMorphValuesForProxy(h){if(!(h in this.operations))return null;const r=this.operations[h];return{from:r.from,to:r.to,phase:r.phase}}update(h){for(const r in this.operations){const l=this.operations[r];for(l.phase=(h-l.startTime)/l.duration;l.phase>=1||!this._validOp(l);)if(!this._nextOp(l,h)){delete this.operations[r];break}}}_nextOp(h,r){return!!h.queued&&(h.from=h.to,h.to=h.queued,h.queued=null,h.phase=0,h.startTime=r,!0)}_validOp(h){return h.from.hasData()&&h.to.hasData()}},Lo={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function ui(h,r){const l=1<<h.z;return!r&&(0===h.x||h.x===l-1)||0===h.y||h.y===l-1}const Ds=h=>({u_matrix:h});function Ea(h,r,l,p,_){if(_>0){const b=c.exported.now(),S=(b-h.timeAdded)/_,A=r?(b-r.timeAdded)/_:-1,R=l.getSource(),V=p.coveringZoomLevel({tileSize:R.tileSize,roundZoom:R.roundZoom}),j=!r||Math.abs(r.tileID.overscaledZ-V)>Math.abs(h.tileID.overscaledZ-V),y=j&&h.refreshedUponExpiration?1:c.clamp(j?S:1-A,0,1);return h.refreshedUponExpiration&&S>=1&&(h.refreshedUponExpiration=!1),r?{opacity:1,mix:1-y}:{opacity:y,mix:0}}return{opacity:1,mix:0}}class gn extends c.SourceCache{constructor(r){const l={type:"raster-dem",maxzoom:r.transform.maxZoom},p=new Lt(yt(),null),_=Ce("mock-dem",l,p,r.style);super("mock-dem",_,!1),_.setEventedParent(this),this._sourceLoaded=!0}_loadTile(r,l){r.state="loaded",l(null)}}class Qs extends c.SourceCache{constructor(r){const l=Ce("proxy",{type:"geojson",maxzoom:r.transform.maxZoom},new Lt(yt(),null),r.style);super("proxy",l,!1),l.setEventedParent(this),this.map=this.getSource().map=r,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(r,l,p){if(r.freezeTileCoverage)return;this.transform=r;const _=r.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((b,S)=>{if(b[S.key]="",!this._tiles[S.key]){const A=new c.Tile(S,this._source.tileSize*S.overscaleFactor(),r.tileZoom);A.state="loaded",this._tiles[S.key]=A}return b},{});for(const b in this._tiles)b in _||(this.freeFBO(b),this._tiles[b].unloadVectorData(),delete this._tiles[b])}freeFBO(r){const l=this.proxyCachedFBO[r];if(void 0!==l){const p=Object.values(l);this.renderCachePool.push(...p),delete this.proxyCachedFBO[r]}}deallocRenderCache(){this.renderCache.forEach(r=>r.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Ts extends c.OverscaledTileID{constructor(r,l,p){super(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,r.canonical.y),this.proxyTileKey=l,this.projMatrix=p}}class ho extends c.Elevation{constructor(r,l){super(),this.painter=r,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[p,_,b]=function(R){const V=new c.StructArrayLayout4i8,j=new c.StructArrayLayout3ui6,y=131;V.reserve(17161),j.reserve(33800);const E=c.EXTENT/128,x=c.EXTENT+E/2,T=x+E;for(let L=-E;L<T;L+=E)for(let O=-E;O<T;O+=E){const Z=O<0||O>x||L<0||L>x?24575:0,Y=c.clamp(Math.round(O),0,c.EXTENT),oe=c.clamp(Math.round(L),0,c.EXTENT);V.emplaceBack(Y+Z,oe,Y,oe)}const M=(L,O)=>{const Z=O*y+L;j.emplaceBack(Z+1,Z,Z+y),j.emplaceBack(Z+y,Z+y+1,Z+1)};for(let L=1;L<129;L++)for(let O=1;O<129;O++)M(O,L);return[0,129].forEach(L=>{for(let O=0;O<130;O++)M(O,L),M(L,O)}),[V,j,32768]}(),S=r.context;this.gridBuffer=S.createVertexBuffer(p,c.boundsAttributes.members),this.gridIndexBuffer=S.createIndexBuffer(_),this.gridSegments=c.SegmentVector.simpleSegment(0,0,p.length,_.length),this.gridNoSkirtSegments=c.SegmentVector.simpleSegment(0,0,p.length,b),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Qs(l.map),this.orthoMatrix=c.create(),c.ortho(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,c.EXTENT,0,c.EXTENT,0,1);const A=S.gl;this._overlapStencilMode=new c.StencilMode({func:A.GEQUAL,mask:255},0,255,A.KEEP,A.KEEP,A.REPLACE),this._previousZoom=r.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=l,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new gn(l.map)}set style(r){r.on("data",this._onStyleDataEvent.bind(this)),r.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=r,this._checkRenderCacheEfficiency()}update(r,l,p){if(r&&r.terrain){this._style!==r&&(this.style=r),this.enabled=!0;const _=r.terrain.properties;this.sourceCache=0===r.terrain.drapeRenderMode?this._mockSourceCache:r._getSourceCache(_.get("source")),this._exaggeration=_.get("exaggeration");const b=()=>{this.sourceCache.used&&c.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const S=this.getScaledDemTileSize();this.sourceCache.update(l,S,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,b(),this._initializing=!0),b(),l.updateElevation(!0,p),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(l),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(r){this._findCoveringTileCache[r]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const r=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==r.efficiency&&c.warnOnce(`Terrain render cache efficiency is not optimal (${r.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${r.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(r){r.coord&&"source"===r.dataType?this._clearRenderCacheForTile(r.sourceCacheId,r.coord):"style"===r.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const r in this._style._sourceCaches)this._style._sourceCaches[r].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(r=>r.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const r=2*this.proxySourceCache.getSource().tileSize;return[r,r]}set useVertexMorphing(r){this._useVertexMorphing=r}updateTileBinding(r){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const l=this.proxySourceCache,p=this.painter.transform;this._initializing&&(this._initializing=0===p._centerAltitude&&-1===this.getAtPointOrZero(c.MercatorCoordinate.fromLngLat(p.center),-1),this._emptyDEMTextureDirty=!this._initializing);const _=this.proxyCoords=l.getIds().map(R=>{const V=l.getTileByID(R).tileID;return V.projMatrix=p.calculateProjMatrix(V.toUnwrapped()),V});(function(R,V){const j=V.transform.pointCoordinate(V.transform.getCameraPoint()),y=new c.pointGeometry(j.x,j.y);R.sort((E,x)=>{if(x.overscaledZ-E.overscaledZ)return x.overscaledZ-E.overscaledZ;const T=new c.pointGeometry(E.canonical.x+(1<<E.canonical.z)*E.wrap,E.canonical.y),M=new c.pointGeometry(x.canonical.x+(1<<x.canonical.z)*x.wrap,x.canonical.y),L=y.mult(1<<E.canonical.z);return L.x-=.5,L.y-=.5,L.distSqr(T)-L.distSqr(M)})})(_,this.painter),this._previousZoom=p.zoom;const b=this.proxyToSource||{};this.proxyToSource={},_.forEach(R=>{this.proxyToSource[R.key]={}}),this.terrainTileForTile={};const S=this._style._sourceCaches;for(const R in S){const V=S[R];if(!V.used||(V!==this.sourceCache&&this.resetTileLookupCache(V.id),this._setupProxiedCoordsForOrtho(V,r[R],b),V.usedForTerrain))continue;const j=r[R];V.getSource().reparseOverscaled&&this._assignTerrainTiles(j)}this.proxiedCoords[l.id]=_.map(R=>new Ts(R,R.key,this.orthoMatrix)),this._assignTerrainTiles(_),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(b),this.renderingToTexture=!1,this._updateTimestamp=c.exported.now();const A={};this._visibleDemTiles=[];for(const R of this.proxyCoords){const V=this.terrainTileForTile[R.key];if(!V)continue;const j=V.tileID.key;j in A||(this._visibleDemTiles.push(V),A[j]=j)}}_assignTerrainTiles(r){this._initializing||r.forEach(l=>{if(this.terrainTileForTile[l.key])return;const p=this._findTileCoveringTileID(l,this.sourceCache);p&&(this.terrainTileForTile[l.key]=p)})}_prepareDEMTextures(){const r=this.painter.context,l=r.gl;for(const p in this.terrainTileForTile){const _=this.terrainTileForTile[p],b=_.dem;!b||_.demTexture&&!_.needsDEMTextureUpload||(r.activeTexture.set(l.TEXTURE1),Ws(this.painter,_,b))}}_prepareDemTileUniforms(r,l,p,_){if(!l||null==l.demTexture)return!1;const b=r.tileID.canonical,S=Math.pow(2,l.tileID.canonical.z-b.z),A=_||"";return p[`u_dem_tl${A}`]=[b.x*S%1,b.y*S%1],p[`u_dem_scale${A}`]=S,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const r=this.painter.context,l=r.gl;if(!this._emptyDepthBufferTexture){const p=new c.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new c.Texture(r,p,l.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let r=0;const l=this._visibleDemTiles.reduce((p,_)=>{if(!_.dem)return p;const b=_.dem.tree.minimums[0];return b>0&&r++,p+b},0);return r?l/r:0}_updateEmptyDEMTexture(){const r=this.painter.context,l=r.gl;r.activeTexture.set(l.TEXTURE2);const p=this._getLoadedAreaMinimum(),_=new c.RGBAImage({width:1,height:1},new Uint8Array(c.DEMData.pack(p,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let b=this._emptyDEMTexture;return b?b.update(_,{premultiply:!1}):b=this._emptyDEMTexture=new c.Texture(r,_,l.RGBA,{premultiply:!1}),b}setupElevationDraw(r,l,p){const _=this.painter.context,b=_.gl,S=(A=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:c.DEMData.getUnpackVector(A),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var A;S.u_dem_size=this.sourceCache.getSource().tileSize,S.u_exaggeration=this.exaggeration();let R=null,V=null,j=1;if(p&&p.morphing&&this._useVertexMorphing){const y=p.morphing.srcDemTile,E=p.morphing.dstDemTile;j=p.morphing.phase,y&&E&&(this._prepareDemTileUniforms(r,y,S,"_prev")&&(V=y),this._prepareDemTileUniforms(r,E,S)&&(R=E))}if(V&&R?(_.activeTexture.set(b.TEXTURE2),R.demTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE,b.NEAREST),_.activeTexture.set(b.TEXTURE4),V.demTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE,b.NEAREST),S.u_dem_lerp=j):(R=this.terrainTileForTile[r.tileID.key],_.activeTexture.set(b.TEXTURE2),(this._prepareDemTileUniforms(r,R,S)?R.demTexture:this.emptyDEMTexture).bind(b.NEAREST,b.CLAMP_TO_EDGE)),_.activeTexture.set(b.TEXTURE3),p&&p.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),this._depthFBO&&(S.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),S.u_depth_size_inv=[1,1]),p&&p.useMeterToDem&&R){const y=(1<<R.tileID.canonical.z)*c.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;S.u_meter_to_dem=y}if(p&&p.labelPlaneMatrixInv&&(S.u_label_plane_matrix_inv=p.labelPlaneMatrixInv),l.setTerrainUniformValues(_,S),"globe"===this.painter.transform.projection.name){const y=this.globeUniformValues(this.painter.transform,r.tileID.canonical,p&&p.useDenormalizedUpVectorScale);l.setGlobeUniformValues(_,y)}}globeUniformValues(r,l,p){const _=r.projection;return{u_tile_tl_up:_.upVector(l,0,0),u_tile_tr_up:_.upVector(l,c.EXTENT,0),u_tile_br_up:_.upVector(l,c.EXTENT,c.EXTENT),u_tile_bl_up:_.upVector(l,0,c.EXTENT),u_tile_up_scale:p?c.GLOBE_METERS_TO_ECEF:_.upVectorScale(l,r.center.lat,r.worldSize).metersToTile}}renderToBackBuffer(r){const l=this.painter,p=this.painter.context;0!==r.length&&(p.bindFramebuffer.set(null),p.viewport.set([0,0,l.width,l.height]),l.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(_,b,S,A,R){if("globe"===_.transform.projection.name)!function(V,j,y,E,x){const T=V.context,M=T.gl;let L,O;const Z=V.options.showTerrainWireframe?2:0,Y=V.transform,oe=c.globeUseCustomAntiAliasing(V,T,Y),se=(ct,Ne)=>{if(O===ct)return;const Ke=[Lo[ct],"PROJECTION_GLOBE_VIEW"];oe&&Ke.push("CUSTOM_ANTIALIASING"),Ne&&Ke.push(Lo[Z]),L=V.useProgram("globeRaster",null,Ke),O=ct},he=V.colorModeForRenderPass(),be=new c.DepthMode(M.LEQUAL,c.DepthMode.ReadWrite,V.depthRangeFor3D);uo.update(x);const Le=c.calculateGlobeMercatorMatrix(Y),Pe=[c.mercatorXfromLng(Y.center.lng),c.mercatorYfromLat(Y.center.lat)],Te=Z?[!1,!0]:[!1],et=V.globeSharedBuffers,Re=[Y.width*c.exported.devicePixelRatio,Y.height*c.exported.devicePixelRatio],He=Float32Array.from(Y.globeMatrix),ze={useDenormalizedUpVectorScale:!0};if(Te.forEach(ct=>{O=-1;const Ne=ct?M.LINES:M.TRIANGLES;for(const Ke of E){const vt=y.getTile(Ke),Ae=c.StencilMode.disabled,Be=j.prevTerrainTileForTile[Ke.key],Zt=j.terrainTileForTile[Ke.key];wa(Be,Zt)&&uo.newMorphing(Ke.key,Be,Zt,x,250),T.activeTexture.set(M.TEXTURE0),vt.texture.bind(M.LINEAR,M.CLAMP_TO_EDGE);const an=uo.getMorphValuesForProxy(Ke.key),qt=an?1:0;an&&c.extend$1(ze,{morphing:{srcDemTile:an.from,dstDemTile:an.to,phase:c.easeCubicInOut(an.phase)}});const mn=c.tileCornersToBounds(Ke.canonical),Pn=c.getLatitudinalLod(mn.getCenter().lat),tn=c.getGridMatrix(Ke.canonical,mn,Pn,Y.worldSize/Y._pixelsPerMercatorPixel),Ft=c.globeNormalizeECEF(c.globeTileBounds(Ke.canonical)),vr=Js(Y.projMatrix,He,Le,Ft,c.globeToMercatorTransition(Y.zoom),Pe,Y.frustumCorners.TL,Y.frustumCorners.TR,Y.frustumCorners.BR,Y.frustumCorners.BL,Y.globeCenterInViewSpace,Y.globeRadius,Re,tn);if(se(qt,ct),j.setupElevationDraw(vt,L,ze),V.prepareDrawProgram(T,L,Ke.toUnwrapped()),et){const[hr,Mr,xr]=ct?et.getWirefameBuffers(V.context,Pn):et.getGridBuffers(Pn);L.draw(T,Ne,be,Ae,he,c.CullFaceMode.backCCW,vr,"globe_raster",hr,Mr,xr)}}}),et){const ct=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];oe&&ct.push("CUSTOM_ANTIALIASING"),L=V.useProgram("globeRaster",null,ct);for(const Ne of E){const{x:Ke,y:vt,z:Ae}=Ne.canonical,Be=0===vt,Zt=vt===(1<<Ae)-1,[an,qt,mn,Pn]=et.getPoleBuffers(Ae);if(Pn&&(Be||Zt)){const tn=y.getTile(Ne);T.activeTexture.set(M.TEXTURE0),tn.texture.bind(M.LINEAR,M.CLAMP_TO_EDGE);let Ft=c.globePoleMatrixForTile(Ae,Ke,Y);const vr=c.globeNormalizeECEF(c.globeTileBounds(Ne.canonical)),hr=(Mr,xr)=>Mr.draw(T,M.TRIANGLES,be,c.StencilMode.disabled,he,c.CullFaceMode.disabled,Js(Y.projMatrix,Ft,Ft,vr,0,Pe,Y.frustumCorners.TL,Y.frustumCorners.TR,Y.frustumCorners.BR,Y.frustumCorners.BL,Y.globeCenterInViewSpace,Y.globeRadius,Re),"globe_pole_raster",xr,mn,Pn);j.setupElevationDraw(tn,L,ze),V.prepareDrawProgram(T,L,Ne.toUnwrapped()),Be&&hr(L,an),Zt&&(Ft=c.scale(c.create(),Ft,[1,-1,1]),hr(L,qt))}}}}(_,b,S,A,R);else{const V=_.context,j=V.gl;let y,E;const x=_.options.showTerrainWireframe?2:0,T=(Y,oe)=>{if(E===Y)return;const se=[Lo[Y]];oe&&se.push(Lo[x]),y=_.useProgram("terrainRaster",null,se),E=Y},M=_.colorModeForRenderPass(),L=new c.DepthMode(j.LEQUAL,c.DepthMode.ReadWrite,_.depthRangeFor3D);uo.update(R);const O=_.transform,Z=6*Math.pow(1.5,22-O.zoom)*b.exaggeration();(x?[!1,!0]:[!1]).forEach(Y=>{E=-1;const oe=Y?j.LINES:j.TRIANGLES,[se,he]=Y?b.getWirefameBuffer():[b.gridIndexBuffer,b.gridSegments];for(const be of A){const Le=S.getTile(be),Pe=c.StencilMode.disabled,Te=b.prevTerrainTileForTile[be.key],et=b.terrainTileForTile[be.key];wa(Te,et)&&uo.newMorphing(be.key,Te,et,R,250),V.activeTexture.set(j.TEXTURE0),Le.texture.bind(j.LINEAR,j.CLAMP_TO_EDGE,j.LINEAR_MIPMAP_NEAREST);const Re=uo.getMorphValuesForProxy(be.key),He=Re?1:0;let ze;Re&&(ze={morphing:{srcDemTile:Re.from,dstDemTile:Re.to,phase:c.easeCubicInOut(Re.phase)}});const ct=Ks(be.projMatrix,ui(be.canonical,O.renderWorldCopies)?Z/10:Z);T(He,Y),b.setupElevationDraw(Le,y,ze),_.prepareDrawProgram(V,y,be.toUnwrapped()),y.draw(V,oe,L,Pe,M,c.CullFaceMode.backCCW,ct,"terrain_raster",b.gridBuffer,se,he)}})}}(l,this,this.proxySourceCache,r,this._updateTimestamp),this.renderingToTexture=!0,l.gpuTimingDeferredRenderEnd(),r.splice(0,r.length))}renderBatch(r){if(0===this._drapedRenderBatches.length)return r+1;this.renderingToTexture=!0;const l=this.painter,p=this.painter.context,_=this.proxySourceCache,b=this.proxiedCoords[_.id],S=this._drapedRenderBatches.shift(),A=[],R=l.style.order;let V=0;for(const j of b){const y=_.getTileByID(j.proxyTileKey),E=_.proxyCachedFBO[j.key]?_.proxyCachedFBO[j.key][r]:void 0,x=void 0!==E?_.renderCache[E]:this.pool[V++],T=void 0!==E;if(y.texture=x.tex,T&&!x.dirty){A.push(y.tileID);continue}let M;p.bindFramebuffer.set(x.fb.framebuffer),this.renderedToTile=!1,x.dirty&&(p.clear({color:c.Color.transparent,stencil:0}),x.dirty=!1);for(let L=S.start;L<=S.end;++L){const O=l.style._layers[R[L]];if(O.isHidden(l.transform.zoom))continue;const Z=l.style._getLayerSourceCache(O),Y=Z?this.proxyToSource[j.key][Z.id]:[j];if(!Y)continue;const oe=Y;p.viewport.set([0,0,x.fb.width,x.fb.height]),M!==(Z?Z.id:null)&&(this._setupStencil(x,Y,O,Z),M=Z?Z.id:null),l.renderLayer(l,Z,O,oe)}this.renderedToTile?(x.dirty=!0,A.push(y.tileID)):T||--V,5===V&&(V=0,this.renderToBackBuffer(A))}return this.renderToBackBuffer(A),this.renderingToTexture=!1,p.bindFramebuffer.set(null),p.viewport.set([0,0,l.width,l.height]),S.end+1}postRender(){}renderCacheEfficiency(r){const l=r.order.length;if(0===l)return{efficiency:100};let p,_=0,b=0,S=!1;for(let A=0;A<l;++A){const R=r._layers[r.order[A]];this._style.isLayerDraped(R)?(S&&++_,++b):S||(S=!0,p=R.id)}return 0===b?{efficiency:100}:{efficiency:100*(1-_/b),firstUndrapedLayer:p}}getMinElevationBelowMSL(){let r=0;return this._visibleDemTiles.filter(l=>l.dem).forEach(l=>{r=Math.min(r,l.dem.tree.minimums[0])}),0===r?r:(r-30)*this._exaggeration}raycast(r,l,p){if(!this._visibleDemTiles)return null;const _=this._visibleDemTiles.filter(b=>b.dem).map(b=>{const S=b.tileID,A=1<<S.overscaledZ,{x:R,y:V}=S.canonical,j=R/A,y=(R+1)/A,E=V/A,x=(V+1)/A;return{minx:j,miny:E,maxx:y,maxy:x,t:b.dem.tree.raycastRoot(j,E,y,x,r,l,p),tile:b}});_.sort((b,S)=>(null!==b.t?b.t:Number.MAX_VALUE)-(null!==S.t?S.t:Number.MAX_VALUE));for(const b of _){if(null==b.t)return null;const S=b.tile.dem.tree.raycast(b.minx,b.miny,b.maxx,b.maxy,r,l,p);if(null!=S)return S}return null}_createFBO(){const r=this.painter.context,l=r.gl,p=this.drapeBufferSize;r.activeTexture.set(l.TEXTURE0);const _=new c.Texture(r,{width:p[0],height:p[1],data:null},l.RGBA);_.bind(l.LINEAR,l.CLAMP_TO_EDGE);const b=r.createFramebuffer(p[0],p[1],!1);return b.colorAttachment.set(_.texture),b.depthAttachment=new Ui(r,b.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=r.createRenderbuffer(r.gl.DEPTH_STENCIL,p[0],p[1]),this._stencilRef=0,b.depthAttachment.set(this._sharedDepthStencil),r.clear({stencil:0})):b.depthAttachment.set(this._sharedDepthStencil),r.extTextureFilterAnisotropic&&!r.extTextureFilterAnisotropicForceOff&&l.texParameterf(l.TEXTURE_2D,r.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,r.extTextureFilterAnisotropicMax),{fb:b,tex:_,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const r in this._style._sourceCaches)if(this._style._sourceCaches[r].hasTransition())return!0;return this._style.order.some(r=>{const l=this._style._layers[r],p=l.isHidden(this.painter.transform.zoom);return"custom"!==l.type&&!p&&l.hasTransition()})}_clearRasterFadeFromRenderCache(){let r=!1;for(const l in this._style._sourceCaches)if(this._style._sourceCaches[l]._source instanceof X){r=!0;break}if(r)for(let l=0;l<this._style.order.length;++l){const p=this._style._layers[this._style.order[l]],_=p.isHidden(this.painter.transform.zoom),b=this._style._getLayerSourceCache(p);if("raster"!==p.type||_||!b)continue;const S=p.paint.get("raster-fade-duration");for(const A of this.proxyCoords){const R=this.proxyToSource[A.key][b.id];if(R)for(const V of R){const j=Ea(b.getTile(V),b.findLoadedParent(V,0),b,this.painter.transform,S);(1!==j.opacity||0!==j.mix)&&this._clearRenderCacheForTile(b.id,V)}}}}_setupDrapedRenderBatches(){const r=this._style.order,l=r.length;if(0===l)return;const p=[];let _,b=0,S=this._style._layers[r[b]];for(;!this._style.isLayerDraped(S)&&S.isHidden(this.painter.transform.zoom)&&++b<l;)S=this._style._layers[r[b]];for(;b<l;++b){const A=this._style._layers[r[b]];A.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(A)?void 0===_&&(_=b):void 0!==_&&(p.push({start:_,end:b-1}),_=void 0))}void 0!==_&&p.push({start:_,end:b-1}),this._drapedRenderBatches=p}_setupRenderCache(r){const l=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,l.renderCache.length>l.renderCachePool.length){const S=Object.values(l.proxyCachedFBO);l.proxyCachedFBO={};for(let A=0;A<S.length;++A){const R=Object.values(S[A]);l.renderCachePool.push(...R)}}return}this._clearRasterFadeFromRenderCache();const p=this.proxyCoords,_=this._tilesDirty;for(let S=p.length-1;S>=0;S--){const A=p[S];if(l.getTileByID(A.key),void 0!==l.proxyCachedFBO[A.key]){const R=r[A.key],V=this.proxyToSource[A.key];let j=0;for(const y in V){const E=V[y],x=R[y];if(!x||x.length!==E.length||E.some((T,M)=>T!==x[M]||_[y]&&_[y].hasOwnProperty(T.key))){j=-1;break}++j}for(const y in l.proxyCachedFBO[A.key])l.renderCache[l.proxyCachedFBO[A.key][y]].dirty=j<0||j!==Object.values(R).length}}const b=[...this._drapedRenderBatches];b.sort((S,A)=>A.end-A.start-(S.end-S.start));for(const S of b)for(const A of p){if(l.proxyCachedFBO[A.key])continue;let R=l.renderCachePool.pop();void 0===R&&l.renderCache.length<50&&(R=l.renderCache.length,l.renderCache.push(this._createFBO())),void 0!==R&&(l.proxyCachedFBO[A.key]={},l.proxyCachedFBO[A.key][S.start]=R,l.renderCache[R].dirty=!0)}this._tilesDirty={}}_setupStencil(r,l,p,_){if(!_||!this._sourceTilesOverlap[_.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const b=this.painter.context,S=b.gl;if(l.length<=1)return void(this._overlapStencilType=!1);let A;if(p.isTileClipped())A=l.length,this._overlapStencilMode.test={func:S.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(l[0].overscaledZ>l[l.length-1].overscaledZ))return void(this._overlapStencilType=!1);A=1,this._overlapStencilMode.test={func:S.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+A>255&&(b.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=A,this._overlapStencilMode.ref=this._stencilRef,p.isTileClipped()&&this._renderTileClippingMasks(l,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(r){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[r.key]),this._overlapStencilMode):c.StencilMode.disabled}_renderTileClippingMasks(r,l){const p=this.painter,_=this.painter.context,b=_.gl;p._tileClippingMaskIDs={},_.setColorMode(c.ColorMode.disabled),_.setDepthMode(c.DepthMode.disabled);const S=p.useProgram("clippingMask");for(const A of r){const R=p._tileClippingMaskIDs[A.key]=--l;S.draw(_,b.TRIANGLES,c.DepthMode.disabled,new c.StencilMode({func:b.ALWAYS,mask:0},R,255,b.KEEP,b.KEEP,b.REPLACE),c.ColorMode.disabled,c.CullFaceMode.disabled,Ds(A.projMatrix),"$clipping",p.tileExtentBuffer,p.quadTriangleIndexBuffer,p.tileExtentSegments)}}pointCoordinate(r){const l=this.painter.transform;if(r.x<0||r.x>l.width||r.y<0||r.y>l.height)return null;const p=[r.x,r.y,1,1];c.transformMat4$1(p,p,l.pixelMatrixInverse),c.scale$1(p,p,1/p[3]),p[0]/=l.worldSize,p[1]/=l.worldSize;const _=l._camera.position,b=c.mercatorZfromAltitude(1,l.center.lat),S=[_[0],_[1],_[2]/b,0],A=c.subtract([],p.slice(0,3),S);c.normalize(A,A);const R=this.raycast(S,A,this._exaggeration);return null!==R&&R?(c.scaleAndAdd(S,S,A,R),S[3]=S[2],S[2]*=b,S):null}drawDepth(){const r=this.painter,l=r.context,p=this.proxySourceCache,_=Math.ceil(r.width),b=Math.ceil(r.height);if(!this._depthFBO||this._depthFBO.width===_&&this._depthFBO.height===b||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const S=l.gl,A=l.createFramebuffer(_,b,!0);l.activeTexture.set(S.TEXTURE0);const R=new c.Texture(l,{width:_,height:b,data:null},S.RGBA);R.bind(S.NEAREST,S.CLAMP_TO_EDGE),A.colorAttachment.set(R.texture);const V=l.createRenderbuffer(l.gl.DEPTH_COMPONENT16,_,b);A.depthAttachment.set(V),this._depthFBO=A,this._depthTexture=R}l.bindFramebuffer.set(this._depthFBO.framebuffer),l.viewport.set([0,0,_,b]),function(S,A,R,V){if("globe"===S.transform.projection.name)return;const j=S.context,y=j.gl;j.clear({depth:1});const E=S.useProgram("terrainDepth"),x=new c.DepthMode(y.LESS,c.DepthMode.ReadWrite,S.depthRangeFor3D);for(const T of V){const M=R.getTile(T),L=Ks(T.projMatrix,0);A.setupElevationDraw(M,E),E.draw(j,y.TRIANGLES,x,c.StencilMode.disabled,c.ColorMode.unblended,c.CullFaceMode.backCCW,L,"terrain_depth",A.gridBuffer,A.gridIndexBuffer,A.gridNoSkirtSegments)}}(r,this,p,this.proxyCoords)}_setupProxiedCoordsForOrtho(r,l,p){if(r.getSource()instanceof xe)return this._setupProxiedCoordsForImageSource(r,l,p);this._findCoveringTileCache[r.id]=this._findCoveringTileCache[r.id]||{};const _=this.proxiedCoords[r.id]=[],b=this.proxyCoords;for(let A=0;A<b.length;A++){const R=b[A],V=this._findTileCoveringTileID(R,r);if(V){const j=this._createProxiedId(R,V,p[R.key]&&p[R.key][r.id]);_.push(j),this.proxyToSource[R.key][r.id]=[j]}}let S=!1;for(let A=0;A<l.length;A++){const R=r.getTile(l[A]);if(!R||!R.hasData())continue;const V=this._findTileCoveringTileID(R.tileID,this.proxySourceCache);if(V&&V.tileID.canonical.z!==R.tileID.canonical.z){const j=this.proxyToSource[V.tileID.key][r.id],y=this._createProxiedId(V.tileID,R,p[V.tileID.key]&&p[V.tileID.key][r.id]);j?j.splice(j.length-1,0,y):this.proxyToSource[V.tileID.key][r.id]=[y],_.push(y),S=!0}}this._sourceTilesOverlap[r.id]=S}_setupProxiedCoordsForImageSource(r,l,p){if(!r.getSource().loaded())return;const _=this.proxiedCoords[r.id]=[],b=this.proxyCoords,S=r.getSource(),A=new c.pointGeometry(S.tileID.x,S.tileID.y)._div(1<<S.tileID.z),R=S.coordinates.map(c.MercatorCoordinate.fromLngLat).reduce((j,y)=>(j.min.x=Math.min(j.min.x,y.x-A.x),j.min.y=Math.min(j.min.y,y.y-A.y),j.max.x=Math.max(j.max.x,y.x-A.x),j.max.y=Math.max(j.max.y,y.y-A.y),j),{min:new c.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new c.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),V=(j,y)=>{const E=j.wrap+j.canonical.x/(1<<j.canonical.z),x=j.canonical.y/(1<<j.canonical.z),T=c.EXTENT/(1<<j.canonical.z),M=y.wrap+y.canonical.x/(1<<y.canonical.z),L=y.canonical.y/(1<<y.canonical.z);return E+T<M+R.min.x||E>M+R.max.x||x+T<L+R.min.y||x>L+R.max.y};for(let j=0;j<b.length;j++){const y=b[j];for(let E=0;E<l.length;E++){const x=r.getTile(l[E]);if(!x||!x.hasData()||V(y,x.tileID))continue;const T=this._createProxiedId(y,x,p[y.key]&&p[y.key][r.id]),M=this.proxyToSource[y.key][r.id];M?M.push(T):this.proxyToSource[y.key][r.id]=[T],_.push(T)}}}_createProxiedId(r,l,p){let _=this.orthoMatrix;if(p){const b=p.find(S=>S.key===l.tileID.key);if(b)return b}if(l.tileID.key!==r.key){const b=r.canonical.z-l.tileID.canonical.z;let S,A,R;_=c.create();const V=l.tileID.wrap-r.wrap<<r.overscaledZ;b>0?(S=c.EXTENT>>b,A=S*((l.tileID.canonical.x<<b)-r.canonical.x+V),R=S*((l.tileID.canonical.y<<b)-r.canonical.y)):(S=c.EXTENT<<-b,A=c.EXTENT*(l.tileID.canonical.x-(r.canonical.x+V<<-b)),R=c.EXTENT*(l.tileID.canonical.y-(r.canonical.y<<-b))),c.ortho(_,0,S,0,S,0,1),c.translate(_,_,[A,R,0])}return new Ts(l.tileID,r.key,_)}_findTileCoveringTileID(r,l){let p=l.getTile(r);if(p&&p.hasData())return p;const _=this._findCoveringTileCache[l.id],b=_[r.key];if(p=b?l.getTileByID(b):null,p&&p.hasData()||null===b)return p;let S=p?p.tileID:r,A=S.overscaledZ;const R=l.getSource().minzoom,V=[];if(!b){const y=l.getSource().maxzoom;if(r.canonical.z>=y){const E=r.canonical.z-y;l.getSource().reparseOverscaled?(A=Math.max(r.canonical.z+2,l.transform.tileZoom),S=new c.OverscaledTileID(A,r.wrap,y,r.canonical.x>>E,r.canonical.y>>E)):0!==E&&(A=y,S=new c.OverscaledTileID(A,r.wrap,y,r.canonical.x>>E,r.canonical.y>>E))}S.key!==r.key&&(V.push(S.key),p=l.getTile(S))}const j=y=>{V.forEach(E=>{_[E]=y}),V.length=0};for(A-=1;A>=R&&(!p||!p.hasData());A--){p&&j(p.tileID.key);const y=S.calculateScaledKey(A);if(p=l.getTileByID(y),p&&p.hasData())break;const E=_[y];if(null===E)break;void 0===E?V.push(y):p=l.getTileByID(E)}return j(p?p.tileID.key:null),p&&p.hasData()?p:null}findDEMTileFor(r){return this.enabled?this._findTileCoveringTileID(r,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(r,l){let p=this._tilesDirty[r];p||(p=this._tilesDirty[r]={}),p[l.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const r=function(l){let p=0;const _=new c.StructArrayLayout2ui4,b=131;for(let S=1;S<129;S++){for(let A=1;A<129;A++)p=S*b+A,_.emplaceBack(p,p+1),_.emplaceBack(p,p+b),_.emplaceBack(p+1,p+b),128===S&&_.emplaceBack(p+b,p+b+1);_.emplaceBack(p+1,p+1+b)}return _}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(r),this.wireframeSegments=c.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,r.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class mc{static cacheKey(r,l,p,_){let b=`${l}${_?_.cacheKey:""}`;for(const S of p)r.usedDefines.includes(S)&&(b+=`/${S}`);return b}constructor(r,l,p,_,b,S){const A=r.gl;this.program=A.createProgram();const R=function(L){const O=[];for(let Z=0;Z<L.length;Z++){if(null===L[Z])continue;const Y=L[Z].split(" ");O.push(Y.pop())}return O}(p.staticAttributes),V=_?_.getBinderAttributes():[],j=R.concat(V);let y=_?_.defines():[];y=y.concat(S.map(L=>`#define ${L}`));const E=y.concat(r.extStandardDerivatives?"#extension GL_OES_standard_derivatives : enable\n".concat(cs):cs,cs,tl,el.fragmentSource,Pl.fragmentSource,p.fragmentSource).join("\n"),x=y.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",tl,el.vertexSource,Pl.vertexSource,ba.vertexSource,p.vertexSource).join("\n"),T=A.createShader(A.FRAGMENT_SHADER);if(A.isContextLost())return void(this.failedToCreate=!0);A.shaderSource(T,E),A.compileShader(T),A.attachShader(this.program,T);const M=A.createShader(A.VERTEX_SHADER);if(A.isContextLost())this.failedToCreate=!0;else{A.shaderSource(M,x),A.compileShader(M),A.attachShader(this.program,M),this.attributes={},this.numAttributes=j.length;for(let L=0;L<this.numAttributes;L++)j[L]&&(A.bindAttribLocation(this.program,L,j[L]),this.attributes[j[L]]=L);A.linkProgram(this.program),A.deleteShader(M),A.deleteShader(T),this.fixedUniforms=b(r),this.binderUniforms=_?_.getUniforms(r):[],S.includes("TERRAIN")&&(this.terrainUniforms={u_dem:new c.Uniform1i(L=r),u_dem_prev:new c.Uniform1i(L),u_dem_unpack:new c.Uniform4f(L),u_dem_tl:new c.Uniform2f(L),u_dem_scale:new c.Uniform1f(L),u_dem_tl_prev:new c.Uniform2f(L),u_dem_scale_prev:new c.Uniform1f(L),u_dem_size:new c.Uniform1f(L),u_dem_lerp:new c.Uniform1f(L),u_exaggeration:new c.Uniform1f(L),u_depth:new c.Uniform1i(L),u_depth_size_inv:new c.Uniform2f(L),u_meter_to_dem:new c.Uniform1f(L),u_label_plane_matrix_inv:new c.UniformMatrix4f(L)}),S.includes("GLOBE")&&(this.globeUniforms=(L=>({u_tile_tl_up:new c.Uniform3f(L),u_tile_tr_up:new c.Uniform3f(L),u_tile_br_up:new c.Uniform3f(L),u_tile_bl_up:new c.Uniform3f(L),u_tile_up_scale:new c.Uniform1f(L)}))(r)),S.includes("FOG")&&(this.fogUniforms=(L=>({u_fog_matrix:new c.UniformMatrix4f(L),u_fog_range:new c.Uniform2f(L),u_fog_color:new c.Uniform4f(L),u_fog_horizon_blend:new c.Uniform1f(L),u_fog_temporal_offset:new c.Uniform1f(L),u_frustum_tl:new c.Uniform3f(L),u_frustum_tr:new c.Uniform3f(L),u_frustum_br:new c.Uniform3f(L),u_frustum_bl:new c.Uniform3f(L),u_globe_pos:new c.Uniform3f(L),u_globe_radius:new c.Uniform1f(L),u_globe_transition:new c.Uniform1f(L),u_is_globe:new c.Uniform1i(L),u_viewport:new c.Uniform2f(L)}))(r))}var L}setTerrainUniformValues(r,l){if(!this.terrainUniforms)return;const p=this.terrainUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const _ in l)p[_]&&p[_].set(this.program,_,l[_])}}setGlobeUniformValues(r,l){if(!this.globeUniforms)return;const p=this.globeUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const _ in l)p[_]&&p[_].set(this.program,_,l[_])}}setFogUniformValues(r,l){if(!this.fogUniforms)return;const p=this.fogUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const _ in l)p[_].set(this.program,_,l[_])}}draw(r,l,p,_,b,S,A,R,V,j,y,E,x,T,M){const L=r.gl;if(this.failedToCreate)return;r.program.set(this.program),r.setDepthMode(p),r.setStencilMode(_),r.setColorMode(b),r.setCullFace(S);for(const Z of Object.keys(this.fixedUniforms))this.fixedUniforms[Z].set(this.program,Z,A[Z]);T&&T.setUniforms(this.program,r,this.binderUniforms,E,{zoom:x});const O={[L.LINES]:2,[L.TRIANGLES]:3,[L.LINE_STRIP]:1}[l];for(const Z of y.get()){const Y=Z.vaos||(Z.vaos={});(Y[R]||(Y[R]=new hs)).bind(r,this,V,T?T.getPaintVertexBuffers():[],j,Z.vertexOffset,M||[]),L.drawElements(l,Z.primitiveLength*O,L.UNSIGNED_SHORT,Z.primitiveOffset*O*2)}}}function rl(h,r){const l=Math.pow(2,r.tileID.overscaledZ),p=r.tileSize*Math.pow(2,h.transform.tileZoom)/l,_=p*(r.tileID.canonical.x+r.tileID.wrap*l),b=p*r.tileID.canonical.y;return{u_image:0,u_texsize:r.imageAtlasTexture.size,u_tile_units_to_pixels:1/at(r,1,h.transform.tileZoom),u_pixel_coord_upper:[_>>16,b>>16],u_pixel_coord_lower:[65535&_,65535&b]}}const ea=c.create(),Si=(h,r,l,p,_,b,S,A,R,V,j)=>{const y=r.style.light,E=y.properties.get("position"),x=[E.x,E.y,E.z],T=c.create$1();"viewport"===y.properties.get("anchor")&&(c.fromRotation(T,-r.transform.angle),c.transformMat3(x,x,T));const M=y.properties.get("color"),L=r.transform,O={u_matrix:h,u_lightpos:x,u_lightintensity:y.properties.get("intensity"),u_lightcolor:[M.r,M.g,M.b],u_vertical_gradient:+l,u_opacity:p,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:ea,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:_,u_edge_radius:b};return"globe"===L.projection.name&&(O.u_tile_id=[S.canonical.x,S.canonical.y,1<<S.canonical.z],O.u_zoom_transition=R,O.u_inv_rot_matrix=j,O.u_merc_center=V,O.u_up_dir=L.projection.upVector(new c.CanonicalTileID(0,0,0),V[0]*c.EXTENT,V[1]*c.EXTENT),O.u_height_lift=A),O},xu=(h,r,l,p,_,b,S,A,R,V,j,y)=>{const E=Si(h,r,l,p,_,b,S,R,V,j,y),x={u_height_factor:-Math.pow(2,S.overscaledZ)/A.tileSize/8};return c.extend(E,rl(r,A),x)},Cs=h=>({u_matrix:h}),il=(h,r,l)=>c.extend(Cs(h),rl(r,l)),fo=(h,r)=>({u_matrix:h,u_world:r}),ki=(h,r,l,p)=>c.extend(il(h,r,l),{u_world:p}),ol=c.create(),wn=(h,r,l,p,_,b)=>{const S=h.transform,A="globe"===S.projection.name;let R;if("map"===b.paint.get("circle-pitch-alignment"))if(A){const j=c.globePixelsToTileUnits(S.zoom,r.canonical)*S._pixelsPerMercatorPixel;R=Float32Array.from([j,0,0,j])}else R=S.calculatePixelsToTileUnitsMatrix(l);else R=new Float32Array([S.pixelsToGLUnits[0],0,0,S.pixelsToGLUnits[1]]);const V={u_camera_to_center_distance:S.cameraToCenterDistance,u_matrix:h.translatePosMatrix(r.projMatrix,l,b.paint.get("circle-translate"),b.paint.get("circle-translate-anchor")),u_device_pixel_ratio:c.exported.devicePixelRatio,u_extrude_scale:R,u_inv_rot_matrix:ol,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(A){V.u_inv_rot_matrix=p,V.u_merc_center=_,V.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],V.u_zoom_transition=c.globeToMercatorTransition(S.zoom);const j=_[0]*c.EXTENT,y=_[1]*c.EXTENT;V.u_up_dir=S.projection.upVector(new c.CanonicalTileID(0,0,0),j,y)}return V},ti=h=>{const r=[];return"map"===h.paint.get("circle-pitch-alignment")&&r.push("PITCH_WITH_MAP"),"map"===h.paint.get("circle-pitch-scale")&&r.push("SCALE_WITH_MAP"),r},Ll=(h,r,l,p)=>{const _=c.EXTENT/l.tileSize;return{u_matrix:h,u_camera_to_center_distance:r.getCameraToCenterDistance(p),u_extrude_scale:[r.pixelsToGLUnits[0]/_,r.pixelsToGLUnits[1]/_]}},ta=(h,r,l=1)=>({u_matrix:h,u_color:r,u_overlay:0,u_overlay_scale:l}),sl=c.create(),kl=(h,r,l,p,_,b,S)=>{const A=h.transform,R="globe"===A.projection.name,V=R?c.globePixelsToTileUnits(A.zoom,r.canonical)*A._pixelsPerMercatorPixel:at(l,1,b),j={u_matrix:r.projMatrix,u_extrude_scale:V,u_intensity:S,u_inv_rot_matrix:sl,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(R){j.u_inv_rot_matrix=p,j.u_merc_center=_,j.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],j.u_zoom_transition=c.globeToMercatorTransition(A.zoom);const y=_[0]*c.EXTENT,E=_[1]*c.EXTENT;j.u_up_dir=A.projection.upVector(new c.CanonicalTileID(0,0,0),y,E)}return j},Ol=(h,r,l,p,_,b,S)=>{const A=h.transform,R=A.calculatePixelsToTileUnitsMatrix(r);return{u_matrix:pt(h,r,l,p),u_pixels_to_tile_units:R,u_device_pixel_ratio:b,u_units_to_pixels:[1/A.pixelsToGLUnits[0],1/A.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:_,u_texsize:Jn(l)?r.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:fs(r,h.transform),u_alpha_discard_threshold:0,u_trim_offset:S}},Vi=(h,r,l,p,_)=>{const b=h.transform;return{u_matrix:pt(h,r,l,p),u_texsize:r.imageAtlasTexture.size,u_pixels_to_tile_units:b.calculatePixelsToTileUnitsMatrix(r),u_device_pixel_ratio:_,u_image:0,u_tile_units_to_pixels:fs(r,b),u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function fs(h,r){return 1/at(h,1,r.tileZoom)}function pt(h,r,l,p){return h.translatePosMatrix(p||r.tileID.projMatrix,r,l.paint.get("line-translate"),l.paint.get("line-translate-anchor"))}function Jn(h){const r=h.paint.get("line-dasharray").value;return r.value||"constant"!==r.kind}const na=(h,r,l,p,_,b)=>{return{u_matrix:h,u_tl_parent:r,u_scale_parent:l,u_fade_t:p.mix,u_opacity:p.opacity*_.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:_.paint.get("raster-brightness-min"),u_brightness_high:_.paint.get("raster-brightness-max"),u_saturation_factor:(A=_.paint.get("raster-saturation"),A>0?1-1/(1.001-A):-A),u_contrast_factor:(S=_.paint.get("raster-contrast"),S>0?1/(1-S):1+S),u_spin_weights:Xo(_.paint.get("raster-hue-rotate")),u_perspective_transform:b};var S,A};function Xo(h){h*=Math.PI/180;const r=Math.sin(h),l=Math.cos(h);return[(2*l+1)/3,(-Math.sqrt(3)*r-l+1)/3,(Math.sqrt(3)*r-l+1)/3]}const hi=c.create(),Da=(h,r,l,p,_,b,S,A,R,V,j,y,E,x,T,M)=>{const L=_.transform,O={u_is_size_zoom_constant:+("constant"===h||"source"===h),u_is_size_feature_constant:+("constant"===h||"camera"===h),u_size_t:r?r.uSizeT:0,u_size:r?r.uSize:0,u_camera_to_center_distance:L.cameraToCenterDistance,u_rotate_symbol:+l,u_aspect_ratio:L.width/L.height,u_fade_change:_.options.fadeDuration?_.symbolFadeChange:1,u_matrix:b,u_label_plane_matrix:S,u_coord_matrix:A,u_is_text:+R,u_pitch_with_map:+p,u_texsize:V,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:hi,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:hi,u_up_vector:[0,-1,0]};return"globe"===M.name&&(O.u_tile_id=[j.canonical.x,j.canonical.y,1<<j.canonical.z],O.u_zoom_transition=y,O.u_inv_rot_matrix=x,O.u_merc_center=E,O.u_camera_forward=L._camera.forward(),O.u_ecef_origin=c.globeECEFOrigin(L.globeMatrix,j.toUnwrapped()),O.u_tile_matrix=Float32Array.from(L.globeMatrix),O.u_up_vector=T),O},ps=(h,r,l,p,_,b,S,A,R,V,j,y,E,x,T,M,L)=>c.extend(Da(h,r,l,p,_,b,S,A,R,V,y,E,x,T,M,L),{u_gamma_scale:p?_.transform.cameraToCenterDistance*Math.cos(_.terrain?0:_.transform._pitch):1,u_device_pixel_ratio:c.exported.devicePixelRatio,u_is_halo:+j}),gi=(h,r,l,p,_,b,S,A,R,V,j,y,E,x,T,M)=>c.extend(ps(h,r,l,p,_,b,S,A,!0,R,!0,j,y,E,x,T,M),{u_texsize_icon:V,u_texture_icon:1}),gc=(h,r,l)=>({u_matrix:h,u_opacity:r,u_color:l}),al=(h,r,l,p,_)=>c.extend(function(b,S,A){const R=S.imageManager.getPattern(b.toString()),{width:V,height:j}=S.imageManager.getPixelSize(),y=Math.pow(2,A.tileID.overscaledZ),E=A.tileSize*Math.pow(2,S.transform.tileZoom)/y,x=E*(A.tileID.canonical.x+A.tileID.wrap*y),T=E*A.tileID.canonical.y;return{u_image:0,u_pattern_tl:R.tl,u_pattern_br:R.br,u_texsize:[V,j],u_pattern_size:R.displaySize,u_tile_units_to_pixels:1/at(A,1,S.transform.tileZoom),u_pixel_coord_upper:[x>>16,T>>16],u_pixel_coord_lower:[65535&x,65535&T]}}(p,l,_),{u_matrix:h,u_opacity:r}),Bc={fillExtrusion:h=>({u_matrix:new c.UniformMatrix4f(h),u_lightpos:new c.Uniform3f(h),u_lightintensity:new c.Uniform1f(h),u_lightcolor:new c.Uniform3f(h),u_vertical_gradient:new c.Uniform1f(h),u_opacity:new c.Uniform1f(h),u_edge_radius:new c.Uniform1f(h),u_ao:new c.Uniform2f(h),u_tile_id:new c.Uniform3f(h),u_zoom_transition:new c.Uniform1f(h),u_inv_rot_matrix:new c.UniformMatrix4f(h),u_merc_center:new c.Uniform2f(h),u_up_dir:new c.Uniform3f(h),u_height_lift:new c.Uniform1f(h)}),fillExtrusionPattern:h=>({u_matrix:new c.UniformMatrix4f(h),u_lightpos:new c.Uniform3f(h),u_lightintensity:new c.Uniform1f(h),u_lightcolor:new c.Uniform3f(h),u_vertical_gradient:new c.Uniform1f(h),u_height_factor:new c.Uniform1f(h),u_edge_radius:new c.Uniform1f(h),u_ao:new c.Uniform2f(h),u_tile_id:new c.Uniform3f(h),u_zoom_transition:new c.Uniform1f(h),u_inv_rot_matrix:new c.UniformMatrix4f(h),u_merc_center:new c.Uniform2f(h),u_up_dir:new c.Uniform3f(h),u_height_lift:new c.Uniform1f(h),u_image:new c.Uniform1i(h),u_texsize:new c.Uniform2f(h),u_pixel_coord_upper:new c.Uniform2f(h),u_pixel_coord_lower:new c.Uniform2f(h),u_tile_units_to_pixels:new c.Uniform1f(h),u_opacity:new c.Uniform1f(h)}),fill:h=>({u_matrix:new c.UniformMatrix4f(h)}),fillPattern:h=>({u_matrix:new c.UniformMatrix4f(h),u_image:new c.Uniform1i(h),u_texsize:new c.Uniform2f(h),u_pixel_coord_upper:new c.Uniform2f(h),u_pixel_coord_lower:new c.Uniform2f(h),u_tile_units_to_pixels:new c.Uniform1f(h)}),fillOutline:h=>({u_matrix:new c.UniformMatrix4f(h),u_world:new c.Uniform2f(h)}),fillOutlinePattern:h=>({u_matrix:new c.UniformMatrix4f(h),u_world:new c.Uniform2f(h),u_image:new c.Uniform1i(h),u_texsize:new c.Uniform2f(h),u_pixel_coord_upper:new c.Uniform2f(h),u_pixel_coord_lower:new c.Uniform2f(h),u_tile_units_to_pixels:new c.Uniform1f(h)}),circle:h=>({u_camera_to_center_distance:new c.Uniform1f(h),u_extrude_scale:new c.UniformMatrix2f(h),u_device_pixel_ratio:new c.Uniform1f(h),u_matrix:new c.UniformMatrix4f(h),u_inv_rot_matrix:new c.UniformMatrix4f(h),u_merc_center:new c.Uniform2f(h),u_tile_id:new c.Uniform3f(h),u_zoom_transition:new c.Uniform1f(h),u_up_dir:new c.Uniform3f(h)}),collisionBox:h=>({u_matrix:new c.UniformMatrix4f(h),u_camera_to_center_distance:new c.Uniform1f(h),u_extrude_scale:new c.Uniform2f(h)}),collisionCircle:h=>({u_matrix:new c.UniformMatrix4f(h),u_inv_matrix:new c.UniformMatrix4f(h),u_camera_to_center_distance:new c.Uniform1f(h),u_viewport_size:new c.Uniform2f(h)}),debug:h=>({u_color:new c.UniformColor(h),u_matrix:new c.UniformMatrix4f(h),u_overlay:new c.Uniform1i(h),u_overlay_scale:new c.Uniform1f(h)}),clippingMask:h=>({u_matrix:new c.UniformMatrix4f(h)}),heatmap:h=>({u_extrude_scale:new c.Uniform1f(h),u_intensity:new c.Uniform1f(h),u_matrix:new c.UniformMatrix4f(h),u_inv_rot_matrix:new c.UniformMatrix4f(h),u_merc_center:new c.Uniform2f(h),u_tile_id:new c.Uniform3f(h),u_zoom_transition:new c.Uniform1f(h),u_up_dir:new c.Uniform3f(h)}),heatmapTexture:h=>({u_image:new c.Uniform1i(h),u_color_ramp:new c.Uniform1i(h),u_opacity:new c.Uniform1f(h)}),hillshade:h=>({u_matrix:new c.UniformMatrix4f(h),u_image:new c.Uniform1i(h),u_latrange:new c.Uniform2f(h),u_light:new c.Uniform2f(h),u_shadow:new c.UniformColor(h),u_highlight:new c.UniformColor(h),u_accent:new c.UniformColor(h)}),hillshadePrepare:h=>({u_matrix:new c.UniformMatrix4f(h),u_image:new c.Uniform1i(h),u_dimension:new c.Uniform2f(h),u_zoom:new c.Uniform1f(h),u_unpack:new c.Uniform4f(h)}),line:h=>({u_matrix:new c.UniformMatrix4f(h),u_pixels_to_tile_units:new c.UniformMatrix2f(h),u_device_pixel_ratio:new c.Uniform1f(h),u_units_to_pixels:new c.Uniform2f(h),u_dash_image:new c.Uniform1i(h),u_gradient_image:new c.Uniform1i(h),u_image_height:new c.Uniform1f(h),u_texsize:new c.Uniform2f(h),u_tile_units_to_pixels:new c.Uniform1f(h),u_alpha_discard_threshold:new c.Uniform1f(h),u_trim_offset:new c.Uniform2f(h)}),linePattern:h=>({u_matrix:new c.UniformMatrix4f(h),u_texsize:new c.Uniform2f(h),u_pixels_to_tile_units:new c.UniformMatrix2f(h),u_device_pixel_ratio:new c.Uniform1f(h),u_image:new c.Uniform1i(h),u_units_to_pixels:new c.Uniform2f(h),u_tile_units_to_pixels:new c.Uniform1f(h),u_alpha_discard_threshold:new c.Uniform1f(h)}),raster:h=>({u_matrix:new c.UniformMatrix4f(h),u_tl_parent:new c.Uniform2f(h),u_scale_parent:new c.Uniform1f(h),u_fade_t:new c.Uniform1f(h),u_opacity:new c.Uniform1f(h),u_image0:new c.Uniform1i(h),u_image1:new c.Uniform1i(h),u_brightness_low:new c.Uniform1f(h),u_brightness_high:new c.Uniform1f(h),u_saturation_factor:new c.Uniform1f(h),u_contrast_factor:new c.Uniform1f(h),u_spin_weights:new c.Uniform3f(h),u_perspective_transform:new c.Uniform2f(h)}),symbolIcon:h=>({u_is_size_zoom_constant:new c.Uniform1i(h),u_is_size_feature_constant:new c.Uniform1i(h),u_size_t:new c.Uniform1f(h),u_size:new c.Uniform1f(h),u_camera_to_center_distance:new c.Uniform1f(h),u_rotate_symbol:new c.Uniform1i(h),u_aspect_ratio:new c.Uniform1f(h),u_fade_change:new c.Uniform1f(h),u_matrix:new c.UniformMatrix4f(h),u_label_plane_matrix:new c.UniformMatrix4f(h),u_coord_matrix:new c.UniformMatrix4f(h),u_is_text:new c.Uniform1i(h),u_pitch_with_map:new c.Uniform1i(h),u_texsize:new c.Uniform2f(h),u_tile_id:new c.Uniform3f(h),u_zoom_transition:new c.Uniform1f(h),u_inv_rot_matrix:new c.UniformMatrix4f(h),u_merc_center:new c.Uniform2f(h),u_camera_forward:new c.Uniform3f(h),u_tile_matrix:new c.UniformMatrix4f(h),u_up_vector:new c.Uniform3f(h),u_ecef_origin:new c.Uniform3f(h),u_texture:new c.Uniform1i(h)}),symbolSDF:h=>({u_is_size_zoom_constant:new c.Uniform1i(h),u_is_size_feature_constant:new c.Uniform1i(h),u_size_t:new c.Uniform1f(h),u_size:new c.Uniform1f(h),u_camera_to_center_distance:new c.Uniform1f(h),u_rotate_symbol:new c.Uniform1i(h),u_aspect_ratio:new c.Uniform1f(h),u_fade_change:new c.Uniform1f(h),u_matrix:new c.UniformMatrix4f(h),u_label_plane_matrix:new c.UniformMatrix4f(h),u_coord_matrix:new c.UniformMatrix4f(h),u_is_text:new c.Uniform1i(h),u_pitch_with_map:new c.Uniform1i(h),u_texsize:new c.Uniform2f(h),u_texture:new c.Uniform1i(h),u_gamma_scale:new c.Uniform1f(h),u_device_pixel_ratio:new c.Uniform1f(h),u_tile_id:new c.Uniform3f(h),u_zoom_transition:new c.Uniform1f(h),u_inv_rot_matrix:new c.UniformMatrix4f(h),u_merc_center:new c.Uniform2f(h),u_camera_forward:new c.Uniform3f(h),u_tile_matrix:new c.UniformMatrix4f(h),u_up_vector:new c.Uniform3f(h),u_ecef_origin:new c.Uniform3f(h),u_is_halo:new c.Uniform1i(h)}),symbolTextAndIcon:h=>({u_is_size_zoom_constant:new c.Uniform1i(h),u_is_size_feature_constant:new c.Uniform1i(h),u_size_t:new c.Uniform1f(h),u_size:new c.Uniform1f(h),u_camera_to_center_distance:new c.Uniform1f(h),u_rotate_symbol:new c.Uniform1i(h),u_aspect_ratio:new c.Uniform1f(h),u_fade_change:new c.Uniform1f(h),u_matrix:new c.UniformMatrix4f(h),u_label_plane_matrix:new c.UniformMatrix4f(h),u_coord_matrix:new c.UniformMatrix4f(h),u_is_text:new c.Uniform1i(h),u_pitch_with_map:new c.Uniform1i(h),u_texsize:new c.Uniform2f(h),u_texsize_icon:new c.Uniform2f(h),u_texture:new c.Uniform1i(h),u_texture_icon:new c.Uniform1i(h),u_gamma_scale:new c.Uniform1f(h),u_device_pixel_ratio:new c.Uniform1f(h),u_is_halo:new c.Uniform1i(h)}),background:h=>({u_matrix:new c.UniformMatrix4f(h),u_opacity:new c.Uniform1f(h),u_color:new c.UniformColor(h)}),backgroundPattern:h=>({u_matrix:new c.UniformMatrix4f(h),u_opacity:new c.Uniform1f(h),u_image:new c.Uniform1i(h),u_pattern_tl:new c.Uniform2f(h),u_pattern_br:new c.Uniform2f(h),u_texsize:new c.Uniform2f(h),u_pattern_size:new c.Uniform2f(h),u_pixel_coord_upper:new c.Uniform2f(h),u_pixel_coord_lower:new c.Uniform2f(h),u_tile_units_to_pixels:new c.Uniform1f(h)}),terrainRaster:Ys,terrainDepth:Ys,skybox:h=>({u_matrix:new c.UniformMatrix4f(h),u_sun_direction:new c.Uniform3f(h),u_cubemap:new c.Uniform1i(h),u_opacity:new c.Uniform1f(h),u_temporal_offset:new c.Uniform1f(h)}),skyboxGradient:h=>({u_matrix:new c.UniformMatrix4f(h),u_color_ramp:new c.Uniform1i(h),u_center_direction:new c.Uniform3f(h),u_radius:new c.Uniform1f(h),u_opacity:new c.Uniform1f(h),u_temporal_offset:new c.Uniform1f(h)}),skyboxCapture:h=>({u_matrix_3f:new c.UniformMatrix3f(h),u_sun_direction:new c.Uniform3f(h),u_sun_intensity:new c.Uniform1f(h),u_color_tint_r:new c.Uniform4f(h),u_color_tint_m:new c.Uniform4f(h),u_luminance:new c.Uniform1f(h)}),globeRaster:h=>({u_proj_matrix:new c.UniformMatrix4f(h),u_globe_matrix:new c.UniformMatrix4f(h),u_normalize_matrix:new c.UniformMatrix4f(h),u_merc_matrix:new c.UniformMatrix4f(h),u_zoom_transition:new c.Uniform1f(h),u_merc_center:new c.Uniform2f(h),u_image0:new c.Uniform1i(h),u_grid_matrix:new c.UniformMatrix3f(h),u_frustum_tl:new c.Uniform3f(h),u_frustum_tr:new c.Uniform3f(h),u_frustum_br:new c.Uniform3f(h),u_frustum_bl:new c.Uniform3f(h),u_globe_pos:new c.Uniform3f(h),u_globe_radius:new c.Uniform1f(h),u_viewport:new c.Uniform2f(h)}),globeAtmosphere:h=>({u_frustum_tl:new c.Uniform3f(h),u_frustum_tr:new c.Uniform3f(h),u_frustum_br:new c.Uniform3f(h),u_frustum_bl:new c.Uniform3f(h),u_horizon:new c.Uniform1f(h),u_transition:new c.Uniform1f(h),u_fadeout_range:new c.Uniform1f(h),u_color:new c.Uniform4f(h),u_high_color:new c.Uniform4f(h),u_space_color:new c.Uniform4f(h),u_star_intensity:new c.Uniform1f(h),u_star_density:new c.Uniform1f(h),u_star_size:new c.Uniform1f(h),u_temporal_offset:new c.Uniform1f(h),u_horizon_angle:new c.Uniform1f(h),u_rotation_matrix:new c.UniformMatrix4f(h)})};let ra;function ll(h,r,l,p,_,b,S){const A=h.context,R=A.gl,V=h.transform,j=h.useProgram("collisionBox"),y=[];let E=0,x=0;for(let oe=0;oe<p.length;oe++){const se=p[oe],he=r.getTile(se),be=he.getBucket(l);if(!be)continue;const Le=Eo(se,be,V);let Pe=Le;0===_[0]&&0===_[1]||(Pe=h.translatePosMatrix(Le,he,_,b));const Te=S?be.textCollisionBox:be.iconCollisionBox,et=be.collisionCircleArray;if(et.length>0){const Re=c.create(),He=Pe;c.mul(Re,be.placementInvProjMatrix,V.glCoordMatrix),c.mul(Re,Re,be.placementViewportMatrix),y.push({circleArray:et,circleOffset:x,transform:He,invTransform:Re,projection:be.getProjection()}),E+=et.length/4,x=E}Te&&(h.terrain&&h.terrain.setupElevationDraw(he,j),j.draw(A,R.LINES,c.DepthMode.disabled,c.StencilMode.disabled,h.colorModeForRenderPass(),c.CullFaceMode.disabled,Ll(Pe,V,he,be.getProjection()),l.id,Te.layoutVertexBuffer,Te.indexBuffer,Te.segments,null,V.zoom,null,[Te.collisionVertexBuffer,Te.collisionVertexBufferExt]))}if(!S||!y.length)return;const T=h.useProgram("collisionCircle"),M=new c.StructArrayLayout2f1f2i16;M.resize(4*E),M._trim();let L=0;for(const oe of y)for(let se=0;se<oe.circleArray.length/4;se++){const he=4*se,be=oe.circleArray[he+0],Le=oe.circleArray[he+1],Pe=oe.circleArray[he+2],Te=oe.circleArray[he+3];M.emplace(L++,be,Le,Pe,Te,0),M.emplace(L++,be,Le,Pe,Te,1),M.emplace(L++,be,Le,Pe,Te,2),M.emplace(L++,be,Le,Pe,Te,3)}(!ra||ra.length<2*E)&&(ra=function(oe){const se=2*oe,he=new c.StructArrayLayout3ui6;he.resize(se),he._trim();for(let be=0;be<se;be++){const Le=6*be;he.uint16[Le+0]=4*be+0,he.uint16[Le+1]=4*be+1,he.uint16[Le+2]=4*be+2,he.uint16[Le+3]=4*be+2,he.uint16[Le+4]=4*be+3,he.uint16[Le+5]=4*be+0}return he}(E));const O=A.createIndexBuffer(ra,!0),Z=A.createVertexBuffer(M,c.collisionCircleLayout.members,!0);for(const oe of y){const se={u_matrix:oe.transform,u_inv_matrix:oe.invTransform,u_camera_to_center_distance:(Y=V).getCameraToCenterDistance(oe.projection),u_viewport_size:[Y.width,Y.height]};T.draw(A,R.TRIANGLES,c.DepthMode.disabled,c.StencilMode.disabled,h.colorModeForRenderPass(),c.CullFaceMode.disabled,se,l.id,Z,O,c.SegmentVector.simpleSegment(0,2*oe.circleOffset,oe.circleArray.length,oe.circleArray.length/2),null,V.zoom)}var Y;Z.destroy(),O.destroy()}const Zr=c.create();function $i({width:h,height:r,anchor:l,textOffset:p,textScale:_},b){const{horizontalAlign:S,verticalAlign:A}=c.getAnchorAlignment(l),R=-(S-.5)*h,V=-(A-.5)*r,j=c.evaluateVariableOffset(l,p);return new c.pointGeometry((R/_+j[0])*b,(V/_+j[1])*b)}function cl(h,r,l,p,_,b,S,A,R,V,j){const y=h.text.placedSymbolArray,E=h.text.dynamicLayoutVertexArray,x=h.icon.dynamicLayoutVertexArray,T={},M=h.getProjection(),L=bn(A,M,b),O=b.elevation,Z=M.upVectorScale(A.canonical,b.center.lat,b.worldSize).metersToTile;E.clear();for(let Y=0;Y<y.length;Y++){const oe=y.get(Y),{tileAnchorX:se,tileAnchorY:he,numGlyphs:be}=oe,Pe=oe.hidden||!oe.crossTileID||h.allowVerticalPlacement&&!oe.placedOrientation?null:p[oe.crossTileID];if(Pe){let Te=0,et=0,Re=0;if(O){const Zt=O?O.getAtTileOffset(A,se,he):0,[an,qt,mn]=M.upVector(A.canonical,se,he);Te=Zt*an*Z,et=Zt*qt*Z,Re=Zt*mn*Z}let[He,ze,ct,Ne]=Sn(oe.projectedAnchorX+Te,oe.projectedAnchorY+et,oe.projectedAnchorZ+Re,l?L:S);const Ke=xt(b.getCameraToCenterDistance(M),Ne);let vt=_.evaluateSizeForFeature(h.textSizeData,V,oe)*Ke/c.ONE_EM;l&&(vt*=h.tilePixelRatio/R);const Ae=$i(Pe,vt);l?(({x:He,y:ze,z:ct}=M.projectTilePoint(se+Ae.x,he+Ae.y,A.canonical)),[He,ze,ct]=Sn(He+Te,ze+et,ct+Re,S)):(r&&Ae._rotate(-b.angle),He+=Ae.x,ze+=Ae.y,ct=0);const Be=h.allowVerticalPlacement&&oe.placedOrientation===c.WritingMode.vertical?Math.PI/2:0;for(let Zt=0;Zt<be;Zt++)c.addDynamicAttributes(E,He,ze,ct,Be);j&&oe.associatedIconIndex>=0&&(T[oe.associatedIconIndex]={x:He,y:ze,z:ct,angle:Be})}else pr(be,E)}if(j){x.clear();const Y=h.icon.placedSymbolArray;for(let oe=0;oe<Y.length;oe++){const se=Y.get(oe),{numGlyphs:he}=se,be=T[oe];if(se.hidden||!be)pr(he,x);else{const{x:Le,y:Pe,z:Te,angle:et}=be;for(let Re=0;Re<he;Re++)c.addDynamicAttributes(x,Le,Pe,Te,et)}}h.icon.dynamicLayoutVertexBuffer.updateData(x)}h.text.dynamicLayoutVertexBuffer.updateData(E)}function ia(h,r,l){return l.iconsInText&&r?"symbolTextAndIcon":h?"symbolSDF":"symbolIcon"}function Gi(h,r,l,p,_,b,S,A,R,V,j,y){const E=h.context,x=E.gl,T=h.transform,M="map"===A,L="map"===R,O=M&&"point"!==l.layout.get("symbol-placement"),Z=M&&!L&&!O,Y=void 0!==l.layout.get("symbol-sort-key").constantOr(1);let oe=!1;const se=h.depthModeForSublayer(0,c.DepthMode.ReadOnly),he=[c.mercatorXfromLng(T.center.lng),c.mercatorYfromLat(T.center.lat)],be=l.layout.get("text-variable-anchor"),Le="globe"===T.projection.name,Pe=[],Te=[0,-1,0];let et=Te;!Le&&!T.mercatorFromTransition||M||(et=function(Re){const He=Re._camera.getWorldToCamera(Re.worldSize,1),ze=c.multiply([],He,Re.globeMatrix);c.invert(ze,ze);const ct=[0,0,0],Ne=[0,1,0,0];return c.transformMat4$1(Ne,Ne,ze),ct[0]=Ne[0],ct[1]=Ne[1],ct[2]=Ne[2],c.normalize(ct,ct),ct}(T));for(const Re of p){const He=r.getTile(Re),ze=He.getBucket(l);if(!ze||"mercator"===ze.projection.name&&Le)continue;const ct=_?ze.text:ze.icon;if(!ct||ze.fullyClipped||!ct.segments.get().length)continue;const Ne=ct.programConfigurations.get(l.id),Ke=_||ze.sdfIcons,vt=_?ze.textSizeData:ze.iconSizeData,Ae=L||0!==T.pitch,Be=c.evaluateSizeForZoom(vt,T.zoom);let Zt,an,qt,mn,Pn=[0,0],tn=null;if(_)an=He.glyphAtlasTexture,qt=x.LINEAR,Zt=He.glyphAtlasTexture.size,ze.iconsInText&&(Pn=He.imageAtlasTexture.size,tn=He.imageAtlasTexture,mn=Ae||h.options.rotating||h.options.zooming||"composite"===vt.kind||"camera"===vt.kind?x.LINEAR:x.NEAREST);else{const zo=1!==l.layout.get("icon-size").constantOr(0)||ze.iconsNeedLinear;an=He.imageAtlasTexture,qt=Ke||h.options.rotating||h.options.zooming||zo||Ae?x.LINEAR:x.NEAREST,Zt=He.imageAtlasTexture.size}const Ft="globe"===ze.projection.name,vr=Ft?et:Te,hr=Ft?c.globeToMercatorTransition(T.zoom):0,Mr=bn(Re,ze.getProjection(),T),xr=T.calculatePixelsToTileUnitsMatrix(He),Qo=Ti(Mr,He.tileID.canonical,L,M,T,ze.getProjection(),xr),es=h.terrain&&L&&O?c.invert(c.create(),Qo):Zr,Co=ya(Mr,He.tileID.canonical,L,M,T,ze.getProjection(),xr),_s=be&&ze.hasTextData(),Or="none"!==l.layout.get("icon-text-fit")&&_s&&ze.hasIconData();if(O){const zo=T.elevation,Ps=zo?zo.getAtTileOffsetFunc(Re,T.center.lat,T.worldSize,ze.getProjection()):null,Rs=lo(Mr,He.tileID.canonical,L,M,T,ze.getProjection(),xr);Tn(ze,Mr,h,_,Rs,Co,L,V,Ps,Re)}const Ar=O||_&&be||Or,ir=h.translatePosMatrix(Mr,He,b,S),vi=Ar?Zr:Qo,So=h.translatePosMatrix(Co,He,b,S,!0),Lr=ze.getProjection().createInversionMatrix(T,Re.canonical),Fo=[];h.terrainRenderModeElevated()&&L&&Fo.push("PITCH_WITH_MAP_TERRAIN"),Ft&&Fo.push("PROJECTION_GLOBE_VIEW"),Ar&&Fo.push("PROJECTED_POS_ON_VIEWPORT");const Mu=Ke&&0!==l.paint.get(_?"text-halo-width":"icon-halo-width").constantOr(1);let Fa;Fa=Ke?ze.iconsInText?gi(vt.kind,Be,Z,L,h,ir,vi,So,Zt,Pn,Re,hr,he,Lr,vr,ze.getProjection()):ps(vt.kind,Be,Z,L,h,ir,vi,So,_,Zt,!0,Re,hr,he,Lr,vr,ze.getProjection()):Da(vt.kind,Be,Z,L,h,ir,vi,So,_,Zt,Re,hr,he,Lr,vr,ze.getProjection());const Ji={program:h.useProgram(ia(Ke,_,ze),Ne,Fo),buffers:ct,uniformValues:Fa,atlasTexture:an,atlasTextureIcon:tn,atlasInterpolation:qt,atlasInterpolationIcon:mn,isSDF:Ke,hasHalo:Mu,tile:He,labelPlaneMatrixInv:es};if(Y&&ze.canOverlap){oe=!0;const zo=ct.segments.get();for(const Ps of zo)Pe.push({segments:new c.SegmentVector([Ps]),sortKey:Ps.sortKey,state:Ji})}else Pe.push({segments:ct.segments,sortKey:0,state:Ji})}oe&&Pe.sort((Re,He)=>Re.sortKey-He.sortKey);for(const Re of Pe){const He=Re.state;if(h.terrain&&h.terrain.setupElevationDraw(He.tile,He.program,{useDepthForOcclusion:!Le,labelPlaneMatrixInv:He.labelPlaneMatrixInv}),E.activeTexture.set(x.TEXTURE0),He.atlasTexture.bind(He.atlasInterpolation,x.CLAMP_TO_EDGE),He.atlasTextureIcon&&(E.activeTexture.set(x.TEXTURE1),He.atlasTextureIcon&&He.atlasTextureIcon.bind(He.atlasInterpolationIcon,x.CLAMP_TO_EDGE)),He.isSDF){const ze=He.uniformValues;He.hasHalo&&(ze.u_is_halo=1,Nc(He.buffers,Re.segments,l,h,He.program,se,j,y,ze)),ze.u_is_halo=0}Nc(He.buffers,Re.segments,l,h,He.program,se,j,y,He.uniformValues)}}function Nc(h,r,l,p,_,b,S,A,R){const V=p.context,j=[h.dynamicLayoutVertexBuffer,h.opacityVertexBuffer,h.globeExtVertexBuffer];_.draw(V,V.gl.TRIANGLES,b,S,A,c.CullFaceMode.disabled,R,l.id,h.layoutVertexBuffer,h.indexBuffer,r,l.paint,p.transform.zoom,h.programConfigurations.get(l.id),j)}function _c(h,r,l,p,_,b,S){const A=h.context.gl,R=l.paint.get("fill-pattern"),V=R&&R.constantOr(1);let j,y,E,x,T;S?(y=V&&!l.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",j=A.LINES):(y=V?"fillPattern":"fill",j=A.TRIANGLES);for(const M of p){const L=r.getTile(M);if(V&&!L.patternsLoaded())continue;const O=L.getBucket(l);if(!O)continue;h.prepareDrawTile();const Z=O.programConfigurations.get(l.id),Y=h.useProgram(y,Z);V&&(h.context.activeTexture.set(A.TEXTURE0),L.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),Z.updatePaintBuffers());const oe=R.constantOr(null);if(oe&&L.imageAtlas){const he=L.imageAtlas.patternPositions[oe.toString()];he&&Z.setConstantPatternPositions(he)}const se=h.translatePosMatrix(M.projMatrix,L,l.paint.get("fill-translate"),l.paint.get("fill-translate-anchor"));if(S){x=O.indexBuffer2,T=O.segments2;const he=h.terrain&&h.terrain.renderingToTexture?h.terrain.drapeBufferSize:[A.drawingBufferWidth,A.drawingBufferHeight];E="fillOutlinePattern"===y&&V?ki(se,h,L,he):fo(se,he)}else x=O.indexBuffer,T=O.segments,E=V?il(se,h,L):Cs(se);h.prepareDrawProgram(h.context,Y,M.toUnwrapped()),Y.draw(h.context,j,_,h.stencilModeForClipping(M),b,c.CullFaceMode.disabled,E,l.id,O.layoutVertexBuffer,x,T,l.paint,h.transform.zoom,Z)}}function yc(h,r,l,p,_,b,S){const A=h.context,R=A.gl,V=h.transform,j=l.paint.get("fill-extrusion-pattern"),y=j.constantOr(1),E=l.paint.get("fill-extrusion-opacity"),x=[l.paint.get("fill-extrusion-ambient-occlusion-intensity"),l.paint.get("fill-extrusion-ambient-occlusion-radius")],T=l.layout.get("fill-extrusion-edge-radius"),M="globe"===V.projection.name?c.fillExtrusionHeightLift():0,L="globe"===V.projection.name,O=L?c.globeToMercatorTransition(V.zoom):0,Z=[c.mercatorXfromLng(V.center.lng),c.mercatorYfromLat(V.center.lat)],Y=[];L&&(Y.push("PROJECTION_GLOBE_VIEW"),h.style.terrainSetForDrapingOnly()&&Y.push("TERRAIN")),x[0]>0&&Y.push("FAUX_AO");for(const oe of p){const se=r.getTile(oe),he=se.getBucket(l);if(!he||he.projection.name!==V.projection.name)continue;const be=he.programConfigurations.get(l.id),Le=h.useProgram(y?"fillExtrusionPattern":"fillExtrusion",be,Y);if(h.terrain){const ct=h.terrain;if(h.style.terrainSetForDrapingOnly())ct.setupElevationDraw(se,Le,{useMeterToDem:!0});else{if(!he.enableTerrain)continue;if(ct.setupElevationDraw(se,Le,{useMeterToDem:!0}),bu(A,r,oe,he,l,ct),!he.centroidVertexBuffer){const Ne=Le.attributes.a_centroid_pos;void 0!==Ne&&R.vertexAttrib2f(Ne,0,0)}}}y&&(h.context.activeTexture.set(R.TEXTURE0),se.imageAtlasTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE),be.updatePaintBuffers());const Pe=j.constantOr(null);if(Pe&&se.imageAtlas){const ct=se.imageAtlas.patternPositions[Pe.toString()];ct&&be.setConstantPatternPositions(ct)}const Te=h.translatePosMatrix(oe.projMatrix,se,l.paint.get("fill-extrusion-translate"),l.paint.get("fill-extrusion-translate-anchor")),et=V.projection.createInversionMatrix(V,oe.canonical),Re=l.paint.get("fill-extrusion-vertical-gradient"),He=y?xu(Te,h,Re,E,x,T,oe,se,M,O,Z,et):Si(Te,h,Re,E,x,T,oe,M,O,Z,et);h.prepareDrawProgram(A,Le,oe.toUnwrapped());const ze=[];h.terrain&&ze.push(he.centroidVertexBuffer),L&&ze.push(he.layoutVertexExtBuffer),Le.draw(A,A.gl.TRIANGLES,_,b,S,c.CullFaceMode.backCCW,He,l.id,he.layoutVertexBuffer,he.indexBuffer,he.segments,l.paint,h.transform.zoom,be,ze)}}function bu(h,r,l,p,_,b){const S=[O=>{let Z=O.canonical.x-1,Y=O.wrap;return Z<0&&(Z=(1<<O.canonical.z)-1,Y--),new c.OverscaledTileID(O.overscaledZ,Y,O.canonical.z,Z,O.canonical.y)},O=>{let Z=O.canonical.x+1,Y=O.wrap;return Z===1<<O.canonical.z&&(Z=0,Y++),new c.OverscaledTileID(O.overscaledZ,Y,O.canonical.z,Z,O.canonical.y)},O=>new c.OverscaledTileID(O.overscaledZ,O.wrap,O.canonical.z,O.canonical.x,(0===O.canonical.y?1<<O.canonical.z:O.canonical.y)-1),O=>new c.OverscaledTileID(O.overscaledZ,O.wrap,O.canonical.z,O.canonical.x,O.canonical.y===(1<<O.canonical.z)-1?0:O.canonical.y+1)],A=O=>{const Z=r.getSource().minzoom,Y=se=>{const he=r.getTileByID(se);if(he&&he.hasData())return he.getBucket(_)},oe=[0,-1,1];for(const se of oe){if(O.overscaledZ+se<Z)continue;const he=Y(O.calculateScaledKey(O.overscaledZ+se));if(he)return he}},R=[0,0,0],V=(O,Z)=>(R[0]=Math.min(O.min.y,Z.min.y),R[1]=Math.max(O.max.y,Z.max.y),R[2]=c.EXTENT-Z.min.x>O.max.x?Z.min.x-c.EXTENT:O.max.x,R),j=(O,Z)=>(R[0]=Math.min(O.min.x,Z.min.x),R[1]=Math.max(O.max.x,Z.max.x),R[2]=c.EXTENT-Z.min.y>O.max.y?Z.min.y-c.EXTENT:O.max.y,R),y=[(O,Z)=>V(O,Z),(O,Z)=>V(Z,O),(O,Z)=>j(O,Z),(O,Z)=>j(Z,O)],E=new c.pointGeometry(0,0);let x,T,M;const L=(O,Z,Y,oe,se)=>{const he=[[oe?Y:O,oe?O:Y,0],[oe?Y:Z,oe?Z:Y,0]],be=se<0?c.EXTENT+se:se,Le=[oe?be:(O+Z)/2,oe?(O+Z)/2:be,0];return 0===Y&&se<0||0!==Y&&se>0?b.getForTilePoints(M,[Le],!0,T):he.push(Le),b.getForTilePoints(l,he,!0,x),Math.max(he[0][2],he[1][2],Le[2])/b.exaggeration()};for(let O=0;O<4;O++){const Z=(O<2?1:5)-O,Y=p.borders[O];if(0===Y.length)continue;const oe=M=S[O](l),se=A(oe);if(!(se&&se instanceof c.FillExtrusionBucket&&se.enableTerrain)||p.borderDoneWithNeighborZ[O]===se.canonical.z&&se.borderDoneWithNeighborZ[Z]===p.canonical.z||(T=b.findDEMTileFor(oe),!T||!T.dem))continue;if(!x){const Pe=b.findDEMTileFor(l);if(!Pe||!Pe.dem)return;x=Pe}const he=se.borders[Z];let be=0;const Le=se.borderDoneWithNeighborZ[Z]!==p.canonical.z;if(p.canonical.z===se.canonical.z){for(let Pe=0;Pe<Y.length;Pe++){const Te=p.featuresOnBorder[Y[Pe]],et=Te.borders[O];let Re;for(;be<he.length&&(Re=se.featuresOnBorder[he[be]],!(Re.borders[Z][1]>et[0]+3));)Le&&se.encodeCentroid(void 0,Re,!1),be++;if(Re&&be<he.length){const He=be;let ze=0;for(;!(Re.borders[Z][0]>et[1]-3)&&(ze++,++be!==he.length);)Re=se.featuresOnBorder[he[be]];if(Re=se.featuresOnBorder[he[He]],Te.intersectsCount()>1||Re.intersectsCount()>1||1!==ze){1!==ze&&(be=He),p.encodeCentroid(void 0,Te,!1),Le&&se.encodeCentroid(void 0,Re,!1);continue}const ct=y[O](Te,Re),Ne=O%2?c.EXTENT-1:0;E.x=L(ct[0],Math.min(c.EXTENT-1,ct[1]),Ne,O<2,ct[2]),E.y=0,p.encodeCentroid(E,Te,!1),Le&&se.encodeCentroid(E,Re,!1)}else p.encodeCentroid(void 0,Te,!1)}p.borderDoneWithNeighborZ[O]=se.canonical.z,p.needsCentroidUpdate=!0,Le&&(se.borderDoneWithNeighborZ[Z]=p.canonical.z,se.needsCentroidUpdate=!0)}else{for(const Pe of Y)p.encodeCentroid(void 0,p.featuresOnBorder[Pe],!1);if(Le){for(const Pe of he)se.encodeCentroid(void 0,se.featuresOnBorder[Pe],!1);se.borderDoneWithNeighborZ[Z]=p.canonical.z,se.needsCentroidUpdate=!0}p.borderDoneWithNeighborZ[O]=se.canonical.z,p.needsCentroidUpdate=!0}}(p.needsCentroidUpdate||!p.centroidVertexBuffer&&0!==p.centroidVertexArray.length)&&p.uploadCentroid(h)}const vc=new c.Color(1,0,0,1),xc=new c.Color(0,1,0,1),ul=new c.Color(0,0,1,1),hl=new c.Color(1,0,1,1),dl=new c.Color(0,1,1,1);function Fl(h,r,l){const p=h.context,_=h.transform,b=p.gl,S="globe"===_.projection.name,A=S?["PROJECTION_GLOBE_VIEW"]:null;let R=l.projMatrix;if(S&&c.globeToMercatorTransition(_.zoom)>0){const Te=c.transitionTileAABBinECEF(l.canonical,_),et=c.globeDenormalizeECEF(Te);R=c.multiply(new Float32Array(16),_.globeMatrix,et),c.multiply(R,_.projMatrix,R)}const V=h.useProgram("debug",null,A),j=r.getTileByID(l.key);h.terrain&&h.terrain.setupElevationDraw(j,V);const y=c.DepthMode.disabled,E=c.StencilMode.disabled,x=h.colorModeForRenderPass(),T="$debug";p.activeTexture.set(b.TEXTURE0),h.emptyTexture.bind(b.LINEAR,b.CLAMP_TO_EDGE),S?j._makeGlobeTileDebugBuffers(h.context,_):j._makeDebugTileBoundsBuffers(h.context,_.projection);const M=j._tileDebugBuffer||h.debugBuffer,L=j._tileDebugIndexBuffer||h.debugIndexBuffer,O=j._tileDebugSegments||h.debugSegments;V.draw(p,b.LINE_STRIP,y,E,x,c.CullFaceMode.disabled,ta(R,c.Color.red),T,M,L,O,null,null,null,[j._globeTileDebugBorderBuffer]);const Z=j.latestRawTileData,Y=Math.floor((Z&&Z.byteLength||0)/1024),oe=r.getTile(l).tileSize,se=512/Math.min(oe,512)*(l.overscaledZ/_.zoom)*.5;let he=l.canonical.toString();l.overscaledZ!==l.canonical.z&&(he+=` => ${l.overscaledZ}`),he+=` ${Y}kb`,function(Te,et){Te.initDebugOverlayCanvas();const Re=Te.debugOverlayCanvas,He=Te.context.gl,ze=Te.debugOverlayCanvas.getContext("2d");ze.clearRect(0,0,Re.width,Re.height),ze.shadowColor="white",ze.shadowBlur=2,ze.lineWidth=1.5,ze.strokeStyle="white",ze.textBaseline="top",ze.font="bold 36px Open Sans, sans-serif",ze.fillText(et,5,5),ze.strokeText(et,5,5),Te.debugOverlayTexture.update(Re),Te.debugOverlayTexture.bind(He.LINEAR,He.CLAMP_TO_EDGE)}(h,he);const be=j._tileDebugTextBuffer||h.debugBuffer,Le=j._tileDebugTextIndexBuffer||h.quadTriangleIndexBuffer,Pe=j._tileDebugTextSegments||h.debugSegments;V.draw(p,b.TRIANGLES,y,E,c.ColorMode.alphaBlended,c.CullFaceMode.disabled,ta(R,c.Color.transparent,se),T,be,Le,Pe,null,null,null,[j._globeTileDebugTextBuffer])}function Ss(h,r,l,p){ko(h,0,r+l/2,h.transform.width,l,p)}function ms(h,r,l,p){ko(h,r-l/2,0,l,h.transform.height,p)}function ko(h,r,l,p,_,b){const S=h.context,A=S.gl;A.enable(A.SCISSOR_TEST),A.scissor(r*c.exported.devicePixelRatio,l*c.exported.devicePixelRatio,p*c.exported.devicePixelRatio,_*c.exported.devicePixelRatio),S.clear({color:b}),A.disable(A.SCISSOR_TEST)}const Ta=c.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:bc}=Ta;function Hi(h,r,l,p){h.emplaceBack(r,l,p)}class Yo{constructor(r){this.vertexArray=new c.StructArrayLayout3f12,this.indices=new c.StructArrayLayout3ui6,Hi(this.vertexArray,-1,-1,1),Hi(this.vertexArray,1,-1,1),Hi(this.vertexArray,-1,1,1),Hi(this.vertexArray,1,1,1),Hi(this.vertexArray,-1,-1,-1),Hi(this.vertexArray,1,-1,-1),Hi(this.vertexArray,-1,1,-1),Hi(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=r.createVertexBuffer(this.vertexArray,bc),this.indexBuffer=r.createIndexBuffer(this.indices),this.segment=c.SegmentVector.simpleSegment(0,0,36,12)}}function Is(h,r,l,p,_,b){const S=h.gl,A=r.paint.get("sky-atmosphere-color"),R=r.paint.get("sky-atmosphere-halo-color"),V=r.paint.get("sky-atmosphere-sun-intensity"),j={u_matrix_3f:c.fromMat4(c.create$1(),p),u_sun_direction:_,u_sun_intensity:V,u_color_tint_r:[(T=A).r,T.g,T.b,T.a],u_color_tint_m:[(M=R).r,M.g,M.b,M.a],u_luminance:5e-5};var T,M;S.framebufferTexture2D(S.FRAMEBUFFER,S.COLOR_ATTACHMENT0,S.TEXTURE_CUBE_MAP_POSITIVE_X+b,r.skyboxTexture,0),l.draw(h,S.TRIANGLES,c.DepthMode.disabled,c.StencilMode.disabled,c.ColorMode.unblended,c.CullFaceMode.frontCW,j,"skyboxCapture",r.skyboxGeometry.vertexBuffer,r.skyboxGeometry.indexBuffer,r.skyboxGeometry.segment)}const _i=c.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class An{constructor(r){const l=new c.StructArrayLayout5f20;l.emplaceBack(-1,1,1,0,0),l.emplaceBack(1,1,1,1,0),l.emplaceBack(1,-1,1,1,1),l.emplaceBack(-1,-1,1,0,1);const p=new c.StructArrayLayout3ui6;p.emplaceBack(0,1,2),p.emplaceBack(2,3,0),this.vertexBuffer=r.createVertexBuffer(l,_i.members),this.indexBuffer=r.createIndexBuffer(p),this.segments=c.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const z={symbol:function(h,r,l,p,_){if("translucent"!==h.renderPass)return;const b=c.StencilMode.disabled,S=h.colorModeForRenderPass();l.layout.get("text-variable-anchor")&&function(A,R,V,j,y,E,x){const T=R.transform,M="map"===y,L="map"===E;for(const O of A){const Z=j.getTile(O),Y=Z.getBucket(V);if(!Y||!Y.text||!Y.text.segments.get().length)continue;const oe=c.evaluateSizeForZoom(Y.textSizeData,T.zoom),se=bn(O,Y.getProjection(),T),he=T.calculatePixelsToTileUnitsMatrix(Z),be=Ti(se,Z.tileID.canonical,L,M,T,Y.getProjection(),he),Le="none"!==V.layout.get("icon-text-fit")&&Y.hasIconData();if(oe){const Pe=Math.pow(2,T.zoom-Z.tileID.overscaledZ);cl(Y,M,L,x,c.symbolSize,T,be,O,Pe,oe,Le)}}}(p,h,l,r,l.layout.get("text-rotation-alignment"),l.layout.get("text-pitch-alignment"),_),0!==l.paint.get("icon-opacity").constantOr(1)&&Gi(h,r,l,p,!1,l.paint.get("icon-translate"),l.paint.get("icon-translate-anchor"),l.layout.get("icon-rotation-alignment"),l.layout.get("icon-pitch-alignment"),l.layout.get("icon-keep-upright"),b,S),0!==l.paint.get("text-opacity").constantOr(1)&&Gi(h,r,l,p,!0,l.paint.get("text-translate"),l.paint.get("text-translate-anchor"),l.layout.get("text-rotation-alignment"),l.layout.get("text-pitch-alignment"),l.layout.get("text-keep-upright"),b,S),r.map.showCollisionBoxes&&(ll(h,r,l,p,l.paint.get("text-translate"),l.paint.get("text-translate-anchor"),!0),ll(h,r,l,p,l.paint.get("icon-translate"),l.paint.get("icon-translate-anchor"),!1))},circle:function(h,r,l,p){if("translucent"!==h.renderPass)return;const _=l.paint.get("circle-opacity"),b=l.paint.get("circle-stroke-width"),S=l.paint.get("circle-stroke-opacity"),A=void 0!==l.layout.get("circle-sort-key").constantOr(1);if(0===_.constantOr(1)&&(0===b.constantOr(1)||0===S.constantOr(1)))return;const R=h.context,V=R.gl,j=h.transform,y=h.depthModeForSublayer(0,c.DepthMode.ReadOnly),E=c.StencilMode.disabled,x=h.colorModeForRenderPass(),T="globe"===j.projection.name,M=[c.mercatorXfromLng(j.center.lng),c.mercatorYfromLat(j.center.lat)],L=[];for(let Z=0;Z<p.length;Z++){const Y=p[Z],oe=r.getTile(Y),se=oe.getBucket(l);if(!se||se.projection.name!==j.projection.name)continue;const he=se.programConfigurations.get(l.id),be=ti(l);T&&be.push("PROJECTION_GLOBE_VIEW");const Le=h.useProgram("circle",he,be),Pe=se.layoutVertexBuffer,Te=se.globeExtVertexBuffer,et=se.indexBuffer,Re=j.projection.createInversionMatrix(j,Y.canonical),He={programConfiguration:he,program:Le,layoutVertexBuffer:Pe,globeExtVertexBuffer:Te,indexBuffer:et,uniformValues:wn(h,Y,oe,Re,M,l),tile:oe};if(A){const ze=se.segments.get();for(const ct of ze)L.push({segments:new c.SegmentVector([ct]),sortKey:ct.sortKey,state:He})}else L.push({segments:se.segments,sortKey:0,state:He})}A&&L.sort((Z,Y)=>Z.sortKey-Y.sortKey);const O={useDepthForOcclusion:!T};for(const Z of L){const{programConfiguration:Y,program:oe,layoutVertexBuffer:se,globeExtVertexBuffer:he,indexBuffer:be,uniformValues:Le,tile:Pe}=Z.state,Te=Z.segments;h.terrain&&h.terrain.setupElevationDraw(Pe,oe,O),h.prepareDrawProgram(R,oe,Pe.tileID.toUnwrapped()),oe.draw(R,V.TRIANGLES,y,E,x,c.CullFaceMode.disabled,Le,l.id,se,be,Te,l.paint,j.zoom,Y,[he])}},heatmap:function(h,r,l,p){if(0!==l.paint.get("heatmap-opacity"))if("offscreen"===h.renderPass){const _=h.context,b=_.gl,S=c.StencilMode.disabled,A=new c.ColorMode([b.ONE,b.ONE],c.Color.transparent,[!0,!0,!0,!0]);(function(x,T,M,L){const O=x.gl,Z=T.width*L,Y=T.height*L;x.activeTexture.set(O.TEXTURE1),x.viewport.set([0,0,Z,Y]);let oe=M.heatmapFbo;if(!oe||oe&&(oe.width!==Z||oe.height!==Y)){oe&&oe.destroy();const se=O.createTexture();O.bindTexture(O.TEXTURE_2D,se),O.texParameteri(O.TEXTURE_2D,O.TEXTURE_WRAP_S,O.CLAMP_TO_EDGE),O.texParameteri(O.TEXTURE_2D,O.TEXTURE_WRAP_T,O.CLAMP_TO_EDGE),O.texParameteri(O.TEXTURE_2D,O.TEXTURE_MIN_FILTER,O.LINEAR),O.texParameteri(O.TEXTURE_2D,O.TEXTURE_MAG_FILTER,O.LINEAR),oe=M.heatmapFbo=x.createFramebuffer(Z,Y,!1),function(he,be,Le,Pe,Te,et){const Re=he.gl;Re.texImage2D(Re.TEXTURE_2D,0,Re.RGBA,Te,et,0,Re.RGBA,he.extRenderToTextureHalfFloat?he.extTextureHalfFloat.HALF_FLOAT_OES:Re.UNSIGNED_BYTE,null),Pe.colorAttachment.set(Le)}(x,0,se,oe,Z,Y)}else O.bindTexture(O.TEXTURE_2D,oe.colorAttachment.get()),x.bindFramebuffer.set(oe.framebuffer)})(_,h,l,"globe"===h.transform.projection.name?.5:.25),_.clear({color:c.Color.transparent});const R=h.transform,V="globe"===R.projection.name,j=V?["PROJECTION_GLOBE_VIEW"]:null,y=V?c.CullFaceMode.frontCCW:c.CullFaceMode.disabled,E=[c.mercatorXfromLng(R.center.lng),c.mercatorYfromLat(R.center.lat)];for(let x=0;x<p.length;x++){const T=p[x];if(r.hasRenderableParent(T))continue;const M=r.getTile(T),L=M.getBucket(l);if(!L||L.projection.name!==R.projection.name)continue;const O=L.programConfigurations.get(l.id),Z=h.useProgram("heatmap",O,j),{zoom:Y}=h.transform;h.terrain&&h.terrain.setupElevationDraw(M,Z),h.prepareDrawProgram(_,Z,T.toUnwrapped());const oe=R.projection.createInversionMatrix(R,T.canonical);Z.draw(_,b.TRIANGLES,c.DepthMode.disabled,S,A,y,kl(h,T,M,oe,E,Y,l.paint.get("heatmap-intensity")),l.id,L.layoutVertexBuffer,L.indexBuffer,L.segments,l.paint,h.transform.zoom,O,V?[L.globeExtVertexBuffer]:null)}_.viewport.set([0,0,h.width,h.height])}else"translucent"===h.renderPass&&(h.context.setColorMode(h.colorModeForRenderPass()),function(_,b){const S=_.context,A=S.gl,R=b.heatmapFbo;if(!R)return;S.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,R.colorAttachment.get()),S.activeTexture.set(A.TEXTURE1);let V=b.colorRampTexture;V||(V=b.colorRampTexture=new c.Texture(S,b.colorRamp,A.RGBA)),V.bind(A.LINEAR,A.CLAMP_TO_EDGE),_.useProgram("heatmapTexture").draw(S,A.TRIANGLES,c.DepthMode.disabled,c.StencilMode.disabled,_.colorModeForRenderPass(),c.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:b.paint.get("heatmap-opacity")},b.id,_.viewportBuffer,_.quadTriangleIndexBuffer,_.viewportSegments,b.paint,_.transform.zoom)}(h,l))},line:function(h,r,l,p){if("translucent"!==h.renderPass)return;const _=l.paint.get("line-opacity"),b=l.paint.get("line-width");if(0===_.constantOr(1)||0===b.constantOr(1))return;const S=h.depthModeForSublayer(0,c.DepthMode.ReadOnly),A=h.colorModeForRenderPass(),R=h.terrain&&h.terrain.renderingToTexture?1:c.exported.devicePixelRatio,V=l.paint.get("line-dasharray"),j=V.constantOr(1),y=l.layout.get("line-cap"),E=l.paint.get("line-pattern"),x=E.constantOr(1),T=l.paint.get("line-gradient"),M=x?"linePattern":"line",L=h.context,O=L.gl,Z=(oe=>{const se=[];Jn(oe)&&se.push("RENDER_LINE_DASH"),oe.paint.get("line-gradient")&&se.push("RENDER_LINE_GRADIENT");const he=oe.paint.get("line-trim-offset");0===he[0]&&0===he[1]||se.push("RENDER_LINE_TRIM_OFFSET");const be=oe.paint.get("line-pattern").constantOr(1),Le=1!==oe.paint.get("line-opacity").constantOr(1);return!be&&Le&&se.push("RENDER_LINE_ALPHA_DISCARD"),se})(l);let Y=Z.includes("RENDER_LINE_ALPHA_DISCARD");h.terrain&&h.terrain.clipOrMaskOverlapStencilType()&&(Y=!1);for(const oe of p){const se=r.getTile(oe);if(x&&!se.patternsLoaded())continue;const he=se.getBucket(l);if(!he)continue;h.prepareDrawTile();const be=he.programConfigurations.get(l.id),Le=h.useProgram(M,be,Z),Pe=E.constantOr(null);if(Pe&&se.imageAtlas){const Ke=se.imageAtlas.patternPositions[Pe.toString()];Ke&&be.setConstantPatternPositions(Ke)}const Te=V.constantOr(null),et=y.constantOr(null);if(!x&&Te&&et&&se.lineAtlas){const Ke=se.lineAtlas.getDash(Te,et);Ke&&be.setConstantPatternPositions(Ke)}let[Re,He]=l.paint.get("line-trim-offset");("round"===et||"square"===et)&&Re!==He&&(0===Re&&(Re-=1),1===He&&(He+=1));const ze=h.terrain?oe.projMatrix:null,ct=x?Vi(h,se,l,ze,R):Ol(h,se,l,ze,he.lineClipsArray.length,R,[Re,He]);if(T){const Ke=he.gradients[l.id];let vt=Ke.texture;if(l.gradientVersion!==Ke.version){let Ae=256;if(l.stepInterpolant){const Be=r.getSource().maxzoom,Zt=oe.canonical.z===Be?Math.ceil(1<<h.transform.maxZoom-oe.canonical.z):1;Ae=c.clamp(c.nextPowerOfTwo(he.maxLineLength/c.EXTENT*1024*Zt),256,L.maxTextureSize)}Ke.gradient=c.renderColorRamp({expression:l.gradientExpression(),evaluationKey:"lineProgress",resolution:Ae,image:Ke.gradient||void 0,clips:he.lineClipsArray}),Ke.texture?Ke.texture.update(Ke.gradient):Ke.texture=new c.Texture(L,Ke.gradient,O.RGBA),Ke.version=l.gradientVersion,vt=Ke.texture}L.activeTexture.set(O.TEXTURE1),vt.bind(l.stepInterpolant?O.NEAREST:O.LINEAR,O.CLAMP_TO_EDGE)}j&&(L.activeTexture.set(O.TEXTURE0),se.lineAtlasTexture.bind(O.LINEAR,O.REPEAT),be.updatePaintBuffers()),x&&(L.activeTexture.set(O.TEXTURE0),se.imageAtlasTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE),be.updatePaintBuffers()),h.prepareDrawProgram(L,Le,oe.toUnwrapped());const Ne=Ke=>{Le.draw(L,O.TRIANGLES,S,Ke,A,c.CullFaceMode.disabled,ct,l.id,he.layoutVertexBuffer,he.indexBuffer,he.segments,l.paint,h.transform.zoom,be,[he.layoutVertexBuffer2])};if(Y){const Ke=h.stencilModeForClipping(oe).ref;0===Ke&&h.terrain&&L.clear({stencil:0});const vt={func:O.EQUAL,mask:255};ct.u_alpha_discard_threshold=.8,Ne(new c.StencilMode(vt,Ke,255,O.KEEP,O.KEEP,O.INVERT)),ct.u_alpha_discard_threshold=0,Ne(new c.StencilMode(vt,Ke,255,O.KEEP,O.KEEP,O.KEEP))}else Ne(h.stencilModeForClipping(oe))}Y&&(h.resetStencilClippingMasks(),h.terrain&&L.clear({stencil:0}))},fill:function(h,r,l,p){const _=l.paint.get("fill-color"),b=l.paint.get("fill-opacity");if(0===b.constantOr(1))return;const S=h.colorModeForRenderPass(),A=l.paint.get("fill-pattern"),R=h.opaquePassEnabledForLayer()&&!A.constantOr(1)&&1===_.constantOr(c.Color.transparent).a&&1===b.constantOr(0)?"opaque":"translucent";if(h.renderPass===R){const V=h.depthModeForSublayer(1,"opaque"===h.renderPass?c.DepthMode.ReadWrite:c.DepthMode.ReadOnly);_c(h,r,l,p,V,S,!1)}if("translucent"===h.renderPass&&l.paint.get("fill-antialias")){const V=h.depthModeForSublayer(l.getPaintProperty("fill-outline-color")?2:0,c.DepthMode.ReadOnly);_c(h,r,l,p,V,S,!0)}},"fill-extrusion":function(h,r,l,p){const _=l.paint.get("fill-extrusion-opacity");if(0!==_&&"translucent"===h.renderPass){const b=new c.DepthMode(h.context.gl.LEQUAL,c.DepthMode.ReadWrite,h.depthRangeFor3D);if(1!==_||l.paint.get("fill-extrusion-pattern").constantOr(1))yc(h,r,l,p,b,c.StencilMode.disabled,c.ColorMode.disabled),yc(h,r,l,p,b,h.stencilModeFor3D(),h.colorModeForRenderPass()),h.resetStencilClippingMasks();else{const S=h.colorModeForRenderPass();yc(h,r,l,p,b,c.StencilMode.disabled,S)}}},hillshade:function(h,r,l,p){if("offscreen"!==h.renderPass&&"translucent"!==h.renderPass)return;const _=h.context,b=h.depthModeForSublayer(0,c.DepthMode.ReadOnly),S=h.colorModeForRenderPass(),A=h.terrain&&h.terrain.renderingToTexture,[R,V]="translucent"!==h.renderPass||A?[{},p]:h.stencilConfigForOverlap(p);for(const j of V){const y=r.getTile(j);if(y.needsHillshadePrepare&&"offscreen"===h.renderPass)Xs(h,y,l,b,c.StencilMode.disabled,S);else if("translucent"===h.renderPass){const E=A&&h.terrain?h.terrain.stencilModeForRTTOverlap(j):R[j.overscaledZ];Es(h,j,y,l,b,E,S)}}_.viewport.set([0,0,h.width,h.height]),h.resetStencilClippingMasks()},raster:function(h,r,l,p,_,b){if("translucent"!==h.renderPass||0===l.paint.get("raster-opacity")||!p.length)return;const S=h.context,A=S.gl,R=r.getSource(),V=h.useProgram("raster"),j=h.colorModeForRenderPass(),y=h.terrain&&h.terrain.renderingToTexture,[E,x]=R instanceof xe||y?[{},p]:h.stencilConfigForOverlap(p),T=x[x.length-1].overscaledZ,M=!h.options.moving;for(const L of x){const O=y?c.DepthMode.disabled:h.depthModeForSublayer(L.overscaledZ-T,1===l.paint.get("raster-opacity")?c.DepthMode.ReadWrite:c.DepthMode.ReadOnly,A.LESS),Z=L.toUnwrapped(),Y=r.getTile(L);if(y&&(!Y||!Y.hasData()))continue;const oe=y?L.projMatrix:h.transform.calculateProjMatrix(Z,M),se=h.terrain&&y?h.terrain.stencilModeForRTTOverlap(L):E[L.overscaledZ],he=b?0:l.paint.get("raster-fade-duration");Y.registerFadeDuration(he);const be=r.findLoadedParent(L,0),Le=Ea(Y,be,r,h.transform,he);let Pe,Te;h.terrain&&h.terrain.prepareDrawTile();const et="nearest"===l.paint.get("raster-resampling")?A.NEAREST:A.LINEAR;S.activeTexture.set(A.TEXTURE0),Y.texture.bind(et,A.CLAMP_TO_EDGE),S.activeTexture.set(A.TEXTURE1),be?(be.texture.bind(et,A.CLAMP_TO_EDGE),Pe=Math.pow(2,be.tileID.overscaledZ-Y.tileID.overscaledZ),Te=[Y.tileID.canonical.x*Pe%1,Y.tileID.canonical.y*Pe%1]):Y.texture.bind(et,A.CLAMP_TO_EDGE);const Re=na(oe,Te||[0,0],Pe||1,Le,l,R instanceof xe?R.perspectiveTransform:[0,0]);if(h.prepareDrawProgram(S,V,Z),R instanceof xe)R.boundsBuffer&&R.boundsSegments&&V.draw(S,A.TRIANGLES,O,c.StencilMode.disabled,j,c.CullFaceMode.disabled,Re,l.id,R.boundsBuffer,h.quadTriangleIndexBuffer,R.boundsSegments);else{const{tileBoundsBuffer:He,tileBoundsIndexBuffer:ze,tileBoundsSegments:ct}=h.getTileBoundsBuffers(Y);V.draw(S,A.TRIANGLES,O,se,j,c.CullFaceMode.disabled,Re,l.id,He,ze,ct)}}h.resetStencilClippingMasks()},background:function(h,r,l,p){const _=l.paint.get("background-color"),b=l.paint.get("background-opacity");if(0===b)return;const S=h.context,A=S.gl,R=h.transform,V=R.tileSize,j=l.paint.get("background-pattern");if(h.isPatternMissing(j))return;const y=!j&&1===_.a&&1===b&&h.opaquePassEnabledForLayer()?"opaque":"translucent";if(h.renderPass!==y)return;const E=c.StencilMode.disabled,x=h.depthModeForSublayer(0,"opaque"===y?c.DepthMode.ReadWrite:c.DepthMode.ReadOnly),T=h.colorModeForRenderPass(),M=h.useProgram(j?"backgroundPattern":"background");let L,O=p;O||(L=h.getBackgroundTiles(),O=Object.values(L).map(Z=>Z.tileID)),j&&(S.activeTexture.set(A.TEXTURE0),h.imageManager.bind(h.context));for(const Z of O){const Y=Z.toUnwrapped(),oe=p?Z.projMatrix:h.transform.calculateProjMatrix(Y);h.prepareDrawTile();const se=r?r.getTile(Z):L?L[Z.key]:new c.Tile(Z,V,R.zoom,h),he=j?al(oe,b,h,j,{tileID:Z,tileSize:V}):gc(oe,b,_);h.prepareDrawProgram(S,M,Y);const{tileBoundsBuffer:be,tileBoundsIndexBuffer:Le,tileBoundsSegments:Pe}=h.getTileBoundsBuffers(se);M.draw(S,A.TRIANGLES,x,E,T,c.CullFaceMode.disabled,he,l.id,be,Le,Pe)}},sky:function(h,r,l){const p=h.transform,_="mercator"===p.projection.name||"globe"===p.projection.name?1:c.smoothstep(7,8,p.zoom),b=l.paint.get("sky-opacity")*_;if(0===b)return;const S=h.context,A=l.paint.get("sky-type"),R=new c.DepthMode(S.gl.LEQUAL,c.DepthMode.ReadOnly,[0,1]),V=h.frameCounter/1e3%1;"atmosphere"===A?"offscreen"===h.renderPass?l.needsSkyboxCapture(h)&&(function(j,y,E,x){const T=j.context,M=T.gl;let L=y.skyboxFbo;if(!L){L=y.skyboxFbo=T.createFramebuffer(32,32,!1),y.skyboxGeometry=new Yo(T),y.skyboxTexture=T.gl.createTexture(),M.bindTexture(M.TEXTURE_CUBE_MAP,y.skyboxTexture),M.texParameteri(M.TEXTURE_CUBE_MAP,M.TEXTURE_WRAP_S,M.CLAMP_TO_EDGE),M.texParameteri(M.TEXTURE_CUBE_MAP,M.TEXTURE_WRAP_T,M.CLAMP_TO_EDGE),M.texParameteri(M.TEXTURE_CUBE_MAP,M.TEXTURE_MIN_FILTER,M.LINEAR),M.texParameteri(M.TEXTURE_CUBE_MAP,M.TEXTURE_MAG_FILTER,M.LINEAR);for(let oe=0;oe<6;++oe)M.texImage2D(M.TEXTURE_CUBE_MAP_POSITIVE_X+oe,0,M.RGBA,32,32,0,M.RGBA,M.UNSIGNED_BYTE,null)}T.bindFramebuffer.set(L.framebuffer),T.viewport.set([0,0,32,32]);const O=y.getCenter(j,!0),Z=j.useProgram("skyboxCapture"),Y=new Float64Array(16);c.identity(Y),c.rotateY(Y,Y,.5*-Math.PI),Is(T,y,Z,Y,O,0),c.identity(Y),c.rotateY(Y,Y,.5*Math.PI),Is(T,y,Z,Y,O,1),c.identity(Y),c.rotateX(Y,Y,.5*-Math.PI),Is(T,y,Z,Y,O,2),c.identity(Y),c.rotateX(Y,Y,.5*Math.PI),Is(T,y,Z,Y,O,3),c.identity(Y),Is(T,y,Z,Y,O,4),c.identity(Y),c.rotateY(Y,Y,Math.PI),Is(T,y,Z,Y,O,5),T.viewport.set([0,0,j.width,j.height])}(h,l),l.markSkyboxValid(h)):"sky"===h.renderPass&&function(j,y,E,x,T){const M=j.context,L=M.gl,O=j.transform,Z=j.useProgram("skybox");M.activeTexture.set(L.TEXTURE0),L.bindTexture(L.TEXTURE_CUBE_MAP,y.skyboxTexture);const Y={u_matrix:O.skyboxMatrix,u_sun_direction:y.getCenter(j,!1),u_cubemap:0,u_opacity:x,u_temporal_offset:T};j.prepareDrawProgram(M,Z),Z.draw(M,L.TRIANGLES,E,c.StencilMode.disabled,j.colorModeForRenderPass(),c.CullFaceMode.backCW,Y,"skybox",y.skyboxGeometry.vertexBuffer,y.skyboxGeometry.indexBuffer,y.skyboxGeometry.segment)}(h,l,R,b,V):"gradient"===A&&"sky"===h.renderPass&&function(j,y,E,x,T){const M=j.context,L=M.gl,O=j.transform,Z=j.useProgram("skyboxGradient");y.skyboxGeometry||(y.skyboxGeometry=new Yo(M)),M.activeTexture.set(L.TEXTURE0);let Y=y.colorRampTexture;Y||(Y=y.colorRampTexture=new c.Texture(M,y.colorRamp,L.RGBA)),Y.bind(L.LINEAR,L.CLAMP_TO_EDGE);const oe=(se=O.skyboxMatrix,he=y.getCenter(j,!1),be=y.paint.get("sky-gradient-radius"),Le=x,Pe=T,{u_matrix:se,u_color_ramp:0,u_center_direction:he,u_radius:c.degToRad(be),u_opacity:Le,u_temporal_offset:Pe});var se,he,be,Le,Pe;j.prepareDrawProgram(M,Z),Z.draw(M,L.TRIANGLES,E,c.StencilMode.disabled,j.colorModeForRenderPass(),c.CullFaceMode.backCW,oe,"skyboxGradient",y.skyboxGeometry.vertexBuffer,y.skyboxGeometry.indexBuffer,y.skyboxGeometry.segment)}(h,l,R,b,V)},debug:function(h,r,l){for(let p=0;p<l.length;p++)Fl(h,r,l[p])},custom:function(h,r,l){const p=h.context,_=l.implementation;if(h.transform.projection.unsupportedLayers&&h.transform.projection.unsupportedLayers.includes("custom"))c.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if("offscreen"===h.renderPass){const b=_.prerender;b&&(h.setCustomLayerDefaults(),p.setColorMode(h.colorModeForRenderPass()),b.call(_,p.gl,h.transform.customLayerMatrix()),p.setDirty(),h.setBaseState())}else if("translucent"===h.renderPass){h.setCustomLayerDefaults(),p.setColorMode(h.colorModeForRenderPass()),p.setStencilMode(c.StencilMode.disabled);const b="3d"===_.renderingMode?new c.DepthMode(h.context.gl.LEQUAL,c.DepthMode.ReadWrite,h.depthRangeFor3D):h.depthModeForSublayer(0,c.DepthMode.ReadOnly);p.setDepthMode(b),_.render(p.gl,h.transform.customLayerMatrix()),p.setDirty(),h.setBaseState(),p.bindFramebuffer.set(null)}}};class W{constructor(r,l){this.context=new H(r),this.transform=l,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=c.SourceCache.maxUnderzooming+c.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new qs,this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(r,l){const p=!!r&&!!r.terrain&&this.transform.projection.supportsTerrain;if(!(p||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new ho(this,r));const _=this._terrain;this.transform.elevation=p?_:null,_.update(r,this.transform,l)}_updateFog(r){const l=r.fog;if(!l||"globe"===this.transform.projection.name||l.getOpacity(this.transform.pitch)<1||l.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[p,_]=l.getFovAdjustedRange(this.transform._fov);if(p>_)return void(this.transform.fogCullDistSq=null);const b=p+.78*(_-p);this.transform.fogCullDistSq=b*b}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(r,l){if(this.width=r*c.exported.devicePixelRatio,this.height=l*c.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const p of this.style.order)this.style._layers[p].resize()}setup(){const r=this.context,l=new c.StructArrayLayout2i4;l.emplaceBack(0,0),l.emplaceBack(c.EXTENT,0),l.emplaceBack(0,c.EXTENT),l.emplaceBack(c.EXTENT,c.EXTENT),this.tileExtentBuffer=r.createVertexBuffer(l,c.posAttributes.members),this.tileExtentSegments=c.SegmentVector.simpleSegment(0,0,4,2);const p=new c.StructArrayLayout2i4;p.emplaceBack(0,0),p.emplaceBack(c.EXTENT,0),p.emplaceBack(0,c.EXTENT),p.emplaceBack(c.EXTENT,c.EXTENT),this.debugBuffer=r.createVertexBuffer(p,c.posAttributes.members),this.debugSegments=c.SegmentVector.simpleSegment(0,0,4,5);const _=new c.StructArrayLayout2i4;_.emplaceBack(-1,-1),_.emplaceBack(1,-1),_.emplaceBack(-1,1),_.emplaceBack(1,1),this.viewportBuffer=r.createVertexBuffer(_,c.posAttributes.members),this.viewportSegments=c.SegmentVector.simpleSegment(0,0,4,2);const b=new c.StructArrayLayout4i8;b.emplaceBack(0,0,0,0),b.emplaceBack(c.EXTENT,0,c.EXTENT,0),b.emplaceBack(0,c.EXTENT,0,c.EXTENT),b.emplaceBack(c.EXTENT,c.EXTENT,c.EXTENT,c.EXTENT),this.mercatorBoundsBuffer=r.createVertexBuffer(b,c.boundsAttributes.members),this.mercatorBoundsSegments=c.SegmentVector.simpleSegment(0,0,4,2);const S=new c.StructArrayLayout3ui6;S.emplaceBack(0,1,2),S.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=r.createIndexBuffer(S);const A=new c.StructArrayLayout1ui2;for(const V of[0,1,3,2,0])A.emplaceBack(V);this.debugIndexBuffer=r.createIndexBuffer(A),this.emptyTexture=new c.Texture(r,new c.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),r.gl.RGBA),this.identityMat=c.create();const R=this.context.gl;this.stencilClearMode=new c.StencilMode({func:R.ALWAYS,mask:0},0,255,R.ZERO,R.ZERO,R.ZERO),this.loadTimeStamps.push(c.window.performance.now()),this.atmosphereBuffer=new An(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(r){return r._makeTileBoundsBuffers(this.context,this.transform.projection),r._tileBoundsBuffer?{tileBoundsBuffer:r._tileBoundsBuffer,tileBoundsIndexBuffer:r._tileBoundsIndexBuffer,tileBoundsSegments:r._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const r=this.context,l=r.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(r,l.TRIANGLES,c.DepthMode.disabled,this.stencilClearMode,c.ColorMode.disabled,c.CullFaceMode.disabled,Ds(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(r,l,p){if(!l||this.currentStencilSource===l.id||!r.isTileClipped()||!p||0===p.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let A=!1;for(const R of p)if(void 0===this._tileClippingMaskIDs[R.key]){A=!0;break}if(!A)return}this.currentStencilSource=l.id;const _=this.context,b=_.gl;this.nextStencilID+p.length>256&&this.clearStencil(),_.setColorMode(c.ColorMode.disabled),_.setDepthMode(c.DepthMode.disabled);const S=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const A of p){const R=l.getTile(A),V=this._tileClippingMaskIDs[A.key]=this.nextStencilID++,{tileBoundsBuffer:j,tileBoundsIndexBuffer:y,tileBoundsSegments:E}=this.getTileBoundsBuffers(R);S.draw(_,b.TRIANGLES,c.DepthMode.disabled,new c.StencilMode({func:b.ALWAYS,mask:0},V,255,b.KEEP,b.KEEP,b.REPLACE),c.ColorMode.disabled,c.CullFaceMode.disabled,Ds(A.projMatrix),"$clipping",j,y,E)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const r=this.nextStencilID++,l=this.context.gl;return new c.StencilMode({func:l.NOTEQUAL,mask:255},r,255,l.KEEP,l.KEEP,l.REPLACE)}stencilModeForClipping(r){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(r);const l=this.context.gl;return new c.StencilMode({func:l.EQUAL,mask:255},this._tileClippingMaskIDs[r.key],0,l.KEEP,l.KEEP,l.REPLACE)}stencilConfigForOverlap(r){const l=this.context.gl,p=r.sort((S,A)=>A.overscaledZ-S.overscaledZ),_=p[p.length-1].overscaledZ,b=p[0].overscaledZ-_+1;if(b>1){this.currentStencilSource=void 0,this.nextStencilID+b>256&&this.clearStencil();const S={};for(let A=0;A<b;A++)S[A+_]=new c.StencilMode({func:l.GEQUAL,mask:255},A+this.nextStencilID,255,l.KEEP,l.KEEP,l.REPLACE);return this.nextStencilID+=b,[S,p]}return[{[_]:c.StencilMode.disabled},p]}colorModeForRenderPass(){const r=this.context.gl;return this._showOverdrawInspector?new c.ColorMode([r.CONSTANT_COLOR,r.ONE],new c.Color(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?c.ColorMode.unblended:c.ColorMode.alphaBlended}depthModeForSublayer(r,l,p){if(!this.opaquePassEnabledForLayer())return c.DepthMode.disabled;const _=1-((1+this.currentLayer)*this.numSublayers+r)*this.depthEpsilon;return new c.DepthMode(p||this.context.gl.LEQUAL,l,[_,_])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(r,l){this.style=r,this.options=l,this.imageManager=r.imageManager,this.glyphManager=r.glyphManager,this.symbolFadeChange=r.placement.symbolFadeChange(c.exported.now()),this.imageManager.beginFrame();const p=this.style.order,_=this.style._sourceCaches;for(const R in _){const V=_[R];V.used&&V.prepare(this.context)}const b={},S={},A={};for(const R in _){const V=_[R];b[R]=V.getVisibleCoordinates(),S[R]=b[R].slice().reverse(),A[R]=V.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let R=0;R<p.length;R++)if(this.style._layers[p[R]].is3D()){this.opaquePassCutoff=R;break}if(this.terrain&&(this.terrain.updateTileBinding(A),this.opaquePassCutoff=0),"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new c.GlobeSharedBuffers(this.context)),c.isMapAuthenticated(this.context.gl)){this.renderPass="offscreen";for(const R of p){const V=this.style._layers[R],j=r._getLayerSourceCache(V);if(!V.hasOffscreenPass()||V.isHidden(this.transform.zoom))continue;const y=j?S[j.id]:void 0;("custom"===V.type||V.isSky()||y&&y.length)&&this.renderLayer(this,j,V,y)}if(this.depthRangeFor3D=[0,1-(r.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:l.showOverdrawInspector?c.Color.black:c.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=l.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=p.length-1;this.currentLayer>=0;this.currentLayer--){const R=this.style._layers[p[this.currentLayer]],V=r._getLayerSourceCache(R);if(R.isSky())continue;const j=V?S[V.id]:void 0;this._renderTileClippingMasks(R,V,j),this.renderLayer(this,V,R,j)}if(this.style.fog&&this.transform.projection.supportsFog&&function(R,V){const j=R.context,y=j.gl,E=R.transform,x=new c.DepthMode(y.LEQUAL,c.DepthMode.ReadOnly,[0,1]),T=R.useProgram("globeAtmosphere",null,"globe"===E.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),M=c.globeToMercatorTransition(E.zoom),L=V.properties.get("color").toArray01(),O=V.properties.get("high-color").toArray01(),Z=V.properties.get("space-color").toArray01PremultipliedAlpha(),Y=c.identity$1([]);c.rotateY$1(Y,Y,-c.degToRad(E._center.lng)),c.rotateX$1(Y,Y,c.degToRad(E._center.lat)),c.rotateZ$1(Y,Y,E.angle),c.rotateX$1(Y,Y,-E._pitch);const oe=c.fromQuat(new Float32Array(16),Y),se=c.mapValue(V.properties.get("star-intensity"),0,1,0,.25),be=c.mapValue(V.properties.get("horizon-blend"),0,1,5e-4,.25),Le=c.globeUseCustomAntiAliasing(R,j,E)&&5e-4===be?E.worldSize/(2*Math.PI*1.025)-1:E.globeRadius,Pe=R.frameCounter/1e3%1,Te=c.length(E.globeCenterInViewSpace),et=Math.sqrt(Math.pow(Te,2)-Math.pow(Le,2)),Re=Math.acos(et/Te),He={u_frustum_tl:E.frustumCorners.TL,u_frustum_tr:E.frustumCorners.TR,u_frustum_br:E.frustumCorners.BR,u_frustum_bl:E.frustumCorners.BL,u_horizon:E.frustumCorners.horizon,u_transition:M,u_fadeout_range:be,u_color:L,u_high_color:O,u_space_color:Z,u_star_intensity:se,u_star_size:5*c.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:Pe,u_horizon_angle:Re,u_rotation_matrix:oe};R.prepareDrawProgram(j,T);const ze=R.atmosphereBuffer;ze&&T.draw(j,y.TRIANGLES,x,c.StencilMode.disabled,c.ColorMode.alphaBlended,c.CullFaceMode.backCW,He,"skybox",ze.vertexBuffer,ze.indexBuffer,ze.segments)}(this,this.style.fog),this.renderPass="sky",(c.globeToMercatorTransition(this.transform.zoom)>0||"globe"!==this.transform.projection.name)&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<p.length;this.currentLayer++){const R=this.style._layers[p[this.currentLayer]],V=r._getLayerSourceCache(R);R.isSky()&&this.renderLayer(this,V,R,V?S[V.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<p.length;){const R=this.style._layers[p[this.currentLayer]],V=r._getLayerSourceCache(R);if(R.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(R)){if(R.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const j=V?("symbol"===R.type?A:S)[V.id]:void 0;this._renderTileClippingMasks(R,V,V?b[V.id]:void 0),this.renderLayer(this,V,R,j),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let R=null;c.values(this.style._layers).forEach(V=>{const j=r._getLayerSourceCache(V);j&&!V.isHidden(this.transform.zoom)&&(!R||R.getSource().maxzoom<j.getSource().maxzoom)&&(R=j)}),R&&this.options.showTileBoundaries&&z.debug(this,R,R.getVisibleCoordinates())}this.options.showPadding&&function(R){const V=R.transform.padding;Ss(R,R.transform.height-(V.top||0),3,vc),Ss(R,V.bottom||0,3,xc),ms(R,V.left||0,3,ul),ms(R,R.transform.width-(V.right||0),3,hl);const j=R.transform.centerPoint;var y,E,x,T;ko(y=R,(E=j.x)-1,(x=R.transform.height-j.y)-10,2,20,T=dl),ko(y,E-10,x-1,20,2,T)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(c.window.performance.now()),this.saveCanvasCopy())}}renderLayer(r,l,p,_){p.isHidden(this.transform.zoom)||("background"===p.type||"sky"===p.type||"custom"===p.type||_&&_.length)&&(this.id=p.id,this.gpuTimingStart(p),r.transform.projection.unsupportedLayers&&r.transform.projection.unsupportedLayers.includes(p.type)||z[p.type](r,l,p,_,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(r){if(!this.options.gpuTiming)return;const l=this.context.extTimerQuery;let p=this.gpuTimers[r.id];p||(p=this.gpuTimers[r.id]={calls:0,cpuTime:0,query:l.createQueryEXT()}),p.calls++,l.beginQueryEXT(l.TIME_ELAPSED_EXT,p.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const r=this.context.extTimerQuery,l=r.createQueryEXT();this.deferredRenderGpuTimeQueries.push(l),r.beginQueryEXT(r.TIME_ELAPSED_EXT,l)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const r=this.context.extTimerQuery;r.endQueryEXT(r.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const r=this.context.extTimerQuery;r.endQueryEXT(r.TIME_ELAPSED_EXT)}collectGpuTimers(){const r=this.gpuTimers;return this.gpuTimers={},r}collectDeferredRenderGpuQueries(){const r=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],r}queryGpuTimers(r){const l={};for(const p in r){const _=r[p],b=this.context.extTimerQuery,S=b.getQueryObjectEXT(_.query,b.QUERY_RESULT_EXT)/1e6;b.deleteQueryEXT(_.query),l[p]=S}return l}queryGpuTimeDeferredRender(r){if(!this.options.gpuTimingDeferredRender)return 0;const l=this.context.extTimerQuery;let p=0;for(const _ of r)p+=l.getQueryObjectEXT(_,l.QUERY_RESULT_EXT)/1e6,l.deleteQueryEXT(_);return p}translatePosMatrix(r,l,p,_,b){if(!p[0]&&!p[1])return r;const S=b?"map"===_?this.transform.angle:0:"viewport"===_?-this.transform.angle:0;if(S){const V=Math.sin(S),j=Math.cos(S);p=[p[0]*j-p[1]*V,p[0]*V+p[1]*j]}const A=[b?p[0]:at(l,p[0],this.transform.zoom),b?p[1]:at(l,p[1],this.transform.zoom),0],R=new Float32Array(16);return c.translate(R,r,A),R}saveTileTexture(r){const l=this._tileTextures[r.size[0]];l?l.push(r):this._tileTextures[r.size[0]]=[r]}getTileTexture(r){const l=this._tileTextures[r];return l&&l.length>0?l.pop():null}isPatternMissing(r){return null===r||void 0!==r&&!this.imageManager.getPattern(r.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const r=this.terrain&&this.terrain.renderingToTexture,l=this.terrain&&0===this.terrain.exaggeration(),p=this.style&&this.style.fog,_=[];return this.terrainRenderModeElevated()&&_.push("TERRAIN"),"globe"===this.transform.projection.name&&_.push("GLOBE"),l&&_.push("ZERO_EXAGGERATION"),p&&!r&&0!==p.getOpacity(this.transform.pitch)&&_.push("FOG"),r&&_.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&_.push("OVERDRAW_INSPECTOR"),_}useProgram(r,l,p){this.cache=this.cache||{};const _=p||[],b=this.currentGlobalDefines().concat(_),S=mc.cacheKey(nl[r],r,b,l);return this.cache[S]||(this.cache[S]=new mc(this.context,r,nl[r],l,Bc[r],b)),this.cache[S]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const r=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(r.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=c.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new c.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(r,l,p){if(this.terrain&&this.terrain.renderingToTexture)return;const _=this.style.fog;if(_){const b=_.getOpacity(this.transform.pitch),S=((A,R,V,j,y,E,x,T,M,L,O)=>{const Z=A.transform,Y=R.properties.get("color").toArray01();Y[3]=j;const oe=A.frameCounter/1e3%1;return{u_fog_matrix:V?Z.calculateFogTileMatrix(V):A.identityMat,u_fog_range:R.getFovAdjustedRange(Z._fov),u_fog_color:Y,u_fog_horizon_blend:R.properties.get("horizon-blend"),u_fog_temporal_offset:oe,u_frustum_tl:y,u_frustum_tr:E,u_frustum_br:x,u_frustum_bl:T,u_globe_pos:M,u_globe_radius:L,u_viewport:O,u_globe_transition:c.globeToMercatorTransition(Z.zoom),u_is_globe:+("globe"===Z.projection.name)}})(this,_,p,b,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*c.exported.devicePixelRatio,this.transform.height*c.exported.devicePixelRatio]);l.setFogUniformValues(r,S)}}setTileLoadedFlag(r){this.tileLoaded=r}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const r=this.context.gl,l=r.createTexture();return r.bindTexture(r.TEXTURE_2D,l),r.copyTexImage2D(r.TEXTURE_2D,0,r.RGBA,0,0,r.drawingBufferWidth,r.drawingBufferHeight,0),l}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const r=this.style&&this.style.fog;return!!r&&0!==r.getOpacity(this.transform.pitch)}getBackgroundTiles(){const r=this._backgroundTiles,l=this._backgroundTiles={},p=this.transform.coveringTiles({tileSize:512});for(const _ of p)l[_.key]=r[_.key]||new c.Tile(_,512,this.transform.tileZoom,this);return l}clearBackgroundTiles(){this._backgroundTiles={}}}class U{constructor(r=0,l=0,p=0,_=0){if(isNaN(r)||r<0||isNaN(l)||l<0||isNaN(p)||p<0||isNaN(_)||_<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=r,this.bottom=l,this.left=p,this.right=_}interpolate(r,l,p){return null!=l.top&&null!=r.top&&(this.top=c.number(r.top,l.top,p)),null!=l.bottom&&null!=r.bottom&&(this.bottom=c.number(r.bottom,l.bottom,p)),null!=l.left&&null!=r.left&&(this.left=c.number(r.left,l.left,p)),null!=l.right&&null!=r.right&&(this.right=c.number(r.right,l.right,p)),this}getCenter(r,l){const p=c.clamp((this.left+r-this.right)/2,0,r),_=c.clamp((this.top+l-this.bottom)/2,0,l);return new c.pointGeometry(p,_)}equals(r){return this.top===r.top&&this.bottom===r.bottom&&this.left===r.left&&this.right===r.right}clone(){return new U(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function ee(h,r){const l=c.getColumn(h,3);c.fromQuat(h,r),c.setColumn(h,3,l)}function me(h,r){const l=c.identity$1([]);return c.rotateZ$1(l,l,-r),c.rotateX$1(l,l,-h),l}function $e(h,r){const l=[h[0],h[1],0],p=[r[0],r[1],0];if(c.length(l)>=1e-15){const S=c.normalize([],l);c.scale$2(p,S,c.dot(p,S)),r[0]=p[0],r[1]=p[1]}const _=c.cross([],r,h);if(c.len(_)<1e-15)return null;const b=Math.atan2(-_[1],_[0]);return me(Math.atan2(Math.sqrt(h[0]*h[0]+h[1]*h[1]),-h[2]),b)}class rt{constructor(r,l){this.position=r,this.orientation=l}get position(){return this._position}set position(r){if(r){const l=r instanceof c.MercatorCoordinate?r:new c.MercatorCoordinate(r[0],r[1],r[2]);this._renderWorldCopies&&(l.x=c.wrap(l.x,0,1)),this._position=l}else this._position=null}lookAtPoint(r,l){if(this.orientation=null,!this.position)return;const p=this._elevation?this._elevation.getAtPointOrZero(c.MercatorCoordinate.fromLngLat(r)):0,_=this.position,b=c.MercatorCoordinate.fromLngLat(r,p),S=[b.x-_.x,b.y-_.y,b.z-_.z];l||(l=[0,0,1]),l[2]=Math.abs(l[2]),this.orientation=$e(S,l)}setPitchBearing(r,l){this.orientation=me(c.degToRad(r),c.degToRad(-l))}}class Yt{constructor(r,l){this._transform=c.identity([]),this.orientation=l,this.position=r}get mercatorPosition(){const r=this.position;return new c.MercatorCoordinate(r[0],r[1],r[2])}get position(){const r=c.getColumn(this._transform,3);return[r[0],r[1],r[2]]}set position(r){var l;r&&c.setColumn(this._transform,3,[(l=r)[0],l[1],l[2],1])}get orientation(){return this._orientation}set orientation(r){this._orientation=r||c.identity$1([]),r&&ee(this._transform,this._orientation)}getPitchBearing(){const r=this.forward(),l=this.right();return{bearing:Math.atan2(-l[1],l[0]),pitch:Math.atan2(Math.sqrt(r[0]*r[0]+r[1]*r[1]),-r[2])}}setPitchBearing(r,l){this._orientation=me(r,l),ee(this._transform,this._orientation)}forward(){const r=c.getColumn(this._transform,2);return[-r[0],-r[1],-r[2]]}up(){const r=c.getColumn(this._transform,1);return[-r[0],-r[1],-r[2]]}right(){const r=c.getColumn(this._transform,0);return[r[0],r[1],r[2]]}getCameraToWorld(r,l){const p=new Float64Array(16);return c.invert(p,this.getWorldToCamera(r,l)),p}getWorldToCameraPosition(r,l,p){const _=this.position;c.scale$2(_,_,-r);const b=new Float64Array(16);return c.fromScaling(b,[p,p,p]),c.translate(b,b,_),b[10]*=l,b}getWorldToCamera(r,l){const p=new Float64Array(16),_=new Float64Array(4),b=this.position;return c.conjugate(_,this._orientation),c.scale$2(b,b,-r),c.fromQuat(p,_),c.translate(p,p,b),p[1]*=-1,p[5]*=-1,p[9]*=-1,p[13]*=-1,p[8]*=l,p[9]*=l,p[10]*=l,p[11]*=l,p}getCameraToClipPerspective(r,l,p,_){const b=new Float64Array(16);return c.perspective(b,r,l,p,_),b}getDistanceToElevation(r,l=!1){const p=0===r?0:c.mercatorZfromAltitude(r,l?c.latFromMercatorY(this.position[1]):this.position[1]),_=this.forward();return(p-this.position[2])/_[2]}clone(){return new Yt([...this.position],[...this.orientation])}}function Qn(h,r){const l=Zn(h.projection,h.zoom,h.width,h.height),p=function(b,S,A,R,V){const j=new c.LngLat(A.lng-180*In,A.lat),y=new c.LngLat(A.lng+180*In,A.lat),E=b.project(j.lng,j.lat),x=b.project(y.lng,y.lat),T=-Math.atan2(x.y-E.y,x.x-E.x),M=c.MercatorCoordinate.fromLngLat(A);M.y=c.clamp(M.y,-.999975,.999975);const L=M.toLngLat(),O=b.project(L.lng,L.lat),Z=c.MercatorCoordinate.fromLngLat(L);Z.x+=In;const Y=Z.toLngLat(),oe=b.project(Y.lng,Y.lat),se=cr(oe.x-O.x,oe.y-O.y,T),he=c.MercatorCoordinate.fromLngLat(L);he.y+=In;const be=he.toLngLat(),Le=b.project(be.lng,be.lat),Pe=cr(Le.x-O.x,Le.y-O.y,T),Te=Math.abs(se.x)/Math.abs(Pe.y),et=c.identity([]);c.rotateZ(et,et,-T*(1-(V?0:R)));const Re=c.identity([]);return c.scale(Re,Re,[1,1-(1-Te)*R,1]),Re[4]=-Pe.x/Pe.y*R,c.rotateZ(Re,Re,T),c.multiply(Re,et,Re),Re}(h.projection,0,h.center,l,r),_=Hn(h);return c.scale(p,p,[_,_,1]),p}function Hn(h){const r=h.projection,l=Zn(h.projection,h.zoom,h.width,h.height),p=jr(r,h.center),_=jr(r,c.LngLat.convert(r.center));return Math.pow(2,p*l+(1-l)*_)}function Zn(h,r,l,p,_=1/0){const b=h.range;if(!b)return 0;const S=Math.min(_,Math.max(l,p)),A=Math.log(S/1024)/Math.LN2;return c.smoothstep(b[0]+A,b[1]+A,r)}const In=1/4e4;function jr(h,r){const l=c.clamp(r.lat,-c.MAX_MERCATOR_LATITUDE,c.MAX_MERCATOR_LATITUDE),p=new c.LngLat(r.lng-180*In,l),_=new c.LngLat(r.lng+180*In,l),b=h.project(p.lng,l),S=h.project(_.lng,l),A=c.MercatorCoordinate.fromLngLat(p),R=c.MercatorCoordinate.fromLngLat(_),V=S.x-b.x,j=S.y-b.y,y=R.x-A.x,E=R.y-A.y,x=Math.sqrt((y*y+E*E)/(V*V+j*j));return Math.log(x)/Math.LN2}function cr(h,r,l){const p=Math.cos(l),_=Math.sin(l);return{x:h*p-r*_,y:h*_+r*p}}class Cr{constructor(r,l,p,_,b,S,A){this.tileSize=512,this._renderWorldCopies=void 0===b||b,this._minZoom=r||0,this._maxZoom=l||22,this._minPitch=p??0,this._maxPitch=_??60,this.setProjection(S),this.setMaxBounds(A),this.width=0,this.height=0,this._center=new c.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new U,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new Yt,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const r=new Cr(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return r._elevation=this._elevation,r._centerAltitude=this._centerAltitude,r._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,r.tileSize=this.tileSize,r.mercatorFromTransition=this.mercatorFromTransition,r.width=this.width,r.height=this.height,r.cameraElevationReference=this.cameraElevationReference,r._center=this._center,r._setZoom(this.zoom),r._seaLevelZoom=this._seaLevelZoom,r.angle=this.angle,r._fov=this._fov,r._pitch=this._pitch,r._nearZ=this._nearZ,r._farZ=this._farZ,r._averageElevation=this._averageElevation,r._unmodified=this._unmodified,r._edgeInsets=this._edgeInsets.clone(),r._camera=this._camera.clone(),r._calcMatrices(),r.freezeTileCoverage=this.freezeTileCoverage,r.frustumCorners=this.frustumCorners,r}get elevation(){return this._elevation}set elevation(r){this._elevation!==r&&(this._elevation=r,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(r,l=!1){const p=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||p)&&this._updateCameraOnTerrain(),(r||p)&&this._constrainCamera(l),this._calcMatrices()}getProjection(){return c.pick(this.projection,["name","center","parallels"])}setProjection(r){this.projectionOptions=r||{name:"mercator"};const l=this.projection?this.getProjection():void 0;this.projection=c.getProjection(this.projectionOptions);const p=!Ee(l,this.getProjection());return p&&this._calcMatrices(),this.mercatorFromTransition=!1,p}setMercatorFromTransition(){const r=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=c.getProjection({name:"mercator"});const l=r!==this.projection.name;return l&&this._calcMatrices(),l}get minZoom(){return this._minZoom}set minZoom(r){this._minZoom!==r&&(this._minZoom=r,this.zoom=Math.max(this.zoom,r))}get maxZoom(){return this._maxZoom}set maxZoom(r){this._maxZoom!==r&&(this._maxZoom=r,this.zoom=Math.min(this.zoom,r))}get minPitch(){return this._minPitch}set minPitch(r){this._minPitch!==r&&(this._minPitch=r,this.pitch=Math.max(this.pitch,r))}get maxPitch(){return this._maxPitch}set maxPitch(r){this._maxPitch!==r&&(this._maxPitch=r,this.pitch=Math.min(this.pitch,r))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(r){void 0===r?r=!0:null===r&&(r=!1),this._renderWorldCopies=r}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const r=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(r))}get cameraWorldSize(){const r=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(r))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return c.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new c.pointGeometry(this.width,this.height)}get bearing(){return c.wrap(this.rotation,-180,180)}set bearing(r){this.rotation=r}get rotation(){return-this.angle/Math.PI*180}set rotation(r){const l=-r*Math.PI/180;var p,_,b,S,A,R,V,j,y,E;this.angle!==l&&(this._unmodified=!1,this.angle=l,this._calcMatrices(),this.rotationMatrix=(p=new c.ARRAY_TYPE(4),c.ARRAY_TYPE!=Float32Array&&(p[1]=0,p[2]=0),p[0]=1,p[3]=1,p),_=this.rotationMatrix,S=this.angle,A=(b=this.rotationMatrix)[0],R=b[1],V=b[2],j=b[3],y=Math.sin(S),E=Math.cos(S),_[0]=A*E+V*y,_[1]=R*E+j*y,_[2]=A*-y+V*E,_[3]=R*-y+j*E)}get pitch(){return this._pitch/Math.PI*180}set pitch(r){const l=c.clamp(r,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==l&&(this._unmodified=!1,this._pitch=l,this._calcMatrices())}get aspect(){return this.width/this.height}get fovX(){return this._fov}get fovY(){const r=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/r)}set fov(r){r=Math.max(.01,Math.min(60,r)),this._fov!==r&&(this._unmodified=!1,this._fov=c.degToRad(r),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(r){this._averageElevation=r,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(r){const l=Math.min(Math.max(r,this.minZoom),this.maxZoom);this._zoom!==l&&(this._unmodified=!1,this._setZoom(l),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(r){this._zoom=r,this.scale=this.zoomScale(r),this.tileZoom=Math.floor(r),this.zoomFraction=r-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const r=this._elevation;this._centerAltitude=r.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=r.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const r=this._elevation,l=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],p=this.horizonLineFromTop();let _=0,b=0;for(let S=0;S<l.length;S++){const A=new c.pointGeometry(l[S][0]*this.width,p+l[S][1]*(this.height-p)),R=r.pointCoordinate(A);if(!R)continue;const V=1/Math.hypot(R[0]-this._camera.position[0],R[1]-this._camera.position[1]);_+=R[3]*V,b+=V}return 0===b?NaN:_/b}get center(){return this._center}set center(r){r.lat===this._center.lat&&r.lng===this._center.lng||(this._unmodified=!1,this._center=r,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const r=this._seaLevelZoom,l=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),p=this.pixelsPerMeter/this.worldSize*l,_=this._mercatorZfromZoom(r),b=this._mercatorZfromZoom(this._maxZoom),S=Math.max(_-p,b);this._setZoom(this._zoomFromMercatorZ(S))}get padding(){return this._edgeInsets.toJSON()}set padding(r){this._edgeInsets.equals(r)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,r,1),this._calcMatrices())}computeZoomRelativeTo(r){const l=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,r.toAltitude()));let p;p=r.z<this._camera.position[2]?[l.x,l.y,l.z]:[r.x,r.y,r.z];const _=c.length(c.sub([],this._camera.position,p));return c.clamp(this._zoomFromMercatorZ(_),this._minZoom,this._maxZoom)}setFreeCameraOptions(r){if(!this.height||!r.position&&!r.orientation)return;this._updateCameraState();let l=!1;if(r.orientation&&!c.exactEquals(r.orientation,this._camera.orientation)&&(l=this._setCameraOrientation(r.orientation)),r.position){const p=[r.position.x,r.position.y,r.position.z];c.exactEquals$1(p,this._camera.position)||(this._setCameraPosition(p),l=!0)}l&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const r=this._camera.position,l=new rt;return l.position=new c.MercatorCoordinate(r[0],r[1],r[2]),l.orientation=this._camera.orientation,l._elevation=this.elevation,l._renderWorldCopies=this.renderWorldCopies,l}_setCameraOrientation(r){if(!c.length$1(r))return!1;c.normalize$1(r,r);const l=c.transformQuat([],[0,0,-1],r),p=c.transformQuat([],[0,-1,0],r);if(p[2]<0)return!1;const _=$e(l,p);return!!_&&(this._camera.orientation=_,!0)}_setCameraPosition(r){const l=this.zoomScale(this.minZoom)*this.tileSize,p=this.zoomScale(this.maxZoom)*this.tileSize,_=this.cameraToCenterDistance;r[2]=c.clamp(r[2],_/p,_/l),this._camera.position=r}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(r){return this._edgeInsets.equals(r)}interpolatePadding(r,l,p){this._unmodified=!1,this._edgeInsets.interpolate(r,l,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(r){const l=(r.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/r.tileSize));return Math.max(0,l)}getVisibleUnwrappedCoordinates(r){const l=[new c.UnwrappedTileID(0,r)];if(this.renderWorldCopies){const p=this.pointCoordinate(new c.pointGeometry(0,0)),_=this.pointCoordinate(new c.pointGeometry(this.width,0)),b=this.pointCoordinate(new c.pointGeometry(this.width,this.height)),S=this.pointCoordinate(new c.pointGeometry(0,this.height)),A=Math.floor(Math.min(p.x,_.x,b.x,S.x)),R=Math.floor(Math.max(p.x,_.x,b.x,S.x)),V=1;for(let j=A-V;j<=R+V;j++)0!==j&&l.push(new c.UnwrappedTileID(j,r))}return l}coveringTiles(r){let l=this.coveringZoomLevel(r);const p=l,_=this.elevation&&!r.isTerrainDEM,b="mercator"===this.projection.name;if(void 0!==r.minzoom&&l<r.minzoom)return[];void 0!==r.maxzoom&&l>r.maxzoom&&(l=r.maxzoom);const S=this.locationCoordinate(this.center),A=this.center.lat,R=1<<l,V=[R*S.x,R*S.y,0],j="globe"===this.projection.name,y=!j,E=c.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,l,y),x=j?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),T=R*c.mercatorZfromAltitude(1,this.center.lat),M=this._camera.position[2]/c.mercatorZfromAltitude(1,this.center.lat),L=[R*x.x,R*x.y,M*(y?1:T)],O=this.cameraToCenterDistance/r.tileSize*(r.roundZoom?1:.502),Z=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?l:0,Y=r.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,oe=r.isTerrainDEM?-Y:this._elevation?this._elevation.getMinElevationBelowMSL():0,se=this.projection.isReprojectedInTileSpace?Hn(this):1,he=Ne=>{const vt=new c.MercatorCoordinate(Ne.x+25e-6,Ne.y,Ne.z),Ae=new c.MercatorCoordinate(Ne.x,Ne.y+25e-6,Ne.z),Be=Ne.toLngLat(),Zt=vt.toLngLat(),an=Ae.toLngLat(),qt=this.locationCoordinate(Be),mn=this.locationCoordinate(Zt),Pn=this.locationCoordinate(an),tn=Math.hypot(mn.x-qt.x,mn.y-qt.y),Ft=Math.hypot(Pn.x-qt.x,Pn.y-qt.y);return Math.sqrt(tn*Ft)*se/25e-6},be=Ne=>{const Ke=Y,vt=oe;return{aabb:c.tileAABB(this,R,0,0,0,Ne,vt,Ke,this.projection),zoom:0,x:0,y:0,minZ:vt,maxZ:Ke,wrap:Ne,fullyVisible:!1}},Le=[];let Pe=[];const Te=l,et=r.reparseOverscaled?p:l,Re=Ne=>Ne*Ne,He=Re((M-this._centerAltitude)*T),ze=Ne=>{if(!this._elevation||!Ne.tileID||!b)return;const Ke=this._elevation.getMinMaxForTile(Ne.tileID),vt=Ne.aabb;Ke?(vt.min[2]=Ke.min,vt.max[2]=Ke.max,vt.center[2]=(vt.min[2]+vt.max[2])/2):(Ne.shouldSplit=ct(Ne),Ne.shouldSplit||(vt.min[2]=vt.max[2]=vt.center[2]=this._centerAltitude))},ct=Ne=>{if(Ne.zoom<Z)return!0;if(Ne.zoom===Te)return!1;if(null!=Ne.shouldSplit)return Ne.shouldSplit;const Ke=Ne.aabb.distanceX(L),vt=Ne.aabb.distanceY(L);let Ae=He,Be=1;if(j){Ae=Re(Ne.aabb.distanceZ(L));const qt=Math.pow(2,Ne.zoom),mn=c.latFromMercatorY((Ne.y+1)/qt),Pn=c.latFromMercatorY(Ne.y/qt),tn=Math.min(Math.max(A,mn),Pn),Ft=c.circumferenceAtLatitude(tn)/c.circumferenceAtLatitude(A);if(Be=tn===A?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Ft/this._mercatorScaleRatio),this.zoom<=c.GLOBE_ZOOM_THRESHOLD_MIN&&Ne.zoom===Te-1&&Ft>=.9)return!0}else if(_&&(Ae=Re(Ne.aabb.distanceZ(L)*T)),this.projection.isReprojectedInTileSpace&&p<=5){const qt=Math.pow(2,Ne.zoom),mn=he(new c.MercatorCoordinate((Ne.x+.5)/qt,(Ne.y+.5)/qt));Be=mn>.85?1:mn}const Zt=Ke*Ke+vt*vt+Ae;return Zt<Re((1<<Te-Ne.zoom)*O*Be*((qt,mn)=>{if(mn*Re(.707)<qt)return 1;const Pn=Math.sqrt(mn/qt);return Pn/(1.4144271570014144+(Math.pow(1.1,Pn-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(Ae,He),Zt))};if(this.renderWorldCopies)for(let Ne=1;Ne<=3;Ne++)Le.push(be(-Ne)),Le.push(be(Ne));for(Le.push(be(0));Le.length>0;){const Ne=Le.pop(),Ke=Ne.x,vt=Ne.y;let Ae=Ne.fullyVisible;if(!Ae){const Be=Ne.aabb.intersects(E);if(0===Be)continue;Ae=2===Be}if(Ne.zoom!==Te&&ct(Ne))for(let Be=0;Be<4;Be++){const Zt=(Ke<<1)+Be%2,an=(vt<<1)+(Be>>1),qt={aabb:b?Ne.aabb.quadrant(Be):c.tileAABB(this,R,Ne.zoom+1,Zt,an,Ne.wrap,Ne.minZ,Ne.maxZ,this.projection),zoom:Ne.zoom+1,x:Zt,y:an,wrap:Ne.wrap,fullyVisible:Ae,tileID:void 0,shouldSplit:void 0,minZ:Ne.minZ,maxZ:Ne.maxZ};_&&!j&&(qt.tileID=new c.OverscaledTileID(Ne.zoom+1===Te?et:Ne.zoom+1,Ne.wrap,Ne.zoom+1,Zt,an),ze(qt)),Le.push(qt)}else{const Be=Ne.zoom===Te?et:Ne.zoom;if(r.minzoom&&r.minzoom>Be)continue;const Zt=V[0]-(.5+Ke+(Ne.wrap<<Ne.zoom))*(1<<l-Ne.zoom),an=V[1]-.5-vt,qt=Ne.tileID?Ne.tileID:new c.OverscaledTileID(Be,Ne.wrap,Ne.zoom,Ke,vt);Pe.push({tileID:qt,distanceSq:Zt*Zt+an*an})}}if(this.fogCullDistSq){const Ne=this.fogCullDistSq,Ke=this.horizonLineFromTop();Pe=Pe.filter(vt=>{const Ae=[0,0,0,1],Be=[c.EXTENT,c.EXTENT,0,1],Zt=this.calculateFogTileMatrix(vt.tileID.toUnwrapped());c.transformMat4$1(Ae,Ae,Zt),c.transformMat4$1(Be,Be,Zt);const an=c.getAABBPointSquareDist(Ae,Be);if(0===an)return!0;let qt=!1;const mn=this._elevation;if(mn&&an>Ne&&0!==Ke){const Pn=this.calculateProjMatrix(vt.tileID.toUnwrapped());let tn;r.isTerrainDEM||(tn=mn.getMinMaxForTile(vt.tileID)),tn||(tn={min:oe,max:Y});const Ft=c.furthestTileCorner(this.rotation),vr=[Ft[0]*c.EXTENT,Ft[1]*c.EXTENT,tn.max];c.transformMat4(vr,vr,Pn),qt=(1-vr[1])*this.height*.5<Ke}return an<Ne||qt})}return Pe.sort((Ne,Ke)=>Ne.distanceSq-Ke.distanceSq).map(Ne=>Ne.tileID)}resize(r,l){this.width=r,this.height=l,this.pixelsToGLUnits=[2/r,-2/l],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(r){return Math.pow(2,r)}scaleZoom(r){return Math.log(r)/Math.LN2}project(r){const l=c.clamp(r.lat,-c.MAX_MERCATOR_LATITUDE,c.MAX_MERCATOR_LATITUDE),p=this.projection.project(r.lng,l);return new c.pointGeometry(p.x*this.worldSize,p.y*this.worldSize)}unproject(r){return this.projection.unproject(r.x/this.worldSize,r.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(r,l){let p,_;const b=this.centerPoint;if("globe"===this.projection.name){const A=this.worldSize;p=(l.x-b.x)/A,_=(l.y-b.y)/A}else{const A=this.pointCoordinate(l),R=this.pointCoordinate(b);p=A.x-R.x,_=A.y-R.y}const S=this.locationCoordinate(r);this.setLocation(new c.MercatorCoordinate(S.x-p,S.y-_))}setLocation(r){this.center=this.coordinateLocation(r),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(r){return this.projection.locationPoint(this,r)}locationPoint3D(r){return this.projection.locationPoint(this,r,!0)}pointLocation(r){return this.coordinateLocation(this.pointCoordinate(r))}pointLocation3D(r){return this.coordinateLocation(this.pointCoordinate3D(r))}locationCoordinate(r,l){const p=l?c.mercatorZfromAltitude(l,r.lat):void 0,_=this.projection.project(r.lng,r.lat);return new c.MercatorCoordinate(_.x,_.y,p)}coordinateLocation(r){return this.projection.unproject(r.x,r.y)}pointRayIntersection(r,l){const p=l??this._centerAltitude,_=[r.x,r.y,0,1],b=[r.x,r.y,1,1];c.transformMat4$1(_,_,this.pixelMatrixInverse),c.transformMat4$1(b,b,this.pixelMatrixInverse);const S=b[3];c.scale$1(_,_,1/_[3]),c.scale$1(b,b,1/S);const A=_[2],R=b[2];return{p0:_,p1:b,t:A===R?0:(p-A)/(R-A)}}screenPointToMercatorRay(r){const l=[r.x,r.y,0,1],p=[r.x,r.y,1,1];return c.transformMat4$1(l,l,this.pixelMatrixInverse),c.transformMat4$1(p,p,this.pixelMatrixInverse),c.scale$1(l,l,1/l[3]),c.scale$1(p,p,1/p[3]),l[2]=c.mercatorZfromAltitude(l[2],this._center.lat)*this.worldSize,p[2]=c.mercatorZfromAltitude(p[2],this._center.lat)*this.worldSize,c.scale$1(l,l,1/this.worldSize),c.scale$1(p,p,1/this.worldSize),new c.Ray([l[0],l[1],l[2]],c.normalize([],c.sub([],p,l)))}rayIntersectionCoordinate(r){const{p0:l,p1:p,t:_}=r,b=c.mercatorZfromAltitude(l[2],this._center.lat),S=c.mercatorZfromAltitude(p[2],this._center.lat);return new c.MercatorCoordinate(c.number(l[0],p[0],_)/this.worldSize,c.number(l[1],p[1],_)/this.worldSize,c.number(b,S,_))}pointCoordinate(r,l=this._centerAltitude){return this.projection.pointCoordinate(this,r.x,r.y,l)}pointCoordinate3D(r){if(!this.elevation)return this.pointCoordinate(r);let l=this.projection.pointCoordinate3D(this,r.x,r.y);if(l)return new c.MercatorCoordinate(l[0],l[1],l[2]);let p=0,_=this.horizonLineFromTop();if(r.y>_)return this.pointCoordinate(r);const b=.02*_,S=r.clone();for(let A=0;A<10&&_-p>b;A++){S.y=c.number(p,_,.66);const R=this.projection.pointCoordinate3D(this,S.x,S.y);R?(_=S.y,l=R):p=S.y}return l?new c.MercatorCoordinate(l[0],l[1],l[2]):this.pointCoordinate(r)}isPointAboveHorizon(r){return this.projection.isPointAboveHorizon(this,r)}_coordinatePoint(r,l){const p=l&&this.elevation?this.elevation.getAtPointOrZero(r,this._centerAltitude):this._centerAltitude,_=[r.x*this.worldSize,r.y*this.worldSize,p+r.toAltitude(),1];return c.transformMat4$1(_,_,this.pixelMatrix),_[3]>0?new c.pointGeometry(_[0]/_[3],_[1]/_[3]):new c.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getGlobeBounds(){const{top:r,left:l}=this._edgeInsets,p=this.height-this._edgeInsets.bottom,_=this.width-this._edgeInsets.right,b=this.pointCoordinate3D(new c.pointGeometry(l,r)),S=this.pointCoordinate3D(new c.pointGeometry(_,r)),A=this.pointCoordinate3D(new c.pointGeometry(_,p)),R=this.pointCoordinate3D(new c.pointGeometry(l,p));let V=Math.min(b.x,R.x),j=Math.max(S.x,A.x),y=Math.min(b.y,S.y),E=Math.max(R.y,A.y);const x=Math.pow(2,-this.zoom)/16,T=(he,be,Le,Pe)=>{const Te=(he+Le)/2,et=(be+Pe)/2,Re=new c.pointGeometry(Te,et),He=this.pointCoordinate3D(Re),ze=Math.max(0,V-He.x,y-He.y,He.x-j,He.y-E);V=Math.min(V,He.x),j=Math.max(j,He.x),y=Math.min(y,He.y),E=Math.max(E,He.y),ze>x&&(T(he,be,Te,et),T(Te,et,Le,Pe))};T(l,r,_,r),T(_,r,_,p),T(_,p,l,p),T(l,p,l,r);const[M,L]=c.polesInViewport(this),O=M||L,Z=M?90:c.latFromMercatorY(y),Y=O?180:c.lngFromMercatorX(j),oe=L?-90:c.latFromMercatorY(E),se=O?-180:c.lngFromMercatorX(V);return new c.LngLatBounds(new c.LngLat(se,oe),new c.LngLat(Y,Z))}_getBounds(r,l){if("globe"===this.projection.name)return this._getGlobeBounds();const p=new c.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),_=new c.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),b=new c.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),S=new c.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let A=this.pointCoordinate(p,r),R=this.pointCoordinate(_,r);const V=this.pointCoordinate(b,l),j=this.pointCoordinate(S,l),y=(E,x)=>(x.y-E.y)/(x.x-E.x);return A.y>1&&R.y>=0?A=new c.MercatorCoordinate((1-j.y)/y(j,A)+j.x,1):A.y<0&&R.y<=1&&(A=new c.MercatorCoordinate(-j.y/y(j,A)+j.x,0)),R.y>1&&A.y>=0?R=new c.MercatorCoordinate((1-V.y)/y(V,R)+V.x,1):R.y<0&&A.y<=1&&(R=new c.MercatorCoordinate(-V.y/y(V,R)+V.x,0)),(new c.LngLatBounds).extend(this.coordinateLocation(A)).extend(this.coordinateLocation(R)).extend(this.coordinateLocation(j)).extend(this.coordinateLocation(V))}_getBounds3D(){const r=this.elevation;if(!r.visibleDemTiles.length||r.isUsingMockSource())return this._getBounds(0,0);const l=r.visibleDemTiles.reduce((p,_)=>{if(_.dem){const b=_.dem.tree;p.min=Math.min(p.min,b.minimums[0]),p.max=Math.max(p.max,b.maximums[0])}return p},{min:Number.MAX_VALUE,max:0});return this._getBounds(l.min*r.exaggeration(),l.max*r.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(r=!0){const l=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,p=this.height/2-l*(1-this._horizonShift);return r?Math.max(0,p):p}getMaxBounds(){return this.maxBounds}setMaxBounds(r){this.maxBounds=r,this.minLat=-c.MAX_MERCATOR_LATITUDE,this.maxLat=c.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,r&&(this.minLat=r.getSouth(),this.maxLat=r.getNorth(),this.minLng=r.getWest(),this.maxLng=r.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=c.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=c.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=c.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=c.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(r,l){return this.projection.createTileMatrix(this,l,r)}calculateDistanceTileData(r){const l=r.key,p=this._distanceTileDataCache;if(p[l])return p[l];const _=r.canonical,b=1/this.height,S=this.cameraWorldSize,A=S/this.zoomScale(_.z),R=(_.x+Math.pow(2,_.z)*r.wrap)*A,V=_.y*A,j=this.point;j.x*=S/this.worldSize,j.y*=S/this.worldSize;const y=this.angle,E=Math.sin(-y),x=-Math.cos(-y);return p[l]={bearing:[E,x],center:[(j.x-R)*b,(j.y-V)*b],scale:A/c.EXTENT*b},p[l]}calculateFogTileMatrix(r){const l=r.key,p=this._fogTileMatrixCache;if(p[l])return p[l];const _=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,r);return c.multiply(_,this.worldToFogMatrix,_),p[l]=new Float32Array(_),p[l]}calculateProjMatrix(r,l=!1){const p=r.key,_=l?this._alignedProjMatrixCache:this._projMatrixCache;if(_[p])return _[p];const b=this.calculatePosMatrix(r,this.worldSize);return c.multiply(b,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:l?this.alignedProjMatrix:this.projMatrix,b),_[p]=new Float32Array(b),_[p]}calculatePixelsToTileUnitsMatrix(r){const l=r.tileID.key,p=this._pixelsToTileUnitsCache;if(p[l])return p[l];const _=function(b,S){const{scale:A}=b.tileTransform,R=A*c.EXTENT/(b.tileSize*Math.pow(2,S.zoom-b.tileID.overscaledZ+b.tileID.canonical.z));return V=new Float32Array(4),E=(j=S.inverseAdjustmentMatrix)[1],x=j[2],T=j[3],L=(y=[R,R])[1],V[0]=j[0]*(M=y[0]),V[1]=E*M,V[2]=x*L,V[3]=T*L,V;var V,j,y,E,x,T,M,L}(r,this);return p[l]=_,p[l]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const r=this._elevation;this._updateCameraState();const l=c.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,p=this._computeCameraPosition(l),_=this._camera.forward(),b=c.mercatorZfromAltitude(1,this._center.lat);p[2]/=b,_[2]/=b,c.normalize(_,_);const S=r.raycast(p,_,r.exaggeration());if(S){const A=c.scaleAndAdd([],p,_,S),R=new c.MercatorCoordinate(A[0],A[1],c.mercatorZfromAltitude(A[2],c.latFromMercatorY(A[1]))),V=(R.z+c.length([R.x-p[0],R.y-p[1],R.z-p[2]*b]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(V),this._centerAltitude=R.toAltitude(),this._center=this.coordinateLocation(R),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(r=!1){if(!this._elevation)return;const l=this._elevation,p=c.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,_=this._computeCameraPosition(p),b=l.getAtPointOrZero(new c.MercatorCoordinate(..._)),S=this.pixelsPerMeter/this.worldSize*b,A=this._minimumHeightOverTerrain(),R=_[2]-S;if(R<=A)if(R<0||r){const V=this.locationCoordinate(this._center,this._centerAltitude),j=[_[0],_[1],V.z-_[2]],y=c.length(j);j[2]-=(A-R)/this._pixelsPerMercatorPixel;const E=c.length(j);if(0===E)return;c.scale$2(j,j,y/E*this._pixelsPerMercatorPixel),this._camera.position=[_[0],_[1],V.z*this._pixelsPerMercatorPixel-j[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const r="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||r){const E=this.center;return E.lat=c.clamp(E.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!r)&&(E.lng=c.clamp(E.lng,this.minLng,this.maxLng)),this.center=E,void(this._constraining=!1)}const l=this._unmodified,{x:p,y:_}=this.point;let b=0,S=p,A=_;const R=this.width/2,V=this.height/2,j=this.worldMinY*this.scale,y=this.worldMaxY*this.scale;if(_-V<j&&(A=j+V),_+V>y&&(A=y-V),y-j<this.height&&(b=Math.max(b,this.height/(y-j)),A=(y+j)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const E=this.worldMinX*this.scale,x=this.worldMaxX*this.scale,T=this.worldSize/2-(E+x)/2;S=(p+T+this.worldSize)%this.worldSize-T,S-R<E&&(S=E+R),S+R>x&&(S=x-R),x-E<this.width&&(b=Math.max(b,this.width/(x-E)),S=(x+E)/2)}S===p&&A===_||(this.center=this.unproject(new c.pointGeometry(S,A))),b&&(this.zoom+=this.scaleZoom(b)),this._constrainCamera(),this._unmodified=l,this._constraining=!1}_minZoomForBounds(){let r=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(r=Math.max(r,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),r}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const r=this.centerOffset,l=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=c.mercatorZfromAltitude(1,this.center.lat)/c.mercatorZfromAltitude(1,c.GLOBE_SCALE_MATCH_LATITUDE));const p=Zn(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,p),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const _=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?l:1),b=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);b[8]=2*-r.x/this.width,b[9]=2*r.y/this.height;let S=c.mul([],b,_);if(this.projection.isReprojectedInTileSpace){const se=this.locationCoordinate(this.center),he=c.identity([]);c.translate(he,he,[se.x*this.worldSize,se.y*this.worldSize,0]),c.multiply(he,he,Qn(this)),c.translate(he,he,[-se.x*this.worldSize,-se.y*this.worldSize,0]),c.multiply(S,S,he),this.inverseAdjustmentMatrix=function(be){const Le=Qn(be,!0);return qe([],[Le[0],Le[1],Le[4],Le[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=c.scale([],S,[this.worldSize,this.worldSize,this.worldSize/l,1]),this.projMatrix=S,this.invProjMatrix=c.invert(new Float64Array(16),this.projMatrix);const A=c.invert([],b);this.frustumCorners=c.FrustumCorners.fromInvProjectionMatrix(A,this.horizonLineFromTop(),this.height);const R=new Float32Array(16);c.identity(R),c.scale(R,R,[1,-1,1]),c.rotateX(R,R,this._pitch),c.rotateZ(R,R,this.angle);const V=c.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),j=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;V[8]=2*-r.x/this.width,V[9]=2*(r.y+j)/this.height,this.skyboxMatrix=c.multiply(R,V,R);const y=this.point,E=y.x,x=y.y,T=this.width%2/2,M=this.height%2/2,L=Math.cos(this.angle),O=Math.sin(this.angle),Z=E-Math.round(E)+L*T+O*M,Y=x-Math.round(x)+L*M+O*T,oe=new Float64Array(S);if(c.translate(oe,oe,[Z>.5?Z-1:Z,Y>.5?Y-1:Y,0]),this.alignedProjMatrix=oe,S=c.create(),c.scale(S,S,[this.width/2,-this.height/2,1]),c.translate(S,S,[1,-1,0]),this.labelPlaneMatrix=S,S=c.create(),c.scale(S,S,[1,-1,1]),c.translate(S,S,[-1,-1,0]),c.scale(S,S,[2/this.width,2/this.height,1]),this.glCoordMatrix=S,this.pixelMatrix=c.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},S=c.invert(new Float64Array(16),this.pixelMatrix),!S)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=S,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=c.calculateGlobeMatrix(this);const se=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=c.transformMat4(se,se,_),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=S;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const r=this.cameraWorldSizeForFog,l=this.cameraPixelsPerMeter,p=this._camera.position,_=1/this.height/this._pixelsPerMercatorPixel,b=[r,r,l];c.scale$2(b,b,_),c.scale$2(p,p,-1),c.multiply$2(p,p,b);const S=c.create();c.translate(S,S,p),c.scale(S,S,b),this.mercatorFogMatrix=S,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(r,l,_)}_computeCameraPosition(r){const l=(r=r||this.pixelsPerMeter)/this.pixelsPerMeter,p=this._camera.forward(),_=this.point,b=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*l-r/this.worldSize*this._centerAltitude;return[_.x/this.worldSize-p[0]*b,_.y/this.worldSize-p[1]*b,r/this.worldSize*this._centerAltitude-p[2]*b]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(r){const l=this._maxCameraBoundsDistance()*Math.cos(this._pitch),p=this._camera.position[2],_=r[2];let b=1;this.projection.wrap&&(this.center=this.center.wrap()),_>0&&(b=Math.min((l-p)/_,1)),this._camera.position=c.scaleAndAdd([],this._camera.position,r,b),this._updateStateFromCamera()}_updateStateFromCamera(){const r=this._camera.position,l=this._camera.forward(),{pitch:p,bearing:_}=this._camera.getPitchBearing(),b=c.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,S=this._mercatorZfromZoom(this._maxZoom)*Math.cos(c.degToRad(this._maxPitch)),A=Math.max((r[2]-b)/Math.cos(p),S),R=this._zoomFromMercatorZ(A);c.scaleAndAdd(r,r,l,A),this._pitch=c.clamp(p,c.degToRad(this.minPitch),c.degToRad(this.maxPitch)),this.angle=c.wrap(_,-Math.PI,Math.PI),this._setZoom(c.clamp(R,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new c.MercatorCoordinate(r[0],r[1],r[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(r){return Math.pow(2,r)*this.tileSize}_mercatorZfromZoom(r){return this.cameraToCenterDistance/this._worldSizeFromZoom(r)}_minimumHeightOverTerrain(){const r=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(r)}_zoomFromMercatorZ(r){return this.scaleZoom(this.cameraToCenterDistance/(r*this.tileSize))}zoomFromMercatorZAdjusted(r){const l=S=>{const A=this.getCameraToCenterDistance(this.projection,S);return this.scaleZoom(A/(r*this.tileSize))};let p,_=l(this.zoom),b=Math.abs(_-l(_));for(;p!==b;)_=l(_),p=b,b=Math.abs(_-l(_));return _}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(c.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(r,l){const p=Math.min(r.x,l.x),_=Math.max(r.x,l.x),b=Math.min(r.y,l.y),S=Math.max(r.y,l.y);if(b<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const A=[new c.pointGeometry(p,b),new c.pointGeometry(_,S),new c.pointGeometry(p,S),new c.pointGeometry(_,b)],R=this.renderWorldCopies?-3:0,V=this.renderWorldCopies?4:1;for(const j of A){const y=this.pointRayIntersection(j);if(y.t<0)return!0;const E=this.rayIntersectionCoordinate(y);if(E.x<R||E.y<0||E.x>V||E.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+c.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new c.pointGeometry(0,0),new c.pointGeometry(this.width,this.height))}zoomDeltaToMovement(r,l){const p=c.length(c.sub([],this._camera.position,r)),_=this._zoomFromMercatorZ(p)+l;return p-this._mercatorZfromZoom(_)}getCameraPoint(){if("globe"===this.projection.name){const r=function([l,p,_],b){const S=[l,p,_,1];c.transformMat4$1(S,S,b);const A=S[3]=Math.max(S[3],1e-6);return S[0]/=A,S[1]/=A,S[2]/=A,S}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new c.pointGeometry(r[0],r[1])}{const r=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new c.pointGeometry(0,r))}}getCameraToCenterDistance(r,l=this.zoom){const p=Zn(r,l,this.width,this.height,1024),_=r.pixelSpaceConversion(this.center.lat,this.worldSize,p);return.5/Math.tan(.5*this._fov)*this.height*_}getWorldToCameraMatrix(){const r=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&c.multiply(r,r,this.globeMatrix),r}}function Do(h,r){let l=!1,p=null;const _=()=>{p=null,l&&(h(),p=setTimeout(_,r),l=!1)};return()=>(l=!0,p||_(),p)}class St{constructor(r){this._hashName=r&&encodeURIComponent(r),c.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Do(this._updateHashUnthrottled.bind(this),300)}addTo(r){return this._map=r,c.window.addEventListener("hashchange",this._onHashChange,!1),r.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),c.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const r=this._map;if(!r)return"";const l=qr(r);if(this._hashName){const p=this._hashName;let _=!1;const b=c.window.location.hash.slice(1).split("&").map(S=>{const A=S.split("=")[0];return A===p?(_=!0,`${A}=${l}`):S}).filter(S=>S);return _||b.push(`${p}=${l}`),`#${b.join("&")}`}return`#${l}`}_getCurrentHash(){const r=c.window.location.hash.replace("#","");if(this._hashName){let l;return r.split("&").map(p=>p.split("=")).forEach(p=>{p[0]===this._hashName&&(l=p)}),(l&&l[1]||"").split("/")}return r.split("/")}_onHashChange(){const r=this._map;if(!r)return!1;const l=this._getCurrentHash();if(l.length>=3&&!l.some(p=>isNaN(p))){const p=r.dragRotate.isEnabled()&&r.touchZoomRotate.isEnabled()?+(l[3]||0):r.getBearing();return r.jumpTo({center:[+l[2],+l[1]],zoom:+l[0],bearing:p,pitch:+(l[4]||0)}),!0}return!1}_updateHashUnthrottled(){const r=c.window.location.href.replace(/(#.+)?$/,this.getHashString());c.window.history.replaceState(c.window.history.state,null,r)}}function qr(h,r){const l=h.getCenter(),p=Math.round(100*h.getZoom())/100,_=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),b=Math.pow(10,_),S=Math.round(l.lng*b)/b,A=Math.round(l.lat*b)/b,R=h.getBearing(),V=h.getPitch();let j=r?`/${S}/${A}/${p}`:`${p}/${A}/${S}`;return(R||V)&&(j+="/"+Math.round(10*R)/10),V&&(j+=`/${Math.round(V)}`),j}const To={linearity:.3,easing:c.bezier(0,0,.3,1)},oa=c.extend({deceleration:2500,maxSpeed:1400},To),Ca=c.extend({deceleration:20,maxSpeed:1400},To),Sa=c.extend({deceleration:1e3,maxSpeed:360},To),wu=c.extend({deceleration:1e3,maxSpeed:90},To);class Ia{constructor(r){this._map=r,this.clear()}clear(){this._inertiaBuffer=[]}record(r){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:c.exported.now(),settings:r})}_drainInertiaBuffer(){const r=this._inertiaBuffer,l=c.exported.now();for(;r.length>0&&l-r[0].time>160;)r.shift()}_onMoveEnd(r){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const l={zoom:0,bearing:0,pitch:0,pan:new c.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:b}of this._inertiaBuffer)l.zoom+=b.zoomDelta||0,l.bearing+=b.bearingDelta||0,l.pitch+=b.pitchDelta||0,b.panDelta&&l.pan._add(b.panDelta),b.around&&(l.around=b.around),b.pinchAround&&(l.pinchAround=b.pinchAround);const p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,_={};if(l.pan.mag()){const b=sa(l.pan.mag(),p,c.extend({},oa,r||{}));_.offset=l.pan.mult(b.amount/l.pan.mag()),_.center=this._map.transform.center,Ma(_,b)}if(l.zoom){const b=sa(l.zoom,p,Ca);_.zoom=this._map.transform.zoom+b.amount,Ma(_,b)}if(l.bearing){const b=sa(l.bearing,p,Sa);_.bearing=this._map.transform.bearing+c.clamp(b.amount,-179,179),Ma(_,b)}if(l.pitch){const b=sa(l.pitch,p,wu);_.pitch=this._map.transform.pitch+b.amount,Ma(_,b)}if(_.zoom||_.bearing){const b=void 0===l.pinchAround?l.around:l.pinchAround;_.around=b?this._map.unproject(b):this._map.getCenter()}return this.clear(),_.noMoveStart=!0,_}}function Ma(h,r){(!h.duration||h.duration<r.duration)&&(h.duration=r.duration,h.easing=r.easing)}function sa(h,r,l){const{maxSpeed:p,linearity:_,deceleration:b}=l,S=c.clamp(h*_/(r/1e3),-p,p),A=Math.abs(S)/(b*_);return{easing:l.easing,duration:1e3*A,amount:S*(A/2)}}class Ii extends c.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,l,p,_={}){const b=Qe(l.getCanvasContainer(),p),S=l.unproject(b);super(r,c.extend({point:b,lngLat:S,originalEvent:p},_)),this._defaultPrevented=!1,this.target=l}}class fl extends c.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,l,p){const _="touchend"===r?p.changedTouches:p.touches,b=sr(l.getCanvasContainer(),_),S=b.map(R=>l.unproject(R)),A=b.reduce((R,V,j,y)=>R.add(V.div(y.length)),new c.pointGeometry(0,0));super(r,{points:b,point:A,lngLats:S,lngLat:l.unproject(A),originalEvent:p}),this._defaultPrevented=!1}}class Aa extends c.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,l,p){super(r,{originalEvent:p}),this._defaultPrevented=!1}}class wc{constructor(r,l){this._map=r,this._clickTolerance=l.clickTolerance}reset(){this._mousedownPos=void 0}wheel(r){return this._firePreventable(new Aa(r.type,this._map,r))}mousedown(r,l){return this._mousedownPos=l,this._firePreventable(new Ii(r.type,this._map,r))}mouseup(r){this._map.fire(new Ii(r.type,this._map,r))}preclick(r){const l=c.extend({},r);l.type="preclick",this._map.fire(new Ii(l.type,this._map,l))}click(r,l){this._mousedownPos&&this._mousedownPos.dist(l)>=this._clickTolerance||(this.preclick(r),this._map.fire(new Ii(r.type,this._map,r)))}dblclick(r){return this._firePreventable(new Ii(r.type,this._map,r))}mouseover(r){this._map.fire(new Ii(r.type,this._map,r))}mouseout(r){this._map.fire(new Ii(r.type,this._map,r))}touchstart(r){return this._firePreventable(new fl(r.type,this._map,r))}touchmove(r){this._map.fire(new fl(r.type,this._map,r))}touchend(r){this._map.fire(new fl(r.type,this._map,r))}touchcancel(r){this._map.fire(new fl(r.type,this._map,r))}_firePreventable(r){if(this._map.fire(r),r.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Eu{constructor(r){this._map=r}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(r){this._map.fire(new Ii(r.type,this._map,r))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ii("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(r){this._delayContextMenu?this._contextMenuEvent=r:this._map.fire(new Ii(r.type,this._map,r)),this._map.listens("contextmenu")&&r.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Pa{constructor(r,l){this._map=r,this._el=r.getCanvasContainer(),this._container=r.getContainer(),this._clickTolerance=l.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(r,l){this.isEnabled()&&r.shiftKey&&0===r.button&&(_t(),this._startPos=this._lastPos=l,this._active=!0)}mousemoveWindow(r,l){if(!this._active)return;const p=l,_=this._startPos,b=this._lastPos;if(!_||!b||b.equals(p)||!this._box&&p.dist(_)<this._clickTolerance)return;this._lastPos=p,this._box||(this._box=bt("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",r));const S=Math.min(_.x,p.x),A=Math.max(_.x,p.x),R=Math.min(_.y,p.y),V=Math.max(_.y,p.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${S}px,${R}px)`,this._box.style.width=A-S+"px",this._box.style.height=V-R+"px")})}mouseupWindow(r,l){if(!this._active)return;const p=this._startPos,_=l;if(p&&0===r.button){if(this.reset(),Ut(),p.x!==_.x||p.y!==_.y)return this._map.fire(new c.Event("boxzoomend",{originalEvent:r})),{cameraAnimation:b=>b.fitScreenCoordinates(p,_,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",r)}}keydown(r){this._active&&27===r.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",r))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Qt(),delete this._startPos,delete this._lastPos}_fireEvent(r,l){return this._map.fire(new c.Event(r,{originalEvent:l}))}}function aa(h,r){const l={};for(let p=0;p<h.length;p++)l[h[p].identifier]=r[p];return l}class Ra{constructor(r){this.reset(),this.numTouches=r.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(r,l,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=r.timeStamp),p.length===this.numTouches&&(this.centroid=function(_){const b=new c.pointGeometry(0,0);for(const S of _)b._add(S);return b.div(_.length)}(l),this.touches=aa(p,l)))}touchmove(r,l,p){if(this.aborted||!this.centroid)return;const _=aa(p,l);for(const b in this.touches){const A=_[b];(!A||A.dist(this.touches[b])>30)&&(this.aborted=!0)}}touchend(r,l,p){if((!this.centroid||r.timeStamp-this.startTime>500)&&(this.aborted=!0),0===p.length){const _=!this.aborted&&this.centroid;if(this.reset(),_)return _}}}class la{constructor(r){this.singleTap=new Ra(r),this.numTaps=r.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(r,l,p){this.singleTap.touchstart(r,l,p)}touchmove(r,l,p){this.singleTap.touchmove(r,l,p)}touchend(r,l,p){const _=this.singleTap.touchend(r,l,p);if(_){const b=r.timeStamp-this.lastTime<500,S=!this.lastTap||this.lastTap.dist(_)<30;if(b&&S||this.reset(),this.count++,this.lastTime=r.timeStamp,this.lastTap=_,this.count===this.numTaps)return this.reset(),_}}}class zl{constructor(){this._zoomIn=new la({numTouches:1,numTaps:2}),this._zoomOut=new la({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(r,l,p){this._zoomIn.touchstart(r,l,p),this._zoomOut.touchstart(r,l,p)}touchmove(r,l,p){this._zoomIn.touchmove(r,l,p),this._zoomOut.touchmove(r,l,p)}touchend(r,l,p){const _=this._zoomIn.touchend(r,l,p),b=this._zoomOut.touchend(r,l,p);return _?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:S.getZoom()+1,around:S.unproject(_)},{originalEvent:r})}):b?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:S.getZoom()-1,around:S.unproject(b)},{originalEvent:r})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Bl={0:1,2:2};class pl{constructor(r){this.reset(),this._clickTolerance=r.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(r,l){return!1}_move(r,l){return{}}mousedown(r,l){if(this._lastPoint)return;const p=jt(r);this._correctButton(r,p)&&(this._lastPoint=l,this._eventButton=p)}mousemoveWindow(r,l){const p=this._lastPoint;if(p)if(r.preventDefault(),null!=this._eventButton&&function(_,b){const S=Bl[b];return void 0===_.buttons||(_.buttons&S)!==S}(r,this._eventButton))this.reset();else if(this._moved||!(l.dist(p)<this._clickTolerance))return this._moved=!0,this._lastPoint=l,this._move(p,l)}mouseupWindow(r){this._lastPoint&&jt(r)===this._eventButton&&(this._moved&&Ut(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class po extends pl{mousedown(r,l){super.mousedown(r,l),this._lastPoint&&(this._active=!0)}_correctButton(r,l){return 0===l&&!r.ctrlKey}_move(r,l){return{around:l,panDelta:l.sub(r)}}}class ml extends pl{_correctButton(r,l){return 0===l&&r.ctrlKey||2===l}_move(r,l){const p=.8*(l.x-r.x);if(p)return this._active=!0,{bearingDelta:p}}contextmenu(r){r.preventDefault()}}class La extends pl{_correctButton(r,l){return 0===l&&r.ctrlKey||2===l}_move(r,l){const p=-.5*(l.y-r.y);if(p)return this._active=!0,{pitchDelta:p}}contextmenu(r){r.preventDefault()}}class Nl{constructor(r,l){this._map=r,this._el=r.getCanvasContainer(),this._minTouches=1,this._clickTolerance=l.clickTolerance||1,this.reset(),c.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new c.pointGeometry(0,0)}touchstart(r,l,p){return this._calculateTransform(r,l,p)}touchmove(r,l,p){if(this._active&&!(p.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===p.length&&!c.isFullscreen())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return r.cancelable&&r.preventDefault(),this._calculateTransform(r,l,p)}}touchend(r,l,p){this._calculateTransform(r,l,p),this._active&&p.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(r,l,p){p.length>0&&(this._active=!0);const _=aa(p,l),b=new c.pointGeometry(0,0),S=new c.pointGeometry(0,0);let A=0;for(const V in _){const j=_[V],y=this._touches[V];y&&(b._add(j),S._add(j.sub(y)),A++,_[V]=j)}if(this._touches=_,A<this._minTouches||!S.mag())return;const R=S.div(A);return this._sum._add(R),this._sum.mag()<this._clickTolerance?void 0:{around:b.div(A),panDelta:R}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=bt("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class Ul{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(r){}_move(r,l,p){return{}}touchstart(r,l,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([l[0],l[1]]))}touchmove(r,l,p){const _=this._firstTwoTouches;if(!_)return;r.preventDefault();const[b,S]=_,A=Ko(p,l,b),R=Ko(p,l,S);if(!A||!R)return;const V=this._aroundCenter?null:A.add(R).div(2);return this._move([A,R],V,r)}touchend(r,l,p){if(!this._firstTwoTouches)return;const[_,b]=this._firstTwoTouches,S=Ko(p,l,_),A=Ko(p,l,b);S&&A||(this._active&&Ut(),this.reset())}touchcancel(){this.reset()}enable(r){this._enabled=!0,this._aroundCenter=!!r&&"center"===r.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Ko(h,r,l){for(let p=0;p<h.length;p++)if(h[p].identifier===l)return r[p]}function jl(h,r){return Math.log(h/r)/Math.LN2}class Du extends Ul{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(r){this._startDistance=this._distance=r[0].dist(r[1])}_move(r,l){const p=this._distance;if(this._distance=r[0].dist(r[1]),this._active||!(Math.abs(jl(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:jl(this._distance,p),pinchAround:l}}}function Uc(h,r){return 180*h.angleWith(r)/Math.PI}class gl extends Ul{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(r){this._startVector=this._vector=r[0].sub(r[1]),this._minDiameter=r[0].dist(r[1])}_move(r,l){const p=this._vector;if(this._vector=r[0].sub(r[1]),p&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Uc(this._vector,p),pinchAround:l}}_isBelowThreshold(r){this._minDiameter=Math.min(this._minDiameter,r.mag());const l=25/(Math.PI*this._minDiameter)*360,p=this._startVector;if(!p)return!1;const _=Uc(r,p);return Math.abs(_)<l}}function Vl(h){return Math.abs(h.y)>Math.abs(h.x)}class jc extends Ul{constructor(r){super(),this._map=r}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(r){this._lastPoints=r,Vl(r[0].sub(r[1]))&&(this._valid=!1)}_move(r,l,p){const _=this._lastPoints;if(!_)return;const b=r[0].sub(_[0]),S=r[1].sub(_[1]);return this._map._cooperativeGestures&&!c.isFullscreen()&&p.touches.length<3||(this._valid=this.gestureBeginsVertically(b,S,p.timeStamp),!this._valid)?void 0:(this._lastPoints=r,this._active=!0,{pitchDelta:(b.y+S.y)/2*-.5})}gestureBeginsVertically(r,l,p){if(void 0!==this._valid)return this._valid;const _=r.mag()>=2,b=l.mag()>=2;if(!_&&!b)return;if(!_||!b)return null==this._firstMove&&(this._firstMove=p),p-this._firstMove<100&&void 0;const S=r.y>0==l.y>0;return Vl(r)&&Vl(l)&&S}}const Vc={panStep:100,bearingStep:15,pitchStep:10};class yi{constructor(){const r=Vc;this._panStep=r.panStep,this._bearingStep=r.bearingStep,this._pitchStep=r.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(r){if(r.altKey||r.ctrlKey||r.metaKey)return;let l=0,p=0,_=0,b=0,S=0;switch(r.keyCode){case 61:case 107:case 171:case 187:l=1;break;case 189:case 109:case 173:l=-1;break;case 37:r.shiftKey?p=-1:(r.preventDefault(),b=-1);break;case 39:r.shiftKey?p=1:(r.preventDefault(),b=1);break;case 38:r.shiftKey?_=1:(r.preventDefault(),S=-1);break;case 40:r.shiftKey?_=-1:(r.preventDefault(),S=1);break;default:return}return this._rotationDisabled&&(p=0,_=0),{cameraAnimation:A=>{const R=A.getZoom();A.easeTo({duration:300,easeId:"keyboardHandler",easing:ka,zoom:l?Math.round(R)+l*(r.shiftKey?2:1):R,bearing:A.getBearing()+p*this._bearingStep,pitch:A.getPitch()+_*this._pitchStep,offset:[-b*this._panStep,-S*this._panStep],center:A.getCenter()},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function ka(h){return h*(2-h)}const $c=4.000244140625;class Tu{constructor(r,l){this._map=r,this._el=r.getCanvasContainer(),this._handler=l,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,c.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(r){this._defaultZoomRate=r}setWheelZoomRate(r){this._wheelZoomRate=r}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(r){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!r&&"center"===r.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(r){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(r.ctrlKey||r.metaKey||this.isZooming()||c.isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let l=r.deltaMode===c.window.WheelEvent.DOM_DELTA_LINE?40*r.deltaY:r.deltaY;const p=c.exported.now(),_=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,0!==l&&l%$c==0?this._type="wheel":0!==l&&Math.abs(l)<4?this._type="trackpad":_>400?(this._type=null,this._lastValue=l,this._timeout=setTimeout(this._onTimeout,40,r)):this._type||(this._type=Math.abs(_*l)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,l+=this._lastValue)),r.shiftKey&&l&&(l/=4),this._type&&(this._lastWheelEvent=r,this._delta-=l,this._active||this._start(r)),r.preventDefault()}_onTimeout(r){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(r)}_start(r){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const l=Qe(this._el,r);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:l,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const r=this._map.transform;"wheel"===this._type&&r.projection.wrap&&(r._center.lng>=180||r._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const l=()=>r._terrainEnabled()&&this._aroundCoord?r.computeZoomRelativeTo(this._aroundCoord):r.zoom;if(0!==this._delta){const R="wheel"===this._type&&Math.abs(this._delta)>$c?this._wheelZoomRate:this._defaultZoomRate;let V=2/(1+Math.exp(-Math.abs(this._delta*R)));this._delta<0&&0!==V&&(V=1/V);const j=l(),y=Math.pow(2,j),E="number"==typeof this._targetZoom?r.zoomScale(this._targetZoom):y;this._targetZoom=Math.min(r.maxZoom,Math.max(r.minZoom,r.scaleZoom(E*V))),"wheel"===this._type&&(this._startZoom=j,this._easing=this._smoothOutEasing(200)),this._delta=0}const p="number"==typeof this._targetZoom?this._targetZoom:l(),_=this._startZoom,b=this._easing;let S,A=!1;if("wheel"===this._type&&_&&b){const R=Math.min((c.exported.now()-this._lastWheelEventTime)/200,1),V=b(R);S=c.number(_,p,V),R<1?this._frameId||(this._frameId=!0):A=!0}else S=p,A=!0;return this._active=!0,A&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!A,zoomDelta:S-l(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(r){let l=c.ease;if(this._prevEase){const p=this._prevEase,_=(c.exported.now()-p.start)/p.duration,b=p.easing(_+.01)-p.easing(_),S=.27/Math.sqrt(b*b+1e-4)*.01,A=Math.sqrt(.0729-S*S);l=c.bezier(S,A,.25,1)}return this._prevEase={start:c.exported.now(),duration:r,easing:l},l}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=bt("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(c.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class mo{constructor(r,l){this._clickZoom=r,this._tapZoom=l}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class go{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(r,l){return r.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:p.getZoom()+(r.shiftKey?-1:1),around:p.unproject(l)},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class $l{constructor(){this._tap=new la({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(r,l,p){this._swipePoint||(this._tapTime&&r.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?p.length>0&&(this._swipePoint=l[0],this._swipeTouch=p[0].identifier):this._tap.touchstart(r,l,p))}touchmove(r,l,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;const _=l[0],b=_.y-this._swipePoint.y;return this._swipePoint=_,r.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(r,l,p)}touchend(r,l,p){this._tapTime?this._swipePoint&&0===p.length&&this.reset():this._tap.touchend(r,l,p)&&(this._tapTime=r.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ca{constructor(r,l,p){this._el=r,this._mousePan=l,this._touchPan=p}enable(r){this._inertiaOptions=r||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Oo{constructor(r,l,p){this._pitchWithRotate=r.pitchWithRotate,this._mouseRotate=l,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Gl{constructor(r,l,p,_){this._el=r,this._touchZoom=l,this._touchRotate=p,this._tapDragZoom=_,this._rotationDisabled=!1,this._enabled=!0}enable(r){this._touchZoom.enable(r),this._rotationDisabled||this._touchRotate.enable(r),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Ot=h=>h.zoom||h.drag||h.pitch||h.rotate;class Gc extends c.Event{}class Oa{constructor(){this.constants=[1,1,.01],this.radius=0}setup(r,l){const p=c.sub([],l,r);this.radius=c.length(p[2]<0?c.div([],p,this.constants):[p[0],p[1],0])}projectRay(r){c.div(r,r,this.constants),c.normalize(r,r),c.mul$1(r,r,this.constants);const l=c.scale$2([],r,this.radius);if(l[2]>0){const p=c.scale$2([],[0,0,1],c.dot(l,[0,0,1])),_=c.scale$2([],c.normalize([],[l[0],l[1],0]),this.radius),b=c.add([],l,c.scale$2([],c.sub([],c.add([],_,p),l),2));l[0]=b[0],l[1]=b[1]}return l}}function Ki(h){return h.panDelta&&h.panDelta.mag()||h.zoomDelta||h.bearingDelta||h.pitchDelta}class Jo{constructor(r,l){this._map=r,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Ia(r),this._bearingSnap=l.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Oa,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(l),c.bindAll(["handleEvent","handleWindowEvent"],this);const p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[c.window.document,"mousemove",{capture:!0}],[c.window.document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[c.window,"blur",void 0]];for(const[_,b,S]of this._listeners)_.addEventListener(b,_===c.window.document?this.handleWindowEvent:this.handleEvent,S)}destroy(){for(const[r,l,p]of this._listeners)r.removeEventListener(l,r===c.window.document?this.handleWindowEvent:this.handleEvent,p)}_addDefaultHandlers(r){const l=this._map,p=l.getCanvasContainer();this._add("mapEvent",new wc(l,r));const _=l.boxZoom=new Pa(l,r);this._add("boxZoom",_);const b=new zl,S=new go;l.doubleClickZoom=new mo(S,b),this._add("tapZoom",b),this._add("clickZoom",S);const A=new $l;this._add("tapDragZoom",A);const R=l.touchPitch=new jc(l);this._add("touchPitch",R);const V=new ml(r),j=new La(r);l.dragRotate=new Oo(r,V,j),this._add("mouseRotate",V,["mousePitch"]),this._add("mousePitch",j,["mouseRotate"]);const y=new po(r),E=new Nl(l,r);l.dragPan=new ca(p,y,E),this._add("mousePan",y),this._add("touchPan",E,["touchZoom","touchRotate"]);const x=new gl,T=new Du;l.touchZoomRotate=new Gl(p,T,x,A),this._add("touchRotate",x,["touchPan","touchZoom"]),this._add("touchZoom",T,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Eu(l));const M=l.scrollZoom=new Tu(l,this);this._add("scrollZoom",M,["mousePan"]);const L=l.keyboard=new yi;this._add("keyboard",L);for(const O of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])r.interactive&&r[O]&&l[O].enable(r[O])}_add(r,l,p){this._handlers.push({handlerName:r,handler:l,allowed:p}),this._handlersById[r]=l}stop(r){if(!this._updatingCamera){for(const{handler:l}of this._handlers)l.reset();this._inertia.clear(),this._fireEvents({},{},r),this._changes=[]}}isActive(){for(const{handler:r}of this._handlers)if(r.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Ot(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(r,l,p){for(const _ in r)if(_!==p&&(!l||l.indexOf(_)<0))return!0;return!1}handleWindowEvent(r){this.handleEvent(r,`${r.type}Window`)}_getMapTouches(r){const l=[];for(const p of r)this._el.contains(p.target)&&l.push(p);return l}handleEvent(r,l){this._updatingCamera=!0;const p="renderFrame"===r.type,_=p?void 0:r,b={needsRenderFrame:!1},S={},A={},R=r.touches?this._getMapTouches(r.touches):void 0,V=R?sr(this._el,R):p?void 0:Qe(this._el,r);for(const{handlerName:E,handler:x,allowed:T}of this._handlers){if(!x.isEnabled())continue;let M;this._blockedByActive(A,T,E)?x.reset():x[l||r.type]&&(M=x[l||r.type](r,V,R),this.mergeHandlerResult(b,S,M,E,_),M&&M.needsRenderFrame&&this._triggerRenderFrame()),(M||x.isActive())&&(A[E]=x)}const j={};for(const E in this._previousActiveHandlers)A[E]||(j[E]=_);this._previousActiveHandlers=A,(Object.keys(j).length||Ki(b))&&(this._changes.push([b,S,j]),this._triggerRenderFrame()),(Object.keys(A).length||Ki(b))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:y}=b;y&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],y(this._map))}mergeHandlerResult(r,l,p,_,b){if(!p)return;c.extend(r,p);const S={handlerName:_,originalEvent:p.originalEvent||b};void 0!==p.zoomDelta&&(l.zoom=S),void 0!==p.panDelta&&(l.drag=S),void 0!==p.pitchDelta&&(l.pitch=S),void 0!==p.bearingDelta&&(l.rotate=S)}_applyChanges(){const r={},l={},p={};for(const[_,b,S]of this._changes)_.panDelta&&(r.panDelta=(r.panDelta||new c.pointGeometry(0,0))._add(_.panDelta)),_.zoomDelta&&(r.zoomDelta=(r.zoomDelta||0)+_.zoomDelta),_.bearingDelta&&(r.bearingDelta=(r.bearingDelta||0)+_.bearingDelta),_.pitchDelta&&(r.pitchDelta=(r.pitchDelta||0)+_.pitchDelta),void 0!==_.around&&(r.around=_.around),void 0!==_.aroundCoord&&(r.aroundCoord=_.aroundCoord),void 0!==_.pinchAround&&(r.pinchAround=_.pinchAround),_.noInertia&&(r.noInertia=_.noInertia),c.extend(l,b),c.extend(p,S);this._updateMapTransform(r,l,p),this._changes=[]}_updateMapTransform(r,l,p){const _=this._map,b=_.transform,S=Z=>[Z.x,Z.y,Z.z];if((Z=>{const Y=this._eventsInProgress.drag;return Y&&!this._handlersById[Y.handlerName].isActive()})()&&!Ki(r)){const Z=b.zoom;b.cameraElevationReference="sea",b.recenterOnTerrain(),b.cameraElevationReference="ground",Z!==b.zoom&&this._map._update(!0)}if(b._isCameraConstrained&&_._stop(!0),!Ki(r))return void this._fireEvents(l,p,!0);let{panDelta:A,zoomDelta:R,bearingDelta:V,pitchDelta:j,around:y,aroundCoord:E,pinchAround:x}=r;b._isCameraConstrained&&(R>0&&(R=0),b._isCameraConstrained=!1),void 0!==x&&(y=x),(Z=>l.drag&&!this._eventsInProgress.drag)()&&y&&(this._dragOrigin=S(b.pointCoordinate3D(y)),this._trackingEllipsoid.setup(b._camera.position,this._dragOrigin)),b.cameraElevationReference="sea",_._stop(!0),y=y||_.transform.centerPoint,V&&(b.bearing+=V),j&&(b.pitch+=j),b._updateCameraState();const T=[0,0,0];if(A)if("mercator"===b.projection.name){const Z=this._trackingEllipsoid.projectRay(b.screenPointToMercatorRay(y).dir),Y=this._trackingEllipsoid.projectRay(b.screenPointToMercatorRay(y.sub(A)).dir);T[0]=Y[0]-Z[0],T[1]=Y[1]-Z[1]}else{const Z=b.pointCoordinate(y);if("globe"===b.projection.name){A=A.rotate(-b.angle);const Y=b._pixelsPerMercatorPixel/b.worldSize;T[0]=-A.x*c.mercatorScale(c.latFromMercatorY(Z.y))*Y,T[1]=-A.y*c.mercatorScale(b.center.lat)*Y}else{const Y=b.pointCoordinate(y.sub(A));Z&&Y&&(T[0]=Y.x-Z.x,T[1]=Y.y-Z.y)}}const M=b.zoom,L=[0,0,0];if(R){const Z=S(E||b.pointCoordinate3D(y)),Y={dir:c.normalize([],c.sub([],Z,b._camera.position))};if(Y.dir[2]<0){const oe=b.zoomDeltaToMovement(Z,R);c.scale$2(L,Y.dir,oe)}}const O=c.add(T,T,L);b._translateCameraConstrained(O),R&&Math.abs(b.zoom-M)>1e-4&&b.recenterOnTerrain(),b.cameraElevationReference="ground",this._map._update(),r.noInertia||this._inertia.record(r),this._fireEvents(l,p,!0)}_fireEvents(r,l,p){const _=Ot(this._eventsInProgress),b=Ot(r),S={};for(const j in r){const{originalEvent:y}=r[j];this._eventsInProgress[j]||(S[`${j}start`]=y),this._eventsInProgress[j]=r[j]}!_&&b&&this._fireEvent("movestart",b.originalEvent);for(const j in S)this._fireEvent(j,S[j]);b&&this._fireEvent("move",b.originalEvent);for(const j in r){const{originalEvent:y}=r[j];this._fireEvent(j,y)}const A={};let R;for(const j in this._eventsInProgress){const{handlerName:y,originalEvent:E}=this._eventsInProgress[j];this._handlersById[y].isActive()||(delete this._eventsInProgress[j],R=l[y]||E,A[`${j}end`]=R)}for(const j in A)this._fireEvent(j,A[j]);const V=Ot(this._eventsInProgress);if(p&&(_||b)&&!V){this._updatingCamera=!0;const j=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),y=E=>0!==E&&-this._bearingSnap<E&&E<this._bearingSnap;j?(y(j.bearing||this._map.getBearing())&&(j.bearing=0),this._map.easeTo(j,{originalEvent:R})):(this._map.fire(new c.Event("moveend",{originalEvent:R})),y(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(r,l){this._map.fire(new c.Event(r,l?{originalEvent:l}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(r=>{this._frameId=void 0,this.handleEvent(new Gc("renderFrame",{timeStamp:r})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const Ms="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Hc extends c.Evented{constructor(r,l){super(),this._moving=!1,this._zooming=!1,this.transform=r,this._bearingSnap=l.bearingSnap,c.bindAll(["_renderFrameCallback"],this)}getCenter(){return new c.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(r,l){return this.jumpTo({center:r},l)}panBy(r,l,p){return r=c.pointGeometry.convert(r).mult(-1),this.panTo(this.transform.center,c.extend({offset:r},l),p)}panTo(r,l,p){return this.easeTo(c.extend({center:r},l),p)}getZoom(){return this.transform.zoom}setZoom(r,l){return this.jumpTo({zoom:r},l),this}zoomTo(r,l,p){return this.easeTo(c.extend({zoom:r},l),p)}zoomIn(r,l){return this.zoomTo(this.getZoom()+1,r,l),this}zoomOut(r,l){return this.zoomTo(this.getZoom()-1,r,l),this}getBearing(){return this.transform.bearing}setBearing(r,l){return this.jumpTo({bearing:r},l),this}getPadding(){return this.transform.padding}setPadding(r,l){return this.jumpTo({padding:r},l),this}rotateTo(r,l,p){return this.easeTo(c.extend({bearing:r},l),p)}resetNorth(r,l){return this.rotateTo(0,c.extend({duration:1e3},r),l),this}resetNorthPitch(r,l){return this.easeTo(c.extend({bearing:0,pitch:0,duration:1e3},r),l),this}snapToNorth(r,l){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(r,l):this}getPitch(){return this.transform.pitch}setPitch(r,l){return this.jumpTo({pitch:r},l),this}cameraForBounds(r,l){r=c.LngLatBounds.convert(r);const p=l&&l.bearing||0,_=l&&l.pitch||0,b=r.getNorthWest(),S=r.getSouthEast();return this._cameraForBounds(this.transform,b,S,p,_,l)}_extendCameraOptions(r){const l={top:0,bottom:0,right:0,left:0};if("number"==typeof(r=c.extend({padding:l,offset:[0,0],maxZoom:this.transform.maxZoom},r)).padding){const p=r.padding;r.padding={top:p,bottom:p,right:p,left:p}}return r.padding=c.extend(l,r.padding),r}_minimumAABBFrustumDistance(r,l){const p=l.max[0]-l.min[0],_=l.max[1]-l.min[1];return p/_>r.aspect?p/(2*Math.tan(.5*r.fovX)*r.aspect):_/(2*Math.tan(.5*r.fovY)*r.aspect)}_cameraForBoundsOnGlobe(r,l,p,_,b,S){const A=r.clone(),R=this._extendCameraOptions(S);A.bearing=_,A.pitch=b;const V=c.LngLat.convert(l),j=c.LngLat.convert(p),y=.5*(V.lat+j.lat),E=.5*(V.lng+j.lng),x=c.latLngToECEF(y,E),T=c.normalize([],x),M=c.normalize([],c.cross([],T,[0,1,0])),L=c.cross([],M,T),O=[M[0],M[1],M[2],0,L[0],L[1],L[2],0,T[0],T[1],T[2],0,0,0,0,1],Z=[x,c.latLngToECEF(V.lat,V.lng),c.latLngToECEF(j.lat,V.lng),c.latLngToECEF(j.lat,j.lng),c.latLngToECEF(V.lat,j.lng),c.latLngToECEF(y,V.lng),c.latLngToECEF(y,j.lng),c.latLngToECEF(V.lat,E),c.latLngToECEF(j.lat,E)];let Y=c.Aabb.fromPoints(Z.map(Ae=>[c.dot(M,Ae),c.dot(L,Ae),c.dot(T,Ae)]));const oe=c.transformMat4([],Y.center,O);0===c.squaredLength(oe)&&c.set(oe,0,0,1),c.normalize(oe,oe),c.scale$2(oe,oe,c.GLOBE_RADIUS),A.center=c.ecefToLatLng(oe);const se=A.getWorldToCameraMatrix(),he=c.invert(new Float64Array(16),se);Y=c.Aabb.applyTransform(Y,c.multiply([],se,O)),c.transformMat4(oe,oe,se);const be=.5*(Y.max[2]-Y.min[2]),Le=this._minimumAABBFrustumDistance(A,Y),Pe=c.scale$2([],[0,0,1],be),Te=c.add(Pe,oe,Pe),et=Le+(0===A.pitch?0:c.distance(oe,Te)),Re=A.globeCenterInViewSpace,He=c.sub([],oe,[Re[0],Re[1],Re[2]]);c.normalize(He,He),c.scale$2(He,He,et);const ze=c.add([],oe,He);c.transformMat4(ze,ze,he);const ct=c.earthRadius/c.GLOBE_RADIUS,Ne=c.length(ze),Ke=c.mercatorZfromAltitude(Ne*ct-c.earthRadius,0),vt=Math.min(A.zoomFromMercatorZAdjusted(Ke),R.maxZoom);return vt>.5*(c.GLOBE_ZOOM_THRESHOLD_MIN+c.GLOBE_ZOOM_THRESHOLD_MAX)?(A.setProjection({name:"mercator"}),A.zoom=vt,this._cameraForBounds(A,l,p,_,b,S)):{center:A.center,zoom:vt,bearing:_,pitch:b}}queryTerrainElevation(r,l){const p=this.transform.elevation;return p?(l=c.extend({},{exaggerated:!0},l),p.getAtPoint(c.MercatorCoordinate.fromLngLat(r),null,l.exaggerated)):null}_cameraForBounds(r,l,p,_,b,S){if("globe"===r.projection.name)return this._cameraForBoundsOnGlobe(r,l,p,_,b,S);const A=r.clone(),R=this._extendCameraOptions(S),V=A.padding;A.bearing=_,A.pitch=b;const j=c.LngLat.convert(l),y=c.LngLat.convert(p),E=new c.LngLat(j.lng,y.lat),x=new c.LngLat(y.lng,j.lat),T=A.project(j),M=A.project(y),L=this.queryTerrainElevation(j),O=this.queryTerrainElevation(y),Z=this.queryTerrainElevation(E),Y=this.queryTerrainElevation(x),oe=[[T.x,T.y,Math.min(L||0,O||0,Z||0,Y||0)],[M.x,M.y,Math.max(L||0,O||0,Z||0,Y||0)]];let se=c.Aabb.fromPoints(oe);const he=A.getWorldToCameraMatrix(),be=c.invert(new Float64Array(16),he);se=c.Aabb.applyTransform(se,he);const Le=c.sub([],se.max,se.min),Pe=V.left||0,Te=V.right||0,et=V.bottom||0,Re=V.top||0,{left:He,right:ze,top:ct,bottom:Ne}=R.padding,Ke=.5*(Pe+Te),vt=.5*(Re+et),Ae=Math.min(A.scaleZoom(A.scale*Math.min((A.width-(Pe+Te+He+ze))/Le[0],(A.height-(et+Re+Ne+ct))/Le[1])),R.maxZoom),Be=A.scale/A.zoomScale(Ae);se=new c.Aabb([se.min[0]-(He+Ke)*Be,se.min[1]-(Ne+vt)*Be,se.min[2]],[se.max[0]+(ze+Ke)*Be,se.max[1]+(ct+vt)*Be,se.max[2]]);const Zt=.5*Le[2],an=this._minimumAABBFrustumDistance(A,se),qt=[0,0,1,0];c.transformMat4$1(qt,qt,he),c.normalize$2(qt,qt);const mn=c.scale$2([],qt,an+Zt),Pn=c.add([],se.center,mn),tn=("number"==typeof R.offset.x&&"number"==typeof R.offset.y?new c.pointGeometry(R.offset.x,R.offset.y):c.pointGeometry.convert(R.offset)).rotate(-c.degToRad(_));se.center[0]-=tn.x*Be,se.center[1]+=tn.y*Be,c.transformMat4(se.center,se.center,be),c.transformMat4(Pn,Pn,be);const Ft=[se.center[0],se.center[1],Pn[2]*A.pixelsPerMeter];c.scale$2(Ft,Ft,1/A.worldSize);const vr=c.lngFromMercatorX(Ft[0]),hr=c.latFromMercatorY(Ft[1]),Mr=Math.min(A._zoomFromMercatorZ(Ft[2]),R.maxZoom),xr=new c.LngLat(vr,hr);return A.mercatorFromTransition&&Mr<.5*(c.GLOBE_ZOOM_THRESHOLD_MIN+c.GLOBE_ZOOM_THRESHOLD_MAX)?(A.setProjection({name:"globe"}),A.zoom=Mr,this._cameraForBounds(A,l,p,_,b,S)):{center:xr,zoom:Mr,bearing:_,pitch:b}}fitBounds(r,l,p){const _=this.cameraForBounds(r,l);return this._fitInternal(_,l,p)}fitScreenCoordinates(r,l,p,_,b){const S=c.pointGeometry.convert(r),A=c.pointGeometry.convert(l),R=new c.pointGeometry(Math.min(S.x,A.x),Math.min(S.y,A.y)),V=new c.pointGeometry(Math.max(S.x,A.x),Math.max(S.y,A.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(S,A))return this;const j=this.transform.pointLocation3D(R),y=this.transform.pointLocation3D(V),E=this.transform.pointLocation3D(new c.pointGeometry(R.x,V.y)),x=this.transform.pointLocation3D(new c.pointGeometry(V.x,R.y)),T=[Math.min(j.lng,y.lng,E.lng,x.lng),Math.min(j.lat,y.lat,E.lat,x.lat)],M=[Math.max(j.lng,y.lng,E.lng,x.lng),Math.max(j.lat,y.lat,E.lat,x.lat)],L=_&&_.pitch?_.pitch:this.getPitch(),O=this._cameraForBounds(this.transform,T,M,p,L,_);return this._fitInternal(O,_,b)}_fitInternal(r,l,p){return r?(delete(l=c.extend(r,l)).padding,l.linear?this.easeTo(l,p):this.flyTo(l,p)):this}jumpTo(r,l){this.stop();const p=r.preloadOnly?this.transform.clone():this.transform;let _=!1,b=!1,S=!1;return"zoom"in r&&p.zoom!==+r.zoom&&(_=!0,p.zoom=+r.zoom),void 0!==r.center&&(p.center=c.LngLat.convert(r.center)),"bearing"in r&&p.bearing!==+r.bearing&&(b=!0,p.bearing=+r.bearing),"pitch"in r&&p.pitch!==+r.pitch&&(S=!0,p.pitch=+r.pitch),null==r.padding||p.isPaddingEqual(r.padding)||(p.padding=r.padding),r.preloadOnly?(this._preloadTiles(p),this):(this.fire(new c.Event("movestart",l)).fire(new c.Event("move",l)),_&&this.fire(new c.Event("zoomstart",l)).fire(new c.Event("zoom",l)).fire(new c.Event("zoomend",l)),b&&this.fire(new c.Event("rotatestart",l)).fire(new c.Event("rotate",l)).fire(new c.Event("rotateend",l)),S&&this.fire(new c.Event("pitchstart",l)).fire(new c.Event("pitch",l)).fire(new c.Event("pitchend",l)),this.fire(new c.Event("moveend",l)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||c.warnOnce(Ms),this.transform.getFreeCameraOptions()}setFreeCameraOptions(r,l){const p=this.transform;if(!p.projection.supportsFreeCamera)return c.warnOnce(Ms),this;this.stop();const _=p.zoom,b=p.pitch,S=p.bearing;p.setFreeCameraOptions(r);const A=_!==p.zoom,R=b!==p.pitch,V=S!==p.bearing;return this.fire(new c.Event("movestart",l)).fire(new c.Event("move",l)),A&&this.fire(new c.Event("zoomstart",l)).fire(new c.Event("zoom",l)).fire(new c.Event("zoomend",l)),V&&this.fire(new c.Event("rotatestart",l)).fire(new c.Event("rotate",l)).fire(new c.Event("rotateend",l)),R&&this.fire(new c.Event("pitchstart",l)).fire(new c.Event("pitch",l)).fire(new c.Event("pitchend",l)),this.fire(new c.Event("moveend",l)),this}easeTo(r,l){this._stop(!1,r.easeId),(!1===(r=c.extend({offset:[0,0],duration:500,easing:c.ease},r)).animate||!r.essential&&c.exported.prefersReducedMotion)&&(r.duration=0);const p=this.transform,_=this.getZoom(),b=this.getBearing(),S=this.getPitch(),A=this.getPadding(),R="zoom"in r?+r.zoom:_,V="bearing"in r?this._normalizeBearing(r.bearing,b):b,j="pitch"in r?+r.pitch:S,y="padding"in r?r.padding:p.padding,E=c.pointGeometry.convert(r.offset);let x,T,M;if("globe"===p.projection.name){const Pe=c.MercatorCoordinate.fromLngLat(p.center),Te=E.rotate(-p.angle);Pe.x+=Te.x/p.worldSize,Pe.y+=Te.y/p.worldSize;const et=Pe.toLngLat(),Re=c.LngLat.convert(r.center||et);this._normalizeCenter(Re),x=p.centerPoint.add(Te),T=new c.pointGeometry(Pe.x,Pe.y).mult(p.worldSize),M=new c.pointGeometry(c.mercatorXfromLng(Re.lng),c.mercatorYfromLat(Re.lat)).mult(p.worldSize).sub(T)}else{x=p.centerPoint.add(E);const Pe=p.pointLocation(x),Te=c.LngLat.convert(r.center||Pe);this._normalizeCenter(Te),T=p.project(Pe),M=p.project(Te).sub(T)}const L=p.zoomScale(R-_);let O,Z;r.around&&(O=c.LngLat.convert(r.around),Z=p.locationPoint(O));const Y=this._zooming||R!==_,oe=this._rotating||b!==V,se=this._pitching||j!==S,he=!p.isPaddingEqual(y),be=Pe=>Te=>{if(Y&&(Pe.zoom=c.number(_,R,Te)),oe&&(Pe.bearing=c.number(b,V,Te)),se&&(Pe.pitch=c.number(S,j,Te)),he&&(Pe.interpolatePadding(A,y,Te),x=Pe.centerPoint.add(E)),O)Pe.setLocationAtPoint(O,Z);else{const et=Pe.zoomScale(Pe.zoom-_),Re=R>_?Math.min(2,L):Math.max(.5,L),He=Math.pow(Re,1-Te),ze=Pe.unproject(T.add(M.mult(Te*He)).mult(et));Pe.setLocationAtPoint(Pe.renderWorldCopies?ze.wrap():ze,x)}return r.preloadOnly||this._fireMoveEvents(l),Pe};if(r.preloadOnly){const Pe=this._emulate(be,r.duration,p);return this._preloadTiles(Pe),this}const Le={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=Y,this._rotating=oe,this._pitching=se,this._padding=he,this._easeId=r.easeId,this._prepareEase(l,r.noMoveStart,Le),this._ease(be(p),Pe=>{p.recenterOnTerrain(),this._afterEase(l,Pe)},r),this}_prepareEase(r,l,p={}){this._moving=!0,this.transform.cameraElevationReference="sea",l||p.moving||this.fire(new c.Event("movestart",r)),this._zooming&&!p.zooming&&this.fire(new c.Event("zoomstart",r)),this._rotating&&!p.rotating&&this.fire(new c.Event("rotatestart",r)),this._pitching&&!p.pitching&&this.fire(new c.Event("pitchstart",r))}_fireMoveEvents(r){this.fire(new c.Event("move",r)),this._zooming&&this.fire(new c.Event("zoom",r)),this._rotating&&this.fire(new c.Event("rotate",r)),this._pitching&&this.fire(new c.Event("pitch",r))}_afterEase(r,l){if(this._easeId&&l&&this._easeId===l)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const p=this._zooming,_=this._rotating,b=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new c.Event("zoomend",r)),_&&this.fire(new c.Event("rotateend",r)),b&&this.fire(new c.Event("pitchend",r)),this.fire(new c.Event("moveend",r))}flyTo(r,l){if(!r.essential&&c.exported.prefersReducedMotion){const Ae=c.pick(r,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Ae,l)}this.stop(),r=c.extend({offset:[0,0],speed:1.2,curve:1.42,easing:c.ease},r);const p=this.transform,_=this.getZoom(),b=this.getBearing(),S=this.getPitch(),A=this.getPadding(),R="zoom"in r?c.clamp(+r.zoom,p.minZoom,p.maxZoom):_,V="bearing"in r?this._normalizeBearing(r.bearing,b):b,j="pitch"in r?+r.pitch:S,y="padding"in r?r.padding:p.padding,E=p.zoomScale(R-_),x=c.pointGeometry.convert(r.offset);let T=p.centerPoint.add(x);const M=p.pointLocation(T),L=c.LngLat.convert(r.center||M);this._normalizeCenter(L);const O=p.project(M),Z=p.project(L).sub(O);let Y=r.curve;const oe=Math.max(p.width,p.height),se=oe/E,he=Z.mag();if("minZoom"in r){const Ae=c.clamp(Math.min(r.minZoom,_,R),p.minZoom,p.maxZoom),Be=oe/p.zoomScale(Ae-_);Y=Math.sqrt(Be/he*2)}const be=Y*Y;function Le(Ae){const Be=(se*se-oe*oe+(Ae?-1:1)*be*be*he*he)/(2*(Ae?se:oe)*be*he);return Math.log(Math.sqrt(Be*Be+1)-Be)}function Pe(Ae){return(Math.exp(Ae)-Math.exp(-Ae))/2}function Te(Ae){return(Math.exp(Ae)+Math.exp(-Ae))/2}const et=Le(0);let Re=function(Ae){return Te(et)/Te(et+Y*Ae)},He=function(Ae){return oe*((Te(et)*(Pe(Be=et+Y*Ae)/Te(Be))-Pe(et))/be)/he;var Be},ze=(Le(1)-et)/Y;if(Math.abs(he)<1e-6||!isFinite(ze)){if(Math.abs(oe-se)<1e-6)return this.easeTo(r,l);const Ae=se<oe?-1:1;ze=Math.abs(Math.log(se/oe))/Y,He=function(){return 0},Re=function(Be){return Math.exp(Ae*Y*Be)}}r.duration="duration"in r?+r.duration:1e3*ze/("screenSpeed"in r?+r.screenSpeed/Y:+r.speed),r.maxDuration&&r.duration>r.maxDuration&&(r.duration=0);const ct=b!==V,Ne=j!==S,Ke=!p.isPaddingEqual(y),vt=Ae=>Be=>{const Zt=Be*ze,an=1/Re(Zt);Ae.zoom=1===Be?R:_+Ae.scaleZoom(an),ct&&(Ae.bearing=c.number(b,V,Be)),Ne&&(Ae.pitch=c.number(S,j,Be)),Ke&&(Ae.interpolatePadding(A,y,Be),T=Ae.centerPoint.add(x));const qt=1===Be?L:Ae.unproject(O.add(Z.mult(He(Zt))).mult(an));return Ae.setLocationAtPoint(Ae.renderWorldCopies?qt.wrap():qt,T),Ae._updateCameraOnTerrain(),r.preloadOnly||this._fireMoveEvents(l),Ae};if(r.preloadOnly){const Ae=this._emulate(vt,r.duration,p);return this._preloadTiles(Ae),this}return this._zooming=!0,this._rotating=ct,this._pitching=Ne,this._padding=Ke,this._prepareEase(l,!1),this._ease(vt(p),()=>this._afterEase(l),r),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(r,l){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const p=this._onEaseEnd;this._onEaseEnd=void 0,p.call(this,l)}if(!r){const p=this.handlers;p&&p.stop(!1)}return this}_ease(r,l,p){!1===p.animate||0===p.duration?(r(1),l()):(this._easeStart=c.exported.now(),this._easeOptions=p,this._onEaseFrame=r,this._onEaseEnd=l,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const r=Math.min((c.exported.now()-this._easeStart)/this._easeOptions.duration,1),l=this._onEaseFrame;l&&l(this._easeOptions.easing(r)),r<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(r,l){r=c.wrap(r,-180,180);const p=Math.abs(r-l);return Math.abs(r-360-l)<p&&(r-=360),Math.abs(r+360-l)<p&&(r+=360),r}_normalizeCenter(r){const l=this.transform;if(!l.renderWorldCopies||l.maxBounds)return;const p=r.lng-l.center.lng;r.lng+=p>180?-360:p<-180?360:0}_emulate(r,l,p){const _=Math.ceil(15*l/1e3),b=[],S=r(p.clone());for(let A=0;A<=_;A++){const R=S(A/_);b.push(R.clone())}return b}}class As{constructor(r={}){this.options=r,c.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(r){const l=this.options&&this.options.compact;return this._map=r,this._container=bt("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=bt("button","mapboxgl-ctrl-attrib-button",this._container),bt("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=bt("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),l&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===l&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(r,l){const p=this._map._getUIString(`AttributionControl.${l}`);r.setAttribute("aria-label",p),r.removeAttribute("title"),r.firstElementChild&&r.firstElementChild.setAttribute("title",p)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let r=this._editLink;r||(r=this._editLink=this._container.querySelector(".mapbox-improve-map"));const l=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||c.config.ACCESS_TOKEN}];if(r){const p=l.reduce((_,b,S)=>(b.value&&(_+=`${b.key}=${b.value}${S<l.length-1?"&":""}`),_),"?");r.href=`${c.config.FEEDBACK_URL}/${p}#${qr(this._map,!0)}`,r.rel="noopener nofollow",this._setElementTitle(r,"MapFeedback")}}_updateData(r){!r||"metadata"!==r.sourceDataType&&"visibility"!==r.sourceDataType&&"style"!==r.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let r=[];if(this._map.style.stylesheet){const _=this._map.style.stylesheet;this.styleOwner=_.owner,this.styleId=_.id}const l=this._map.style._sourceCaches;for(const _ in l){const b=l[_];if(b.used){const S=b.getSource();S.attribution&&r.indexOf(S.attribution)<0&&r.push(S.attribution)}}r.sort((_,b)=>_.length-b.length),r=r.filter((_,b)=>{for(let S=b+1;S<r.length;S++)if(r[S].indexOf(_)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?r=[...this.options.customAttribution,...r]:r.unshift(this.options.customAttribution));const p=r.join(" | ");p!==this._attribHTML&&(this._attribHTML=p,r.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class ua{constructor(){c.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(r){this._map=r,this._container=bt("div","mapboxgl-ctrl");const l=bt("a","mapboxgl-ctrl-logo");return l.target="_blank",l.rel="noopener nofollow",l.href="https://www.mapbox.com/",l.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),l.setAttribute("rel","noopener nofollow"),this._container.appendChild(l),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(r){r&&"metadata"!==r.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const r=this._map.style._sourceCaches;if(0===Object.entries(r).length)return!0;for(const l in r){const p=r[l].getSource();if(p.hasOwnProperty("mapbox_logo")&&!p.mapbox_logo)return!1}return!0}_updateCompact(){const r=this._container.children;if(r.length){const l=r[0];this._map.getCanvasContainer().offsetWidth<250?l.classList.add("mapboxgl-compact"):l.classList.remove("mapboxgl-compact")}}}class Hl{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(r){const l=++this._id;return this._queue.push({callback:r,id:l,cancelled:!1}),l}remove(r){const l=this._currentlyRunning,p=l?this._queue.concat(l):this._queue;for(const _ of p)if(_.id===r)return void(_.cancelled=!0)}run(r=0){const l=this._currentlyRunning=this._queue;this._queue=[];for(const p of l)if(!p.cancelled&&(p.callback(r),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Sr(h,r,l){if(h=new c.LngLat(h.lng,h.lat),r){const p=new c.LngLat(h.lng-360,h.lat),_=new c.LngLat(h.lng+360,h.lat),b=360*Math.ceil(Math.abs(h.lng-l.center.lng)/360),S=l.locationPoint(h).distSqr(r),A=r.x<0||r.y<0||r.x>l.width||r.y>l.height;l.locationPoint(p).distSqr(r)<S&&(A||Math.abs(p.lng-l.center.lng)<b)?h=p:l.locationPoint(_).distSqr(r)<S&&(A||Math.abs(_.lng-l.center.lng)<b)&&(h=_)}for(;Math.abs(h.lng-l.center.lng)>180;){const p=l.locationPoint(h);if(p.x>=0&&p.y>=0&&p.x<=l.width&&p.y<=l.height)break;h.lng>l.center.lng?h.lng-=360:h.lng+=360}return h}const Ec={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Zc extends c.Evented{constructor(r,l){if(super(),(r instanceof c.window.HTMLElement||l)&&(r=c.extend({element:r},l)),c.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=r&&r.anchor||"center",this._color=r&&r.color||"#3FB1CE",this._scale=r&&r.scale||1,this._draggable=r&&r.draggable||!1,this._clickTolerance=r&&r.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=r&&r.rotation||0,this._rotationAlignment=r&&r.rotationAlignment||"auto",this._pitchAlignment=r&&r.pitchAlignment&&r.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=r&&r.occludedOpacity||.2,r&&r.element)this._element=r.element,this._offset=c.pointGeometry.convert(r&&r.offset||[0,0]);else{this._defaultMarker=!0,this._element=bt("div");const _=41,b=27,S=gt("svg",{display:"block",height:_*this._scale+"px",width:b*this._scale+"px",viewBox:`0 0 ${b} ${_}`},this._element),A=gt("radialGradient",{id:"shadowGradient"},gt("defs",{},S));gt("stop",{offset:"10%","stop-opacity":.4},A),gt("stop",{offset:"100%","stop-opacity":.05},A),gt("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},S),gt("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},S),gt("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},S),gt("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},S),this._offset=c.pointGeometry.convert(r&&r.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",_=>{_.preventDefault()}),this._element.addEventListener("mousedown",_=>{_.preventDefault()});const p=this._element.classList;for(const _ in Ec)p.remove(`mapboxgl-marker-anchor-${_}`);p.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(r){return r===this._map||(this.remove(),this._map=r,r.getCanvasContainer().appendChild(this._element),r.on("move",this._updateMoving),r.on("moveend",this._update),r.on("remove",this._clearFadeTimer),r._addMarker(this),this.setDraggable(this._draggable),this._update(),r.on("click",this._onMapClick)),this}remove(){const r=this._map;return r&&(r.off("click",this._onMapClick),r.off("move",this._updateMoving),r.off("moveend",this._update),r.off("mousedown",this._addDragHandler),r.off("touchstart",this._addDragHandler),r.off("mouseup",this._onUp),r.off("touchend",this._onUp),r.off("mousemove",this._onMove),r.off("touchmove",this._onMove),r.off("remove",this._clearFadeTimer),r._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(r){return this._lngLat=c.LngLat.convert(r),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(r){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),r){if(!("offset"in r.options)){const _=Math.sqrt(Math.pow(13.5,2)/2);r.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[_,-1*(24.6+_)],"bottom-right":[-_,-1*(24.6+_)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=r,r._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(r){const l=r.code,p=r.charCode||r.keyCode;"Space"!==l&&"Enter"!==l&&32!==p&&13!==p||this.togglePopup()}_onMapClick(r){const l=r.originalEvent.target,p=this._element;this._popup&&(l===p||p.contains(l))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const r=this._popup;return r?(r.isOpen()?(r.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(r.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const r=this._map,l=this._pos;if(!r||!l)return!1;const p=r.unproject(l),_=r.getFreeCameraOptions();if(!_.position)return!1;const b=_.position.toLngLat();return b.distanceTo(p)<.9*b.distanceTo(this._lngLat)}_evaluateOpacity(){const r=this._map;if(!r)return;const l=this._pos;if(!l||l.x<0||l.x>r.transform.width||l.y<0||l.y>r.transform.height)return void this._clearFadeTimer();const p=r.unproject(l);let _;r._showingGlobe()&&c.isLngLatBehindGlobe(r.transform,this._lngLat)?_=0:(_=1-r._queryFogOpacity(p),r.transform._terrainEnabled()&&r.getTerrain()&&this._behindTerrain()&&(_*=this._occludedOpacity)),this._element.style.opacity=`${_}`,this._element.style.pointerEvents=_>0?"auto":"none",this._popup&&this._popup._setOpacity(_),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const r=this._pos;if(!r||!this._map)return;const l=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${r.x}px,${r.y}px)\n            ${Ec[this._anchor]}\n            ${this._calculateXYTransform()} ${this._calculateZTransform()}\n            translate(${l.x}px,${l.y}px)\n        `}_calculateXYTransform(){const r=this._pos,l=this._map,p=this.getPitchAlignment();if(!l||!r||"map"!==p)return"";if(!l._showingGlobe()){const R=l.getPitch();return R?`rotateX(${R}deg)`:""}const _=c.radToDeg(c.globeTiltAtLngLat(l.transform,this._lngLat)),b=r.sub(c.globeCenterToScreenPoint(l.transform)),S=Math.abs(b.x)+Math.abs(b.y);if(0===S)return"";const A=_/S;return`rotateX(${-b.y*A}deg) rotateY(${b.x*A}deg)`}_calculateZTransform(){const r=this._pos,l=this._map;if(!l||!r)return"";let p=0;const _=this.getRotationAlignment();if("map"===_)if(l._showingGlobe()){const b=l.project(new c.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),S=l.project(new c.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(b);p=c.radToDeg(Math.atan2(S.y,S.x))-90}else p=-l.getBearing();else if("horizon"===_){const b=c.smoothstep(4,6,l.getZoom()),S=c.globeCenterToScreenPoint(l.transform);S.y+=b*l.transform.height;const A=r.sub(S),R=c.radToDeg(Math.atan2(A.y,A.x));p=(R>90?R-270:R+90)*(1-b)}return p+=this._rotation,p?`rotateZ(${p}deg)`:""}_update(r){c.window.cancelAnimationFrame(this._updateFrameId);const l=this._map;l&&(l.transform.renderWorldCopies&&(this._lngLat=Sr(this._lngLat,this._pos,l.transform)),this._pos=l.project(this._lngLat),!0===r?this._updateFrameId=c.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),l._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(l._showingGlobe()||l.getTerrain()||l.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(r){return this._offset=c.pointGeometry.convert(r),this._update(),this}_onMove(r){const l=this._map;if(!l)return;const p=this._pointerdownPos,_=this._positionDelta;if(p&&_){if(!this._isDragging){const b=this._clickTolerance||l._clickTolerance;if(r.point.dist(p)<b)return;this._isDragging=!0}this._pos=r.point.sub(_),this._lngLat=l.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new c.Event("dragstart"))),this.fire(new c.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const r=this._map;r&&(r.off("mousemove",this._onMove),r.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new c.Event("dragend")),this._state="inactive"}_addDragHandler(r){const l=this._map,p=this._pos;l&&p&&this._element.contains(r.originalEvent.target)&&(r.preventDefault(),this._positionDelta=r.point.sub(p),this._pointerdownPos=r.point,this._state="pending",l.on("mousemove",this._onMove),l.on("touchmove",this._onMove),l.once("mouseup",this._onUp),l.once("touchend",this._onUp))}setDraggable(r){this._draggable=!!r;const l=this._map;return l&&(r?(l.on("mousedown",this._addDragHandler),l.on("touchstart",this._addDragHandler)):(l.off("mousedown",this._addDragHandler),l.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(r){return this._rotation=r||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(r){return this._rotationAlignment=r||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(r){return this._pitchAlignment=r||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(r){return this._occludedOpacity=r||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Dc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Cu=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Tc(h=new c.pointGeometry(0,0),r="bottom"){if("number"==typeof h){const l=Math.round(Math.sqrt(.5*Math.pow(h,2)));switch(r){case"top":return new c.pointGeometry(0,h);case"top-left":return new c.pointGeometry(l,l);case"top-right":return new c.pointGeometry(-l,l);case"bottom":return new c.pointGeometry(0,-h);case"bottom-left":return new c.pointGeometry(l,-l);case"bottom-right":return new c.pointGeometry(-l,-l);case"left":return new c.pointGeometry(h,0);case"right":return new c.pointGeometry(-h,0)}return new c.pointGeometry(0,0)}return h instanceof c.pointGeometry||Array.isArray(h)?c.pointGeometry.convert(h):c.pointGeometry.convert(h[r]||[0,0])}class mh{constructor(r){this.jumpTo(r)}getValue(r){if(r<=this._startTime)return this._start;if(r>=this._endTime)return this._end;const l=c.easeCubicInOut((r-this._startTime)/(this._endTime-this._startTime));return this._start*(1-l)+this._end*l}isEasing(r){return r>=this._startTime&&r<=this._endTime}jumpTo(r){this._startTime=-1/0,this._endTime=-1/0,this._start=r,this._end=r}easeTo(r,l,p){this._start=this.getValue(l),this._end=r,this._startTime=l,this._endTime=l+p}}const gh={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},_l={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},Su={showCompass:!0,showZoom:!0,visualizePitch:!1};class _h{constructor(r,l,p=!1){this._clickTolerance=10,this.element=l,this.mouseRotate=new ml({clickTolerance:r.dragRotate._mouseRotate._clickTolerance}),this.map=r,p&&(this.mousePitch=new La({clickTolerance:r.dragRotate._mousePitch._clickTolerance})),c.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),l.addEventListener("mousedown",this.mousedown),l.addEventListener("touchstart",this.touchstart,{passive:!1}),l.addEventListener("touchmove",this.touchmove),l.addEventListener("touchend",this.touchend),l.addEventListener("touchcancel",this.reset)}down(r,l){this.mouseRotate.mousedown(r,l),this.mousePitch&&this.mousePitch.mousedown(r,l),_t()}move(r,l){const p=this.map,_=this.mouseRotate.mousemoveWindow(r,l),b=_&&_.bearingDelta;if(b&&p.setBearing(p.getBearing()+b),this.mousePitch){const S=this.mousePitch.mousemoveWindow(r,l),A=S&&S.pitchDelta;A&&p.setPitch(p.getPitch()+A)}}off(){const r=this.element;r.removeEventListener("mousedown",this.mousedown),r.removeEventListener("touchstart",this.touchstart,{passive:!1}),r.removeEventListener("touchmove",this.touchmove),r.removeEventListener("touchend",this.touchend),r.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Qt(),c.window.removeEventListener("mousemove",this.mousemove),c.window.removeEventListener("mouseup",this.mouseup)}mousedown(r){this.down(c.extend({},r,{ctrlKey:!0,preventDefault:()=>r.preventDefault()}),Qe(this.element,r)),c.window.addEventListener("mousemove",this.mousemove),c.window.addEventListener("mouseup",this.mouseup)}mousemove(r){this.move(r,Qe(this.element,r))}mouseup(r){this.mouseRotate.mouseupWindow(r),this.mousePitch&&this.mousePitch.mouseupWindow(r),this.offTemp()}touchstart(r){1!==r.targetTouches.length?this.reset():(this._startPos=this._lastPos=sr(this.element,r.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>r.preventDefault()},this._startPos))}touchmove(r){1!==r.targetTouches.length?this.reset():(this._lastPos=sr(this.element,r.targetTouches)[0],this.move({preventDefault:()=>r.preventDefault()},this._lastPos))}touchend(r){0===r.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const di={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},qc={maxWidth:100,unit:"metric"};function gs(h,r,l){const p=Iu(r),_=p/r,b={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"}[l];this._map._requestDomTask(()=>{this._container.style.width=h*_+"px",this._container.innerHTML=`${p}&nbsp;${b}`})}function Iu(h){const r=Math.pow(10,`${Math.floor(h)}`.length-1);let l=h/r;return l=l>=10?10:l>=5?5:l>=3?3:l>=2?2:l>=1?1:function(p){const _=Math.pow(10,Math.ceil(-Math.log(p)/Math.LN10));return Math.round(p*_)/_}(l),r*l}const Oi={version:c.version,supported:Ht,setRTLTextPlugin:c.setRTLTextPlugin,getRTLTextPluginStatus:c.getRTLTextPluginStatus,Map:class extends Hc{constructor(h){if(c.LivePerformanceUtils.mark(c.PerformanceMarkers.create),null!=(h=c.extend({},_l,h)).minZoom&&null!=h.maxZoom&&h.minZoom>h.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=h.minPitch&&null!=h.maxPitch&&h.minPitch>h.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=h.minPitch&&h.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=h.maxPitch&&h.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(h.antialias&&c.isSafariWithAntialiasingBug(c.window)&&(h.antialias=!1,c.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Cr(h.minZoom,h.maxZoom,h.minPitch,h.maxPitch,h.renderWorldCopies),h),this._interactive=h.interactive,this._minTileCacheSize=h.minTileCacheSize,this._maxTileCacheSize=h.maxTileCacheSize,this._failIfMajorPerformanceCaveat=h.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=h.preserveDrawingBuffer,this._antialias=h.antialias,this._trackResize=h.trackResize,this._bearingSnap=h.bearingSnap,this._refreshExpiredTiles=h.refreshExpiredTiles,this._fadeDuration=h.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=h.crossSourceCollisions,this._collectResourceTiming=h.collectResourceTiming,this._optimizeForTerrain=h.optimizeForTerrain,this._language=this._parseLanguage(h.language),this._worldview=h.worldview,this._renderTaskQueue=new Hl,this._domRenderTaskQueue=new Hl,this._controls=[],this._markers=[],this._popups=[],this._mapId=c.uniqueId(),this._locale=c.extend({},gh,h.locale),this._clickTolerance=h.clickTolerance,this._cooperativeGestures=h.cooperativeGestures,this._performanceMetricsCollection=h.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new mh(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new c.RequestManager(h.transformRequest,h.accessToken,h.testMode),this._silenceAuthErrors=!!h.testMode,"string"==typeof h.container){if(this._container=c.window.document.getElementById(h.container),!this._container)throw new Error(`Container '${h.container}' not found.`)}else{if(!(h.container instanceof c.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=h.container}if(this._container.childNodes.length>0&&c.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),h.maxBounds&&this.setMaxBounds(h.maxBounds),c.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==c.window&&(c.window.addEventListener("online",this._onWindowOnline,!1),c.window.addEventListener("resize",this._onWindowResize,!1),c.window.addEventListener("orientationchange",this._onWindowResize,!1),c.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),c.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new Jo(this,h),this._localFontFamily=h.localFontFamily,this._localIdeographFontFamily=h.localIdeographFontFamily,h.style&&this.setStyle(h.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),h.projection&&this.setProjection(h.projection),this._hash=h.hash&&new St("string"==typeof h.hash&&h.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch}),h.bounds&&(this.resize(),this.fitBounds(h.bounds,c.extend({},h.fitBoundsOptions,{duration:0})))),this.resize(),h.attributionControl&&this.addControl(new As({customAttribution:h.customAttribution})),this._logoControl=new ua,this.addControl(this._logoControl,h.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",r=>{this._update("style"===r.dataType),this.fire(new c.Event(`${r.dataType}data`,r))}),this.on("dataloading",r=>{this.fire(new c.Event(`${r.dataType}dataloading`,r))})}_getMapId(){return this._mapId}addControl(h,r){if(void 0===r&&(r=h.getDefaultPosition?h.getDefaultPosition():"top-right"),!h||!h.onAdd)return this.fire(new c.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const l=h.onAdd(this);this._controls.push(h);const p=this._controlPositions[r];return-1!==r.indexOf("bottom")?p.insertBefore(l,p.firstChild):p.appendChild(l),this}removeControl(h){if(!h||!h.onRemove)return this.fire(new c.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const r=this._controls.indexOf(h);return r>-1&&this._controls.splice(r,1),h.onRemove(this),this}hasControl(h){return this._controls.indexOf(h)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(h){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const r=!this._moving;return r&&this.fire(new c.Event("movestart",h)).fire(new c.Event("move",h)),this.fire(new c.Event("resize",h)),r&&this.fire(new c.Event("moveend",h)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(h){return this.transform.setMaxBounds(c.LngLatBounds.convert(h)),this._update()}setMinZoom(h){if((h=h??-2)>=-2&&h<=this.transform.maxZoom)return this.transform.minZoom=h,this._update(),this.getZoom()<h?this.setZoom(h):this.fire(new c.Event("zoomstart")).fire(new c.Event("zoom")).fire(new c.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(h){if((h=h??22)>=this.transform.minZoom)return this.transform.maxZoom=h,this._update(),this.getZoom()>h?this.setZoom(h):this.fire(new c.Event("zoomstart")).fire(new c.Event("zoom")).fire(new c.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(h){if((h=h??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(h>=0&&h<=this.transform.maxPitch)return this.transform.minPitch=h,this._update(),this.getPitch()<h?this.setPitch(h):this.fire(new c.Event("pitchstart")).fire(new c.Event("pitch")).fire(new c.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(h){if((h=h??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(h>=this.transform.minPitch)return this.transform.maxPitch=h,this._update(),this.getPitch()>h?this.setPitch(h):this.fire(new c.Event("pitchstart")).fire(new c.Event("pitch")).fire(new c.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(h){return this.transform.renderWorldCopies=h,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(h){return"auto"===h?c.window.navigator.language:Array.isArray(h)?0===h.length?void 0:h.map(r=>"auto"===r?c.window.navigator.language:r):h}setLanguage(h){const r=this._parseLanguage(h);if(!this.style||r===this._language)return this;this._language=r,this.style._reloadSources();for(const l of this._controls)l._setLanguage&&l._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(h){return this.style&&h!==this._worldview?(this._worldview=h,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(h){return this._lazyInitEmptyStyle(),h?"string"==typeof h&&(h={name:h}):h=null,this._useExplicitProjection=!!h,this._prioritizeAndUpdateProjection(h,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const h=this.transform,r=h.projection.name;let l;"globe"===r&&h.zoom>=c.GLOBE_ZOOM_THRESHOLD_MAX?(h.setMercatorFromTransition(),l=!0):"mercator"===r&&h.zoom<c.GLOBE_ZOOM_THRESHOLD_MAX&&(h.setProjection({name:"globe"}),l=!0),l&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(h,r){return this._updateProjection(h||r||{name:"mercator"})}_updateProjection(h){let r;if(r="globe"===h.name&&this.transform.zoom>=c.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(h),this.style.applyProjectionUpdate(),r){this.painter.clearBackgroundTiles();for(const l in this.style._sourceCaches)this.style._sourceCaches[l].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(h){return this.transform.locationPoint3D(c.LngLat.convert(h))}unproject(h){return this.transform.pointLocation3D(c.pointGeometry.convert(h))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(h,r,l){if("mouseenter"===h||"mouseover"===h){let p=!1;const _=S=>{const A=r.filter(V=>this.getLayer(V)),R=A.length?this.queryRenderedFeatures(S.point,{layers:A}):[];R.length?p||(p=!0,l.call(this,new Ii(h,this,S.originalEvent,{features:R}))):p=!1},b=()=>{p=!1};return{layers:new Set(r),listener:l,delegates:{mousemove:_,mouseout:b}}}if("mouseleave"===h||"mouseout"===h){let p=!1;const _=S=>{const A=r.filter(R=>this.getLayer(R));(A.length?this.queryRenderedFeatures(S.point,{layers:A}):[]).length?p=!0:p&&(p=!1,l.call(this,new Ii(h,this,S.originalEvent)))},b=S=>{p&&(p=!1,l.call(this,new Ii(h,this,S.originalEvent)))};return{layers:new Set(r),listener:l,delegates:{mousemove:_,mouseout:b}}}{const p=_=>{const b=r.filter(A=>this.getLayer(A)),S=b.length?this.queryRenderedFeatures(_.point,{layers:b}):[];S.length&&(_.features=S,l.call(this,_),delete _.features)};return{layers:new Set(r),listener:l,delegates:{[h]:p}}}}on(h,r,l){if(void 0===l)return super.on(h,r);Array.isArray(r)||(r=[r]);const p=this._createDelegatedListener(h,r,l);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[h]=this._delegatedListeners[h]||[],this._delegatedListeners[h].push(p);for(const _ in p.delegates)this.on(_,p.delegates[_]);return this}once(h,r,l){if(void 0===l)return super.once(h,r);Array.isArray(r)||(r=[r]);const p=this._createDelegatedListener(h,r,l);for(const _ in p.delegates)this.once(_,p.delegates[_]);return this}off(h,r,l){if(void 0===l)return super.off(h,r);r=new Set(Array.isArray(r)?r:[r]);const p=(b,S)=>{if(b.size!==S.size)return!1;for(const A of b)if(!S.has(A))return!1;return!0},_=this._delegatedListeners?this._delegatedListeners[h]:void 0;return _&&(b=>{for(let S=0;S<b.length;S++){const A=b[S];if(A.listener===l&&p(A.layers,r)){for(const R in A.delegates)this.off(R,A.delegates[R]);return b.splice(S,1),this}}})(_),this}queryRenderedFeatures(h,r){return this.style?(void 0!==r||void 0===h||h instanceof c.pointGeometry||Array.isArray(h)||(r=h,h=void 0),this.style.queryRenderedFeatures(h=h||[[0,0],[this.transform.width,this.transform.height]],r=r||{},this.transform)):[]}querySourceFeatures(h,r){return this.style.querySourceFeatures(h,r)}setStyle(h,r){return!1!==(r=c.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},r)).diff&&r.localIdeographFontFamily===this._localIdeographFontFamily&&r.localFontFamily===this._localFontFamily&&this.style&&h?(this._diffStyle(h,r),this):(this._localIdeographFontFamily=r.localIdeographFontFamily,this._localFontFamily=r.localFontFamily,this._updateStyle(h,r))}_getUIString(h){const r=this._locale[h];if(null==r)throw new Error(`Missing UI string '${h}'`);return r}_updateStyle(h,r){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),h&&(this.style=new ci(this,r||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof h?this.style.loadURL(h):this.style.loadJSON(h)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new ci(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(h,r){if("string"==typeof h){const l=this._requestManager.normalizeStyleURL(h),p=this._requestManager.transformRequest(l,c.ResourceType.Style);c.getJSON(p,(_,b)=>{_?this.fire(new c.ErrorEvent(_)):b&&this._updateDiff(b,r)})}else"object"==typeof h&&this._updateDiff(h,r)}_updateDiff(h,r){try{this.style.setState(h)&&this._update(!0)}catch(l){c.warnOnce(`Unable to perform style diff: ${l.message||l.error||l}.  Rebuilding the style from scratch.`),this._updateStyle(h,r)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(c.warnOnce("There is no style added to the map."),!1)}addSource(h,r){return this._lazyInitEmptyStyle(),this.style.addSource(h,r),this._update(!0)}isSourceLoaded(h){return!!this.style&&this.style._isSourceCacheLoaded(h)}areTilesLoaded(){const h=this.style&&this.style._sourceCaches;for(const r in h){const l=h[r]._tiles;for(const p in l){const _=l[p];if("loaded"!==_.state&&"errored"!==_.state)return!1}}return!0}addSourceType(h,r,l){this._lazyInitEmptyStyle(),this.style.addSourceType(h,r,l)}removeSource(h){return this.style.removeSource(h),this._updateTerrain(),this._update(!0)}getSource(h){return this.style.getSource(h)}addImage(h,r,{pixelRatio:l=1,sdf:p=!1,stretchX:_,stretchY:b,content:S}={}){if(this._lazyInitEmptyStyle(),r instanceof c.window.HTMLImageElement||c.window.ImageBitmap&&r instanceof c.window.ImageBitmap){const{width:A,height:R,data:V}=c.exported.getImageData(r);this.style.addImage(h,{data:new c.RGBAImage({width:A,height:R},V),pixelRatio:l,stretchX:_,stretchY:b,content:S,sdf:p,version:0})}else if(void 0===r.width||void 0===r.height)this.fire(new c.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:A,height:R}=r,V=r;this.style.addImage(h,{data:new c.RGBAImage({width:A,height:R},new Uint8Array(V.data)),pixelRatio:l,stretchX:_,stretchY:b,content:S,sdf:p,version:0,userImage:V}),V.onAdd&&V.onAdd(this,h)}}updateImage(h,r){const l=this.style.getImage(h);if(!l)return void this.fire(new c.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const p=r instanceof c.window.HTMLImageElement||c.window.ImageBitmap&&r instanceof c.window.ImageBitmap?c.exported.getImageData(r):r,{width:_,height:b}=p;void 0!==_&&void 0!==b?_===l.data.width&&b===l.data.height?(l.data.replace(p.data,!(r instanceof c.window.HTMLImageElement||c.window.ImageBitmap&&r instanceof c.window.ImageBitmap)),this.style.updateImage(h,l)):this.fire(new c.ErrorEvent(new Error(`The width and height of the updated image (${_}, ${b})\n                must be that same as the previous version of the image\n                (${l.data.width}, ${l.data.height})`))):this.fire(new c.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(h){return h?!!this.style.getImage(h):(this.fire(new c.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(h){this.style.removeImage(h)}loadImage(h,r){c.getImage(this._requestManager.transformRequest(h,c.ResourceType.Image),(l,p)=>{r(l,p instanceof c.window.HTMLImageElement?c.exported.getImageData(p):p)})}listImages(){return this.style.listImages()}addLayer(h,r){return this._lazyInitEmptyStyle(),this.style.addLayer(h,r),this._update(!0)}moveLayer(h,r){return this.style.moveLayer(h,r),this._update(!0)}removeLayer(h){return this.style.removeLayer(h),this._update(!0)}getLayer(h){return this.style.getLayer(h)}setLayerZoomRange(h,r,l){return this.style.setLayerZoomRange(h,r,l),this._update(!0)}setFilter(h,r,l={}){return this.style.setFilter(h,r,l),this._update(!0)}getFilter(h){return this.style.getFilter(h)}setPaintProperty(h,r,l,p={}){return this.style.setPaintProperty(h,r,l,p),this._update(!0)}getPaintProperty(h,r){return this.style.getPaintProperty(h,r)}setLayoutProperty(h,r,l,p={}){return this.style.setLayoutProperty(h,r,l,p),this._update(!0)}getLayoutProperty(h,r){return this.style.getLayoutProperty(h,r)}setLight(h,r={}){return this._lazyInitEmptyStyle(),this.style.setLight(h,r),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(h){return this._lazyInitEmptyStyle(),!h&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(h),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(h){return this._lazyInitEmptyStyle(),this.style.setFog(h),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(h){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(c.LngLat.convert(h),this.transform):0}setFeatureState(h,r){return this.style.setFeatureState(h,r),this._update()}removeFeatureState(h,r){return this.style.removeFeatureState(h,r),this._update()}getFeatureState(h){return this.style.getFeatureState(h)}_updateContainerDimensions(){if(!this._container)return;const h=this._container.getBoundingClientRect().width||400,r=this._container.getBoundingClientRect().height||300;let l,p,_,b=this._container;for(;b&&(!p||!_);){const S=c.window.getComputedStyle(b).transform;S&&"none"!==S&&(l=S.match(/matrix.*\((.+)\)/)[1].split(", "),l[0]&&"0"!==l[0]&&"1"!==l[0]&&(p=l[0]),l[3]&&"0"!==l[3]&&"1"!==l[3]&&(_=l[3])),b=b.parentElement}this._containerWidth=p?Math.abs(h/p):h,this._containerHeight=_?Math.abs(r/_):r}_detectMissingCSS(){"rgb(250, 128, 114)"!==c.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&c.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const h=this._container;h.classList.add("mapboxgl-map"),(this._missingCSSCanary=bt("div","mapboxgl-canary",h)).style.visibility="hidden",this._detectMissingCSS();const r=this._canvasContainer=bt("div","mapboxgl-canvas-container",h);this._interactive&&r.classList.add("mapboxgl-interactive"),this._canvas=bt("canvas","mapboxgl-canvas",r),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const l=this._controlContainer=bt("div","mapboxgl-control-container",h),p=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(_=>{p[_]=bt("div",`mapboxgl-ctrl-${_}`,l)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(h,r){const l=c.exported.devicePixelRatio||1;this._canvas.width=l*Math.ceil(h),this._canvas.height=l*Math.ceil(r),this._canvas.style.width=`${h}px`,this._canvas.style.height=`${r}px`}_addMarker(h){this._markers.push(h)}_removeMarker(h){const r=this._markers.indexOf(h);-1!==r&&this._markers.splice(r,1)}_addPopup(h){this._popups.push(h)}_removePopup(h){const r=this._popups.indexOf(h);-1!==r&&this._popups.splice(r,1)}_setupPainter(){const h=c.extend({},Ht.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),r=this._canvas.getContext("webgl",h)||this._canvas.getContext("experimental-webgl",h);r?(c.storeAuthState(r,!0),this.painter=new W(r,this.transform),this.on("data",l=>{"source"===l.dataType&&this.painter.setTileLoadedFlag(!0)}),c.exported$1.testSupport(r)):this.fire(new c.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(h){h.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new c.Event("webglcontextlost",{originalEvent:h}))}_contextRestored(h){this._setupPainter(),this.resize(),this._update(),this.fire(new c.Event("webglcontextrestored",{originalEvent:h}))}_onMapScroll(h){if(h.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(h){return this.style?(this._styleDirty=this._styleDirty||h,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(h){return this._update(),this._renderTaskQueue.add(h)}_cancelRenderFrame(h){this._renderTaskQueue.remove(h)}_requestDomTask(h){!this.loaded()||this.loaded()&&!this.isMoving()?h():this._domRenderTaskQueue.add(h)}_render(h){let r;const l=this.painter.context.extTimerQuery,p=c.exported.now();if(this.listens("gpu-timing-frame")&&(r=l.createQueryEXT(),l.beginQueryEXT(l.TIME_ELAPSED_EXT,r)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],c.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],c.window.performance.now())),this._renderTaskQueue.run(h),this._domRenderTaskQueue.run(h),this._removed)return;this._updateProjectionTransition();const _=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const A=this.transform.zoom,R=this.transform.pitch,V=c.exported.now(),j=new c.EvaluationParameters(A,{now:V,fadeDuration:_,pitch:R,transition:this.style.getTransition()});this.style.update(j)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let b=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),b=this._updateAverageElevation(p),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):b=this._updateAverageElevation(p),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,_,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:_,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new c.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new c.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),r){const A=c.exported.now()-p;l.endQueryEXT(l.TIME_ELAPSED_EXT,r),setTimeout(()=>{const R=l.getQueryObjectEXT(r,l.QUERY_RESULT_EXT)/1e6;l.deleteQueryEXT(r),this.fire(new c.Event("gpu-timing-frame",{cpuTime:A,gpuTime:R})),c.window.performance.mark("frame-gpu",{startTime:p,detail:{gpuTime:R}})},50)}if(this.listens("gpu-timing-layer")){const A=this.painter.collectGpuTimers();setTimeout(()=>{const R=this.painter.queryGpuTimers(A);this.fire(new c.Event("gpu-timing-layer",{layerTimes:R}))},50)}if(this.listens("gpu-timing-deferred-render")){const A=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const R=this.painter.queryGpuTimeDeferredRender(A);this.fire(new c.Event("gpu-timing-deferred-render",{gpuTime:R}))},50)}const S=this._sourcesDirty||this._styleDirty||this._placementDirty||b;if(S||this._repaint)this.triggerRepaint();else{const A=!this.isMoving()&&this.loaded();if(A&&(b=this._updateAverageElevation(p,!0)),b)this.triggerRepaint();else if(this._triggerFrame(!1),A&&(this.fire(new c.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const R=this._calculateSpeedIndex();this.fire(new c.Event("speedindexcompleted",{speedIndex:R})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||S||(this._fullyLoaded=!0,c.LivePerformanceUtils.mark(c.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&c.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(h){for(const r of this._markers)h&&!this.getRenderWorldCopies()&&(r._lngLat=r._lngLat.wrap()),r._update();for(const r of this._popups)!h||this.getRenderWorldCopies()||r._trackPointer||(r._lngLat=r._lngLat.wrap()),r._update()}_updateAverageElevation(h,r=!1){const l=p=>(this.transform.averageElevation=p,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&l(0);if((r||h-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(h)){const p=this.transform.averageElevation;let _=this.transform.sampleAverageElevation(),b=!1;this.transform.elevation&&(b=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(_)?_=0:this._averageElevationLastSampledAt=h;const S=Math.abs(p-_);if(S>1){if(this._isInitialLoad||b)return this._averageElevation.jumpTo(_),l(_);this._averageElevation.easeTo(_,h,300)}else if(S>1e-4)return this._averageElevation.jumpTo(_),l(_)}return!!this._averageElevation.isEasing(h)&&l(this._averageElevation.getValue(h))}_authenticate(){c.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,h=>{if(h&&(h.message===c.AUTH_ERR_MSG||401===h.status)){const r=this.painter.context.gl;c.storeAuthState(r,!1),this._logoControl instanceof ua&&this._logoControl._updateLogo(),r&&r.clear(r.DEPTH_BUFFER_BIT|r.COLOR_BUFFER_BIT|r.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new c.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),c.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const h=this._isDragging();this.painter.updateTerrain(this.style,h)}_calculateSpeedIndex(){const h=this.painter.canvasCopy(),r=this.painter.getCanvasCopiesAndTimestamps();r.timeStamps.push(performance.now());const l=this.painter.context.gl,p=l.createFramebuffer();function _(b){l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,b,0);const S=new Uint8Array(l.drawingBufferWidth*l.drawingBufferHeight*4);return l.readPixels(0,0,l.drawingBufferWidth,l.drawingBufferHeight,l.RGBA,l.UNSIGNED_BYTE,S),S}return l.bindFramebuffer(l.FRAMEBUFFER,p),this._canvasPixelComparison(_(h),r.canvasCopies.map(_),r.timeStamps)}_canvasPixelComparison(h,r,l){let p=l[1]-l[0];const _=h.length/4;for(let b=0;b<r.length;b++){const S=r[b];let A=0;for(let R=0;R<S.length;R+=4)S[R]===h[R]&&S[R+1]===h[R+1]&&S[R+2]===h[R+2]&&S[R+3]===h[R+3]&&(A+=1);p+=(l[b+2]-l[b+1])*(1-A/_)}return p}remove(){this._hash&&this._hash.remove();for(const r of this._controls)r.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==c.window&&(c.window.removeEventListener("resize",this._onWindowResize,!1),c.window.removeEventListener("orientationchange",this._onWindowResize,!1),c.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),c.window.removeEventListener("online",this._onWindowOnline,!1),c.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const h=this.painter.context.gl.getExtension("WEBGL_lose_context");h&&h.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),c.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new c.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(h){this._renderNextFrame=this._renderNextFrame||h,this.style&&!this._frame&&(this._frame=c.exported.frame(r=>{const l=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,l&&this._render(r)}))}_preloadTiles(h){const r=this.style?Object.values(this.style._sourceCaches):[];return c.asyncAll(r,(l,p)=>l._preloadTiles(h,p),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(h){this._trackResize&&this.resize({originalEvent:h})._update()}_onVisibilityChange(){"hidden"===c.window.document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(h){this._showTileBoundaries!==h&&(this._showTileBoundaries=h,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(h){this._showTerrainWireframe!==h&&(this._showTerrainWireframe=h,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(h){this._speedIndexTiming!==h&&(this._speedIndexTiming=h,this._update())}get showPadding(){return!!this._showPadding}set showPadding(h){this._showPadding!==h&&(this._showPadding=h,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(h){this._showCollisionBoxes!==h&&(this._showCollisionBoxes=h,h?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(h){this._showOverdrawInspector!==h&&(this._showOverdrawInspector=h,this._update())}get repaint(){return!!this._repaint}set repaint(h){this._repaint!==h&&(this._repaint=h,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(h){this._vertices=h,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(h){this._showTileAABBs!==h&&(this._showTileAABBs=h,h&&this._update())}_setCacheLimits(h,r){c.setCacheLimits(h,r)}get version(){return c.version}},NavigationControl:class{constructor(h){this.options=c.extend({},Su,h),this._container=bt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",r=>r.preventDefault()),this.options.showZoom&&(c.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",r=>{this._map&&this._map.zoomIn({},{originalEvent:r})}),bt("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",r=>{this._map&&this._map.zoomOut({},{originalEvent:r})}),bt("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(c.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",r=>{const l=this._map;l&&(this.options.visualizePitch?l.resetNorthPitch({},{originalEvent:r}):l.resetNorth({},{originalEvent:r}))}),this._compassIcon=bt("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const h=this._map;if(!h)return;const r=h.getZoom(),l=r===h.getMaxZoom(),p=r===h.getMinZoom();this._zoomInButton.disabled=l,this._zoomOutButton.disabled=p,this._zoomInButton.setAttribute("aria-disabled",l.toString()),this._zoomOutButton.setAttribute("aria-disabled",p.toString())}_rotateCompassArrow(){const h=this._map;if(!h)return;const r=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(h.transform.pitch*(Math.PI/180)),.5)}) rotateX(${h.transform.pitch}deg) rotateZ(${h.transform.angle*(180/Math.PI)}deg)`:`rotate(${h.transform.angle*(180/Math.PI)}deg)`;h._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=r)})}onAdd(h){return this._map=h,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),h.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&h.on("pitch",this._rotateCompassArrow),h.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new _h(h,this._compass,this.options.visualizePitch)),this._container}onRemove(){const h=this._map;h&&(this._container.remove(),this.options.showZoom&&h.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&h.off("pitch",this._rotateCompassArrow),h.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(h,r){const l=bt("button",h,this._container);return l.type="button",l.addEventListener("click",r),l}_setButtonTitle(h,r){if(!this._map)return;const l=this._map._getUIString(`NavigationControl.${r}`);h.setAttribute("aria-label",l),h.firstElementChild&&h.firstElementChild.setAttribute("title",l)}},GeolocateControl:class extends c.Evented{constructor(h){super(),this.options=c.extend({geolocation:c.window.navigator.geolocation},di,h),c.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Do(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(h){return this._map=h,this._container=bt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(h){const r=(l=!!this.options.geolocation)=>{this._supportsGeolocation=l,h(l)};void 0!==this._supportsGeolocation?h(this._supportsGeolocation):void 0!==c.window.navigator.permissions?c.window.navigator.permissions.query({name:"geolocation"}).then(l=>r("denied"!==l.state)).catch(()=>r()):r()}_isOutOfMapMaxBounds(h){const r=this._map.getMaxBounds(),l=h.coords;return!!r&&(l.longitude<r.getWest()||l.longitude>r.getEast()||l.latitude<r.getSouth()||l.latitude>r.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(h){if(this._map){if(this._isOutOfMapMaxBounds(h))return this._setErrorState(),this.fire(new c.Event("outofmaxbounds",h)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=h,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(h),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(h),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new c.Event("geolocate",h)),this._finish()}}_updateCamera(h){const r=new c.LngLat(h.coords.longitude,h.coords.latitude),l=h.coords.accuracy,p=this._map.getBearing(),_=c.extend({bearing:p},this.options.fitBoundsOptions);this._map.fitBounds(r.toBounds(l),_,{geolocateSource:!0})}_updateMarker(h){if(h){const r=new c.LngLat(h.coords.longitude,h.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=h.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const h=this._map.transform,r=c.mercatorZfromAltitude(1,h._center.lat)*h.worldSize,l=Math.ceil(2*this._accuracy*r);this._circleElement.style.width=`${l}px`,this._circleElement.style.height=`${l}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(h){if(this._map){if(this.options.trackUserLocation)if(1===h.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===h.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new c.Event("error",h)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(h){if(void 0!==this._map){if(this._container.addEventListener("contextmenu",r=>r.preventDefault()),this._geolocateButton=bt("button","mapboxgl-ctrl-geolocate",this._container),bt("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===h){c.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}else{const r=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=bt("div","mapboxgl-user-location"),this._dotElement.appendChild(bt("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(bt("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Zc({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=bt("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Zc({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",r=>{r.geolocateSource||"ACTIVE_LOCK"!==this._watchState||r.originalEvent&&"resize"===r.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new c.Event("trackuserlocationend")))})}}_onDeviceOrientation(h){this._userLocationDotMarker&&(h.webkitCompassHeading?this._heading=h.webkitCompassHeading:!0===h.absolute&&(this._heading=-1*h.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return c.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new c.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new c.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new c.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let h;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(h={maximumAge:6e5,timeout:0},this._noTimeout=!0):(h=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,h),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const h=()=>{c.window.addEventListener("ondeviceorientationabsolute"in c.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};void 0!==c.window.DeviceMotionEvent&&"function"==typeof c.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(r=>{"granted"===r&&h()}).catch(console.error):h()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),c.window.removeEventListener("deviceorientation",this._onDeviceOrientation),c.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:As,ScaleControl:class{constructor(h){this.options=c.extend({},qc,h),function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"narrow",unit:"meter"}),!0}catch{return!1}}()||(this._setScale=gs.bind(this)),c.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const h=this.options.maxWidth||100,r=this._map,l=r._containerHeight/2,p=r._containerWidth/2-h/2,_=r.unproject([p,l]),b=r.unproject([p+h,l]),S=_.distanceTo(b);if("imperial"===this.options.unit){const A=3.2808*S;A>5280?this._setScale(h,A/5280,"mile"):this._setScale(h,A,"foot")}else"nautical"===this.options.unit?this._setScale(h,S/1852,"nautical-mile"):S>=1e3?this._setScale(h,S/1e3,"kilometer"):this._setScale(h,S,"meter")}_setScale(h,r,l){const p=Iu(r),_=p/r;this._map._requestDomTask(()=>{this._container.style.width=h*_+"px",this._container.innerHTML="nautical-mile"!==l?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"narrow",unit:l}).format(p):`${p}&nbsp;nm`})}onAdd(h){return this._map=h,this._language=h.getLanguage(),this._container=bt("div","mapboxgl-ctrl mapboxgl-ctrl-scale",h.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(h){this._language=h,this._update()}setUnit(h){this.options.unit=h,this._update()}},FullscreenControl:class{constructor(h){this._fullscreen=!1,h&&h.container&&(h.container instanceof c.window.HTMLElement?this._container=h.container:c.warnOnce("Full screen control 'container' must be a DOM element.")),c.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in c.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in c.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(h){return this._map=h,this._container||(this._container=this._map.getContainer()),this._controlContainer=bt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",c.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,c.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!c.window.document.fullscreenEnabled&&!c.window.document.webkitFullscreenEnabled)}_setupUI(){const h=this._fullscreenButton=bt("button","mapboxgl-ctrl-fullscreen",this._controlContainer);bt("span","mapboxgl-ctrl-icon",h).setAttribute("aria-hidden","true"),h.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),c.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const h=this._getTitle();this._fullscreenButton.setAttribute("aria-label",h),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",h)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(c.window.document.fullscreenElement||c.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?c.window.document.exitFullscreen?c.window.document.exitFullscreen():c.window.document.webkitCancelFullScreen&&c.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends c.Evented{constructor(h){super(),this.options=c.extend(Object.create(Dc),h),c.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(h&&h.className?h.className.trim().split(/\s+/):[])}addTo(h){return this._map&&this.remove(),this._map=h,this.options.closeOnClick&&h.on("preclick",this._onClose),this.options.closeOnMove&&h.on("move",this._onClose),h.on("remove",this.remove),this._update(),h._addPopup(this),this._focusFirstElement(),this._trackPointer?(h.on("mousemove",this._onMouseEvent),h.on("mouseup",this._onMouseEvent),h._canvasContainer.classList.add("mapboxgl-track-pointer")):h.on("move",this._update),this.fire(new c.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const h=this._map;return h&&(h.off("move",this._update),h.off("move",this._onClose),h.off("preclick",this._onClose),h.off("click",this._onClose),h.off("remove",this.remove),h.off("mousemove",this._onMouseEvent),h.off("mouseup",this._onMouseEvent),h.off("drag",this._onMouseEvent),h._canvasContainer&&h._canvasContainer.classList.remove("mapboxgl-track-pointer"),h._removePopup(this),this._map=void 0),this.fire(new c.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(h){this._lngLat=c.LngLat.convert(h),this._pos=null,this._trackPointer=!1,this._update();const r=this._map;return r&&(r.on("move",this._update),r.off("mousemove",this._onMouseEvent),r._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const h=this._map;return h&&(h.off("move",this._update),h.on("mousemove",this._onMouseEvent),h.on("drag",this._onMouseEvent),h._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(h){return this.setDOMContent(c.window.document.createTextNode(h))}setHTML(h){const r=c.window.document.createDocumentFragment(),l=c.window.document.createElement("body");let p;for(l.innerHTML=h;p=l.firstChild,p;)r.appendChild(p);return this.setDOMContent(r)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(h){return this.options.maxWidth=h,this._update(),this}setDOMContent(h){let r=this._content;if(r)for(;r.hasChildNodes();)r.firstChild&&r.removeChild(r.firstChild);else r=this._content=bt("div","mapboxgl-popup-content",this._container||void 0);if(r.appendChild(h),this.options.closeButton){const l=this._closeButton=bt("button","mapboxgl-popup-close-button",r);l.type="button",l.setAttribute("aria-label","Close popup"),l.setAttribute("aria-hidden","true"),l.innerHTML="&#215;",l.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(h){return this._classList.add(h),this._updateClassList(),this}removeClassName(h){return this._classList.delete(h),this._updateClassList(),this}setOffset(h){return this.options.offset=h,this._update(),this}toggleClassName(h){let r;return this._classList.delete(h)?r=!1:(this._classList.add(h),r=!0),this._updateClassList(),r}_onMouseEvent(h){this._update(h.point)}_getAnchor(h){if(this.options.anchor)return this.options.anchor;const r=this._map,l=this._container,p=this._pos;if(!r||!l||!p)return"bottom";const _=l.offsetWidth,b=l.offsetHeight,S=p.x<_/2,A=p.x>r.transform.width-_/2;if(p.y+h<b)return S?"top-left":A?"top-right":"top";if(p.y>r.transform.height-b){if(S)return"bottom-left";if(A)return"bottom-right"}return S?"left":A?"right":"bottom"}_updateClassList(){const h=this._container;if(!h)return;const r=[...this._classList];r.push("mapboxgl-popup"),this._anchor&&r.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&r.push("mapboxgl-popup-track-pointer"),h.className=r.join(" ")}_update(h){const r=this._map,l=this._content;if(!r||!this._lngLat&&!this._trackPointer||!l)return;let p=this._container;if(p||(p=this._container=bt("div","mapboxgl-popup",r.getContainer()),this._tip=bt("div","mapboxgl-popup-tip",p),p.appendChild(l)),this.options.maxWidth&&p.style.maxWidth!==this.options.maxWidth&&(p.style.maxWidth=this.options.maxWidth),r.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Sr(this._lngLat,this._pos,r.transform)),!this._trackPointer||h){const _=this._pos=this._trackPointer&&h?h:r.project(this._lngLat),b=Tc(this.options.offset),S=this._anchor=this._getAnchor(b.y),A=Tc(this.options.offset,S),R=_.add(A).round();r._requestDomTask(()=>{this._container&&S&&(this._container.style.transform=`${Ec[S]} translate(${R.x}px,${R.y}px)`)})}if(!this._marker&&r._showingGlobe()){const _=c.isLngLatBehindGlobe(r.transform,this._lngLat)?0:1;this._setOpacity(_)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const h=this._container.querySelector(Cu);h&&h.focus()}_onClose(){this.remove()}_setOpacity(h){this._container&&(this._container.style.opacity=`${h}`),this._content&&(this._content.style.pointerEvents=h?"auto":"none")}},Marker:Zc,Style:ci,LngLat:c.LngLat,LngLatBounds:c.LngLatBounds,Point:c.pointGeometry,MercatorCoordinate:c.MercatorCoordinate,FreeCameraOptions:rt,Evented:c.Evented,config:c.config,prewarm:function(){yt().acquire(lt)},clearPrewarmedResources:function(){const h=Ct;h&&(h.isPreloaded()&&1===h.numActive()?(h.release(lt),Ct=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return c.config.ACCESS_TOKEN},set accessToken(h){c.config.ACCESS_TOKEN=h},get baseApiUrl(){return c.config.API_URL},set baseApiUrl(h){c.config.API_URL=h},get workerCount(){return mt.workerCount},set workerCount(h){mt.workerCount=h},get maxParallelImageRequests(){return c.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(h){c.config.MAX_PARALLEL_IMAGE_REQUESTS=h},clearStorage(h){c.clearTileCache(h)},workerUrl:"",workerClass:null,setNow:c.exported.setNow,restoreNow:c.exported.restoreNow};return Oi}),K}()},751:(er,Nt,Me)=>{"use strict";Me.d(Nt,{y:()=>kt});var K=Me(961),Ie=Me(727),Dt=Me(822),c=Me(635),Ee=Me(416),Ht=Me(576),Vt=Me(806);let kt=(()=>{class Pt{constructor(_t){_t&&(this._subscribe=_t)}lift(_t){const Qt=new Pt;return Qt.source=this,Qt.operator=_t,Qt}subscribe(_t,Qt,nn){const Ut=function Je(Pt){return Pt&&Pt instanceof K.Lv||function gt(Pt){return Pt&&(0,Ht.m)(Pt.next)&&(0,Ht.m)(Pt.error)&&(0,Ht.m)(Pt.complete)}(Pt)&&(0,Ie.Nn)(Pt)}(_t)?_t:new K.Hp(_t,Qt,nn);return(0,Vt.x)(()=>{const{operator:Qe,source:sr}=this;Ut.add(Qe?Qe.call(Ut,sr):sr?this._subscribe(Ut):this._trySubscribe(Ut))}),Ut}_trySubscribe(_t){try{return this._subscribe(_t)}catch(Qt){_t.error(Qt)}}forEach(_t,Qt){return new(Qt=bt(Qt))((nn,Ut)=>{const Qe=new K.Hp({next:sr=>{try{_t(sr)}catch(jt){Ut(jt),Qe.unsubscribe()}},error:Ut,complete:nn});this.subscribe(Qe)})}_subscribe(_t){var Qt;return null===(Qt=this.source)||void 0===Qt?void 0:Qt.subscribe(_t)}[Dt.L](){return this}pipe(..._t){return(0,c.U)(_t)(this)}toPromise(_t){return new(_t=bt(_t))((Qt,nn)=>{let Ut;this.subscribe(Qe=>Ut=Qe,Qe=>nn(Qe),()=>Qt(Ut))})}}return Pt.create=sn=>new Pt(sn),Pt})();function bt(Pt){var sn;return null!==(sn=Pt??Ee.v.Promise)&&void 0!==sn?sn:Promise}},579:(er,Nt,Me)=>{"use strict";Me.d(Nt,{x:()=>Vt});var K=Me(751),Ie=Me(727);const c=(0,Me(888).d)(bt=>function(){bt(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var Ee=Me(737),Ht=Me(806);let Vt=(()=>{class bt extends K.y{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(Je){const Pt=new kt(this,this);return Pt.operator=Je,Pt}_throwIfClosed(){if(this.closed)throw new c}next(Je){(0,Ht.x)(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const Pt of this.currentObservers)Pt.next(Je)}})}error(Je){(0,Ht.x)(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=Je;const{observers:Pt}=this;for(;Pt.length;)Pt.shift().error(Je)}})}complete(){(0,Ht.x)(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:Je}=this;for(;Je.length;)Je.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var Je;return(null===(Je=this.observers)||void 0===Je?void 0:Je.length)>0}_trySubscribe(Je){return this._throwIfClosed(),super._trySubscribe(Je)}_subscribe(Je){return this._throwIfClosed(),this._checkFinalizedStatuses(Je),this._innerSubscribe(Je)}_innerSubscribe(Je){const{hasError:Pt,isStopped:sn,observers:_t}=this;return Pt||sn?Ie.Lc:(this.currentObservers=null,_t.push(Je),new Ie.w0(()=>{this.currentObservers=null,(0,Ee.P)(_t,Je)}))}_checkFinalizedStatuses(Je){const{hasError:Pt,thrownError:sn,isStopped:_t}=this;Pt?Je.error(sn):_t&&Je.complete()}asObservable(){const Je=new K.y;return Je.source=this,Je}}return bt.create=(gt,Je)=>new kt(gt,Je),bt})();class kt extends Vt{constructor(gt,Je){super(),this.destination=gt,this.source=Je}next(gt){var Je,Pt;null===(Pt=null===(Je=this.destination)||void 0===Je?void 0:Je.next)||void 0===Pt||Pt.call(Je,gt)}error(gt){var Je,Pt;null===(Pt=null===(Je=this.destination)||void 0===Je?void 0:Je.error)||void 0===Pt||Pt.call(Je,gt)}complete(){var gt,Je;null===(Je=null===(gt=this.destination)||void 0===gt?void 0:gt.complete)||void 0===Je||Je.call(gt)}_subscribe(gt){var Je,Pt;return null!==(Pt=null===(Je=this.source)||void 0===Je?void 0:Je.subscribe(gt))&&void 0!==Pt?Pt:Ie.Lc}}},961:(er,Nt,Me)=>{"use strict";Me.d(Nt,{Hp:()=>nn,Lv:()=>Pt});var K=Me(576),Ie=Me(727),Dt=Me(416),c=Me(849);function Ee(){}const Ht=bt("C",void 0,void 0);function bt($t,qe,Xt){return{kind:$t,value:qe,error:Xt}}var gt=Me(410),Je=Me(806);class Pt extends Ie.w0{constructor(qe){super(),this.isStopped=!1,qe?(this.destination=qe,(0,Ie.Nn)(qe)&&qe.add(this)):this.destination=jt}static create(qe,Xt,ar){return new nn(qe,Xt,ar)}next(qe){this.isStopped?sr(function kt($t){return bt("N",$t,void 0)}(qe),this):this._next(qe)}error(qe){this.isStopped?sr(function Vt($t){return bt("E",void 0,$t)}(qe),this):(this.isStopped=!0,this._error(qe))}complete(){this.isStopped?sr(Ht,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(qe){this.destination.next(qe)}_error(qe){try{this.destination.error(qe)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const sn=Function.prototype.bind;function _t($t,qe){return sn.call($t,qe)}class Qt{constructor(qe){this.partialObserver=qe}next(qe){const{partialObserver:Xt}=this;if(Xt.next)try{Xt.next(qe)}catch(ar){Ut(ar)}}error(qe){const{partialObserver:Xt}=this;if(Xt.error)try{Xt.error(qe)}catch(ar){Ut(ar)}else Ut(qe)}complete(){const{partialObserver:qe}=this;if(qe.complete)try{qe.complete()}catch(Xt){Ut(Xt)}}}class nn extends Pt{constructor(qe,Xt,ar){let ut;if(super(),(0,K.m)(qe)||!qe)ut={next:qe??void 0,error:Xt??void 0,complete:ar??void 0};else{let Bt;this&&Dt.v.useDeprecatedNextContext?(Bt=Object.create(qe),Bt.unsubscribe=()=>this.unsubscribe(),ut={next:qe.next&&_t(qe.next,Bt),error:qe.error&&_t(qe.error,Bt),complete:qe.complete&&_t(qe.complete,Bt)}):ut=qe}this.destination=new Qt(ut)}}function Ut($t){Dt.v.useDeprecatedSynchronousErrorHandling?(0,Je.O)($t):(0,c.h)($t)}function sr($t,qe){const{onStoppedNotification:Xt}=Dt.v;Xt&&gt.z.setTimeout(()=>Xt($t,qe))}const jt={closed:!0,next:Ee,error:function Qe($t){throw $t},complete:Ee}},727:(er,Nt,Me)=>{"use strict";Me.d(Nt,{Lc:()=>Ht,w0:()=>Ee,Nn:()=>Vt});var K=Me(576);const Dt=(0,Me(888).d)(bt=>function(Je){bt(this),this.message=Je?`${Je.length} errors occurred during unsubscription:\n${Je.map((Pt,sn)=>`${sn+1}) ${Pt.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=Je});var c=Me(737);class Ee{constructor(gt){this.initialTeardown=gt,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let gt;if(!this.closed){this.closed=!0;const{_parentage:Je}=this;if(Je)if(this._parentage=null,Array.isArray(Je))for(const _t of Je)_t.remove(this);else Je.remove(this);const{initialTeardown:Pt}=this;if((0,K.m)(Pt))try{Pt()}catch(_t){gt=_t instanceof Dt?_t.errors:[_t]}const{_finalizers:sn}=this;if(sn){this._finalizers=null;for(const _t of sn)try{kt(_t)}catch(Qt){gt=gt??[],Qt instanceof Dt?gt=[...gt,...Qt.errors]:gt.push(Qt)}}if(gt)throw new Dt(gt)}}add(gt){var Je;if(gt&&gt!==this)if(this.closed)kt(gt);else{if(gt instanceof Ee){if(gt.closed||gt._hasParent(this))return;gt._addParent(this)}(this._finalizers=null!==(Je=this._finalizers)&&void 0!==Je?Je:[]).push(gt)}}_hasParent(gt){const{_parentage:Je}=this;return Je===gt||Array.isArray(Je)&&Je.includes(gt)}_addParent(gt){const{_parentage:Je}=this;this._parentage=Array.isArray(Je)?(Je.push(gt),Je):Je?[Je,gt]:gt}_removeParent(gt){const{_parentage:Je}=this;Je===gt?this._parentage=null:Array.isArray(Je)&&(0,c.P)(Je,gt)}remove(gt){const{_finalizers:Je}=this;Je&&(0,c.P)(Je,gt),gt instanceof Ee&&gt._removeParent(this)}}Ee.EMPTY=(()=>{const bt=new Ee;return bt.closed=!0,bt})();const Ht=Ee.EMPTY;function Vt(bt){return bt instanceof Ee||bt&&"closed"in bt&&(0,K.m)(bt.remove)&&(0,K.m)(bt.add)&&(0,K.m)(bt.unsubscribe)}function kt(bt){(0,K.m)(bt)?bt():bt.unsubscribe()}},416:(er,Nt,Me)=>{"use strict";Me.d(Nt,{v:()=>K});const K={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1}},515:(er,Nt,Me)=>{"use strict";Me.d(Nt,{E:()=>Ie});const Ie=new(Me(751).y)(Ee=>Ee.complete())},76:(er,Nt,Me)=>{"use strict";Me.d(Nt,{D:()=>ar});var K=Me(421),Ie=Me(672),Dt=Me(482),c=Me(403);function Ee(ut,Bt=0){return(0,Dt.e)((wt,tt)=>{wt.subscribe((0,c.x)(tt,cn=>(0,Ie.f)(tt,ut,()=>tt.next(cn),Bt),()=>(0,Ie.f)(tt,ut,()=>tt.complete(),Bt),cn=>(0,Ie.f)(tt,ut,()=>tt.error(cn),Bt)))})}function Ht(ut,Bt=0){return(0,Dt.e)((wt,tt)=>{tt.add(ut.schedule(()=>wt.subscribe(tt),Bt))})}var bt=Me(751),Je=Me(202),Pt=Me(576);function _t(ut,Bt){if(!ut)throw new Error("Iterable cannot be null");return new bt.y(wt=>{(0,Ie.f)(wt,Bt,()=>{const tt=ut[Symbol.asyncIterator]();(0,Ie.f)(wt,Bt,()=>{tt.next().then(cn=>{cn.done?wt.complete():wt.next(cn.value)})},0,!0)})})}var Qt=Me(670),nn=Me(239),Ut=Me(144),Qe=Me(495),sr=Me(206),jt=Me(532),$t=Me(260);function ar(ut,Bt){return Bt?function Xt(ut,Bt){if(null!=ut){if((0,Qt.c)(ut))return function Vt(ut,Bt){return(0,K.Xf)(ut).pipe(Ht(Bt),Ee(Bt))}(ut,Bt);if((0,Ut.z)(ut))return function gt(ut,Bt){return new bt.y(wt=>{let tt=0;return Bt.schedule(function(){tt===ut.length?wt.complete():(wt.next(ut[tt++]),wt.closed||this.schedule())})})}(ut,Bt);if((0,nn.t)(ut))return function kt(ut,Bt){return(0,K.Xf)(ut).pipe(Ht(Bt),Ee(Bt))}(ut,Bt);if((0,sr.D)(ut))return _t(ut,Bt);if((0,Qe.T)(ut))return function sn(ut,Bt){return new bt.y(wt=>{let tt;return(0,Ie.f)(wt,Bt,()=>{tt=ut[Je.h](),(0,Ie.f)(wt,Bt,()=>{let cn,Nn;try{({value:cn,done:Nn}=tt.next())}catch(Jt){return void wt.error(Jt)}Nn?wt.complete():wt.next(cn)},0,!0)}),()=>(0,Pt.m)(tt?.return)&&tt.return()})}(ut,Bt);if((0,$t.L)(ut))return function qe(ut,Bt){return _t((0,$t.Q)(ut),Bt)}(ut,Bt)}throw(0,jt.z)(ut)}(ut,Bt):(0,K.Xf)(ut)}},421:(er,Nt,Me)=>{"use strict";Me.d(Nt,{Xf:()=>sn});var K=Me(655),Ie=Me(144),Dt=Me(239),c=Me(751),Ee=Me(670),Ht=Me(206),Vt=Me(532),kt=Me(495),bt=Me(260),gt=Me(576),Je=Me(849),Pt=Me(822);function sn($t){if($t instanceof c.y)return $t;if(null!=$t){if((0,Ee.c)($t))return function _t($t){return new c.y(qe=>{const Xt=$t[Pt.L]();if((0,gt.m)(Xt.subscribe))return Xt.subscribe(qe);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}($t);if((0,Ie.z)($t))return function Qt($t){return new c.y(qe=>{for(let Xt=0;Xt<$t.length&&!qe.closed;Xt++)qe.next($t[Xt]);qe.complete()})}($t);if((0,Dt.t)($t))return function nn($t){return new c.y(qe=>{$t.then(Xt=>{qe.closed||(qe.next(Xt),qe.complete())},Xt=>qe.error(Xt)).then(null,Je.h)})}($t);if((0,Ht.D)($t))return Qe($t);if((0,kt.T)($t))return function Ut($t){return new c.y(qe=>{for(const Xt of $t)if(qe.next(Xt),qe.closed)return;qe.complete()})}($t);if((0,bt.L)($t))return function sr($t){return Qe((0,bt.Q)($t))}($t)}throw(0,Vt.z)($t)}function Qe($t){return new c.y(qe=>{(function jt($t,qe){var Xt,ar,ut,Bt;return(0,K.mG)(this,void 0,void 0,function*(){try{for(Xt=(0,K.KL)($t);!(ar=yield Xt.next()).done;)if(qe.next(ar.value),qe.closed)return}catch(wt){ut={error:wt}}finally{try{ar&&!ar.done&&(Bt=Xt.return)&&(yield Bt.call(Xt))}finally{if(ut)throw ut.error}}qe.complete()})})($t,qe).catch(Xt=>qe.error(Xt))})}},403:(er,Nt,Me)=>{"use strict";Me.d(Nt,{x:()=>Ie});var K=Me(961);function Ie(c,Ee,Ht,Vt,kt){return new Dt(c,Ee,Ht,Vt,kt)}class Dt extends K.Lv{constructor(Ee,Ht,Vt,kt,bt,gt){super(Ee),this.onFinalize=bt,this.shouldUnsubscribe=gt,this._next=Ht?function(Je){try{Ht(Je)}catch(Pt){Ee.error(Pt)}}:super._next,this._error=kt?function(Je){try{kt(Je)}catch(Pt){Ee.error(Pt)}finally{this.unsubscribe()}}:super._error,this._complete=Vt?function(){try{Vt()}catch(Je){Ee.error(Je)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var Ee;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:Ht}=this;super.unsubscribe(),!Ht&&(null===(Ee=this.onFinalize)||void 0===Ee||Ee.call(this))}}}},4:(er,Nt,Me)=>{"use strict";Me.d(Nt,{U:()=>Dt});var K=Me(482),Ie=Me(403);function Dt(c,Ee){return(0,K.e)((Ht,Vt)=>{let kt=0;Ht.subscribe((0,Ie.x)(Vt,bt=>{Vt.next(c.call(Ee,bt,kt++))}))})}},189:(er,Nt,Me)=>{"use strict";Me.d(Nt,{J:()=>Dt});var K=Me(577),Ie=Me(671);function Dt(c=1/0){return(0,K.z)(Ie.y,c)}},577:(er,Nt,Me)=>{"use strict";Me.d(Nt,{z:()=>kt});var K=Me(4),Ie=Me(421),Dt=Me(482),c=Me(672),Ee=Me(403),Vt=Me(576);function kt(bt,gt,Je=1/0){return(0,Vt.m)(gt)?kt((Pt,sn)=>(0,K.U)((_t,Qt)=>gt(Pt,_t,sn,Qt))((0,Ie.Xf)(bt(Pt,sn))),Je):("number"==typeof gt&&(Je=gt),(0,Dt.e)((Pt,sn)=>function Ht(bt,gt,Je,Pt,sn,_t,Qt,nn){const Ut=[];let Qe=0,sr=0,jt=!1;const $t=()=>{jt&&!Ut.length&&!Qe&&gt.complete()},qe=ar=>Qe<Pt?Xt(ar):Ut.push(ar),Xt=ar=>{_t&&gt.next(ar),Qe++;let ut=!1;(0,Ie.Xf)(Je(ar,sr++)).subscribe((0,Ee.x)(gt,Bt=>{sn?.(Bt),_t?qe(Bt):gt.next(Bt)},()=>{ut=!0},void 0,()=>{if(ut)try{for(Qe--;Ut.length&&Qe<Pt;){const Bt=Ut.shift();Qt?(0,c.f)(gt,Qt,()=>Xt(Bt)):Xt(Bt)}$t()}catch(Bt){gt.error(Bt)}}))};return bt.subscribe((0,Ee.x)(gt,qe,()=>{jt=!0,$t()})),()=>{nn?.()}}(Pt,sn,bt,Je)))}},410:(er,Nt,Me)=>{"use strict";Me.d(Nt,{z:()=>K});const K={setTimeout(Ie,Dt,...c){const{delegate:Ee}=K;return Ee?.setTimeout?Ee.setTimeout(Ie,Dt,...c):setTimeout(Ie,Dt,...c)},clearTimeout(Ie){const{delegate:Dt}=K;return(Dt?.clearTimeout||clearTimeout)(Ie)},delegate:void 0}},202:(er,Nt,Me)=>{"use strict";Me.d(Nt,{h:()=>Ie});const Ie=function K(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}()},822:(er,Nt,Me)=>{"use strict";Me.d(Nt,{L:()=>K});const K="function"==typeof Symbol&&Symbol.observable||"@@observable"},669:(er,Nt,Me)=>{"use strict";Me.d(Nt,{_6:()=>Ht,jO:()=>c,yG:()=>Ee});var K=Me(576);function Dt(Vt){return Vt[Vt.length-1]}function c(Vt){return(0,K.m)(Dt(Vt))?Vt.pop():void 0}function Ee(Vt){return function Ie(Vt){return Vt&&(0,K.m)(Vt.schedule)}(Dt(Vt))?Vt.pop():void 0}function Ht(Vt,kt){return"number"==typeof Dt(Vt)?Vt.pop():kt}},737:(er,Nt,Me)=>{"use strict";function K(Ie,Dt){if(Ie){const c=Ie.indexOf(Dt);0<=c&&Ie.splice(c,1)}}Me.d(Nt,{P:()=>K})},888:(er,Nt,Me)=>{"use strict";function K(Ie){const c=Ie(Ee=>{Error.call(Ee),Ee.stack=(new Error).stack});return c.prototype=Object.create(Error.prototype),c.prototype.constructor=c,c}Me.d(Nt,{d:()=>K})},806:(er,Nt,Me)=>{"use strict";Me.d(Nt,{O:()=>c,x:()=>Dt});var K=Me(416);let Ie=null;function Dt(Ee){if(K.v.useDeprecatedSynchronousErrorHandling){const Ht=!Ie;if(Ht&&(Ie={errorThrown:!1,error:null}),Ee(),Ht){const{errorThrown:Vt,error:kt}=Ie;if(Ie=null,Vt)throw kt}}else Ee()}function c(Ee){K.v.useDeprecatedSynchronousErrorHandling&&Ie&&(Ie.errorThrown=!0,Ie.error=Ee)}},672:(er,Nt,Me)=>{"use strict";function K(Ie,Dt,c,Ee=0,Ht=!1){const Vt=Dt.schedule(function(){c(),Ht?Ie.add(this.schedule(null,Ee)):this.unsubscribe()},Ee);if(Ie.add(Vt),!Ht)return Vt}Me.d(Nt,{f:()=>K})},671:(er,Nt,Me)=>{"use strict";function K(Ie){return Ie}Me.d(Nt,{y:()=>K})},144:(er,Nt,Me)=>{"use strict";Me.d(Nt,{z:()=>K});const K=Ie=>Ie&&"number"==typeof Ie.length&&"function"!=typeof Ie},206:(er,Nt,Me)=>{"use strict";Me.d(Nt,{D:()=>Ie});var K=Me(576);function Ie(Dt){return Symbol.asyncIterator&&(0,K.m)(Dt?.[Symbol.asyncIterator])}},576:(er,Nt,Me)=>{"use strict";function K(Ie){return"function"==typeof Ie}Me.d(Nt,{m:()=>K})},670:(er,Nt,Me)=>{"use strict";Me.d(Nt,{c:()=>Dt});var K=Me(822),Ie=Me(576);function Dt(c){return(0,Ie.m)(c[K.L])}},495:(er,Nt,Me)=>{"use strict";Me.d(Nt,{T:()=>Dt});var K=Me(202),Ie=Me(576);function Dt(c){return(0,Ie.m)(c?.[K.h])}},239:(er,Nt,Me)=>{"use strict";Me.d(Nt,{t:()=>Ie});var K=Me(576);function Ie(Dt){return(0,K.m)(Dt?.then)}},260:(er,Nt,Me)=>{"use strict";Me.d(Nt,{L:()=>c,Q:()=>Dt});var K=Me(655),Ie=Me(576);function Dt(Ee){return(0,K.FC)(this,arguments,function*(){const Vt=Ee.getReader();try{for(;;){const{value:kt,done:bt}=yield(0,K.qq)(Vt.read());if(bt)return yield(0,K.qq)(void 0);yield yield(0,K.qq)(kt)}}finally{Vt.releaseLock()}})}function c(Ee){return(0,Ie.m)(Ee?.getReader)}},482:(er,Nt,Me)=>{"use strict";Me.d(Nt,{A:()=>Ie,e:()=>Dt});var K=Me(576);function Ie(c){return(0,K.m)(c?.lift)}function Dt(c){return Ee=>{if(Ie(Ee))return Ee.lift(function(Ht){try{return c(Ht,this)}catch(Vt){this.error(Vt)}});throw new TypeError("Unable to lift unknown Observable type")}}},635:(er,Nt,Me)=>{"use strict";Me.d(Nt,{U:()=>Dt,z:()=>Ie});var K=Me(671);function Ie(...c){return Dt(c)}function Dt(c){return 0===c.length?K.y:1===c.length?c[0]:function(Ht){return c.reduce((Vt,kt)=>kt(Vt),Ht)}}},849:(er,Nt,Me)=>{"use strict";Me.d(Nt,{h:()=>Dt});var K=Me(416),Ie=Me(410);function Dt(c){Ie.z.setTimeout(()=>{const{onUnhandledError:Ee}=K.v;if(!Ee)throw c;Ee(c)})}},532:(er,Nt,Me)=>{"use strict";function K(Ie){return new TypeError(`You provided ${null!==Ie&&"object"==typeof Ie?"an invalid object":`'${Ie}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}Me.d(Nt,{z:()=>K})},655:(er,Nt,Me)=>{"use strict";function Pt(We,Ue,it,ht){return new(it||(it=Promise))(function(at,dn){function qn(jn){try{en(ht.next(jn))}catch(Ln){dn(Ln)}}function Un(jn){try{en(ht.throw(jn))}catch(Ln){dn(Ln)}}function en(jn){jn.done?at(jn.value):function Lt(at){return at instanceof it?at:new it(function(dn){dn(at)})}(jn.value).then(qn,Un)}en((ht=ht.apply(We,Ue||[])).next())})}function $t(We){return this instanceof $t?(this.v=We,this):new $t(We)}function qe(We,Ue,it){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var Lt,ht=it.apply(We,Ue||[]),at=[];return Lt={},dn("next"),dn("throw"),dn("return"),Lt[Symbol.asyncIterator]=function(){return this},Lt;function dn(tr){ht[tr]&&(Lt[tr]=function(vn){return new Promise(function(nr,zt){at.push([tr,vn,nr,zt])>1||qn(tr,vn)})})}function qn(tr,vn){try{!function Un(tr){tr.value instanceof $t?Promise.resolve(tr.value.v).then(en,jn):Ln(at[0][2],tr)}(ht[tr](vn))}catch(nr){Ln(at[0][3],nr)}}function en(tr){qn("next",tr)}function jn(tr){qn("throw",tr)}function Ln(tr,vn){tr(vn),at.shift(),at.length&&qn(at[0][0],at[0][1])}}function ar(We){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var it,Ue=We[Symbol.asyncIterator];return Ue?Ue.call(We):(We=function nn(We){var Ue="function"==typeof Symbol&&Symbol.iterator,it=Ue&&We[Ue],ht=0;if(it)return it.call(We);if(We&&"number"==typeof We.length)return{next:function(){return We&&ht>=We.length&&(We=void 0),{value:We&&We[ht++],done:!We}}};throw new TypeError(Ue?"Object is not iterable.":"Symbol.iterator is not defined.")}(We),it={},ht("next"),ht("throw"),ht("return"),it[Symbol.asyncIterator]=function(){return this},it);function ht(at){it[at]=We[at]&&function(dn){return new Promise(function(qn,Un){!function Lt(at,dn,qn,Un){Promise.resolve(Un).then(function(en){at({value:en,done:qn})},dn)}(qn,Un,(dn=We[at](dn)).done,dn.value)})}}}Me.d(Nt,{FC:()=>qe,KL:()=>ar,mG:()=>Pt,qq:()=>$t})},895:(er,Nt,Me)=>{"use strict";Me.d(Nt,{Do:()=>sr,EM:()=>tl,HT:()=>c,JF:()=>hs,JJ:()=>ji,K0:()=>Ht,Mx:()=>Ja,PC:()=>$s,S$:()=>nn,V_:()=>bt,Ye:()=>jt,b0:()=>Qe,bD:()=>co,ez:()=>ci,q:()=>Dt,sg:()=>_r,w_:()=>Ee});var K=Me(256);let Ie=null;function Dt(){return Ie}function c(z){Ie||(Ie=z)}class Ee{}const Ht=new K.OlP("DocumentToken");let Vt=(()=>{class z{historyGo(U){throw new Error("Not implemented")}}return z.\u0275fac=function(U){return new(U||z)},z.\u0275prov=K.Yz7({token:z,factory:function(){return function kt(){return(0,K.LFG)(gt)}()},providedIn:"platform"}),z})();const bt=new K.OlP("Location Initialized");let gt=(()=>{class z extends Vt{constructor(U){super(),this._doc=U,this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Dt().getBaseHref(this._doc)}onPopState(U){const ee=Dt().getGlobalEventTarget(this._doc,"window");return ee.addEventListener("popstate",U,!1),()=>ee.removeEventListener("popstate",U)}onHashChange(U){const ee=Dt().getGlobalEventTarget(this._doc,"window");return ee.addEventListener("hashchange",U,!1),()=>ee.removeEventListener("hashchange",U)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(U){this._location.pathname=U}pushState(U,ee,me){Je()?this._history.pushState(U,ee,me):this._location.hash=me}replaceState(U,ee,me){Je()?this._history.replaceState(U,ee,me):this._location.hash=me}forward(){this._history.forward()}back(){this._history.back()}historyGo(U=0){this._history.go(U)}getState(){return this._history.state}}return z.\u0275fac=function(U){return new(U||z)(K.LFG(Ht))},z.\u0275prov=K.Yz7({token:z,factory:function(){return function Pt(){return new gt((0,K.LFG)(Ht))}()},providedIn:"platform"}),z})();function Je(){return!!window.history.pushState}function sn(z,W){if(0==z.length)return W;if(0==W.length)return z;let U=0;return z.endsWith("/")&&U++,W.startsWith("/")&&U++,2==U?z+W.substring(1):1==U?z+W:z+"/"+W}function _t(z){const W=z.match(/#|\?|$/),U=W&&W.index||z.length;return z.slice(0,U-("/"===z[U-1]?1:0))+z.slice(U)}function Qt(z){return z&&"?"!==z[0]?"?"+z:z}let nn=(()=>{class z{historyGo(U){throw new Error("Not implemented")}}return z.\u0275fac=function(U){return new(U||z)},z.\u0275prov=K.Yz7({token:z,factory:function(){return(0,K.f3M)(Qe)},providedIn:"root"}),z})();const Ut=new K.OlP("appBaseHref");let Qe=(()=>{class z extends nn{constructor(U,ee){super(),this._platformLocation=U,this._removeListenerFns=[],this._baseHref=ee??this._platformLocation.getBaseHrefFromDOM()??(0,K.f3M)(Ht).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(U){this._removeListenerFns.push(this._platformLocation.onPopState(U),this._platformLocation.onHashChange(U))}getBaseHref(){return this._baseHref}prepareExternalUrl(U){return sn(this._baseHref,U)}path(U=!1){const ee=this._platformLocation.pathname+Qt(this._platformLocation.search),me=this._platformLocation.hash;return me&&U?`${ee}${me}`:ee}pushState(U,ee,me,$e){const rt=this.prepareExternalUrl(me+Qt($e));this._platformLocation.pushState(U,ee,rt)}replaceState(U,ee,me,$e){const rt=this.prepareExternalUrl(me+Qt($e));this._platformLocation.replaceState(U,ee,rt)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(U=0){this._platformLocation.historyGo?.(U)}}return z.\u0275fac=function(U){return new(U||z)(K.LFG(Vt),K.LFG(Ut,8))},z.\u0275prov=K.Yz7({token:z,factory:z.\u0275fac,providedIn:"root"}),z})(),sr=(()=>{class z extends nn{constructor(U,ee){super(),this._platformLocation=U,this._baseHref="",this._removeListenerFns=[],null!=ee&&(this._baseHref=ee)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(U){this._removeListenerFns.push(this._platformLocation.onPopState(U),this._platformLocation.onHashChange(U))}getBaseHref(){return this._baseHref}path(U=!1){let ee=this._platformLocation.hash;return null==ee&&(ee="#"),ee.length>0?ee.substring(1):ee}prepareExternalUrl(U){const ee=sn(this._baseHref,U);return ee.length>0?"#"+ee:ee}pushState(U,ee,me,$e){let rt=this.prepareExternalUrl(me+Qt($e));0==rt.length&&(rt=this._platformLocation.pathname),this._platformLocation.pushState(U,ee,rt)}replaceState(U,ee,me,$e){let rt=this.prepareExternalUrl(me+Qt($e));0==rt.length&&(rt=this._platformLocation.pathname),this._platformLocation.replaceState(U,ee,rt)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(U=0){this._platformLocation.historyGo?.(U)}}return z.\u0275fac=function(U){return new(U||z)(K.LFG(Vt),K.LFG(Ut,8))},z.\u0275prov=K.Yz7({token:z,factory:z.\u0275fac}),z})(),jt=(()=>{class z{constructor(U){this._subject=new K.vpe,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=U;const ee=this._locationStrategy.getBaseHref();this._basePath=function ar(z){if(new RegExp("^(https?:)?//").test(z)){const[,U]=z.split(/\/\/[^\/]+/);return U}return z}(_t(Xt(ee))),this._locationStrategy.onPopState(me=>{this._subject.emit({url:this.path(!0),pop:!0,state:me.state,type:me.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(U=!1){return this.normalize(this._locationStrategy.path(U))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(U,ee=""){return this.path()==this.normalize(U+Qt(ee))}normalize(U){return z.stripTrailingSlash(function qe(z,W){return z&&new RegExp(`^${z}([/;?#]|$)`).test(W)?W.substring(z.length):W}(this._basePath,Xt(U)))}prepareExternalUrl(U){return U&&"/"!==U[0]&&(U="/"+U),this._locationStrategy.prepareExternalUrl(U)}go(U,ee="",me=null){this._locationStrategy.pushState(me,"",U,ee),this._notifyUrlChangeListeners(this.prepareExternalUrl(U+Qt(ee)),me)}replaceState(U,ee="",me=null){this._locationStrategy.replaceState(me,"",U,ee),this._notifyUrlChangeListeners(this.prepareExternalUrl(U+Qt(ee)),me)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(U=0){this._locationStrategy.historyGo?.(U)}onUrlChange(U){return this._urlChangeListeners.push(U),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(ee=>{this._notifyUrlChangeListeners(ee.url,ee.state)})),()=>{const ee=this._urlChangeListeners.indexOf(U);this._urlChangeListeners.splice(ee,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(U="",ee){this._urlChangeListeners.forEach(me=>me(U,ee))}subscribe(U,ee,me){return this._subject.subscribe({next:U,error:ee,complete:me})}}return z.normalizeQueryParams=Qt,z.joinWithSlash=sn,z.stripTrailingSlash=_t,z.\u0275fac=function(U){return new(U||z)(K.LFG(nn))},z.\u0275prov=K.Yz7({token:z,factory:function(){return function $t(){return new jt((0,K.LFG)(nn))}()},providedIn:"root"}),z})();function Xt(z){return z.replace(/\/index.html$/,"")}var Bt=(()=>((Bt=Bt||{})[Bt.Decimal=0]="Decimal",Bt[Bt.Percent=1]="Percent",Bt[Bt.Currency=2]="Currency",Bt[Bt.Scientific=3]="Scientific",Bt))(),Jt=(()=>((Jt=Jt||{})[Jt.Decimal=0]="Decimal",Jt[Jt.Group=1]="Group",Jt[Jt.List=2]="List",Jt[Jt.PercentSign=3]="PercentSign",Jt[Jt.PlusSign=4]="PlusSign",Jt[Jt.MinusSign=5]="MinusSign",Jt[Jt.Exponential=6]="Exponential",Jt[Jt.SuperscriptingExponent=7]="SuperscriptingExponent",Jt[Jt.PerMille=8]="PerMille",Jt[Jt.Infinity=9]="Infinity",Jt[Jt.NaN=10]="NaN",Jt[Jt.TimeSeparator=11]="TimeSeparator",Jt[Jt.CurrencyDecimal=12]="CurrencyDecimal",Jt[Jt.CurrencyGroup=13]="CurrencyGroup",Jt))();function Ln(z,W){const U=(0,K.cg1)(z),ee=U[K.wAp.NumberSymbols][W];if(typeof ee>"u"){if(W===Jt.CurrencyDecimal)return U[K.wAp.NumberSymbols][Jt.Decimal];if(W===Jt.CurrencyGroup)return U[K.wAp.NumberSymbols][Jt.Group]}return ee}const Ce=/^(\d+)?\.((\d+)(-(\d+))?)?$/,Q="0";function Di(z){const W=parseInt(z);if(isNaN(W))throw new Error("Invalid integer literal when parsing "+z);return W}function Ja(z,W){W=encodeURIComponent(W);for(const U of z.split(";")){const ee=U.indexOf("="),[me,$e]=-1==ee?[U,""]:[U.slice(0,ee),U.slice(ee+1)];if(me.trim()===W)return decodeURIComponent($e)}return null}class Tn{constructor(W,U,ee,me){this.$implicit=W,this.ngForOf=U,this.index=ee,this.count=me}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let _r=(()=>{class z{set ngForOf(U){this._ngForOf=U,this._ngForOfDirty=!0}set ngForTrackBy(U){this._trackByFn=U}get ngForTrackBy(){return this._trackByFn}constructor(U,ee,me){this._viewContainer=U,this._template=ee,this._differs=me,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForTemplate(U){U&&(this._template=U)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const U=this._ngForOf;!this._differ&&U&&(this._differ=this._differs.find(U).create(this.ngForTrackBy))}if(this._differ){const U=this._differ.diff(this._ngForOf);U&&this._applyChanges(U)}}_applyChanges(U){const ee=this._viewContainer;U.forEachOperation((me,$e,rt)=>{if(null==me.previousIndex)ee.createEmbeddedView(this._template,new Tn(me.item,this._ngForOf,-1,-1),null===rt?void 0:rt);else if(null==rt)ee.remove(null===$e?void 0:$e);else if(null!==$e){const Yt=ee.get($e);ee.move(Yt,rt),Jr(Yt,me)}});for(let me=0,$e=ee.length;me<$e;me++){const Yt=ee.get(me).context;Yt.index=me,Yt.count=$e,Yt.ngForOf=this._ngForOf}U.forEachIdentityChange(me=>{Jr(ee.get(me.currentIndex),me)})}static ngTemplateContextGuard(U,ee){return!0}}return z.\u0275fac=function(U){return new(U||z)(K.Y36(K.s_b),K.Y36(K.Rgc),K.Y36(K.ZZ4))},z.\u0275dir=K.lG2({type:z,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0}),z})();function Jr(z,W){z.context.$implicit=W.item}let $s=(()=>{class z{constructor(U,ee,me){this._ngEl=U,this._differs=ee,this._renderer=me,this._ngStyle=null,this._differ=null}set ngStyle(U){this._ngStyle=U,!this._differ&&U&&(this._differ=this._differs.find(U).create())}ngDoCheck(){if(this._differ){const U=this._differ.diff(this._ngStyle);U&&this._applyChanges(U)}}_setStyle(U,ee){const[me,$e]=U.split("."),rt=-1===me.indexOf("-")?void 0:K.JOm.DashCase;null!=ee?this._renderer.setStyle(this._ngEl.nativeElement,me,$e?`${ee}${$e}`:ee,rt):this._renderer.removeStyle(this._ngEl.nativeElement,me,rt)}_applyChanges(U){U.forEachRemovedItem(ee=>this._setStyle(ee.key,null)),U.forEachAddedItem(ee=>this._setStyle(ee.key,ee.currentValue)),U.forEachChangedItem(ee=>this._setStyle(ee.key,ee.currentValue))}}return z.\u0275fac=function(U){return new(U||z)(K.Y36(K.SBq),K.Y36(K.aQg),K.Y36(K.Qsj))},z.\u0275dir=K.lG2({type:z,selectors:[["","ngStyle",""]],inputs:{ngStyle:"ngStyle"},standalone:!0}),z})();let ji=(()=>{class z{constructor(U){this._locale=U}transform(U,ee,me){if(!function Al(z){return!(null==z||""===z||z!=z)}(U))return null;me=me||this._locale;try{return function Kt(z,W,U){return function yt(z,W,U,ee,me,$e,rt=!1){let Yt="",Qn=!1;if(isFinite(z)){let Hn=function mi(z){let ee,me,$e,rt,Yt,W=Math.abs(z)+"",U=0;for((me=W.indexOf("."))>-1&&(W=W.replace(".","")),($e=W.search(/e/i))>0?(me<0&&(me=$e),me+=+W.slice($e+1),W=W.substring(0,$e)):me<0&&(me=W.length),$e=0;W.charAt($e)===Q;$e++);if($e===(Yt=W.length))ee=[0],me=1;else{for(Yt--;W.charAt(Yt)===Q;)Yt--;for(me-=$e,ee=[],rt=0;$e<=Yt;$e++,rt++)ee[rt]=Number(W.charAt($e))}return me>22&&(ee=ee.splice(0,21),U=me-1,me=1),{digits:ee,exponent:U,integerLen:me}}(z);rt&&(Hn=function Kn(z){if(0===z.digits[0])return z;const W=z.digits.length-z.integerLen;return z.exponent?z.exponent+=2:(0===W?z.digits.push(0,0):1===W&&z.digits.push(0),z.integerLen+=2),z}(Hn));let Zn=W.minInt,In=W.minFrac,jr=W.maxFrac;if($e){const To=$e.match(Ce);if(null===To)throw new Error(`${$e} is not a valid digit info`);const oa=To[1],Ca=To[3],Sa=To[5];null!=oa&&(Zn=Di(oa)),null!=Ca&&(In=Di(Ca)),null!=Sa?jr=Di(Sa):null!=Ca&&In>jr&&(jr=In)}!function os(z,W,U){if(W>U)throw new Error(`The minimum number of digits after fraction (${W}) is higher than the maximum (${U}).`);let ee=z.digits,me=ee.length-z.integerLen;const $e=Math.min(Math.max(W,me),U);let rt=$e+z.integerLen,Yt=ee[rt];if(rt>0){ee.splice(Math.max(z.integerLen,rt));for(let In=rt;In<ee.length;In++)ee[In]=0}else{me=Math.max(0,me),z.integerLen=1,ee.length=Math.max(1,rt=$e+1),ee[0]=0;for(let In=1;In<rt;In++)ee[In]=0}if(Yt>=5)if(rt-1<0){for(let In=0;In>rt;In--)ee.unshift(0),z.integerLen++;ee.unshift(1),z.integerLen++}else ee[rt-1]++;for(;me<Math.max(0,$e);me++)ee.push(0);let Qn=0!==$e;const Hn=W+z.integerLen,Zn=ee.reduceRight(function(In,jr,cr,Cr){return Cr[cr]=(jr+=In)<10?jr:jr-10,Qn&&(0===Cr[cr]&&cr>=Hn?Cr.pop():Qn=!1),jr>=10?1:0},0);Zn&&(ee.unshift(Zn),z.integerLen++)}(Hn,In,jr);let cr=Hn.digits,Cr=Hn.integerLen;const Do=Hn.exponent;let St=[];for(Qn=cr.every(To=>!To);Cr<Zn;Cr++)cr.unshift(0);for(;Cr<0;Cr++)cr.unshift(0);Cr>0?St=cr.splice(Cr,cr.length):(St=cr,cr=[0]);const qr=[];for(cr.length>=W.lgSize&&qr.unshift(cr.splice(-W.lgSize,cr.length).join(""));cr.length>W.gSize;)qr.unshift(cr.splice(-W.gSize,cr.length).join(""));cr.length&&qr.unshift(cr.join("")),Yt=qr.join(Ln(U,ee)),St.length&&(Yt+=Ln(U,me)+St.join("")),Do&&(Yt+=Ln(U,Jt.Exponential)+"+"+Do)}else Yt=Ln(U,Jt.Infinity);return Yt=z<0&&!Qn?W.negPre+Yt+W.negSuf:W.posPre+Yt+W.posSuf,Yt}(z,function lr(z,W="-"){const U={minInt:1,minFrac:0,maxFrac:0,posPre:"",posSuf:"",negPre:"",negSuf:"",gSize:0,lgSize:0},ee=z.split(";"),me=ee[0],$e=ee[1],rt=-1!==me.indexOf(".")?me.split("."):[me.substring(0,me.lastIndexOf(Q)+1),me.substring(me.lastIndexOf(Q)+1)],Yt=rt[0],Qn=rt[1]||"";U.posPre=Yt.substring(0,Yt.indexOf("#"));for(let Zn=0;Zn<Qn.length;Zn++){const In=Qn.charAt(Zn);In===Q?U.minFrac=U.maxFrac=Zn+1:"#"===In?U.maxFrac=Zn+1:U.posSuf+=In}const Hn=Yt.split(",");if(U.gSize=Hn[1]?Hn[1].length:0,U.lgSize=Hn[2]||Hn[1]?(Hn[2]||Hn[1]).length:0,$e){const Zn=me.length-U.posPre.length-U.posSuf.length,In=$e.indexOf("#");U.negPre=$e.substring(0,In).replace(/'/g,""),U.negSuf=$e.slice(In+Zn).replace(/'/g,"")}else U.negPre=W+U.posPre,U.negSuf=U.posSuf;return U}(function tr(z,W){return(0,K.cg1)(z)[K.wAp.NumberFormats][W]}(W,Bt.Decimal),Ln(W,Jt.MinusSign)),W,Jt.Group,Jt.Decimal,U)}(function ls(z){if("string"==typeof z&&!isNaN(Number(z)-parseFloat(z)))return Number(z);if("number"!=typeof z)throw new Error(`${z} is not a number`);return z}(U),me,ee)}catch($e){throw function ei(z,W){return new K.vHH(2100,!1)}()}}}return z.\u0275fac=function(U){return new(U||z)(K.Y36(K.soG,16))},z.\u0275pipe=K.Yjl({name:"number",type:z,pure:!0,standalone:!0}),z})();let ci=(()=>{class z{}return z.\u0275fac=function(U){return new(U||z)},z.\u0275mod=K.oAB({type:z}),z.\u0275inj=K.cJS({}),z})();const co="browser";let tl=(()=>{class z{}return z.\u0275prov=(0,K.Yz7)({token:z,providedIn:"root",factory:()=>new cs((0,K.LFG)(Ht),window)}),z})();class cs{constructor(W,U){this.document=W,this.window=U,this.offset=()=>[0,0]}setOffset(W){this.offset=Array.isArray(W)?()=>W:W}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(W){this.supportsScrolling()&&this.window.scrollTo(W[0],W[1])}scrollToAnchor(W){if(!this.supportsScrolling())return;const U=function us(z,W){const U=z.getElementById(W)||z.getElementsByName(W)[0];if(U)return U;if("function"==typeof z.createTreeWalker&&z.body&&(z.body.createShadowRoot||z.body.attachShadow)){const ee=z.createTreeWalker(z.body,NodeFilter.SHOW_ELEMENT);let me=ee.currentNode;for(;me;){const $e=me.shadowRoot;if($e){const rt=$e.getElementById(W)||$e.querySelector(`[name="${W}"]`);if(rt)return rt}me=ee.nextNode()}}return null}(this.document,W);U&&(this.scrollToElement(U),U.focus())}setHistoryScrollRestoration(W){if(this.supportScrollRestoration()){const U=this.window.history;U&&U.scrollRestoration&&(U.scrollRestoration=W)}}scrollToElement(W){const U=W.getBoundingClientRect(),ee=U.left+this.window.pageXOffset,me=U.top+this.window.pageYOffset,$e=this.offset();this.window.scrollTo(ee-$e[0],me-$e[1])}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const W=nl(this.window.history)||nl(Object.getPrototypeOf(this.window.history));return!(!W||!W.writable&&!W.set)}catch{return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch{return!1}}}function nl(z){return Object.getOwnPropertyDescriptor(z,"scrollRestoration")}class hs{}},256:(er,Nt,Me)=>{"use strict";Me.d(Nt,{tb:()=>d0,AFp:()=>c0,ip1:()=>l0,CZH:()=>Gg,hGG:()=>Ib,z2F:()=>Zg,sBO:()=>db,Sil:()=>W1,_Vd:()=>ru,EJc:()=>Z1,Xts:()=>jo,SBq:()=>kh,lqb:()=>Fr,qLn:()=>Fh,vpe:()=>zc,XFs:()=>Et,OlP:()=>Sr,zs3:()=>iu,ZZ4:()=>Ry,aQg:()=>Ly,soG:()=>Hg,YKP:()=>pv,h0i:()=>sf,PXZ:()=>ab,R0b:()=>Il,FiY:()=>he,Lbi:()=>$1,g9A:()=>h0,Qsj:()=>p_,FYo:()=>bm,JOm:()=>Io,tp0:()=>Le,Rgc:()=>Fp,dDg:()=>rb,eoX:()=>v0,GfV:()=>Oh,s_b:()=>jg,ifc:()=>mt,MMx:()=>ay,Lck:()=>Nx,eFA:()=>w0,f3M:()=>ae,$WT:()=>Tn,_c5:()=>Sb,c2e:()=>G1,zSh:()=>Uf,wAp:()=>_n,vHH:()=>ut,lri:()=>_0,rWj:()=>y0,D6c:()=>Mb,cg1:()=>Ho,kL8:()=>fh,dqk:()=>mr,Z0I:()=>Vr,CqO:()=>gp,QGY:()=>Cl,F4k:()=>Yh,RDi:()=>Lu,AaK:()=>nn,TTD:()=>Es,jDz:()=>gv,xp6:()=>Rm,uIk:()=>dp,Suo:()=>Bv,Xpm:()=>Di,lG2:()=>lo,Yz7:()=>Vn,cJS:()=>Wi,oAB:()=>ao,Yjl:()=>ya,Y36:()=>$u,_UZ:()=>mp,qZA:()=>Xh,TgZ:()=>Zd,EpF:()=>Wa,n5z:()=>ca,LFG:()=>H,$8M:()=>Gc,$Z:()=>Xm,NdJ:()=>qd,CRH:()=>Nv,oxw:()=>bp,ALo:()=>Mv,xi3:()=>Av,Q6J:()=>pp,WLB:()=>Ev,iGM:()=>Fv,MAs:()=>Hd,KtG:()=>Xo,CHM:()=>na,P3R:()=>Bf,YNc:()=>Tg,_uU:()=>un,Oqu:()=>Fn,hij:()=>Rn,lnq:()=>hn,Gf:()=>zv});var K=Me(579),Ie=Me(727),Dt=Me(751),c=Me(189),Ee=Me(421),Ht=Me(515),Vt=Me(669),kt=Me(76),gt=Me(961),Je=Me(482);function sn(i,o,...a){if(!0===o)return void i();if(!1===o)return;const d=new gt.Hp({next:()=>{d.unsubscribe(),i()}});return(0,Ee.Xf)(o(...a)).subscribe(d)}function _t(i){for(let o in i)if(i[o]===_t)return o;throw Error("Could not find renamed property on target object.")}function nn(i){if("string"==typeof i)return i;if(Array.isArray(i))return"["+i.map(nn).join(", ")+"]";if(null==i)return""+i;if(i.overriddenName)return`${i.overriddenName}`;if(i.name)return`${i.name}`;const o=i.toString();if(null==o)return""+o;const a=o.indexOf("\n");return-1===a?o:o.substring(0,a)}function Ut(i,o){return null==i||""===i?null===o?"":o:null==o||""===o?i:i+" "+o}const Qe=_t({__forward_ref__:_t});function sr(i){return i.__forward_ref__=sr,i.toString=function(){return nn(this())},i}function jt(i){return $t(i)?i():i}function $t(i){return"function"==typeof i&&i.hasOwnProperty(Qe)&&i.__forward_ref__===sr}function qe(i){return i&&!!i.\u0275providers}const ar="https://g.co/ng/security#xss";class ut extends Error{constructor(o,a){super(function Bt(i,o){return`NG0${Math.abs(i)}${o?": "+o.trim():""}`}(o,a)),this.code=o}}function wt(i){return"string"==typeof i?i:null==i?"":String(i)}function We(i,o){throw new ut(-201,!1)}function nr(i,o){null==i&&function zt(i,o,a,d){throw new Error(`ASSERTION ERROR: ${i}`+(null==d?"":` [Expected=> ${a} ${d} ${o} <=Actual]`))}(o,i,null,"!=")}function Vn(i){return{token:i.token,providedIn:i.providedIn||null,factory:i.factory,value:void 0}}function Wi(i){return{providers:i.providers||[],imports:i.imports||[]}}function Br(i){return yo(i,ai)||yo(i,fr)}function Vr(i){return null!==Br(i)}function yo(i,o){return i.hasOwnProperty(o)?i[o]:null}function vo(i){return i&&(i.hasOwnProperty(yn)||i.hasOwnProperty(rn))?i[yn]:null}const ai=_t({\u0275prov:_t}),yn=_t({\u0275inj:_t}),fr=_t({ngInjectableDef:_t}),rn=_t({ngInjectorDef:_t});var Et=(()=>((Et=Et||{})[Et.Default=0]="Default",Et[Et.Host=1]="Host",Et[Et.Self=2]="Self",Et[Et.SkipSelf=4]="SkipSelf",Et[Et.Optional=8]="Optional",Et))();let xo;function $n(i){const o=xo;return xo=i,o}function oo(i,o,a){const d=Br(i);return d&&"root"==d.providedIn?void 0===d.value?d.value=d.factory():d.value:a&Et.Optional?null:void 0!==o?o:void We(nn(i))}const mr=(()=>typeof globalThis<"u"&&globalThis||typeof global<"u"&&global||typeof window<"u"&&window||typeof self<"u"&&typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&self)(),Kr={},so="__NG_DI_FLAG__",Zo="ngTempTokenPath",is=/\n/gm,Ei="__source";let pi;function Ui(i){const o=pi;return pi=i,o}function le(i,o=Et.Default){if(void 0===pi)throw new ut(-203,!1);return null===pi?oo(i,void 0,o):pi.get(i,o&Et.Optional?null:void 0,o)}function H(i,o=Et.Default){return(function Yr(){return xo}()||le)(jt(i),o)}function ae(i,o=Et.Default){return H(i,fe(o))}function fe(i){return typeof i>"u"||"number"==typeof i?i:0|(i.optional&&8)|(i.host&&1)|(i.self&&2)|(i.skipSelf&&4)}function xe(i){const o=[];for(let a=0;a<i.length;a++){const d=jt(i[a]);if(Array.isArray(d)){if(0===d.length)throw new ut(900,!1);let g,w=Et.Default;for(let I=0;I<d.length;I++){const k=d[I],B=Ce(k);"number"==typeof B?-1===B?g=k.token:w|=B:g=k}o.push(H(g,w))}else o.push(H(d))}return o}function Se(i,o){return i[so]=o,i.prototype[so]=o,i}function Ce(i){return i[so]}function Q(i){return{toString:i}.toString()}var ve=(()=>((ve=ve||{})[ve.OnPush=0]="OnPush",ve[ve.Default=1]="Default",ve))(),mt=(()=>{return(i=mt||(mt={}))[i.Emulated=0]="Emulated",i[i.None=2]="None",i[i.ShadowDom=3]="ShadowDom",mt;var i})();const Ct={},yt=[],xn=_t({\u0275cmp:_t}),On=_t({\u0275dir:_t}),Kt=_t({\u0275pipe:_t}),lr=_t({\u0275mod:_t}),Kn=_t({\u0275fac:_t}),mi=_t({__NG_ELEMENT_ID__:_t});let os=0;function Di(i){return Q(()=>{const a=!0===i.standalone,d={},g={type:i.type,providersResolver:null,decls:i.decls,vars:i.vars,factory:null,template:i.template||null,consts:i.consts||null,ngContentSelectors:i.ngContentSelectors,hostBindings:i.hostBindings||null,hostVars:i.hostVars||0,hostAttrs:i.hostAttrs||null,contentQueries:i.contentQueries||null,declaredInputs:d,inputs:null,outputs:null,exportAs:i.exportAs||null,onPush:i.changeDetection===ve.OnPush,directiveDefs:null,pipeDefs:null,standalone:a,dependencies:a&&i.dependencies||null,getStandaloneInjector:null,selectors:i.selectors||yt,viewQuery:i.viewQuery||null,features:i.features||null,data:i.data||{},encapsulation:i.encapsulation||mt.Emulated,id:"c"+os++,styles:i.styles||yt,_:null,setInput:null,schemas:i.schemas||null,tView:null,findHostDirectiveDefs:null,hostDirectives:null},w=i.dependencies,I=i.features;return g.inputs=Ti(i.inputs,d),g.outputs=Ti(i.outputs),I&&I.forEach(k=>k(g)),g.directiveDefs=w?()=>("function"==typeof w?w():w).map(wo).filter($r):null,g.pipeDefs=w?()=>("function"==typeof w?w():w).map(fn).filter($r):null,g})}function wo(i){return Sn(i)||xt(i)}function $r(i){return null!==i}function ao(i){return Q(()=>({type:i.type,bootstrap:i.bootstrap||yt,declarations:i.declarations||yt,imports:i.imports||yt,exports:i.exports||yt,transitiveCompileScopes:null,schemas:i.schemas||null,id:i.id||null}))}function Ti(i,o){if(null==i)return Ct;const a={};for(const d in i)if(i.hasOwnProperty(d)){let g=i[d],w=g;Array.isArray(g)&&(w=g[1],g=g[0]),a[g]=d,o&&(o[g]=w)}return a}const lo=Di;function ya(i){return{type:i.type,name:i.name,factory:null,pure:!1!==i.pure,standalone:!0===i.standalone,onDestroy:i.type.prototype.ngOnDestroy||null}}function Sn(i){return i[xn]||null}function xt(i){return i[On]||null}function fn(i){return i[Kt]||null}function Tn(i){const o=Sn(i)||xt(i)||fn(i);return null!==o&&o.standalone}function _r(i,o){const a=i[lr]||null;if(!a&&!0===o)throw new Error(`Type ${nn(i)} does not have '\u0275mod' property.`);return a}function Li(i){return Array.isArray(i)&&"object"==typeof i[1]}function ii(i){return Array.isArray(i)&&!0===i[1]}function bs(i){return 0!=(4&i.flags)}function as(i){return i.componentOffset>-1}function Zs(i){return 1==(1&i.flags)}function ji(i){return null!==i.template}function qs(i){return 0!=(256&i[2])}function hs(i,o){return i.hasOwnProperty(Kn)?i[Kn]:null}class ds{constructor(o,a,d){this.previousValue=o,this.currentValue=a,this.firstChange=d}isFirstChange(){return this.firstChange}}function Es(){return Ws}function Ws(i){return i.type.prototype.ngOnChanges&&(i.setInput=Ys),Xs}function Xs(){const i=Js(this),o=i?.current;if(o){const a=i.previous;if(a===Ct)i.previous=o;else for(let d in o)a[d]=o[d];i.current=null,this.ngOnChanges(o)}}function Ys(i,o,a,d){const g=this.declaredInputs[a],w=Js(i)||function wa(i,o){return i[Ks]=o}(i,{previous:Ct,current:null}),I=w.current||(w.current={}),k=w.previous,B=k[g];I[g]=new ds(B&&B.currentValue,o,k===Ct),i[d]=o}Es.ngInherit=!0;const Ks="__ngSimpleChanges__";function Js(i){return i[Ks]||null}function gn(i){for(;Array.isArray(i);)i=i[0];return i}function ho(i,o){return gn(o[i.index])}function rl(i,o){return i.data[o]}function ea(i,o){return i[o]}function Si(i,o){const a=o[i];return Li(a)?a:a[0]}function Cs(i){return 64==(64&i[2])}function fo(i,o){return null==o?null:i[o]}function ki(i){i[18]=0}function ol(i,o){i[5]+=o;let a=i,d=i[3];for(;null!==d&&(1===o&&1===a[5]||-1===o&&0===a[5]);)d[5]+=o,a=d,d=d[3]}const wn={lFrame:ko(null),bindingsEnabled:!0};function Ol(){return wn.bindingsEnabled}function pt(){return wn.lFrame.lView}function Jn(){return wn.lFrame.tView}function na(i){return wn.lFrame.contextLView=i,i[8]}function Xo(i){return wn.lFrame.contextLView=null,i}function hi(){let i=Da();for(;null!==i&&64===i.type;)i=i.parent;return i}function Da(){return wn.lFrame.currentTNode}function gi(i,o){const a=wn.lFrame;a.currentTNode=i,a.isParent=o}function gc(){return wn.lFrame.isParent}function Zr(){const i=wn.lFrame;let o=i.bindingRootIndex;return-1===o&&(o=i.bindingRootIndex=i.tView.bindingStartIndex),o}function ia(){return wn.lFrame.bindingIndex++}function yc(i,o){const a=wn.lFrame;a.bindingIndex=a.bindingRootIndex=i,vc(o)}function vc(i){wn.lFrame.currentDirectiveIndex=i}function ul(){return wn.lFrame.currentQueryIndex}function hl(i){wn.lFrame.currentQueryIndex=i}function dl(i){const o=i[1];return 2===o.type?o.declTNode:1===o.type?i[6]:null}function Fl(i,o,a){if(a&Et.SkipSelf){let g=o,w=i;for(;!(g=g.parent,null!==g||a&Et.Host||(g=dl(w),null===g||(w=w[15],10&g.type))););if(null===g)return!1;o=g,i=w}const d=wn.lFrame=ms();return d.currentTNode=o,d.lView=i,!0}function Ss(i){const o=ms(),a=i[1];wn.lFrame=o,o.currentTNode=a.firstChild,o.lView=i,o.tView=a,o.contextLView=i,o.bindingIndex=a.bindingStartIndex,o.inI18n=!1}function ms(){const i=wn.lFrame,o=null===i?null:i.child;return null===o?ko(i):o}function ko(i){const o={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:i,child:null,inI18n:!1};return null!==i&&(i.child=o),o}function Ta(){const i=wn.lFrame;return wn.lFrame=i.parent,i.currentTNode=null,i.lView=null,i}const bc=Ta;function Hi(){const i=Ta();i.isParent=!0,i.tView=null,i.selectedIndex=-1,i.contextLView=null,i.elementDepthCount=0,i.currentDirectiveIndex=-1,i.currentNamespace=null,i.bindingRootIndex=-1,i.bindingIndex=-1,i.currentQueryIndex=0}function _i(){return wn.lFrame.selectedIndex}function An(i){wn.lFrame.selectedIndex=i}function z(){const i=wn.lFrame;return rl(i.tView,i.selectedIndex)}function Yt(i,o){for(let a=o.directiveStart,d=o.directiveEnd;a<d;a++){const w=i.data[a].type.prototype,{ngAfterContentInit:I,ngAfterContentChecked:k,ngAfterViewInit:B,ngAfterViewChecked:q,ngOnDestroy:te}=w;I&&(i.contentHooks||(i.contentHooks=[])).push(-a,I),k&&((i.contentHooks||(i.contentHooks=[])).push(a,k),(i.contentCheckHooks||(i.contentCheckHooks=[])).push(a,k)),B&&(i.viewHooks||(i.viewHooks=[])).push(-a,B),q&&((i.viewHooks||(i.viewHooks=[])).push(a,q),(i.viewCheckHooks||(i.viewCheckHooks=[])).push(a,q)),null!=te&&(i.destroyHooks||(i.destroyHooks=[])).push(a,te)}}function Qn(i,o,a){In(i,o,3,a)}function Hn(i,o,a,d){(3&i[2])===a&&In(i,o,a,d)}function Zn(i,o){let a=i[2];(3&a)===o&&(a&=2047,a+=1,i[2]=a)}function In(i,o,a,d){const w=d??-1,I=o.length-1;let k=0;for(let B=void 0!==d?65535&i[18]:0;B<I;B++)if("number"==typeof o[B+1]){if(k=o[B],null!=d&&k>=d)break}else o[B]<0&&(i[18]+=65536),(k<w||-1==w)&&(jr(i,a,o,B),i[18]=(4294901760&i[18])+B+2),B++}function jr(i,o,a,d){const g=a[d]<0,w=a[d+1],k=i[g?-a[d]:a[d]];if(g){if(i[2]>>11<i[18]>>16&&(3&i[2])===o){i[2]+=2048;try{w.call(k)}finally{}}}else try{w.call(k)}finally{}}class Cr{constructor(o,a,d){this.factory=o,this.resolving=!1,this.canSeeViewProviders=a,this.injectImpl=d}}function Ia(i,o,a){let d=0;for(;d<a.length;){const g=a[d];if("number"==typeof g){if(0!==g)break;d++;const w=a[d++],I=a[d++],k=a[d++];i.setAttribute(o,I,k,w)}else{const w=g,I=a[++d];sa(w)?i.setProperty(o,w,I):i.setAttribute(o,w,I),d++}}return d}function Ma(i){return 3===i||4===i||6===i}function sa(i){return 64===i.charCodeAt(0)}function Ii(i,o){if(null!==o&&0!==o.length)if(null===i||0===i.length)i=o.slice();else{let a=-1;for(let d=0;d<o.length;d++){const g=o[d];"number"==typeof g?a=g:0===a||fl(i,a,g,null,-1===a||2===a?o[++d]:null)}}return i}function fl(i,o,a,d,g){let w=0,I=i.length;if(-1===o)I=-1;else for(;w<i.length;){const k=i[w++];if("number"==typeof k){if(k===o){I=-1;break}if(k>o){I=w-1;break}}}for(;w<i.length;){const k=i[w];if("number"==typeof k)break;if(k===a){if(null===d)return void(null!==g&&(i[w+1]=g));if(d===i[w+1])return void(i[w+2]=g)}w++,null!==d&&w++,null!==g&&w++}-1!==I&&(i.splice(I,0,o),w=I+1),i.splice(w++,0,a),null!==d&&i.splice(w++,0,d),null!==g&&i.splice(w++,0,g)}function Aa(i){return-1!==i}function wc(i){return 32767&i}function Pa(i,o){let a=function Eu(i){return i>>16}(i),d=o;for(;a>0;)d=d[15],a--;return d}let aa=!0;function Ra(i){const o=aa;return aa=i,o}let pl=0;const po={};function La(i,o){const a=Ul(i,o);if(-1!==a)return a;const d=o[1];d.firstCreatePass&&(i.injectorIndex=o.length,Nl(d.data,i),Nl(o,null),Nl(d.blueprint,null));const g=Ko(i,o),w=i.injectorIndex;if(Aa(g)){const I=wc(g),k=Pa(g,o),B=k[1].data;for(let q=0;q<8;q++)o[w+q]=k[I+q]|B[I+q]}return o[w+8]=g,w}function Nl(i,o){i.push(0,0,0,0,0,0,0,0,o)}function Ul(i,o){return-1===i.injectorIndex||i.parent&&i.parent.injectorIndex===i.injectorIndex||null===o[i.injectorIndex+8]?-1:i.injectorIndex}function Ko(i,o){if(i.parent&&-1!==i.parent.injectorIndex)return i.parent.injectorIndex;let a=0,d=null,g=o;for(;null!==g;){if(d=Ot(g),null===d)return-1;if(a++,g=g[15],-1!==d.injectorIndex)return d.injectorIndex|a<<16}return-1}function jl(i,o,a){!function ml(i,o,a){let d;"string"==typeof a?d=a.charCodeAt(0)||0:a.hasOwnProperty(mi)&&(d=a[mi]),null==d&&(d=a[mi]=pl++);const g=255&d;o.data[i+(g>>5)]|=1<<g}(i,o,a)}function Uc(i,o,a){if(a&Et.Optional||void 0!==i)return i;We()}function gl(i,o,a,d){if(a&Et.Optional&&void 0===d&&(d=null),!(a&(Et.Self|Et.Host))){const g=i[9],w=$n(void 0);try{return g?g.get(o,d,a&Et.Optional):oo(o,d,a&Et.Optional)}finally{$n(w)}}return Uc(d,0,a)}function Vl(i,o,a,d=Et.Default,g){if(null!==i){if(1024&o[2]){const I=function Gl(i,o,a,d,g){let w=i,I=o;for(;null!==w&&null!==I&&1024&I[2]&&!(256&I[2]);){const k=jc(w,I,a,d|Et.Self,po);if(k!==po)return k;let B=w.parent;if(!B){const q=I[21];if(q){const te=q.get(a,po,d);if(te!==po)return te}B=Ot(I),I=I[15]}w=B}return g}(i,o,a,d,po);if(I!==po)return I}const w=jc(i,o,a,d,po);if(w!==po)return w}return gl(o,a,d,g)}function jc(i,o,a,d,g){const w=function $c(i){if("string"==typeof i)return i.charCodeAt(0)||0;const o=i.hasOwnProperty(mi)?i[mi]:void 0;return"number"==typeof o?o>=0?255&o:$l:o}(a);if("function"==typeof w){if(!Fl(o,i,d))return d&Et.Host?Uc(g,0,d):gl(o,a,d,g);try{const I=w(d);if(null!=I||d&Et.Optional)return I;We()}finally{bc()}}else if("number"==typeof w){let I=null,k=Ul(i,o),B=-1,q=d&Et.Host?o[16][6]:null;for((-1===k||d&Et.SkipSelf)&&(B=-1===k?Ko(i,o):o[k+8],-1!==B&&mo(d,!1)?(I=o[1],k=wc(B),o=Pa(B,o)):k=-1);-1!==k;){const te=o[1];if(Tu(w,k,te.data)){const de=Vc(k,o,a,I,d,q);if(de!==po)return de}B=o[k+8],-1!==B&&mo(d,o[1].data[k+8]===q)&&Tu(w,k,o)?(I=te,k=wc(B),o=Pa(B,o)):k=-1}}return g}function Vc(i,o,a,d,g,w){const I=o[1],k=I.data[i+8],te=yi(k,I,a,null==d?as(k)&&aa:d!=I&&0!=(3&k.type),g&Et.Host&&w===k);return null!==te?ka(o,I,te,k):po}function yi(i,o,a,d,g){const w=i.providerIndexes,I=o.data,k=1048575&w,B=i.directiveStart,te=w>>20,De=g?k+te:i.directiveEnd;for(let Fe=d?k:k+te;Fe<De;Fe++){const nt=I[Fe];if(Fe<B&&a===nt||Fe>=B&&nt.type===a)return Fe}if(g){const Fe=I[B];if(Fe&&ji(Fe)&&Fe.type===a)return B}return null}function ka(i,o,a,d){let g=i[a];const w=o.data;if(function Do(i){return i instanceof Cr}(g)){const I=g;I.resolving&&function cn(i,o){const a=o?`. Dependency path: ${o.join(" > ")} > ${i}`:"";throw new ut(-200,`Circular dependency in DI detected for ${i}${a}`)}(function tt(i){return"function"==typeof i?i.name||i.toString():"object"==typeof i&&null!=i&&"function"==typeof i.type?i.type.name||i.type.toString():wt(i)}(w[a]));const k=Ra(I.canSeeViewProviders);I.resolving=!0;const B=I.injectImpl?$n(I.injectImpl):null;Fl(i,d,Et.Default);try{g=i[a]=I.factory(void 0,w,i,d),o.firstCreatePass&&a>=d.directiveStart&&function rt(i,o,a){const{ngOnChanges:d,ngOnInit:g,ngDoCheck:w}=o.type.prototype;if(d){const I=Ws(o);(a.preOrderHooks||(a.preOrderHooks=[])).push(i,I),(a.preOrderCheckHooks||(a.preOrderCheckHooks=[])).push(i,I)}g&&(a.preOrderHooks||(a.preOrderHooks=[])).push(0-i,g),w&&((a.preOrderHooks||(a.preOrderHooks=[])).push(i,w),(a.preOrderCheckHooks||(a.preOrderCheckHooks=[])).push(i,w))}(a,w[a],o)}finally{null!==B&&$n(B),Ra(k),I.resolving=!1,bc()}}return g}function Tu(i,o,a){return!!(a[o+(i>>5)]&1<<i)}function mo(i,o){return!(i&Et.Self||i&Et.Host&&o)}class go{constructor(o,a){this._tNode=o,this._lView=a}get(o,a,d){return Vl(this._tNode,this._lView,o,fe(d),a)}}function $l(){return new go(hi(),pt())}function ca(i){return Q(()=>{const o=i.prototype.constructor,a=o[Kn]||Oo(o),d=Object.prototype;let g=Object.getPrototypeOf(i.prototype).constructor;for(;g&&g!==d;){const w=g[Kn]||Oo(g);if(w&&w!==a)return w;g=Object.getPrototypeOf(g)}return w=>new w})}function Oo(i){return $t(i)?()=>{const o=Oo(jt(i));return o&&o()}:hs(i)}function Ot(i){const o=i[1],a=o.type;return 2===a?o.declTNode:1===a?i[6]:null}function Gc(i){return function Du(i,o){if("class"===o)return i.classes;if("style"===o)return i.styles;const a=i.attrs;if(a){const d=a.length;let g=0;for(;g<d;){const w=a[g];if(Ma(w))break;if(0===w)g+=2;else if("number"==typeof w)for(g++;g<d&&"string"==typeof a[g];)g++;else{if(w===o)return a[g+1];g+=2}}}return null}(hi(),i)}const Ki="__parameters__";function As(i,o,a){return Q(()=>{const d=function Hc(i){return function(...a){if(i){const d=i(...a);for(const g in d)this[g]=d[g]}}}(o);function g(...w){if(this instanceof g)return d.apply(this,w),this;const I=new g(...w);return k.annotation=I,k;function k(B,q,te){const de=B.hasOwnProperty(Ki)?B[Ki]:Object.defineProperty(B,Ki,{value:[]})[Ki];for(;de.length<=te;)de.push(null);return(de[te]=de[te]||[]).push(I),B}}return a&&(g.prototype=Object.create(a.prototype)),g.prototype.ngMetadataName=i,g.annotationCls=g,g})}class Sr{constructor(o,a){this._desc=o,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof a?this.__NG_ELEMENT_ID__=a:void 0!==a&&(this.\u0275prov=Vn({token:this,providedIn:a.providedIn||"root",factory:a.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}function h(i,o){i.forEach(a=>Array.isArray(a)?h(a,o):o(a))}function r(i,o,a){o>=i.length?i.push(a):i.splice(o,0,a)}function l(i,o){return o>=i.length-1?i.pop():i.splice(o,1)[0]}const he=Se(As("Optional"),8),Le=Se(As("SkipSelf"),4);var Io=(()=>((Io=Io||{})[Io.Important=1]="Important",Io[Io.DashCase=2]="DashCase",Io))();const vh=new Map;let Bp=0;const df="__ngContext__";function Bo(i,o){Li(o)?(i[df]=o[20],function Up(i){vh.set(i[20],i)}(o)):i[df]=o}function id(i,o){return undefined(i,o)}function bh(i){const o=i[3];return ii(o)?o[3]:o}function Wc(i){return vl(i[13])}function Sc(i){return vl(i[4])}function vl(i){for(;null!==i&&!ii(i);)i=i[4];return i}function No(i,o,a,d,g){if(null!=d){let w,I=!1;ii(d)?w=d:Li(d)&&(I=!0,d=d[0]);const k=gn(d);0===i&&null!==a?null==g?Ba(o,a,k):Wl(o,a,k,g||null,!0):1===i&&null!==a?Wl(o,a,k,g||null,!0):2===i?function Ef(i,o,a){const d=Fi(i,o);d&&function da(i,o,a,d){i.removeChild(o,a,d)}(i,d,o,a)}(o,k,I):3===i&&o.destroyNode(k),null!=w&&function Df(i,o,a,d,g){const w=a[7];w!==gn(a)&&No(o,i,d,w,g);for(let k=10;k<a.length;k++){const B=a[k];Va(B[1],B,i,o,d,w)}}(o,i,w,a,g)}}function yf(i,o,a){return i.createElement(o,a)}function Zp(i,o){const a=i[9],d=a.indexOf(o),g=o[3];512&o[2]&&(o[2]&=-513,ol(g,-1)),a.splice(d,1)}function vf(i,o){if(i.length<=10)return;const a=10+o,d=i[a];if(d){const g=d[17];null!==g&&g!==i&&Zp(g,d),o>0&&(i[a-1][4]=d[4]);const w=l(i,10+o);!function Jg(i,o){Va(i,o,o[11],2,null,null),o[0]=null,o[6]=null}(d[1],d);const I=w[19];null!==I&&I.detachView(w[1]),d[3]=null,d[4]=null,d[2]&=-65}return d}function xi(i,o){if(!(128&o[2])){const a=o[11];a.destroyNode&&Va(i,o,a,3,null,null),function Hp(i){let o=i[13];if(!o)return pn(i[1],i);for(;o;){let a=null;if(Li(o))a=o[13];else{const d=o[10];d&&(a=d)}if(!a){for(;o&&!o[4]&&o!==i;)Li(o)&&pn(o[1],o),o=o[3];null===o&&(o=i),Li(o)&&pn(o[1],o),a=o&&o[4]}o=a}}(o)}}function pn(i,o){if(!(128&o[2])){o[2]&=-65,o[2]|=128,function sd(i,o){let a;if(null!=i&&null!=(a=i.destroyHooks))for(let d=0;d<a.length;d+=2){const g=o[a[d]];if(!(g instanceof Cr)){const w=a[d+1];if(Array.isArray(w))for(let I=0;I<w.length;I+=2){const k=g[w[I]],B=w[I+1];try{B.call(k)}finally{}}else try{w.call(g)}finally{}}}}(i,o),function Ic(i,o){const a=i.cleanup,d=o[7];let g=-1;if(null!==a)for(let w=0;w<a.length-1;w+=2)if("string"==typeof a[w]){const I=a[w+3];I>=0?d[g=I]():d[g=-I].unsubscribe(),w+=2}else{const I=d[g=a[w+1]];a[w].call(I)}if(null!==d){for(let w=g+1;w<d.length;w++)(0,d[w])();o[7]=null}}(i,o),1===o[1].type&&o[11].destroy();const a=o[17];if(null!==a&&ii(o[3])){a!==o[3]&&Zp(a,o);const d=o[19];null!==d&&d.detachView(i)}!function jp(i){vh.delete(i[20])}(o)}}function or(i,o,a){return function xf(i,o,a){let d=o;for(;null!==d&&40&d.type;)d=(o=d).parent;if(null===d)return a[0];{const{componentOffset:g}=d;if(g>-1){const{encapsulation:w}=i.data[d.directiveStart+g];if(w===mt.None||w===mt.Emulated)return null}return ho(d,a)}}(i,o.parent,a)}function Wl(i,o,a,d,g){i.insertBefore(o,a,d,g)}function Ba(i,o,a){i.appendChild(o,a)}function Na(i,o,a,d,g){null!==d?Wl(i,o,a,d,g):Ba(i,o,a)}function Fi(i,o){return i.parentNode(o)}let Sf,Th,Yc=function bf(i,o,a){return 40&i.type?ho(i,a):null};function Au(i,o,a,d){const g=or(i,d,o),w=o[11],k=function Ua(i,o,a){return Yc(i,o,a)}(d.parent||o[6],d,o);if(null!=g)if(Array.isArray(a))for(let B=0;B<a.length;B++)Na(w,g,a[B],k,!1);else Na(w,g,a,k,!1)}function ad(i,o){if(null!==o){const a=o.type;if(3&a)return ho(o,i);if(4&a)return cd(-1,i[o.index]);if(8&a){const d=o.child;if(null!==d)return ad(i,d);{const g=i[o.index];return ii(g)?cd(-1,g):gn(g)}}if(32&a)return id(o,i)()||gn(i[o.index]);{const d=ld(i,o);return null!==d?Array.isArray(d)?d[0]:ad(bh(i[16]),d):ad(i,o.next)}}return null}function ld(i,o){return null!==o?i[16][6].projection[o.projection]:null}function cd(i,o){const a=10+i+1;if(a<o.length){const d=o[a],g=d[1].firstChild;if(null!==g)return ad(d,g)}return o[7]}function ja(i,o,a,d,g,w,I){for(;null!=a;){const k=d[a.index],B=a.type;if(I&&0===o&&(k&&Bo(gn(k),d),a.flags|=2),32!=(32&a.flags))if(8&B)ja(i,o,a.child,d,g,w,!1),No(o,i,g,k,w);else if(32&B){const q=id(a,d);let te;for(;te=q();)No(o,i,g,te,w);No(o,i,g,k,w)}else 16&B?Eh(i,o,d,a,g,w):No(o,i,g,k,w);a=I?a.projectionNext:a.next}}function Va(i,o,a,d,g,w){ja(a,d,i.firstChild,o,g,w,!1)}function Eh(i,o,a,d,g,w){const I=a[16],B=I[6].projection[d.projection];if(Array.isArray(B))for(let q=0;q<B.length;q++)No(o,i,g,B[q],w);else ja(i,o,B,I[3],g,w,!0)}function Tf(i,o,a){""===a?i.removeAttribute(o,"class"):i.setAttribute(o,"class",a)}function Xp(i,o,a){const{mergedAttrs:d,classes:g,styles:w}=a;null!==d&&Ia(i,o,d),null!==g&&Tf(i,o,g),null!==w&&function t_(i,o,a){i.setAttribute(o,"style",a)}(i,o,w)}function Lu(i){Sf=i}function Ch(i){return function hd(){if(void 0===Th&&(Th=null,mr.trustedTypes))try{Th=mr.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:i=>i,createScript:i=>i,createScriptURL:i=>i})}catch{}return Th}()?.createScriptURL(i)||i}class ns{constructor(o){this.changingThisBreaksApplicationSecurity=o}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${ar})`}}function pa(i){return i instanceof ns?i.changingThisBreaksApplicationSecurity:i}function Ga(i,o){const a=function Mf(i){return i instanceof ns&&i.getTypeName()||null}(i);if(null!=a&&a!==o){if("ResourceURL"===a&&"URL"===o)return!0;throw new Error(`Required a safe ${o}, got a ${a} (see ${ar})`)}return a===o}const Rf=/^(?:(?:https?|mailto|data|ftp|tel|file|sms):|[^&:/?#]*(?:[/?#]|$))/gi;var Mi=(()=>((Mi=Mi||{})[Mi.NONE=0]="NONE",Mi[Mi.HTML=1]="HTML",Mi[Mi.STYLE=2]="STYLE",Mi[Mi.SCRIPT=3]="SCRIPT",Mi[Mi.URL=4]="URL",Mi[Mi.RESOURCE_URL=5]="RESOURCE_URL",Mi))();function zf(i){const o=ks();return o?o.sanitize(Mi.URL,i)||"":Ga(i,"URL")?pa(i):function dd(i){return(i=String(i)).match(Rf)?i:"unsafe:"+i}(wt(i))}function um(i){const o=ks();if(o)return Ch(o.sanitize(Mi.RESOURCE_URL,i)||"");if(Ga(i,"ResourceURL"))return Ch(pa(i));throw new ut(904,!1)}function Bf(i,o,a){return function dm(i,o){return"src"===o&&("embed"===i||"frame"===i||"iframe"===i||"media"===i||"script"===i)||"href"===o&&("base"===i||"link"===i)?um:zf}(o,a)(i)}function ks(){const i=pt();return i&&i[12]}const jo=new Sr("ENVIRONMENT_INITIALIZER"),pm=new Sr("INJECTOR",-1),pd=new Sr("INJECTOR_DEF_TYPES");class mm{get(o,a=Kr){if(a===Kr){const d=new Error(`NullInjectorError: No provider for ${nn(o)}!`);throw d.name="NullInjectorError",d}return a}}function a_(...i){return{\u0275providers:Fu(0,i),\u0275fromNgModule:!0}}function Fu(i,...o){const a=[],d=new Set;let g;return h(o,w=>{const I=w;md(I,a,[],d)&&(g||(g=[]),g.push(I))}),void 0!==g&&Mh(g,a),a}function Mh(i,o){for(let a=0;a<i.length;a++){const{providers:g}=i[a];eu(g,w=>{o.push(w)})}}function md(i,o,a,d){if(!(i=jt(i)))return!1;let g=null,w=vo(i);const I=!w&&Sn(i);if(w||I){if(I&&!I.standalone)return!1;g=i}else{const B=i.ngModule;if(w=vo(B),!w)return!1;g=B}const k=d.has(g);if(I){if(k)return!1;if(d.add(g),I.dependencies){const B="function"==typeof I.dependencies?I.dependencies():I.dependencies;for(const q of B)md(q,o,a,d)}}else{if(!w)return!1;{if(null!=w.imports&&!k){let q;d.add(g);try{h(w.imports,te=>{md(te,o,a,d)&&(q||(q=[]),q.push(te))})}finally{}void 0!==q&&Mh(q,o)}if(!k){const q=hs(g)||(()=>new g);o.push({provide:g,useFactory:q,deps:yt},{provide:pd,useValue:g,multi:!0},{provide:jo,useValue:()=>H(g),multi:!0})}const B=w.providers;null==B||k||eu(B,te=>{o.push(te)})}}return g!==i&&void 0!==i.providers}function eu(i,o){for(let a of i)qe(a)&&(a=a.\u0275providers),Array.isArray(a)?eu(a,o):o(a)}const l_=_t({provide:String,useValue:_t});function Nf(i){return null!==i&&"object"==typeof i&&l_ in i}function tu(i){return"function"==typeof i}const Uf=new Sr("Set Injector scope."),Bu={},u_={};let Mc;function gd(){return void 0===Mc&&(Mc=new mm),Mc}class Fr{}class Ah extends Fr{get destroyed(){return this._destroyed}constructor(o,a,d,g){super(),this.parent=a,this.source=d,this.scopes=g,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,Rh(o,I=>this.processProvider(I)),this.records.set(pm,nu(void 0,this)),g.has("environment")&&this.records.set(Fr,nu(void 0,this));const w=this.records.get(Uf);null!=w&&"string"==typeof w.value&&this.scopes.add(w.value),this.injectorDefTypes=new Set(this.get(pd.multi,yt,Et.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const o of this._ngOnDestroyHooks)o.ngOnDestroy();for(const o of this._onDestroyHooks)o()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),this._onDestroyHooks.length=0}}onDestroy(o){this._onDestroyHooks.push(o)}runInContext(o){this.assertNotDestroyed();const a=Ui(this),d=$n(void 0);try{return o()}finally{Ui(a),$n(d)}}get(o,a=Kr,d=Et.Default){this.assertNotDestroyed(),d=fe(d);const g=Ui(this),w=$n(void 0);try{if(!(d&Et.SkipSelf)){let k=this.records.get(o);if(void 0===k){const B=function jf(i){return"function"==typeof i||"object"==typeof i&&i instanceof Sr}(o)&&Br(o);k=B&&this.injectableDefInScope(B)?nu(_d(o),Bu):null,this.records.set(o,k)}if(null!=k)return this.hydrate(o,k)}return(d&Et.Self?gd():this.parent).get(o,a=d&Et.Optional&&a===Kr?null:a)}catch(I){if("NullInjectorError"===I.name){if((I[Zo]=I[Zo]||[]).unshift(nn(o)),g)throw I;return function re(i,o,a,d){const g=i[Zo];throw o[Ei]&&g.unshift(o[Ei]),i.message=function ne(i,o,a,d=null){i=i&&"\n"===i.charAt(0)&&"\u0275"==i.charAt(1)?i.slice(2):i;let g=nn(o);if(Array.isArray(o))g=o.map(nn).join(" -> ");else if("object"==typeof o){let w=[];for(let I in o)if(o.hasOwnProperty(I)){let k=o[I];w.push(I+":"+("string"==typeof k?JSON.stringify(k):nn(k)))}g=`{${w.join(", ")}}`}return`${a}${d?"("+d+")":""}[${g}]: ${i.replace(is,"\n  ")}`}("\n"+i.message,g,a,d),i.ngTokenPath=g,i[Zo]=null,i}(I,o,"R3InjectorError",this.source)}throw I}finally{$n(w),Ui(g)}}resolveInjectorInitializers(){const o=Ui(this),a=$n(void 0);try{const d=this.get(jo.multi,yt,Et.Self);for(const g of d)g()}finally{Ui(o),$n(a)}}toString(){const o=[],a=this.records;for(const d of a.keys())o.push(nn(d));return`R3Injector[${o.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new ut(205,!1)}processProvider(o){let a=tu(o=jt(o))?o:jt(o&&o.provide);const d=function vd(i){return Nf(i)?nu(void 0,i.useValue):nu(function Nu(i,o,a){let d;if(tu(i)){const g=jt(i);return hs(g)||_d(g)}if(Nf(i))d=()=>jt(i.useValue);else if(function _m(i){return!(!i||!i.useFactory)}(i))d=()=>i.useFactory(...xe(i.deps||[]));else if(function gm(i){return!(!i||!i.useExisting)}(i))d=()=>H(jt(i.useExisting));else{const g=jt(i&&(i.useClass||i.provide));if(!function ym(i){return!!i.deps}(i))return hs(g)||_d(g);d=()=>new g(...xe(i.deps))}return d}(i),Bu)}(o);if(tu(o)||!0!==o.multi)this.records.get(a);else{let g=this.records.get(a);g||(g=nu(void 0,Bu,!0),g.factory=()=>xe(g.multi),this.records.set(a,g)),a=o,g.multi.push(o)}this.records.set(a,d)}hydrate(o,a){return a.value===Bu&&(a.value=u_,a.value=a.factory()),"object"==typeof a.value&&a.value&&function Ph(i){return null!==i&&"object"==typeof i&&"function"==typeof i.ngOnDestroy}(a.value)&&this._ngOnDestroyHooks.add(a.value),a.value}injectableDefInScope(o){if(!o.providedIn)return!1;const a=jt(o.providedIn);return"string"==typeof a?"any"===a||this.scopes.has(a):this.injectorDefTypes.has(a)}}function _d(i){const o=Br(i),a=null!==o?o.factory:hs(i);if(null!==a)return a;if(i instanceof Sr)throw new ut(204,!1);if(i instanceof Function)return function yd(i){const o=i.length;if(o>0)throw function p(i,o){const a=[];for(let d=0;d<i;d++)a.push(o);return a}(o,"?"),new ut(204,!1);const a=function rs(i){const o=i&&(i[ai]||i[fr]);if(o){const a=function Vs(i){if(i.hasOwnProperty("name"))return i.name;const o=(""+i).match(/^function\s*([^\s(]+)/);return null===o?"":o[1]}(i);return console.warn(`DEPRECATED: DI is instantiating a token "${a}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${a}" class.`),o}return null}(i);return null!==a?()=>a.factory(i):()=>new i}(i);throw new ut(204,!1)}function nu(i,o,a=!1){return{factory:i,value:o,multi:a?[]:void 0}}function Rh(i,o){for(const a of i)Array.isArray(a)?Rh(a,o):a&&qe(a)?Rh(a.\u0275providers,o):o(a)}class h_{}class Vf{}class d_{resolveComponentFactory(o){throw function Lh(i){const o=Error(`No component factory found for ${nn(i)}. Did you add it to @NgModule.entryComponents?`);return o.ngComponent=i,o}(o)}}let ru=(()=>{class i{}return i.NULL=new d_,i})();function $f(){return Jl(hi(),pt())}function Jl(i,o){return new kh(ho(i,o))}let kh=(()=>{class i{constructor(a){this.nativeElement=a}}return i.__NG_ELEMENT_ID__=$f,i})();function f_(i){return i instanceof kh?i.nativeElement:i}class bm{}let p_=(()=>{class i{}return i.__NG_ELEMENT_ID__=()=>function m_(){const i=pt(),a=Si(hi().index,i);return(Li(a)?a:i)[11]}(),i})(),g_=(()=>{class i{}return i.\u0275prov=Vn({token:i,providedIn:"root",factory:()=>null}),i})();class Oh{constructor(o){this.full=o,this.major=o.split(".")[0],this.minor=o.split(".")[1],this.patch=o.split(".").slice(2).join(".")}}const __=new Oh("15.1.2"),xd={};function Gf(i){return i.ngOriginalError}class Fh{constructor(){this._console=console}handleError(o){const a=this._findOriginalError(o);this._console.error("ERROR",o),a&&this._console.error("ORIGINAL ERROR",a)}_findOriginalError(o){let a=o&&Gf(o);for(;a&&Gf(a);)a=Gf(a);return a||null}}function ec(i){return i instanceof Function?i():i}function Dm(i,o,a){let d=i.length;for(;;){const g=i.indexOf(o,a);if(-1===g)return g;if(0===g||i.charCodeAt(g-1)<=32){const w=o.length;if(g+w===d||i.charCodeAt(g+w)<=32)return g}a=g+1}}const Zf="ng-template";function Tm(i,o,a){let d=0;for(;d<i.length;){let g=i[d++];if(a&&"class"===g){if(g=i[d],-1!==Dm(g.toLowerCase(),o,0))return!0}else if(1===g){for(;d<i.length&&"string"==typeof(g=i[d++]);)if(g.toLowerCase()===o)return!0;return!1}}return!1}function qf(i){return 4===i.type&&i.value!==Zf}function Cm(i,o,a){return o===(4!==i.type||a?i.value:Zf)}function Sm(i,o,a){let d=4;const g=i.attrs||[],w=function Ed(i){for(let o=0;o<i.length;o++)if(Ma(i[o]))return o;return i.length}(g);let I=!1;for(let k=0;k<o.length;k++){const B=o[k];if("number"!=typeof B){if(!I)if(4&d){if(d=2|1&d,""!==B&&!Cm(i,B,a)||""===B&&1===o.length){if(ma(d))return!1;I=!0}}else{const q=8&d?B:o[++k];if(8&d&&null!==i.attrs){if(!Tm(i.attrs,q,a)){if(ma(d))return!1;I=!0}continue}const de=T_(8&d?"class":B,g,qf(i),a);if(-1===de){if(ma(d))return!1;I=!0;continue}if(""!==q){let De;De=de>w?"":g[de+1].toLowerCase();const Fe=8&d?De:null;if(Fe&&-1!==Dm(Fe,q,0)||2&d&&q!==De){if(ma(d))return!1;I=!0}}}}else{if(!I&&!ma(d)&&!ma(B))return!1;if(I&&ma(B))continue;I=!1,d=B|1&d}}return ma(d)||I}function ma(i){return 0==(1&i)}function T_(i,o,a,d){if(null===o)return-1;let g=0;if(d||!a){let w=!1;for(;g<o.length;){const I=o[g];if(I===i)return g;if(3===I||6===I)w=!0;else{if(1===I||2===I){let k=o[++g];for(;"string"==typeof k;)k=o[++g];continue}if(4===I)break;if(0===I){g+=4;continue}}g+=w?1:2}return-1}return function Am(i,o){let a=i.indexOf(4);if(a>-1)for(a++;a<i.length;){const d=i[a];if("number"==typeof d)return-1;if(d===o)return a;a++}return-1}(o,i)}function Im(i,o,a=!1){for(let d=0;d<o.length;d++)if(Sm(i,o[d],a))return!0;return!1}function ju(i,o){return i?":not("+o.trim()+")":o}function Vu(i){let o=i[0],a=1,d=2,g="",w=!1;for(;a<i.length;){let I=i[a];if("string"==typeof I)if(2&d){const k=i[++a];g+="["+I+(k.length>0?'="'+k+'"':"")+"]"}else 8&d?g+="."+I:4&d&&(g+=" "+I);else""!==g&&!ma(I)&&(o+=ju(w,g),g=""),d=I,w=w||!ma(d);a++}return""!==g&&(o+=ju(w,g)),o}const zn={};function Rm(i){Lm(Jn(),pt(),_i()+i,!1)}function Lm(i,o,a,d){if(!d)if(3==(3&o[2])){const w=i.preOrderCheckHooks;null!==w&&Qn(o,w,a)}else{const w=i.preOrderHooks;null!==w&&Hn(o,w,0,a)}An(a)}function Nm(i,o=null,a=null,d){const g=Um(i,o,a,d);return g.resolveInjectorInitializers(),g}function Um(i,o=null,a=null,d,g=new Set){const w=[a||yt,a_(i)];return d=d||("object"==typeof i?void 0:nn(i)),new Ah(w,o||gd(),d||null,g)}let iu=(()=>{class i{static create(a,d){if(Array.isArray(a))return Nm({name:""},d,a,"");{const g=a.name??"";return Nm({name:g},a.parent,a.providers,g)}}}return i.THROW_IF_NOT_FOUND=Kr,i.NULL=new mm,i.\u0275prov=Vn({token:i,providedIn:"any",factory:()=>H(pm)}),i.__NG_ELEMENT_ID__=-1,i})();function $u(i,o=Et.Default){const a=pt();return null===a?H(i,o):Vl(hi(),a,jt(i),o)}function Xm(){throw new Error("invalid")}function au(i,o){const a=i.contentQueries;if(null!==a)for(let d=0;d<a.length;d+=2){const w=a[d+1];if(-1!==w){const I=i.data[w];hl(a[d]),I.contentQueries(2,o[w],w)}}}function Id(i,o,a,d,g,w,I,k,B,q,te){const de=o.blueprint.slice();return de[0]=g,de[2]=76|d,(null!==te||i&&1024&i[2])&&(de[2]|=1024),ki(de),de[3]=de[15]=i,de[8]=a,de[10]=I||i&&i[10],de[11]=k||i&&i[11],de[12]=B||i&&i[12]||null,de[9]=q||i&&i[9]||null,de[6]=w,de[20]=function Np(){return Bp++}(),de[21]=te,de[16]=2==o.type?i[16]:de,de}function Gu(i,o,a,d,g){let w=i.data[o];if(null===w)w=function Nh(i,o,a,d,g){const w=Da(),I=gc(),B=i.data[o]=function Qm(i,o,a,d,g,w){return{type:a,index:d,insertBeforeIndex:null,injectorIndex:o?o.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:0,providerIndexes:0,value:g,attrs:w,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:o,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,I?w:w&&w.parent,a,o,d,g);return null===i.firstChild&&(i.firstChild=B),null!==w&&(I?null==w.child&&null!==B.parent&&(w.child=B):null===w.next&&(w.next=B)),B}(i,o,a,d,g),function Nc(){return wn.lFrame.inI18n}()&&(w.flags|=32);else if(64&w.type){w.type=a,w.value=d,w.attrs=g;const I=function ps(){const i=wn.lFrame,o=i.currentTNode;return i.isParent?o:o.parent}();w.injectorIndex=null===I?-1:I.injectorIndex}return gi(w,!0),w}function lu(i,o,a,d){if(0===a)return-1;const g=o.length;for(let w=0;w<a;w++)o.push(d),i.blueprint.push(d),i.data.push(null);return g}function Md(i,o,a){Ss(o);try{const d=i.viewQuery;null!==d&&Od(1,d,a);const g=i.template;null!==g&&Hu(i,o,g,1,a),i.firstCreatePass&&(i.firstCreatePass=!1),i.staticContentQueries&&au(i,o),i.staticViewQueries&&Od(2,i.viewQuery,a);const w=i.components;null!==w&&function k_(i,o){for(let a=0;a<o.length;a++)ug(i,o[a])}(o,w)}catch(d){throw i.firstCreatePass&&(i.incompleteFirstPass=!0,i.firstCreatePass=!1),d}finally{o[2]&=-5,Hi()}}function $o(i,o,a,d){const g=o[2];if(128!=(128&g)){Ss(o);try{ki(o),function cl(i){return wn.lFrame.bindingIndex=i}(i.bindingStartIndex),null!==a&&Hu(i,o,a,2,d);const I=3==(3&g);if(I){const q=i.preOrderCheckHooks;null!==q&&Qn(o,q,null)}else{const q=i.preOrderHooks;null!==q&&Hn(o,q,0,null),Zn(o,0)}if(function Xu(i){for(let o=Wc(i);null!==o;o=Sc(o)){if(!o[2])continue;const a=o[9];for(let d=0;d<a.length;d++){const g=a[d];512&g[2]||ol(g[3],1),g[2]|=512}}}(o),function j_(i){for(let o=Wc(i);null!==o;o=Sc(o))for(let a=10;a<o.length;a++){const d=o[a],g=d[1];Cs(d)&&$o(g,d,g.template,d[8])}}(o),null!==i.contentQueries&&au(i,o),I){const q=i.contentCheckHooks;null!==q&&Qn(o,q)}else{const q=i.contentHooks;null!==q&&Hn(o,q,1),Zn(o,1)}!function Sd(i,o){const a=i.hostBindingOpCodes;if(null!==a)try{for(let d=0;d<a.length;d++){const g=a[d];if(g<0)An(~g);else{const w=g,I=a[++d],k=a[++d];yc(I,w),k(2,o[w])}}}finally{An(-1)}}(i,o);const k=i.components;null!==k&&function Ym(i,o){for(let a=0;a<o.length;a++)rp(i,o[a])}(o,k);const B=i.viewQuery;if(null!==B&&Od(2,B,d),I){const q=i.viewCheckHooks;null!==q&&Qn(o,q)}else{const q=i.viewHooks;null!==q&&Hn(o,q,2),Zn(o,2)}!0===i.firstUpdatePass&&(i.firstUpdatePass=!1),o[2]&=-41,512&o[2]&&(o[2]&=-513,ol(o[3],-1))}finally{Hi()}}}function Hu(i,o,a,d,g){const w=_i(),I=2&d;try{An(-1),I&&o.length>22&&Lm(i,o,22,!1),a(d,g)}finally{An(w)}}function Rc(i,o,a){if(bs(o)){const g=o.directiveEnd;for(let w=o.directiveStart;w<g;w++){const I=i.data[w];I.contentQueries&&I.contentQueries(1,a[w],w)}}}function Uh(i,o,a){Ol()&&(function ig(i,o,a,d){const g=a.directiveStart,w=a.directiveEnd;as(a)&&function kd(i,o,a){const d=ho(o,i),g=Km(a),w=i[10],I=Yu(i,Id(i,g,null,a.onPush?32:16,d,o,w,w.createRenderer(d,a),null,null,null));i[o.index]=I}(o,a,i.data[g+a.componentOffset]),i.firstCreatePass||La(a,o),Bo(d,o);const I=a.initialInputs;for(let k=g;k<w;k++){const B=i.data[k],q=ka(o,i,k,a);Bo(q,o),null!==I&&N_(0,k-g,q,B,0,I),ji(B)&&(Si(a.index,o)[8]=ka(o,i,k,a))}}(i,o,a,ho(a,o)),64==(64&a.flags)&&qu(i,o,a))}function Zu(i,o,a=ho){const d=o.localNames;if(null!==d){let g=o.index+1;for(let w=0;w<d.length;w+=2){const I=d[w+1],k=-1===I?a(o,i):i[I];i[g++]=k}}}function Km(i){const o=i.tView;return null===o||o.incompleteFirstPass?i.tView=Ad(1,null,i.template,i.decls,i.vars,i.directiveDefs,i.pipeDefs,i.viewQuery,i.schemas,i.consts):o}function Ad(i,o,a,d,g,w,I,k,B,q){const te=22+d,de=te+g,De=function Jm(i,o){const a=[];for(let d=0;d<o;d++)a.push(d<i?null:zn);return a}(te,de),Fe="function"==typeof q?q():q;return De[1]={type:i,blueprint:De,template:a,queries:null,viewQuery:k,declTNode:o,data:De.slice().fill(null,te),bindingStartIndex:te,expandoStartIndex:de,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof w?w():w,pipeRegistry:"function"==typeof I?I():I,firstChild:null,schemas:B,consts:Fe,incompleteFirstPass:!1}}function Qf(i,o,a,d){const g=Fd(o);null===a?g.push(d):(g.push(a),i.firstCreatePass&&hg(i).push(d,g.length-1))}function Pd(i,o,a,d){for(let g in i)if(i.hasOwnProperty(g)){a=null===a?{}:a;const w=i[g];null===d?ep(a,o,g,w):d.hasOwnProperty(g)&&ep(a,o,d[g],w)}return a}function ep(i,o,a,d){i.hasOwnProperty(a)?i[a].push(o,d):i[a]=[o,d]}function tp(i,o){const a=Si(o,i);16&a[2]||(a[2]|=32)}function Rd(i,o,a,d){let g=!1;if(Ol()){const w=null===d?null:{"":-1},I=function sg(i,o){const a=i.directiveRegistry;let d=null,g=null;if(a)for(let w=0;w<a.length;w++){const I=a[w];if(Im(o,I.selectors,!1))if(d||(d=[]),ji(I))if(null!==I.findHostDirectiveDefs){const k=[];g=g||new Map,I.findHostDirectiveDefs(I,k,g),d.unshift(...k,I),jh(i,o,k.length)}else d.unshift(I),jh(i,o,0);else g=g||new Map,I.findHostDirectiveDefs?.(I,d,g),d.push(I)}return null===d?null:[d,g]}(i,a);let k,B;null===I?k=B=null:[k,B]=I,null!==k&&(g=!0,ng(i,o,a,k,w,B)),w&&function Wu(i,o,a){if(o){const d=i.localNames=[];for(let g=0;g<o.length;g+=2){const w=a[o[g+1]];if(null==w)throw new ut(-301,!1);d.push(o[g],w)}}}(a,d,w)}return a.mergedAttrs=Ii(a.mergedAttrs,a.attrs),g}function ng(i,o,a,d,g,w){for(let q=0;q<d.length;q++)jl(La(a,o),i,d[q].type);!function Ld(i,o,a){i.flags|=1,i.directiveStart=o,i.directiveEnd=o+a,i.providerIndexes=o}(a,i.data.length,d.length);for(let q=0;q<d.length;q++){const te=d[q];te.providersResolver&&te.providersResolver(te)}let I=!1,k=!1,B=lu(i,o,d.length,null);for(let q=0;q<d.length;q++){const te=d[q];a.mergedAttrs=Ii(a.mergedAttrs,te.hostAttrs),lg(i,a,o,B,te),ag(B,te,g),null!==te.contentQueries&&(a.flags|=4),(null!==te.hostBindings||null!==te.hostAttrs||0!==te.hostVars)&&(a.flags|=64);const de=te.type.prototype;!I&&(de.ngOnChanges||de.ngOnInit||de.ngDoCheck)&&((i.preOrderHooks||(i.preOrderHooks=[])).push(a.index),I=!0),!k&&(de.ngOnChanges||de.ngDoCheck)&&((i.preOrderCheckHooks||(i.preOrderCheckHooks=[])).push(a.index),k=!0),B++}!function F_(i,o,a){const g=o.directiveEnd,w=i.data,I=o.attrs,k=[];let B=null,q=null;for(let te=o.directiveStart;te<g;te++){const de=w[te],De=a?a.get(de):null,nt=De?De.outputs:null;B=Pd(de.inputs,te,B,De?De.inputs:null),q=Pd(de.outputs,te,q,nt);const At=null===B||null===I||qf(o)?null:U_(B,te,I);k.push(At)}null!==B&&(B.hasOwnProperty("class")&&(o.flags|=8),B.hasOwnProperty("style")&&(o.flags|=16)),o.initialInputs=k,o.inputs=B,o.outputs=q}(i,a,w)}function qu(i,o,a){const d=a.directiveStart,g=a.directiveEnd,w=a.index,I=function bu(){return wn.lFrame.currentDirectiveIndex}();try{An(w);for(let k=d;k<g;k++){const B=i.data[k],q=o[k];vc(k),(null!==B.hostBindings||0!==B.hostVars||null!==B.hostAttrs)&&og(B,q)}}finally{An(-1),vc(I)}}function og(i,o){null!==i.hostBindings&&i.hostBindings(1,o)}function jh(i,o,a){o.componentOffset=a,(i.components||(i.components=[])).push(o.index)}function ag(i,o,a){if(a){if(o.exportAs)for(let d=0;d<o.exportAs.length;d++)a[o.exportAs[d]]=i;ji(o)&&(a[""]=i)}}function lg(i,o,a,d,g){i.data[d]=g;const w=g.factory||(g.factory=hs(g.type)),I=new Cr(w,ji(g),$u);i.blueprint[d]=I,a[d]=I,function B_(i,o,a,d,g){const w=g.hostBindings;if(w){let I=i.hostBindingOpCodes;null===I&&(I=i.hostBindingOpCodes=[]);const k=~o.index;(function rg(i){let o=i.length;for(;o>0;){const a=i[--o];if("number"==typeof a&&a<0)return a}return 0})(I)!=k&&I.push(k),I.push(a,d,w)}}(i,o,d,lu(i,a,g.hostVars,zn),g)}function Os(i,o,a,d,g,w){const I=ho(i,o);!function np(i,o,a,d,g,w,I){if(null==w)i.removeAttribute(o,g,a);else{const k=null==I?wt(w):I(w,d||"",g);i.setAttribute(o,g,k,a)}}(o[11],I,w,i.value,a,d,g)}function N_(i,o,a,d,g,w){const I=w[o];if(null!==I){const k=d.setInput;for(let B=0;B<I.length;){const q=I[B++],te=I[B++],de=I[B++];null!==k?d.setInput(a,de,q,te):a[te]=de}}}function U_(i,o,a){let d=null,g=0;for(;g<a.length;){const w=a[g];if(0!==w)if(5!==w){if("number"==typeof w)break;if(i.hasOwnProperty(w)){null===d&&(d=[]);const I=i[w];for(let k=0;k<I.length;k+=2)if(I[k]===o){d.push(w,I[k+1],a[g+1]);break}}g+=2}else g+=2;else g+=4}return d}function cg(i,o,a,d){return[i,!0,!1,o,null,0,d,a,null,null]}function rp(i,o){const a=Si(o,i);if(Cs(a)){const d=a[1];48&a[2]?$o(d,a,d.template,a[8]):a[5]>0&&ip(a)}}function ip(i){for(let d=Wc(i);null!==d;d=Sc(d))for(let g=10;g<d.length;g++){const w=d[g];if(Cs(w))if(512&w[2]){const I=w[1];$o(I,w,I.template,w[8])}else w[5]>0&&ip(w)}const a=i[1].components;if(null!==a)for(let d=0;d<a.length;d++){const g=Si(a[d],i);Cs(g)&&g[5]>0&&ip(g)}}function ug(i,o){const a=Si(o,i),d=a[1];(function V_(i,o){for(let a=o.length;a<i.blueprint.length;a++)o.push(i.blueprint[a])})(d,a),Md(d,a,a[8])}function Yu(i,o){return i[13]?i[14][4]=o:i[13]=o,i[14]=o,o}function op(i){for(;i;){i[2]|=32;const o=bh(i);if(qs(i)&&!o)return i;i=o}return null}function Za(i,o,a,d=!0){const g=o[10];g.begin&&g.begin();try{$o(i,o,i.template,a)}catch(I){throw d&&ap(o,I),I}finally{g.end&&g.end()}}function Od(i,o,a){hl(0),o(i,a)}function Fd(i){return i[7]||(i[7]=[])}function hg(i){return i.cleanup||(i.cleanup=[])}function ap(i,o){const a=i[9],d=a?a.get(Fh,null):null;d&&d.handleError(o)}function zd(i,o,a,d,g){for(let w=0;w<a.length;){const I=a[w++],k=a[w++],B=o[I],q=i.data[I];null!==q.setInput?q.setInput(B,g,d,k):B[k]=g}}function Fs(i,o,a){const d=function Ts(i,o){return gn(o[i])}(o,i);!function ql(i,o,a){i.setValue(o,a)}(i[11],d,a)}function ga(i,o,a){let d=a?i.styles:null,g=a?i.classes:null,w=0;if(null!==o)for(let I=0;I<o.length;I++){const k=o[I];"number"==typeof k?w=k:1==w?g=Ut(g,k):2==w&&(d=Ut(d,k+": "+o[++I]+";"))}a?i.styles=d:i.stylesWithoutHost=d,a?i.classes=g:i.classesWithoutHost=g}function Ku(i,o,a,d,g=!1){for(;null!==a;){const w=o[a.index];if(null!==w&&d.push(gn(w)),ii(w))for(let k=10;k<w.length;k++){const B=w[k],q=B[1].firstChild;null!==q&&Ku(B[1],B,q,d)}const I=a.type;if(8&I)Ku(i,o,a.child,d);else if(32&I){const k=id(a,o);let B;for(;B=k();)d.push(B)}else if(16&I){const k=ld(o,a);if(Array.isArray(k))d.push(...k);else{const B=bh(o[16]);Ku(B[1],B,k,d,!0)}}a=g?a.projectionNext:a.next}return d}class El{get rootNodes(){const o=this._lView,a=o[1];return Ku(a,o,a.firstChild,[])}constructor(o,a){this._lView=o,this._cdRefInjectingView=a,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[8]}set context(o){this._lView[8]=o}get destroyed(){return 128==(128&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const o=this._lView[3];if(ii(o)){const a=o[8],d=a?a.indexOf(this):-1;d>-1&&(vf(o,d),l(a,d))}this._attachedToViewContainer=!1}xi(this._lView[1],this._lView)}onDestroy(o){Qf(this._lView[1],this._lView,null,o)}markForCheck(){op(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-65}reattach(){this._lView[2]|=64}detectChanges(){Za(this._lView[1],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new ut(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function e_(i,o){Va(i,o,o[11],2,null,null)}(this._lView[1],this._lView)}attachToAppRef(o){if(this._attachedToViewContainer)throw new ut(902,!1);this._appRef=o}}class Ju extends El{constructor(o){super(o),this._view=o}detectChanges(){const o=this._view;Za(o[1],o,o[8],!1)}checkNoChanges(){}get context(){return null}}class zs extends ru{constructor(o){super(),this.ngModule=o}resolveComponentFactory(o){const a=Sn(o);return new Vh(a,this.ngModule)}}function Bs(i){const o=[];for(let a in i)i.hasOwnProperty(a)&&o.push({propName:i[a],templateName:a});return o}class fg{constructor(o,a){this.injector=o,this.parentInjector=a}get(o,a,d){d=fe(d);const g=this.injector.get(o,xd,d);return g!==xd||a===xd?g:this.parentInjector.get(o,a,d)}}class Vh extends Vf{get inputs(){return Bs(this.componentDef.inputs)}get outputs(){return Bs(this.componentDef.outputs)}constructor(o,a){super(),this.componentDef=o,this.ngModule=a,this.componentType=o.type,this.selector=function Bh(i){return i.map(Vu).join(",")}(o.selectors),this.ngContentSelectors=o.ngContentSelectors?o.ngContentSelectors:[],this.isBoundToModule=!!a}create(o,a,d,g){let w=(g=g||this.ngModule)instanceof Fr?g:g?.injector;w&&null!==this.componentDef.getStandaloneInjector&&(w=this.componentDef.getStandaloneInjector(w)||w);const I=w?new fg(o,w):o,k=I.get(bm,null);if(null===k)throw new ut(407,!1);const B=I.get(g_,null),q=k.createRenderer(null,this.componentDef),te=this.componentDef.selectors[0][0]||"div",de=d?function O_(i,o,a){return i.selectRootElement(o,a===mt.ShadowDom)}(q,d,this.componentDef.encapsulation):yf(q,te,function G_(i){const o=i.toLowerCase();return"svg"===o?"svg":"math"===o?"math":null}(te)),De=this.componentDef.onPush?288:272,Fe=Ad(0,null,null,1,0,null,null,null,null,null),nt=Id(null,Fe,null,De,null,null,k,q,B,I,null);let At,Gt;Ss(nt);try{const on=this.componentDef;let Dn,Tt=null;on.findHostDirectiveDefs?(Dn=[],Tt=new Map,on.findHostDirectiveDefs(on,Dn,Tt),Dn.push(on)):Dn=[on];const Yn=function cu(i,o){const a=i[1];return i[22]=o,Gu(a,22,2,"#host",null)}(nt,de),Pi=function pg(i,o,a,d,g,w,I,k){const B=g[1];!function mg(i,o,a,d){for(const g of i)o.mergedAttrs=Ii(o.mergedAttrs,g.hostAttrs);null!==o.mergedAttrs&&(ga(o,o.mergedAttrs,!0),null!==a&&Xp(d,a,o))}(d,i,o,I);const q=w.createRenderer(o,a),te=Id(g,Km(a),null,a.onPush?32:16,g[i.index],i,w,q,k||null,null,null);return B.firstCreatePass&&jh(B,i,d.length-1),Yu(g,te),g[i.index]=te}(Yn,de,on,Dn,nt,k,q);Gt=rl(Fe,22),de&&function Bd(i,o,a,d){if(d)Ia(i,a,["ng-version",__.full]);else{const{attrs:g,classes:w}=function Pm(i){const o=[],a=[];let d=1,g=2;for(;d<i.length;){let w=i[d];if("string"==typeof w)2===g?""!==w&&o.push(w,i[++d]):8===g&&a.push(w);else{if(!ma(g))break;g=w}d++}return{attrs:o,classes:a}}(o.selectors[0]);g&&Ia(i,a,g),w&&w.length>0&&Tf(i,a,w.join(" "))}}(q,on,de,d),void 0!==a&&function cp(i,o,a){const d=i.projection=[];for(let g=0;g<o.length;g++){const w=a[g];d.push(null!=w?Array.from(w):null)}}(Gt,this.ngContentSelectors,a),At=function H_(i,o,a,d,g,w){const I=hi(),k=g[1],B=ho(I,g);ng(k,g,I,a,null,d);for(let te=0;te<a.length;te++)Bo(ka(g,k,I.directiveStart+te,I),g);qu(k,g,I),B&&Bo(B,g);const q=ka(g,k,I.directiveStart+I.componentOffset,I);if(i[8]=g[8]=q,null!==w)for(const te of w)te(q,o);return Rc(k,I,i),q}(Pi,on,Dn,Tt,nt,[Qu]),Md(Fe,nt,null)}finally{Hi()}return new lp(this.componentType,At,Jl(Gt,nt),nt,Gt)}}class lp extends h_{constructor(o,a,d,g,w){super(),this.location=d,this._rootLView=g,this._tNode=w,this.instance=a,this.hostView=this.changeDetectorRef=new Ju(g),this.componentType=o}setInput(o,a){const d=this._tNode.inputs;let g;if(null!==d&&(g=d[o])){const w=this._rootLView;zd(w[1],w,g,o,a),tp(w,this._tNode.index)}}get injector(){return new go(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(o){this.hostView.onDestroy(o)}}function Qu(){const i=hi();Yt(pt()[1],i)}let qa=null;function uu(){if(!qa){const i=mr.Symbol;if(i&&i.iterator)qa=i.iterator;else{const o=Object.getOwnPropertyNames(Map.prototype);for(let a=0;a<o.length;++a){const d=o[a];"entries"!==d&&"size"!==d&&Map.prototype[d]===Map.prototype.entries&&(qa=d)}}}return qa}function Lc(i){return!!ih(i)&&(Array.isArray(i)||!(i instanceof Map)&&uu()in i)}function ih(i){return null!==i&&("function"==typeof i||"object"==typeof i)}function Qi(i,o,a){return!Object.is(i[o],a)&&(i[o]=a,!0)}function hu(i,o,a,d){const g=Qi(i,o,a);return Qi(i,o+1,d)||g}function dp(i,o,a,d){const g=pt();return Qi(g,ia(),o)&&(Jn(),Os(z(),g,i,o,a,d)),dp}function sh(i,o,a,d,g,w,I,k){const q=function Zh(i,o,a,d,g){const w=hu(i,o,a,d);return Qi(i,o+2,g)||w}(i,function $i(){return wn.lFrame.bindingIndex}(),a,g,I);return function Gi(i){const o=wn.lFrame,a=o.bindingIndex;return o.bindingIndex=o.bindingIndex+i,a}(3),q?o+wt(a)+d+wt(g)+w+wt(I)+k:zn}function Tg(i,o,a,d,g,w,I,k){const B=pt(),q=Jn(),te=i+22,de=q.firstCreatePass?function W_(i,o,a,d,g,w,I,k,B){const q=o.consts,te=Gu(o,i,4,I||null,fo(q,k));Rd(o,a,te,fo(q,B)),Yt(o,te);const de=te.tViews=Ad(2,te,d,g,w,o.directiveRegistry,o.pipeRegistry,null,o.schemas,q);return null!==o.queries&&(o.queries.template(o,te),de.queries=o.queries.embeddedTView(te)),te}(te,q,B,o,a,d,g,w,I):q.data[te];gi(de,!1);const De=B[11].createComment("");Au(q,B,De,de),Bo(De,B),Yu(B,B[te]=cg(De,B,De,de)),Zs(de)&&Uh(q,B,de),null!=I&&Zu(B,de,k)}function Hd(i){return ea(function Bc(){return wn.lFrame.contextLView}(),22+i)}function pp(i,o,a){const d=pt();return Qi(d,ia(),o)&&function zi(i,o,a,d,g,w,I,k){const B=ho(o,a);let te,q=o.inputs;!k&&null!=q&&(te=q[d])?(zd(i,a,te,d,g),as(o)&&tp(a,o.index)):3&o.type&&(d=function eg(i){return"class"===i?"className":"for"===i?"htmlFor":"formaction"===i?"formAction":"innerHtml"===i?"innerHTML":"readonly"===i?"readOnly":"tabindex"===i?"tabIndex":i}(d),g=null!=I?I(g,o.value||"",d):g,w.setProperty(B,d,g))}(Jn(),z(),d,i,o,d[11],a,!1),pp}function mu(i,o,a,d,g){const I=g?"class":"style";zd(i,a,o.inputs[I],I,d)}function Zd(i,o,a,d){const g=pt(),w=Jn(),I=22+i,k=g[11],B=g[I]=yf(k,o,function $e(){return wn.lFrame.currentNamespace}()),q=w.firstCreatePass?function Y_(i,o,a,d,g,w,I){const k=o.consts,q=Gu(o,i,2,g,fo(k,w));return Rd(o,a,q,fo(k,I)),null!==q.attrs&&ga(q,q.attrs,!1),null!==q.mergedAttrs&&ga(q,q.mergedAttrs,!0),null!==o.queries&&o.queries.elementStart(o,q),q}(I,w,g,0,o,a,d):w.data[I];return gi(q,!0),Xp(k,B,q),32!=(32&q.flags)&&Au(w,g,B,q),0===function ta(){return wn.lFrame.elementDepthCount}()&&Bo(B,g),function sl(){wn.lFrame.elementDepthCount++}(),Zs(q)&&(Uh(w,g,q),Rc(w,q,g)),null!==d&&Zu(g,q),Zd}function Xh(){let i=hi();gc()?function al(){wn.lFrame.isParent=!1}():(i=i.parent,gi(i,!1));const o=i;!function kl(){wn.lFrame.elementDepthCount--}();const a=Jn();return a.firstCreatePass&&(Yt(a,i),bs(i)&&a.queries.elementEnd(i)),null!=o.classesWithoutHost&&function oa(i){return 0!=(8&i.flags)}(o)&&mu(a,o,pt(),o.classesWithoutHost,!0),null!=o.stylesWithoutHost&&function Ca(i){return 0!=(16&i.flags)}(o)&&mu(a,o,pt(),o.stylesWithoutHost,!1),Xh}function mp(i,o,a,d){return Zd(i,o,a,d),Xh(),mp}function Wa(){return pt()}function Cl(i){return!!i&&"function"==typeof i.then}function Yh(i){return!!i&&"function"==typeof i.subscribe}const gp=Yh;function qd(i,o,a,d){const g=pt(),w=Jn(),I=hi();return function Sg(i,o,a,d,g,w,I){const k=Zs(d),q=i.firstCreatePass&&hg(i),te=o[8],de=Fd(o);let De=!0;if(3&d.type||I){const At=ho(d,o),Gt=I?I(At):At,on=de.length,Dn=I?Yn=>I(gn(Yn[d.index])):d.index;let Tt=null;if(!I&&k&&(Tt=function yp(i,o,a,d){const g=i.cleanup;if(null!=g)for(let w=0;w<g.length-1;w+=2){const I=g[w];if(I===a&&g[w+1]===d){const k=o[7],B=g[w+2];return k.length>B?k[B]:null}"string"==typeof I&&(w+=2)}return null}(i,o,g,d.index)),null!==Tt)(Tt.__ngLastListenerFn__||Tt).__ngNextListenerFn__=w,Tt.__ngLastListenerFn__=w,De=!1;else{w=xp(d,o,te,w,!1);const Yn=a.listen(Gt,g,w);de.push(w,Yn),q&&q.push(g,Dn,on,on+1)}}else w=xp(d,o,te,w,!1);const Fe=d.outputs;let nt;if(De&&null!==Fe&&(nt=Fe[g])){const At=nt.length;if(At)for(let Gt=0;Gt<At;Gt+=2){const Pi=o[nt[Gt]][nt[Gt+1]].subscribe(w),io=de.length;de.push(w,Pi),q&&q.push(g,d.index,io,-(io+1))}}}(w,g,g[11],I,i,o,d),qd}function vp(i,o,a,d){try{return!1!==a(d)}catch(g){return ap(i,g),!1}}function xp(i,o,a,d,g){return function w(I){if(I===Function)return d;op(i.componentOffset>-1?Si(i.index,o):o);let B=vp(o,0,d,I),q=w.__ngNextListenerFn__;for(;q;)B=vp(o,0,q,I)&&B,q=q.__ngNextListenerFn__;return g&&!1===B&&(I.preventDefault(),I.returnValue=!1),B}}function bp(i=1){return function Yo(i){return(wn.lFrame.contextLView=function Is(i,o){for(;i>0;)o=o[15],i--;return o}(i,wn.lFrame.contextLView))[8]}(i)}function un(i,o=""){const a=pt(),d=Jn(),g=i+22,w=d.firstCreatePass?Gu(d,g,1,o,null):d.data[g],I=a[g]=function xl(i,o){return i.createText(o)}(a[11],o);Au(d,a,I,w),gi(w,!1)}function Fn(i){return Rn("",i,""),Fn}function Rn(i,o,a){const d=pt(),g=function oh(i,o,a,d){return Qi(i,ia(),a)?o+wt(a)+d:zn}(d,i,o,a);return g!==zn&&Fs(d,_i(),g),Rn}function hn(i,o,a,d,g,w,I){const k=pt(),B=sh(k,i,o,a,d,g,w,I);return B!==zn&&Fs(k,_i(),B),hn}const cc=void 0;var Oc=["en",[["a","p"],["AM","PM"],cc],[["AM","PM"],cc,cc],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],cc,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],cc,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",cc,"{1} 'at' {0}",cc],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function Ip(i){const a=Math.floor(Math.abs(i)),d=i.toString().replace(/^[^.]*\.?/,"").length;return 1===a&&0===d?1:5}];let Fc={};function Ho(i){const o=function U0(i){return i.toLowerCase().replace(/_/g,"-")}(i);let a=nf(o);if(a)return a;const d=o.split("-")[0];if(a=nf(d),a)return a;if("en"===d)return Oc;throw new ut(701,!1)}function fh(i){return Ho(i)[_n.PluralCase]}function nf(i){return i in Fc||(Fc[i]=mr.ng&&mr.ng.common&&mr.ng.common.locales&&mr.ng.common.locales[i]),Fc[i]}var _n=(()=>((_n=_n||{})[_n.LocaleId=0]="LocaleId",_n[_n.DayPeriodsFormat=1]="DayPeriodsFormat",_n[_n.DayPeriodsStandalone=2]="DayPeriodsStandalone",_n[_n.DaysFormat=3]="DaysFormat",_n[_n.DaysStandalone=4]="DaysStandalone",_n[_n.MonthsFormat=5]="MonthsFormat",_n[_n.MonthsStandalone=6]="MonthsStandalone",_n[_n.Eras=7]="Eras",_n[_n.FirstDayOfWeek=8]="FirstDayOfWeek",_n[_n.WeekendRange=9]="WeekendRange",_n[_n.DateFormat=10]="DateFormat",_n[_n.TimeFormat=11]="TimeFormat",_n[_n.DateTimeFormat=12]="DateTimeFormat",_n[_n.NumberSymbols=13]="NumberSymbols",_n[_n.NumberFormats=14]="NumberFormats",_n[_n.CurrencyCode=15]="CurrencyCode",_n[_n.CurrencySymbol=16]="CurrencySymbol",_n[_n.CurrencyName=17]="CurrencyName",_n[_n.Currencies=18]="Currencies",_n[_n.Directionality=19]="Directionality",_n[_n.PluralCase=20]="PluralCase",_n[_n.ExtraData=21]="ExtraData",_n))();const rf="en-US";let Vy=rf;class sf{}class pv{}function Nx(i,o){return new mv(i,o??null)}class mv extends sf{constructor(o,a){super(),this._parent=a,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new zs(this);const d=_r(o);this._bootstrapComponents=ec(d.bootstrap),this._r3Injector=Um(o,a,[{provide:sf,useValue:this},{provide:ru,useValue:this.componentFactoryResolver}],nn(o),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(o)}get injector(){return this._r3Injector}destroy(){const o=this._r3Injector;!o.destroyed&&o.destroy(),this.destroyCbs.forEach(a=>a()),this.destroyCbs=null}onDestroy(o){this.destroyCbs.push(o)}}class sy extends pv{constructor(o){super(),this.moduleType=o}create(o){return new mv(this.moduleType,o)}}class Ux extends sf{constructor(o,a,d){super(),this.componentFactoryResolver=new zs(this),this.instance=null;const g=new Ah([...o,{provide:sf,useValue:this},{provide:ru,useValue:this.componentFactoryResolver}],a||gd(),d,new Set(["environment"]));this.injector=g,g.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(o){this.injector.onDestroy(o)}}function ay(i,o,a=null){return new Ux(i,o,a).injector}let jx=(()=>{class i{constructor(a){this._injector=a,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(a){if(!a.standalone)return null;if(!this.cachedInjectors.has(a.id)){const d=Fu(0,a.type),g=d.length>0?ay([d],this._injector,`Standalone[${a.type.name}]`):null;this.cachedInjectors.set(a.id,g)}return this.cachedInjectors.get(a.id)}ngOnDestroy(){try{for(const a of this.cachedInjectors.values())null!==a&&a.destroy()}finally{this.cachedInjectors.clear()}}}return i.\u0275prov=Vn({token:i,providedIn:"environment",factory:()=>new i(H(Fr))}),i})();function gv(i){i.getStandaloneInjector=o=>o.get(jx).getOrCreateStandaloneInjector(i)}function Ev(i,o,a,d,g){return Tv(pt(),Zr(),i,o,a,d,g)}function Tv(i,o,a,d,g,w,I){const k=o+a;return hu(i,k,g,w)?function Dl(i,o,a){return i[o]=a}(i,k+2,I?d.call(I,g,w):d(g,w)):function kp(i,o){const a=i[o];return a===zn?void 0:a}(i,k+2)}function Mv(i,o){const a=Jn();let d;const g=i+22;a.firstCreatePass?(d=function o1(i,o){if(o)for(let a=o.length-1;a>=0;a--){const d=o[a];if(i===d.name)return d}}(o,a.pipeRegistry),a.data[g]=d,d.onDestroy&&(a.destroyHooks||(a.destroyHooks=[])).push(g,d.onDestroy)):d=a.data[g];const w=d.factory||(d.factory=hs(d.type)),I=$n($u);try{const k=Ra(!1),B=w();return Ra(k),function X_(i,o,a,d){a>=i.data.length&&(i.data[a]=null,i.blueprint[a]=null),o[a]=d}(a,pt(),g,B),B}finally{$n(I)}}function Av(i,o,a,d){const g=i+22,w=pt(),I=ea(w,g);return function Op(i,o){return i[1].data[o].pure}(w,g)?Tv(w,Zr(),o,I.transform,a,d,I):I.transform(a,d)}function cy(i){return o=>{setTimeout(i,void 0,o)}}const zc=class u1 extends K.x{constructor(o=!1){super(),this.__isAsync=o}emit(o){super.next(o)}subscribe(o,a,d){let g=o,w=a||(()=>null),I=d;if(o&&"object"==typeof o){const B=o;g=B.next?.bind(B),w=B.error?.bind(B),I=B.complete?.bind(B)}this.__isAsync&&(w=cy(w),g&&(g=cy(g)),I&&(I=cy(I)));const k=super.subscribe({next:g,error:w,complete:I});return o instanceof Ie.w0&&o.add(k),k}};function h1(){return this._results[uu()]()}class uy{get changes(){return this._changes||(this._changes=new zc)}constructor(o=!1){this._emitDistinctChangesOnly=o,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const a=uu(),d=uy.prototype;d[a]||(d[a]=h1)}get(o){return this._results[o]}map(o){return this._results.map(o)}filter(o){return this._results.filter(o)}find(o){return this._results.find(o)}reduce(o,a){return this._results.reduce(o,a)}forEach(o){this._results.forEach(o)}some(o){return this._results.some(o)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(o,a){const d=this;d.dirty=!1;const g=function Oi(i){return i.flat(Number.POSITIVE_INFINITY)}(o);(this._changesDetected=!function Iu(i,o,a){if(i.length!==o.length)return!1;for(let d=0;d<i.length;d++){let g=i[d],w=o[d];if(a&&(g=a(g),w=a(w)),w!==g)return!1}return!0}(d._results,g,a))&&(d._results=g,d.length=g.length,d.last=g[this.length-1],d.first=g[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}let Fp=(()=>{class i{}return i.__NG_ELEMENT_ID__=p1,i})();const d1=Fp,f1=class extends d1{constructor(o,a,d){super(),this._declarationLView=o,this._declarationTContainer=a,this.elementRef=d}createEmbeddedView(o,a){const d=this._declarationTContainer.tViews,g=Id(this._declarationLView,d,o,16,null,d.declTNode,null,null,null,null,a||null);g[17]=this._declarationLView[this._declarationTContainer.index];const I=this._declarationLView[19];return null!==I&&(g[19]=I.createEmbeddedView(d)),Md(d,g,o),new El(g)}};function p1(){return Ug(hi(),pt())}function Ug(i,o){return 4&i.type?new f1(o,i,Jl(i,o)):null}let jg=(()=>{class i{}return i.__NG_ELEMENT_ID__=m1,i})();function m1(){return Lv(hi(),pt())}const g1=jg,Pv=class extends g1{constructor(o,a,d){super(),this._lContainer=o,this._hostTNode=a,this._hostLView=d}get element(){return Jl(this._hostTNode,this._hostLView)}get injector(){return new go(this._hostTNode,this._hostLView)}get parentInjector(){const o=Ko(this._hostTNode,this._hostLView);if(Aa(o)){const a=Pa(o,this._hostLView),d=wc(o);return new go(a[1].data[d+8],a)}return new go(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(o){const a=Rv(this._lContainer);return null!==a&&a[o]||null}get length(){return this._lContainer.length-10}createEmbeddedView(o,a,d){let g,w;"number"==typeof d?g=d:null!=d&&(g=d.index,w=d.injector);const I=o.createEmbeddedView(a||{},w);return this.insert(I,g),I}createComponent(o,a,d,g,w){const I=o&&!function gs(i){return"function"==typeof i}(o);let k;if(I)k=a;else{const de=a||{};k=de.index,d=de.injector,g=de.projectableNodes,w=de.environmentInjector||de.ngModuleRef}const B=I?o:new Vh(Sn(o)),q=d||this.parentInjector;if(!w&&null==B.ngModule){const De=(I?q:this.parentInjector).get(Fr,null);De&&(w=De)}const te=B.create(q,g,void 0,w);return this.insert(te.hostView,k),te}insert(o,a){const d=o._lView,g=d[1];if(function il(i){return ii(i[3])}(d)){const te=this.indexOf(o);if(-1!==te)this.detach(te);else{const de=d[3],De=new Pv(de,de[6],de[3]);De.detach(De.indexOf(o))}}const w=this._adjustIndex(a),I=this._lContainer;!function od(i,o,a,d){const g=10+d,w=a.length;d>0&&(a[g-1][4]=o),d<w-10?(o[4]=a[g],r(a,10+d,o)):(a.push(o),o[4]=null),o[3]=a;const I=o[17];null!==I&&a!==I&&function za(i,o){const a=i[9];o[16]!==o[3][3][16]&&(i[2]=!0),null===a?i[9]=[o]:a.push(o)}(I,o);const k=o[19];null!==k&&k.insertView(i),o[2]|=64}(g,d,I,w);const k=cd(w,I),B=d[11],q=Fi(B,I[7]);return null!==q&&function Qg(i,o,a,d,g,w){d[0]=g,d[6]=o,Va(i,d,a,1,g,w)}(g,I[6],B,d,q,k),o.attachToViewContainerRef(),r(hy(I),w,o),o}move(o,a){return this.insert(o,a)}indexOf(o){const a=Rv(this._lContainer);return null!==a?a.indexOf(o):-1}remove(o){const a=this._adjustIndex(o,-1),d=vf(this._lContainer,a);d&&(l(hy(this._lContainer),a),xi(d[1],d))}detach(o){const a=this._adjustIndex(o,-1),d=vf(this._lContainer,a);return d&&null!=l(hy(this._lContainer),a)?new El(d):null}_adjustIndex(o,a=0){return o??this.length+a}};function Rv(i){return i[8]}function hy(i){return i[8]||(i[8]=[])}function Lv(i,o){let a;const d=o[i.index];if(ii(d))a=d;else{let g;if(8&i.type)g=gn(d);else{const w=o[11];g=w.createComment("");const I=ho(i,o);Wl(w,Fi(w,I),g,function qp(i,o){return i.nextSibling(o)}(w,I),!1)}o[i.index]=a=cg(d,o,g,i),Yu(o,a)}return new Pv(a,i,o)}class dy{constructor(o){this.queryList=o,this.matches=null}clone(){return new dy(this.queryList)}setDirty(){this.queryList.setDirty()}}class fy{constructor(o=[]){this.queries=o}createEmbeddedView(o){const a=o.queries;if(null!==a){const d=null!==o.contentQueries?o.contentQueries[0]:a.length,g=[];for(let w=0;w<d;w++){const I=a.getByIndex(w);g.push(this.queries[I.indexInDeclarationView].clone())}return new fy(g)}return null}insertView(o){this.dirtyQueriesWithMatches(o)}detachView(o){this.dirtyQueriesWithMatches(o)}dirtyQueriesWithMatches(o){for(let a=0;a<this.queries.length;a++)null!==Vv(o,a).matches&&this.queries[a].setDirty()}}class kv{constructor(o,a,d=null){this.predicate=o,this.flags=a,this.read=d}}class py{constructor(o=[]){this.queries=o}elementStart(o,a){for(let d=0;d<this.queries.length;d++)this.queries[d].elementStart(o,a)}elementEnd(o){for(let a=0;a<this.queries.length;a++)this.queries[a].elementEnd(o)}embeddedTView(o){let a=null;for(let d=0;d<this.length;d++){const g=null!==a?a.length:0,w=this.getByIndex(d).embeddedTView(o,g);w&&(w.indexInDeclarationView=d,null!==a?a.push(w):a=[w])}return null!==a?new py(a):null}template(o,a){for(let d=0;d<this.queries.length;d++)this.queries[d].template(o,a)}getByIndex(o){return this.queries[o]}get length(){return this.queries.length}track(o){this.queries.push(o)}}class my{constructor(o,a=-1){this.metadata=o,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=a}elementStart(o,a){this.isApplyingToNode(a)&&this.matchTNode(o,a)}elementEnd(o){this._declarationNodeIndex===o.index&&(this._appliesToNextNode=!1)}template(o,a){this.elementStart(o,a)}embeddedTView(o,a){return this.isApplyingToNode(o)?(this.crossesNgTemplate=!0,this.addMatch(-o.index,a),new my(this.metadata)):null}isApplyingToNode(o){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const a=this._declarationNodeIndex;let d=o.parent;for(;null!==d&&8&d.type&&d.index!==a;)d=d.parent;return a===(null!==d?d.index:-1)}return this._appliesToNextNode}matchTNode(o,a){const d=this.metadata.predicate;if(Array.isArray(d))for(let g=0;g<d.length;g++){const w=d[g];this.matchTNodeWithReadOption(o,a,_1(a,w)),this.matchTNodeWithReadOption(o,a,yi(a,o,w,!1,!1))}else d===Fp?4&a.type&&this.matchTNodeWithReadOption(o,a,-1):this.matchTNodeWithReadOption(o,a,yi(a,o,d,!1,!1))}matchTNodeWithReadOption(o,a,d){if(null!==d){const g=this.metadata.read;if(null!==g)if(g===kh||g===jg||g===Fp&&4&a.type)this.addMatch(a.index,-2);else{const w=yi(a,o,g,!1,!1);null!==w&&this.addMatch(a.index,w)}else this.addMatch(a.index,d)}}addMatch(o,a){null===this.matches?this.matches=[o,a]:this.matches.push(o,a)}}function _1(i,o){const a=i.localNames;if(null!==a)for(let d=0;d<a.length;d+=2)if(a[d]===o)return a[d+1];return null}function v1(i,o,a,d){return-1===a?function y1(i,o){return 11&i.type?Jl(i,o):4&i.type?Ug(i,o):null}(o,i):-2===a?function x1(i,o,a){return a===kh?Jl(o,i):a===Fp?Ug(o,i):a===jg?Lv(o,i):void 0}(i,o,d):ka(i,i[1],a,o)}function Ov(i,o,a,d){const g=o[19].queries[d];if(null===g.matches){const w=i.data,I=a.matches,k=[];for(let B=0;B<I.length;B+=2){const q=I[B];k.push(q<0?null:v1(o,w[q],I[B+1],a.metadata.read))}g.matches=k}return g.matches}function gy(i,o,a,d){const g=i.queries.getByIndex(a),w=g.matches;if(null!==w){const I=Ov(i,o,g,a);for(let k=0;k<w.length;k+=2){const B=w[k];if(B>0)d.push(I[k/2]);else{const q=w[k+1],te=o[-B];for(let de=10;de<te.length;de++){const De=te[de];De[17]===De[3]&&gy(De[1],De,q,d)}if(null!==te[9]){const de=te[9];for(let De=0;De<de.length;De++){const Fe=de[De];gy(Fe[1],Fe,q,d)}}}}}return d}function Fv(i){const o=pt(),a=Jn(),d=ul();hl(d+1);const g=Vv(a,d);if(i.dirty&&function xu(i){return 4==(4&i[2])}(o)===(2==(2&g.metadata.flags))){if(null===g.matches)i.reset([]);else{const w=g.crossesNgTemplate?gy(a,o,d,[]):Ov(a,o,g,d);i.reset(w,f_),i.notifyOnChanges()}return!0}return!1}function zv(i,o,a){const d=Jn();d.firstCreatePass&&(jv(d,new kv(i,o,a),-1),2==(2&o)&&(d.staticViewQueries=!0)),Uv(d,pt(),o)}function Bv(i,o,a,d){const g=Jn();if(g.firstCreatePass){const w=hi();jv(g,new kv(o,a,d),w.index),function w1(i,o){const a=i.contentQueries||(i.contentQueries=[]);o!==(a.length?a[a.length-1]:-1)&&a.push(i.queries.length-1,o)}(g,i),2==(2&a)&&(g.staticContentQueries=!0)}Uv(g,pt(),a)}function Nv(){return function b1(i,o){return i[19].queries[o].queryList}(pt(),ul())}function Uv(i,o,a){const d=new uy(4==(4&a));Qf(i,o,d,d.destroy),null===o[19]&&(o[19]=new fy),o[19].queries.push(new dy(d))}function jv(i,o,a){null===i.queries&&(i.queries=new py),i.queries.track(new my(o,a))}function Vv(i,o){return i.queries.getByIndex(o)}function $g(...i){}const l0=new Sr("Application Initializer");let Gg=(()=>{class i{constructor(a){this.appInits=a,this.resolve=$g,this.reject=$g,this.initialized=!1,this.done=!1,this.donePromise=new Promise((d,g)=>{this.resolve=d,this.reject=g})}runInitializers(){if(this.initialized)return;const a=[],d=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let g=0;g<this.appInits.length;g++){const w=this.appInits[g]();if(Cl(w))a.push(w);else if(gp(w)){const I=new Promise((k,B)=>{w.subscribe({complete:k,error:B})});a.push(I)}}Promise.all(a).then(()=>{d()}).catch(g=>{this.reject(g)}),0===a.length&&d(),this.initialized=!0}}return i.\u0275fac=function(a){return new(a||i)(H(l0,8))},i.\u0275prov=Vn({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();const c0=new Sr("AppId",{providedIn:"root",factory:function u0(){return`${by()}${by()}${by()}`}});function by(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const h0=new Sr("Platform Initializer"),$1=new Sr("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),d0=new Sr("appBootstrapListener");let G1=(()=>{class i{log(a){console.log(a)}warn(a){console.warn(a)}}return i.\u0275fac=function(a){return new(a||i)},i.\u0275prov=Vn({token:i,factory:i.\u0275fac,providedIn:"platform"}),i})();const Hg=new Sr("LocaleId",{providedIn:"root",factory:()=>ae(Hg,Et.Optional|Et.SkipSelf)||function H1(){return typeof $localize<"u"&&$localize.locale||rf}()}),Z1=new Sr("DefaultCurrencyCode",{providedIn:"root",factory:()=>"USD"});class q1{constructor(o,a){this.ngModuleFactory=o,this.componentFactories=a}}let W1=(()=>{class i{compileModuleSync(a){return new sy(a)}compileModuleAsync(a){return Promise.resolve(this.compileModuleSync(a))}compileModuleAndAllComponentsSync(a){const d=this.compileModuleSync(a),w=ec(_r(a).declarations).reduce((I,k)=>{const B=Sn(k);return B&&I.push(new Vh(B)),I},[]);return new q1(d,w)}compileModuleAndAllComponentsAsync(a){return Promise.resolve(this.compileModuleAndAllComponentsSync(a))}clearCache(){}clearCacheFor(a){}getModuleId(a){}}return i.\u0275fac=function(a){return new(a||i)},i.\u0275prov=Vn({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();const K1=(()=>Promise.resolve(0))();function wy(i){typeof Zone>"u"?K1.then(()=>{i&&i.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",i)}class Il{constructor({enableLongStackTrace:o=!1,shouldCoalesceEventChangeDetection:a=!1,shouldCoalesceRunChangeDetection:d=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new zc(!1),this.onMicrotaskEmpty=new zc(!1),this.onStable=new zc(!1),this.onError=new zc(!1),typeof Zone>"u")throw new ut(908,!1);Zone.assertZonePatched();const g=this;g._nesting=0,g._outer=g._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(g._inner=g._inner.fork(new Zone.TaskTrackingZoneSpec)),o&&Zone.longStackTraceZoneSpec&&(g._inner=g._inner.fork(Zone.longStackTraceZoneSpec)),g.shouldCoalesceEventChangeDetection=!d&&a,g.shouldCoalesceRunChangeDetection=d,g.lastRequestAnimationFrameId=-1,g.nativeRequestAnimationFrame=function J1(){let i=mr.requestAnimationFrame,o=mr.cancelAnimationFrame;if(typeof Zone<"u"&&i&&o){const a=i[Zone.__symbol__("OriginalDelegate")];a&&(i=a);const d=o[Zone.__symbol__("OriginalDelegate")];d&&(o=d)}return{nativeRequestAnimationFrame:i,nativeCancelAnimationFrame:o}}().nativeRequestAnimationFrame,function tb(i){const o=()=>{!function eb(i){i.isCheckStableRunning||-1!==i.lastRequestAnimationFrameId||(i.lastRequestAnimationFrameId=i.nativeRequestAnimationFrame.call(mr,()=>{i.fakeTopEventTask||(i.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{i.lastRequestAnimationFrameId=-1,Dy(i),i.isCheckStableRunning=!0,Ey(i),i.isCheckStableRunning=!1},void 0,()=>{},()=>{})),i.fakeTopEventTask.invoke()}),Dy(i))}(i)};i._inner=i._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(a,d,g,w,I,k)=>{try{return m0(i),a.invokeTask(g,w,I,k)}finally{(i.shouldCoalesceEventChangeDetection&&"eventTask"===w.type||i.shouldCoalesceRunChangeDetection)&&o(),g0(i)}},onInvoke:(a,d,g,w,I,k,B)=>{try{return m0(i),a.invoke(g,w,I,k,B)}finally{i.shouldCoalesceRunChangeDetection&&o(),g0(i)}},onHasTask:(a,d,g,w)=>{a.hasTask(g,w),d===g&&("microTask"==w.change?(i._hasPendingMicrotasks=w.microTask,Dy(i),Ey(i)):"macroTask"==w.change&&(i.hasPendingMacrotasks=w.macroTask))},onHandleError:(a,d,g,w)=>(a.handleError(g,w),i.runOutsideAngular(()=>i.onError.emit(w)),!1)})}(g)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!Il.isInAngularZone())throw new ut(909,!1)}static assertNotInAngularZone(){if(Il.isInAngularZone())throw new ut(909,!1)}run(o,a,d){return this._inner.run(o,a,d)}runTask(o,a,d,g){const w=this._inner,I=w.scheduleEventTask("NgZoneEvent: "+g,o,Q1,$g,$g);try{return w.runTask(I,a,d)}finally{w.cancelTask(I)}}runGuarded(o,a,d){return this._inner.runGuarded(o,a,d)}runOutsideAngular(o){return this._outer.run(o)}}const Q1={};function Ey(i){if(0==i._nesting&&!i.hasPendingMicrotasks&&!i.isStable)try{i._nesting++,i.onMicrotaskEmpty.emit(null)}finally{if(i._nesting--,!i.hasPendingMicrotasks)try{i.runOutsideAngular(()=>i.onStable.emit(null))}finally{i.isStable=!0}}}function Dy(i){i.hasPendingMicrotasks=!!(i._hasPendingMicrotasks||(i.shouldCoalesceEventChangeDetection||i.shouldCoalesceRunChangeDetection)&&-1!==i.lastRequestAnimationFrameId)}function m0(i){i._nesting++,i.isStable&&(i.isStable=!1,i.onUnstable.emit(null))}function g0(i){i._nesting--,Ey(i)}class nb{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new zc,this.onMicrotaskEmpty=new zc,this.onStable=new zc,this.onError=new zc}run(o,a,d){return o.apply(a,d)}runGuarded(o,a,d){return o.apply(a,d)}runOutsideAngular(o){return o()}runTask(o,a,d,g){return o.apply(a,d)}}const _0=new Sr(""),y0=new Sr("");let Ty,rb=(()=>{class i{constructor(a,d,g){this._ngZone=a,this.registry=d,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,Ty||(function ib(i){Ty=i}(g),g.addToWindow(d)),this._watchAngularEvents(),a.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{Il.assertNotInAngularZone(),wy(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())wy(()=>{for(;0!==this._callbacks.length;){let a=this._callbacks.pop();clearTimeout(a.timeoutId),a.doneCb(this._didWork)}this._didWork=!1});else{let a=this.getPendingTasks();this._callbacks=this._callbacks.filter(d=>!d.updateCb||!d.updateCb(a)||(clearTimeout(d.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(a=>({source:a.source,creationLocation:a.creationLocation,data:a.data})):[]}addCallback(a,d,g){let w=-1;d&&d>0&&(w=setTimeout(()=>{this._callbacks=this._callbacks.filter(I=>I.timeoutId!==w),a(this._didWork,this.getPendingTasks())},d)),this._callbacks.push({doneCb:a,timeoutId:w,updateCb:g})}whenStable(a,d,g){if(g&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(a,d,g),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(a){this.registry.registerApplication(a,this)}unregisterApplication(a){this.registry.unregisterApplication(a)}findProviders(a,d,g){return[]}}return i.\u0275fac=function(a){return new(a||i)(H(Il),H(v0),H(y0))},i.\u0275prov=Vn({token:i,factory:i.\u0275fac}),i})(),v0=(()=>{class i{constructor(){this._applications=new Map}registerApplication(a,d){this._applications.set(a,d)}unregisterApplication(a){this._applications.delete(a)}unregisterAllApplications(){this._applications.clear()}getTestability(a){return this._applications.get(a)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(a,d=!0){return Ty?.findTestabilityInTree(this,a,d)??null}}return i.\u0275fac=function(a){return new(a||i)},i.\u0275prov=Vn({token:i,factory:i.\u0275fac,providedIn:"platform"}),i})(),ph=null;const x0=new Sr("AllowMultipleToken"),Cy=new Sr("PlatformDestroyListeners");class ab{constructor(o,a){this.name=o,this.token=a}}function w0(i,o,a=[]){const d=`Platform: ${o}`,g=new Sr(d);return(w=[])=>{let I=Sy();if(!I||I.injector.get(x0,!1)){const k=[...a,...w,{provide:g,useValue:!0}];i?i(k):function lb(i){if(ph&&!ph.get(x0,!1))throw new ut(400,!1);ph=i;const o=i.get(D0);(function b0(i){const o=i.get(h0,null);o&&o.forEach(a=>a())})(i)}(function E0(i=[],o){return iu.create({name:o,providers:[{provide:Uf,useValue:"platform"},{provide:Cy,useValue:new Set([()=>ph=null])},...i]})}(k,d))}return function ub(i){const o=Sy();if(!o)throw new ut(401,!1);return o}()}}function Sy(){return ph?.get(D0)??null}let D0=(()=>{class i{constructor(a){this._injector=a,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(a,d){const g=function C0(i,o){let a;return a="noop"===i?new nb:("zone.js"===i?void 0:i)||new Il(o),a}(d?.ngZone,function T0(i){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:!(!i||!i.ngZoneEventCoalescing)||!1,shouldCoalesceRunChangeDetection:!(!i||!i.ngZoneRunCoalescing)||!1}}(d)),w=[{provide:Il,useValue:g}];return g.run(()=>{const I=iu.create({providers:w,parent:this.injector,name:a.moduleType.name}),k=a.create(I),B=k.injector.get(Fh,null);if(!B)throw new ut(402,!1);return g.runOutsideAngular(()=>{const q=g.onError.subscribe({next:te=>{B.handleError(te)}});k.onDestroy(()=>{qg(this._modules,k),q.unsubscribe()})}),function S0(i,o,a){try{const d=a();return Cl(d)?d.catch(g=>{throw o.runOutsideAngular(()=>i.handleError(g)),g}):d}catch(d){throw o.runOutsideAngular(()=>i.handleError(d)),d}}(B,g,()=>{const q=k.injector.get(Gg);return q.runInitializers(),q.donePromise.then(()=>(function $y(i){nr(i,"Expected localeId to be defined"),"string"==typeof i&&(Vy=i.toLowerCase().replace(/_/g,"-"))}(k.injector.get(Hg,rf)||rf),this._moduleDoBootstrap(k),k))})})}bootstrapModule(a,d=[]){const g=I0({},d);return function ob(i,o,a){const d=new sy(a);return Promise.resolve(d)}(0,0,a).then(w=>this.bootstrapModuleFactory(w,g))}_moduleDoBootstrap(a){const d=a.injector.get(Zg);if(a._bootstrapComponents.length>0)a._bootstrapComponents.forEach(g=>d.bootstrap(g));else{if(!a.instance.ngDoBootstrap)throw new ut(-403,!1);a.instance.ngDoBootstrap(d)}this._modules.push(a)}onDestroy(a){this._destroyListeners.push(a)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new ut(404,!1);this._modules.slice().forEach(d=>d.destroy()),this._destroyListeners.forEach(d=>d());const a=this._injector.get(Cy,null);a&&(a.forEach(d=>d()),a.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}}return i.\u0275fac=function(a){return new(a||i)(H(iu))},i.\u0275prov=Vn({token:i,factory:i.\u0275fac,providedIn:"platform"}),i})();function I0(i,o){return Array.isArray(o)?o.reduce(I0,i):{...i,...o}}let Zg=(()=>{class i{get destroyed(){return this._destroyed}get injector(){return this._injector}constructor(a,d,g){this._zone=a,this._injector=d,this._exceptionHandler=g,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this._destroyed=!1,this._destroyListeners=[],this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const w=new Dt.y(k=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{k.next(this._stable),k.complete()})}),I=new Dt.y(k=>{let B;this._zone.runOutsideAngular(()=>{B=this._zone.onStable.subscribe(()=>{Il.assertNotInAngularZone(),wy(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,k.next(!0))})})});const q=this._zone.onUnstable.subscribe(()=>{Il.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{k.next(!1)}))});return()=>{B.unsubscribe(),q.unsubscribe()}});this.isStable=function bt(...i){const o=(0,Vt.yG)(i),a=(0,Vt._6)(i,1/0),d=i;return d.length?1===d.length?(0,Ee.Xf)(d[0]):(0,c.J)(a)((0,kt.D)(d,o)):Ht.E}(w,I.pipe(function Pt(i={}){const{connector:o=(()=>new K.x),resetOnError:a=!0,resetOnComplete:d=!0,resetOnRefCountZero:g=!0}=i;return w=>{let I,k,B,q=0,te=!1,de=!1;const De=()=>{k?.unsubscribe(),k=void 0},Fe=()=>{De(),I=B=void 0,te=de=!1},nt=()=>{const At=I;Fe(),At?.unsubscribe()};return(0,Je.e)((At,Gt)=>{q++,!de&&!te&&De();const on=B=B??o();Gt.add(()=>{q--,0===q&&!de&&!te&&(k=sn(nt,g))}),on.subscribe(Gt),!I&&q>0&&(I=new gt.Hp({next:Dn=>on.next(Dn),error:Dn=>{de=!0,De(),k=sn(Fe,a,Dn),on.error(Dn)},complete:()=>{te=!0,De(),k=sn(Fe,d),on.complete()}}),(0,Ee.Xf)(At).subscribe(I))})(w)}}()))}bootstrap(a,d){const g=a instanceof Vf;if(!this._injector.get(Gg).done)throw!g&&Tn(a),new ut(405,false);let I;I=g?a:this._injector.get(ru).resolveComponentFactory(a),this.componentTypes.push(I.componentType);const k=function sb(i){return i.isBoundToModule}(I)?void 0:this._injector.get(sf),q=I.create(iu.NULL,[],d||I.selector,k),te=q.location.nativeElement,de=q.injector.get(_0,null);return de?.registerApplication(te),q.onDestroy(()=>{this.detachView(q.hostView),qg(this.components,q),de?.unregisterApplication(te)}),this._loadComponent(q),q}tick(){if(this._runningTick)throw new ut(101,!1);try{this._runningTick=!0;for(let a of this._views)a.detectChanges()}catch(a){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(a))}finally{this._runningTick=!1}}attachView(a){const d=a;this._views.push(d),d.attachToAppRef(this)}detachView(a){const d=a;qg(this._views,d),d.detachFromAppRef()}_loadComponent(a){this.attachView(a.hostView),this.tick(),this.components.push(a);const d=this._injector.get(d0,[]);d.push(...this._bootstrapListeners),d.forEach(g=>g(a))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(a=>a()),this._views.slice().forEach(a=>a.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(a){return this._destroyListeners.push(a),()=>qg(this._destroyListeners,a)}destroy(){if(this._destroyed)throw new ut(406,!1);const a=this._injector;a.destroy&&!a.destroyed&&a.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}}return i.\u0275fac=function(a){return new(a||i)(H(Il),H(Fr),H(Fh))},i.\u0275prov=Vn({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();function qg(i,o){const a=i.indexOf(o);a>-1&&i.splice(a,1)}let db=(()=>{class i{}return i.__NG_ELEMENT_ID__=fb,i})();function fb(i){return function pb(i,o,a){if(as(i)&&!a){const d=Si(i.index,o);return new El(d,d)}return 47&i.type?new El(o[16],o):null}(hi(),pt(),16==(16&i))}class L0{constructor(){}supports(o){return Lc(o)}create(o){return new xb(o)}}const vb=(i,o)=>o;class xb{constructor(o){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=o||vb}forEachItem(o){let a;for(a=this._itHead;null!==a;a=a._next)o(a)}forEachOperation(o){let a=this._itHead,d=this._removalsHead,g=0,w=null;for(;a||d;){const I=!d||a&&a.currentIndex<O0(d,g,w)?a:d,k=O0(I,g,w),B=I.currentIndex;if(I===d)g--,d=d._nextRemoved;else if(a=a._next,null==I.previousIndex)g++;else{w||(w=[]);const q=k-g,te=B-g;if(q!=te){for(let De=0;De<q;De++){const Fe=De<w.length?w[De]:w[De]=0,nt=Fe+De;te<=nt&&nt<q&&(w[De]=Fe+1)}w[I.previousIndex]=te-q}}k!==B&&o(I,k,B)}}forEachPreviousItem(o){let a;for(a=this._previousItHead;null!==a;a=a._nextPrevious)o(a)}forEachAddedItem(o){let a;for(a=this._additionsHead;null!==a;a=a._nextAdded)o(a)}forEachMovedItem(o){let a;for(a=this._movesHead;null!==a;a=a._nextMoved)o(a)}forEachRemovedItem(o){let a;for(a=this._removalsHead;null!==a;a=a._nextRemoved)o(a)}forEachIdentityChange(o){let a;for(a=this._identityChangesHead;null!==a;a=a._nextIdentityChange)o(a)}diff(o){if(null==o&&(o=[]),!Lc(o))throw new ut(900,!1);return this.check(o)?this:null}onDestroy(){}check(o){this._reset();let g,w,I,a=this._itHead,d=!1;if(Array.isArray(o)){this.length=o.length;for(let k=0;k<this.length;k++)w=o[k],I=this._trackByFn(k,w),null!==a&&Object.is(a.trackById,I)?(d&&(a=this._verifyReinsertion(a,w,I,k)),Object.is(a.item,w)||this._addIdentityChange(a,w)):(a=this._mismatch(a,w,I,k),d=!0),a=a._next}else g=0,function Hh(i,o){if(Array.isArray(i))for(let a=0;a<i.length;a++)o(i[a]);else{const a=i[uu()]();let d;for(;!(d=a.next()).done;)o(d.value)}}(o,k=>{I=this._trackByFn(g,k),null!==a&&Object.is(a.trackById,I)?(d&&(a=this._verifyReinsertion(a,k,I,g)),Object.is(a.item,k)||this._addIdentityChange(a,k)):(a=this._mismatch(a,k,I,g),d=!0),a=a._next,g++}),this.length=g;return this._truncate(a),this.collection=o,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let o;for(o=this._previousItHead=this._itHead;null!==o;o=o._next)o._nextPrevious=o._next;for(o=this._additionsHead;null!==o;o=o._nextAdded)o.previousIndex=o.currentIndex;for(this._additionsHead=this._additionsTail=null,o=this._movesHead;null!==o;o=o._nextMoved)o.previousIndex=o.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(o,a,d,g){let w;return null===o?w=this._itTail:(w=o._prev,this._remove(o)),null!==(o=null===this._unlinkedRecords?null:this._unlinkedRecords.get(d,null))?(Object.is(o.item,a)||this._addIdentityChange(o,a),this._reinsertAfter(o,w,g)):null!==(o=null===this._linkedRecords?null:this._linkedRecords.get(d,g))?(Object.is(o.item,a)||this._addIdentityChange(o,a),this._moveAfter(o,w,g)):o=this._addAfter(new bb(a,d),w,g),o}_verifyReinsertion(o,a,d,g){let w=null===this._unlinkedRecords?null:this._unlinkedRecords.get(d,null);return null!==w?o=this._reinsertAfter(w,o._prev,g):o.currentIndex!=g&&(o.currentIndex=g,this._addToMoves(o,g)),o}_truncate(o){for(;null!==o;){const a=o._next;this._addToRemovals(this._unlink(o)),o=a}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(o,a,d){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(o);const g=o._prevRemoved,w=o._nextRemoved;return null===g?this._removalsHead=w:g._nextRemoved=w,null===w?this._removalsTail=g:w._prevRemoved=g,this._insertAfter(o,a,d),this._addToMoves(o,d),o}_moveAfter(o,a,d){return this._unlink(o),this._insertAfter(o,a,d),this._addToMoves(o,d),o}_addAfter(o,a,d){return this._insertAfter(o,a,d),this._additionsTail=null===this._additionsTail?this._additionsHead=o:this._additionsTail._nextAdded=o,o}_insertAfter(o,a,d){const g=null===a?this._itHead:a._next;return o._next=g,o._prev=a,null===g?this._itTail=o:g._prev=o,null===a?this._itHead=o:a._next=o,null===this._linkedRecords&&(this._linkedRecords=new k0),this._linkedRecords.put(o),o.currentIndex=d,o}_remove(o){return this._addToRemovals(this._unlink(o))}_unlink(o){null!==this._linkedRecords&&this._linkedRecords.remove(o);const a=o._prev,d=o._next;return null===a?this._itHead=d:a._next=d,null===d?this._itTail=a:d._prev=a,o}_addToMoves(o,a){return o.previousIndex===a||(this._movesTail=null===this._movesTail?this._movesHead=o:this._movesTail._nextMoved=o),o}_addToRemovals(o){return null===this._unlinkedRecords&&(this._unlinkedRecords=new k0),this._unlinkedRecords.put(o),o.currentIndex=null,o._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=o,o._prevRemoved=null):(o._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=o),o}_addIdentityChange(o,a){return o.item=a,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=o:this._identityChangesTail._nextIdentityChange=o,o}}class bb{constructor(o,a){this.item=o,this.trackById=a,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class wb{constructor(){this._head=null,this._tail=null}add(o){null===this._head?(this._head=this._tail=o,o._nextDup=null,o._prevDup=null):(this._tail._nextDup=o,o._prevDup=this._tail,o._nextDup=null,this._tail=o)}get(o,a){let d;for(d=this._head;null!==d;d=d._nextDup)if((null===a||a<=d.currentIndex)&&Object.is(d.trackById,o))return d;return null}remove(o){const a=o._prevDup,d=o._nextDup;return null===a?this._head=d:a._nextDup=d,null===d?this._tail=a:d._prevDup=a,null===this._head}}class k0{constructor(){this.map=new Map}put(o){const a=o.trackById;let d=this.map.get(a);d||(d=new wb,this.map.set(a,d)),d.add(o)}get(o,a){const g=this.map.get(o);return g?g.get(o,a):null}remove(o){const a=o.trackById;return this.map.get(a).remove(o)&&this.map.delete(a),o}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function O0(i,o,a){const d=i.previousIndex;if(null===d)return d;let g=0;return a&&d<a.length&&(g=a[d]),d+o+g}class F0{constructor(){}supports(o){return o instanceof Map||ih(o)}create(){return new Eb}}class Eb{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(o){let a;for(a=this._mapHead;null!==a;a=a._next)o(a)}forEachPreviousItem(o){let a;for(a=this._previousMapHead;null!==a;a=a._nextPrevious)o(a)}forEachChangedItem(o){let a;for(a=this._changesHead;null!==a;a=a._nextChanged)o(a)}forEachAddedItem(o){let a;for(a=this._additionsHead;null!==a;a=a._nextAdded)o(a)}forEachRemovedItem(o){let a;for(a=this._removalsHead;null!==a;a=a._nextRemoved)o(a)}diff(o){if(o){if(!(o instanceof Map||ih(o)))throw new ut(900,!1)}else o=new Map;return this.check(o)?this:null}onDestroy(){}check(o){this._reset();let a=this._mapHead;if(this._appendAfter=null,this._forEach(o,(d,g)=>{if(a&&a.key===g)this._maybeAddToChanges(a,d),this._appendAfter=a,a=a._next;else{const w=this._getOrCreateRecordForKey(g,d);a=this._insertBeforeOrAppend(a,w)}}),a){a._prev&&(a._prev._next=null),this._removalsHead=a;for(let d=a;null!==d;d=d._nextRemoved)d===this._mapHead&&(this._mapHead=null),this._records.delete(d.key),d._nextRemoved=d._next,d.previousValue=d.currentValue,d.currentValue=null,d._prev=null,d._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(o,a){if(o){const d=o._prev;return a._next=o,a._prev=d,o._prev=a,d&&(d._next=a),o===this._mapHead&&(this._mapHead=a),this._appendAfter=o,o}return this._appendAfter?(this._appendAfter._next=a,a._prev=this._appendAfter):this._mapHead=a,this._appendAfter=a,null}_getOrCreateRecordForKey(o,a){if(this._records.has(o)){const g=this._records.get(o);this._maybeAddToChanges(g,a);const w=g._prev,I=g._next;return w&&(w._next=I),I&&(I._prev=w),g._next=null,g._prev=null,g}const d=new Db(o);return this._records.set(o,d),d.currentValue=a,this._addToAdditions(d),d}_reset(){if(this.isDirty){let o;for(this._previousMapHead=this._mapHead,o=this._previousMapHead;null!==o;o=o._next)o._nextPrevious=o._next;for(o=this._changesHead;null!==o;o=o._nextChanged)o.previousValue=o.currentValue;for(o=this._additionsHead;null!=o;o=o._nextAdded)o.previousValue=o.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(o,a){Object.is(a,o.currentValue)||(o.previousValue=o.currentValue,o.currentValue=a,this._addToChanges(o))}_addToAdditions(o){null===this._additionsHead?this._additionsHead=this._additionsTail=o:(this._additionsTail._nextAdded=o,this._additionsTail=o)}_addToChanges(o){null===this._changesHead?this._changesHead=this._changesTail=o:(this._changesTail._nextChanged=o,this._changesTail=o)}_forEach(o,a){o instanceof Map?o.forEach(a):Object.keys(o).forEach(d=>a(o[d],d))}}class Db{constructor(o){this.key=o,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function z0(){return new Ry([new L0])}let Ry=(()=>{class i{constructor(a){this.factories=a}static create(a,d){if(null!=d){const g=d.factories.slice();a=a.concat(g)}return new i(a)}static extend(a){return{provide:i,useFactory:d=>i.create(a,d||z0()),deps:[[i,new Le,new he]]}}find(a){const d=this.factories.find(g=>g.supports(a));if(null!=d)return d;throw new ut(901,!1)}}return i.\u0275prov=Vn({token:i,providedIn:"root",factory:z0}),i})();function B0(){return new Ly([new F0])}let Ly=(()=>{class i{constructor(a){this.factories=a}static create(a,d){if(d){const g=d.factories.slice();a=a.concat(g)}return new i(a)}static extend(a){return{provide:i,useFactory:d=>i.create(a,d||B0()),deps:[[i,new Le,new he]]}}find(a){const d=this.factories.find(g=>g.supports(a));if(d)return d;throw new ut(901,!1)}}return i.\u0275prov=Vn({token:i,providedIn:"root",factory:B0}),i})();const Sb=w0(null,"core",[]);let Ib=(()=>{class i{constructor(a){}}return i.\u0275fac=function(a){return new(a||i)(H(Zg))},i.\u0275mod=ao({type:i}),i.\u0275inj=Wi({}),i})();function Mb(i){return"boolean"==typeof i?i:null!=i&&"false"!==i}},481:(er,Nt,Me)=>{"use strict";Me.d(Nt,{Dx:()=>ai,b2:()=>Vr,q6:()=>Vn});var K=Me(895),Ie=Me(256);class Dt extends K.w_{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class c extends Dt{static makeCurrent(){(0,K.HT)(new c)}onAndCancel(ne,Q,ve){return ne.addEventListener(Q,ve,!1),()=>{ne.removeEventListener(Q,ve,!1)}}dispatchEvent(ne,Q){ne.dispatchEvent(Q)}remove(ne){ne.parentNode&&ne.parentNode.removeChild(ne)}createElement(ne,Q){return(Q=Q||this.getDefaultDocument()).createElement(ne)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(ne){return ne.nodeType===Node.ELEMENT_NODE}isShadowRoot(ne){return ne instanceof DocumentFragment}getGlobalEventTarget(ne,Q){return"window"===Q?window:"document"===Q?ne:"body"===Q?ne.body:null}getBaseHref(ne){const Q=function Ht(){return Ee=Ee||document.querySelector("base"),Ee?Ee.getAttribute("href"):null}();return null==Q?null:function kt(re){Vt=Vt||document.createElement("a"),Vt.setAttribute("href",re);const ne=Vt.pathname;return"/"===ne.charAt(0)?ne:`/${ne}`}(Q)}resetBaseElement(){Ee=null}getUserAgent(){return window.navigator.userAgent}getCookie(ne){return(0,K.Mx)(document.cookie,ne)}}let Vt,Ee=null;const bt=new Ie.OlP("TRANSITION_ID"),Je=[{provide:Ie.ip1,useFactory:function gt(re,ne,Q){return()=>{Q.get(Ie.CZH).donePromise.then(()=>{const ve=(0,K.q)(),we=ne.querySelectorAll(`style[ng-transition="${re}"]`);for(let lt=0;lt<we.length;lt++)ve.remove(we[lt])})}},deps:[bt,K.K0,Ie.zs3],multi:!0}];let sn=(()=>{class re{build(){return new XMLHttpRequest}}return re.\u0275fac=function(Q){return new(Q||re)},re.\u0275prov=Ie.Yz7({token:re,factory:re.\u0275fac}),re})();const _t=new Ie.OlP("EventManagerPlugins");let Qt=(()=>{class re{constructor(Q,ve){this._zone=ve,this._eventNameToPlugin=new Map,Q.forEach(we=>we.manager=this),this._plugins=Q.slice().reverse()}addEventListener(Q,ve,we){return this._findPluginFor(ve).addEventListener(Q,ve,we)}addGlobalEventListener(Q,ve,we){return this._findPluginFor(ve).addGlobalEventListener(Q,ve,we)}getZone(){return this._zone}_findPluginFor(Q){const ve=this._eventNameToPlugin.get(Q);if(ve)return ve;const we=this._plugins;for(let lt=0;lt<we.length;lt++){const mt=we[lt];if(mt.supports(Q))return this._eventNameToPlugin.set(Q,mt),mt}throw new Error(`No event manager plugin found for event ${Q}`)}}return re.\u0275fac=function(Q){return new(Q||re)(Ie.LFG(_t),Ie.LFG(Ie.R0b))},re.\u0275prov=Ie.Yz7({token:re,factory:re.\u0275fac}),re})();class nn{constructor(ne){this._doc=ne}addGlobalEventListener(ne,Q,ve){const we=(0,K.q)().getGlobalEventTarget(this._doc,ne);if(!we)throw new Error(`Unsupported event target ${we} for event ${Q}`);return this.addEventListener(we,Q,ve)}}let Ut=(()=>{class re{constructor(){this._stylesSet=new Set}addStyles(Q){const ve=new Set;Q.forEach(we=>{this._stylesSet.has(we)||(this._stylesSet.add(we),ve.add(we))}),this.onStylesAdded(ve)}onStylesAdded(Q){}getAllStyles(){return Array.from(this._stylesSet)}}return re.\u0275fac=function(Q){return new(Q||re)},re.\u0275prov=Ie.Yz7({token:re,factory:re.\u0275fac}),re})(),Qe=(()=>{class re extends Ut{constructor(Q){super(),this._doc=Q,this._hostNodes=new Map,this._hostNodes.set(Q.head,[])}_addStylesToHost(Q,ve,we){Q.forEach(lt=>{const mt=this._doc.createElement("style");mt.textContent=lt,we.push(ve.appendChild(mt))})}addHost(Q){const ve=[];this._addStylesToHost(this._stylesSet,Q,ve),this._hostNodes.set(Q,ve)}removeHost(Q){const ve=this._hostNodes.get(Q);ve&&ve.forEach(sr),this._hostNodes.delete(Q)}onStylesAdded(Q){this._hostNodes.forEach((ve,we)=>{this._addStylesToHost(Q,we,ve)})}ngOnDestroy(){this._hostNodes.forEach(Q=>Q.forEach(sr))}}return re.\u0275fac=function(Q){return new(Q||re)(Ie.LFG(K.K0))},re.\u0275prov=Ie.Yz7({token:re,factory:re.\u0275fac}),re})();function sr(re){(0,K.q)().remove(re)}const jt={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},$t=/%COMP%/g;function tt(re,ne){return ne.flat(100).map(Q=>Q.replace($t,re))}function cn(re){return ne=>{if("__ngUnwrap__"===ne)return re;!1===re(ne)&&(ne.preventDefault(),ne.returnValue=!1)}}let Nn=(()=>{class re{constructor(Q,ve,we){this.eventManager=Q,this.sharedStylesHost=ve,this.appId=we,this.rendererByCompId=new Map,this.defaultRenderer=new Jt(Q)}createRenderer(Q,ve){if(!Q||!ve)return this.defaultRenderer;switch(ve.encapsulation){case Ie.ifc.Emulated:{let we=this.rendererByCompId.get(ve.id);return we||(we=new ht(this.eventManager,this.sharedStylesHost,ve,this.appId),this.rendererByCompId.set(ve.id,we)),we.applyToHost(Q),we}case Ie.ifc.ShadowDom:return new Lt(this.eventManager,this.sharedStylesHost,Q,ve);default:if(!this.rendererByCompId.has(ve.id)){const we=tt(ve.id,ve.styles);this.sharedStylesHost.addStyles(we),this.rendererByCompId.set(ve.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return re.\u0275fac=function(Q){return new(Q||re)(Ie.LFG(Qt),Ie.LFG(Qe),Ie.LFG(Ie.AFp))},re.\u0275prov=Ie.Yz7({token:re,factory:re.\u0275fac}),re})();class Jt{constructor(ne){this.eventManager=ne,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(ne,Q){return Q?document.createElementNS(jt[Q]||Q,ne):document.createElement(ne)}createComment(ne){return document.createComment(ne)}createText(ne){return document.createTextNode(ne)}appendChild(ne,Q){(it(ne)?ne.content:ne).appendChild(Q)}insertBefore(ne,Q,ve){ne&&(it(ne)?ne.content:ne).insertBefore(Q,ve)}removeChild(ne,Q){ne&&ne.removeChild(Q)}selectRootElement(ne,Q){let ve="string"==typeof ne?document.querySelector(ne):ne;if(!ve)throw new Error(`The selector "${ne}" did not match any elements`);return Q||(ve.textContent=""),ve}parentNode(ne){return ne.parentNode}nextSibling(ne){return ne.nextSibling}setAttribute(ne,Q,ve,we){if(we){Q=we+":"+Q;const lt=jt[we];lt?ne.setAttributeNS(lt,Q,ve):ne.setAttribute(Q,ve)}else ne.setAttribute(Q,ve)}removeAttribute(ne,Q,ve){if(ve){const we=jt[ve];we?ne.removeAttributeNS(we,Q):ne.removeAttribute(`${ve}:${Q}`)}else ne.removeAttribute(Q)}addClass(ne,Q){ne.classList.add(Q)}removeClass(ne,Q){ne.classList.remove(Q)}setStyle(ne,Q,ve,we){we&(Ie.JOm.DashCase|Ie.JOm.Important)?ne.style.setProperty(Q,ve,we&Ie.JOm.Important?"important":""):ne.style[Q]=ve}removeStyle(ne,Q,ve){ve&Ie.JOm.DashCase?ne.style.removeProperty(Q):ne.style[Q]=""}setProperty(ne,Q,ve){ne[Q]=ve}setValue(ne,Q){ne.nodeValue=Q}listen(ne,Q,ve){return"string"==typeof ne?this.eventManager.addGlobalEventListener(ne,Q,cn(ve)):this.eventManager.addEventListener(ne,Q,cn(ve))}}function it(re){return"TEMPLATE"===re.tagName&&void 0!==re.content}class ht extends Jt{constructor(ne,Q,ve,we){super(ne),this.component=ve;const lt=tt(we+"-"+ve.id,ve.styles);Q.addStyles(lt),this.contentAttr=function Bt(re){return"_ngcontent-%COMP%".replace($t,re)}(we+"-"+ve.id),this.hostAttr=function wt(re){return"_nghost-%COMP%".replace($t,re)}(we+"-"+ve.id)}applyToHost(ne){super.setAttribute(ne,this.hostAttr,"")}createElement(ne,Q){const ve=super.createElement(ne,Q);return super.setAttribute(ve,this.contentAttr,""),ve}}class Lt extends Jt{constructor(ne,Q,ve,we){super(ne),this.sharedStylesHost=Q,this.hostEl=ve,this.shadowRoot=ve.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const lt=tt(we.id,we.styles);for(let mt=0;mt<lt.length;mt++){const Ct=document.createElement("style");Ct.textContent=lt[mt],this.shadowRoot.appendChild(Ct)}}nodeOrShadowRoot(ne){return ne===this.hostEl?this.shadowRoot:ne}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(ne,Q){return super.appendChild(this.nodeOrShadowRoot(ne),Q)}insertBefore(ne,Q,ve){return super.insertBefore(this.nodeOrShadowRoot(ne),Q,ve)}removeChild(ne,Q){return super.removeChild(this.nodeOrShadowRoot(ne),Q)}parentNode(ne){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(ne)))}}let at=(()=>{class re extends nn{constructor(Q){super(Q)}supports(Q){return!0}addEventListener(Q,ve,we){return Q.addEventListener(ve,we,!1),()=>this.removeEventListener(Q,ve,we)}removeEventListener(Q,ve,we){return Q.removeEventListener(ve,we)}}return re.\u0275fac=function(Q){return new(Q||re)(Ie.LFG(K.K0))},re.\u0275prov=Ie.Yz7({token:re,factory:re.\u0275fac}),re})();const dn=["alt","control","meta","shift"],qn={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},Un={alt:re=>re.altKey,control:re=>re.ctrlKey,meta:re=>re.metaKey,shift:re=>re.shiftKey};let en=(()=>{class re extends nn{constructor(Q){super(Q)}supports(Q){return null!=re.parseEventName(Q)}addEventListener(Q,ve,we){const lt=re.parseEventName(ve),mt=re.eventCallback(lt.fullKey,we,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>(0,K.q)().onAndCancel(Q,lt.domEventName,mt))}static parseEventName(Q){const ve=Q.toLowerCase().split("."),we=ve.shift();if(0===ve.length||"keydown"!==we&&"keyup"!==we)return null;const lt=re._normalizeKey(ve.pop());let mt="",Ct=ve.indexOf("code");if(Ct>-1&&(ve.splice(Ct,1),mt="code."),dn.forEach(xn=>{const On=ve.indexOf(xn);On>-1&&(ve.splice(On,1),mt+=xn+".")}),mt+=lt,0!=ve.length||0===lt.length)return null;const yt={};return yt.domEventName=we,yt.fullKey=mt,yt}static matchEventFullKeyCode(Q,ve){let we=qn[Q.key]||Q.key,lt="";return ve.indexOf("code.")>-1&&(we=Q.code,lt="code."),!(null==we||!we)&&(we=we.toLowerCase()," "===we?we="space":"."===we&&(we="dot"),dn.forEach(mt=>{mt!==we&&(0,Un[mt])(Q)&&(lt+=mt+".")}),lt+=we,lt===ve)}static eventCallback(Q,ve,we){return lt=>{re.matchEventFullKeyCode(lt,Q)&&we.runGuarded(()=>ve(lt))}}static _normalizeKey(Q){return"esc"===Q?"escape":Q}}return re.\u0275fac=function(Q){return new(Q||re)(Ie.LFG(K.K0))},re.\u0275prov=Ie.Yz7({token:re,factory:re.\u0275fac}),re})();const Vn=(0,Ie.eFA)(Ie._c5,"browser",[{provide:Ie.Lbi,useValue:K.bD},{provide:Ie.g9A,useValue:function zt(){c.makeCurrent()},multi:!0},{provide:K.K0,useFactory:function ni(){return(0,Ie.RDi)(document),document},deps:[]}]),Ni=new Ie.OlP(""),Wi=[{provide:Ie.rWj,useClass:class Pt{addToWindow(ne){Ie.dqk.getAngularTestability=(ve,we=!0)=>{const lt=ne.findTestabilityInTree(ve,we);if(null==lt)throw new Error("Could not find testability for element.");return lt},Ie.dqk.getAllAngularTestabilities=()=>ne.getAllTestabilities(),Ie.dqk.getAllAngularRootElements=()=>ne.getAllRootElements(),Ie.dqk.frameworkStabilizers||(Ie.dqk.frameworkStabilizers=[]),Ie.dqk.frameworkStabilizers.push(ve=>{const we=Ie.dqk.getAllAngularTestabilities();let lt=we.length,mt=!1;const Ct=function(yt){mt=mt||yt,lt--,0==lt&&ve(mt)};we.forEach(function(yt){yt.whenStable(Ct)})})}findTestabilityInTree(ne,Q,ve){return null==Q?null:ne.getTestability(Q)??(ve?(0,K.q)().isShadowRoot(Q)?this.findTestabilityInTree(ne,Q.host,!0):this.findTestabilityInTree(ne,Q.parentElement,!0):null)}},deps:[]},{provide:Ie.lri,useClass:Ie.dDg,deps:[Ie.R0b,Ie.eoX,Ie.rWj]},{provide:Ie.dDg,useClass:Ie.dDg,deps:[Ie.R0b,Ie.eoX,Ie.rWj]}],Br=[{provide:Ie.zSh,useValue:"root"},{provide:Ie.qLn,useFactory:function Xr(){return new Ie.qLn},deps:[]},{provide:_t,useClass:at,multi:!0,deps:[K.K0,Ie.R0b,Ie.Lbi]},{provide:_t,useClass:en,multi:!0,deps:[K.K0]},{provide:Nn,useClass:Nn,deps:[Qt,Qe,Ie.AFp]},{provide:Ie.FYo,useExisting:Nn},{provide:Ut,useExisting:Qe},{provide:Qe,useClass:Qe,deps:[K.K0]},{provide:Qt,useClass:Qt,deps:[_t,Ie.R0b]},{provide:K.JF,useClass:sn,deps:[]},[]];let Vr=(()=>{class re{constructor(Q){}static withServerTransition(Q){return{ngModule:re,providers:[{provide:Ie.AFp,useValue:Q.appId},{provide:bt,useExisting:Ie.AFp},Je]}}}return re.\u0275fac=function(Q){return new(Q||re)(Ie.LFG(Ni,12))},re.\u0275mod=Ie.oAB({type:re}),re.\u0275inj=Ie.cJS({providers:[...Br,...Wi],imports:[K.ez,Ie.hGG]}),re})(),ai=(()=>{class re{constructor(Q){this._doc=Q}getTitle(){return this._doc.title}setTitle(Q){this._doc.title=Q||""}}return re.\u0275fac=function(Q){return new(Q||re)(Ie.LFG(K.K0))},re.\u0275prov=Ie.Yz7({token:re,factory:function(Q){let ve=null;return ve=Q?new Q:function vo(){return new ai((0,Ie.LFG)(K.K0))}(),ve},providedIn:"root"}),re})();typeof window<"u"&&window},322:(er,Nt,Me)=>{"use strict";Me.d(Nt,{rH:()=>$l,Od:()=>ca,Bz:()=>l,lC:()=>Ds});var K=Me(256),Ie=Me(76),Dt=Me(669);function c(...y){const E=(0,Dt.yG)(y);return(0,Ie.D)(y,E)}var Ee=Me(579);class Ht extends Ee.x{constructor(E){super(),this._value=E}get value(){return this.getValue()}_subscribe(E){const x=super._subscribe(E);return!x.closed&&E.next(this._value),x}getValue(){const{hasError:E,thrownError:x,_value:T}=this;if(E)throw x;return this._throwIfClosed(),T}next(E){super.next(this._value=E)}}const kt=(0,Me(888).d)(y=>function(){y(this),this.name="EmptyError",this.message="no elements in sequence"});var bt=Me(751);const{isArray:gt}=Array,{getPrototypeOf:Je,prototype:Pt,keys:sn}=Object;var nn=Me(671),Ut=Me(4);const{isArray:Qe}=Array;var qe=Me(403),Xt=Me(672);function ar(...y){const E=(0,Dt.yG)(y),x=(0,Dt.jO)(y),{args:T,keys:M}=function _t(y){if(1===y.length){const E=y[0];if(gt(E))return{args:E,keys:null};if(function Qt(y){return y&&"object"==typeof y&&Je(y)===Pt}(E)){const x=sn(E);return{args:x.map(T=>E[T]),keys:x}}}return{args:y,keys:null}}(y);if(0===T.length)return(0,Ie.D)([],E);const L=new bt.y(function ut(y,E,x=nn.y){return T=>{Bt(E,()=>{const{length:M}=y,L=new Array(M);let O=M,Z=M;for(let Y=0;Y<M;Y++)Bt(E,()=>{const oe=(0,Ie.D)(y[Y],E);let se=!1;oe.subscribe((0,qe.x)(T,he=>{L[Y]=he,se||(se=!0,Z--),Z||T.next(x(L.slice()))},()=>{--O||T.complete()}))},T)},T)}}(T,E,M?O=>function $t(y,E){return y.reduce((x,T,M)=>(x[T]=E[M],x),{})}(M,O):nn.y));return x?L.pipe(function jt(y){return(0,Ut.U)(E=>function sr(y,E){return Qe(E)?y(...E):y(E)}(y,E))}(x)):L}function Bt(y,E,x){y?(0,Xt.f)(x,y,E):E()}var wt=Me(189);function cn(...y){return function tt(){return(0,wt.J)(1)}()((0,Ie.D)(y,(0,Dt.yG)(y)))}var Nn=Me(421);function Jt(y){return new bt.y(E=>{(0,Nn.Xf)(y()).subscribe(E)})}var We=Me(635),Ue=Me(576);function it(y,E){const x=(0,Ue.m)(y)?y:()=>y,T=M=>M.error(x());return new bt.y(E?M=>E.schedule(T,0,M):T)}var ht=Me(515),Lt=Me(727),at=Me(482);function dn(){return(0,at.e)((y,E)=>{let x=null;y._refCount++;const T=(0,qe.x)(E,void 0,void 0,void 0,()=>{if(!y||y._refCount<=0||0<--y._refCount)return void(x=null);const M=y._connection,L=x;x=null,M&&(!L||M===L)&&M.unsubscribe(),E.unsubscribe()});y.subscribe(T),T.closed||(x=y.connect())})}class qn extends bt.y{constructor(E,x){super(),this.source=E,this.subjectFactory=x,this._subject=null,this._refCount=0,this._connection=null,(0,at.A)(E)&&(this.lift=E.lift)}_subscribe(E){return this.getSubject().subscribe(E)}getSubject(){const E=this._subject;return(!E||E.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:E}=this;this._subject=this._connection=null,E?.unsubscribe()}connect(){let E=this._connection;if(!E){E=this._connection=new Lt.w0;const x=this.getSubject();E.add(this.source.subscribe((0,qe.x)(x,void 0,()=>{this._teardown(),x.complete()},T=>{this._teardown(),x.error(T)},()=>this._teardown()))),E.closed&&(this._connection=null,E=Lt.w0.EMPTY)}return E}refCount(){return dn()(this)}}var Un=Me(895);function en(y,E){return(0,at.e)((x,T)=>{let M=null,L=0,O=!1;const Z=()=>O&&!M&&T.complete();x.subscribe((0,qe.x)(T,Y=>{M?.unsubscribe();let oe=0;const se=L++;(0,Nn.Xf)(y(Y,se)).subscribe(M=(0,qe.x)(T,he=>T.next(E?E(Y,he,se,oe++):he),()=>{M=null,Z()}))},()=>{O=!0,Z()}))})}function jn(y){return y<=0?()=>ht.E:(0,at.e)((E,x)=>{let T=0;E.subscribe((0,qe.x)(x,M=>{++T<=y&&(x.next(M),y<=T&&x.complete())}))})}function tr(y,E){return(0,at.e)((x,T)=>{let M=0;x.subscribe((0,qe.x)(T,L=>y.call(E,L,M++)&&T.next(L)))})}var vn=Me(577);function nr(y){return(0,at.e)((E,x)=>{let T=!1;E.subscribe((0,qe.x)(x,M=>{T=!0,x.next(M)},()=>{T||x.next(y),x.complete()}))})}function zt(y=Xr){return(0,at.e)((E,x)=>{let T=!1;E.subscribe((0,qe.x)(x,M=>{T=!0,x.next(M)},()=>T?x.complete():x.error(y())))})}function Xr(){return new kt}function ni(y,E){const x=arguments.length>=2;return T=>T.pipe(y?tr((M,L)=>y(M,L,T)):nn.y,jn(1),x?nr(E):zt(()=>new kt))}function si(y,E){return(0,Ue.m)(E)?(0,vn.z)(y,E,1):(0,vn.z)(y,1)}function Vn(y,E,x){const T=(0,Ue.m)(y)||E||x?{next:y,error:E,complete:x}:y;return T?(0,at.e)((M,L)=>{var O;null===(O=T.subscribe)||void 0===O||O.call(T);let Z=!0;M.subscribe((0,qe.x)(L,Y=>{var oe;null===(oe=T.next)||void 0===oe||oe.call(T,Y),L.next(Y)},()=>{var Y;Z=!1,null===(Y=T.complete)||void 0===Y||Y.call(T),L.complete()},Y=>{var oe;Z=!1,null===(oe=T.error)||void 0===oe||oe.call(T,Y),L.error(Y)},()=>{var Y,oe;Z&&(null===(Y=T.unsubscribe)||void 0===Y||Y.call(T)),null===(oe=T.finalize)||void 0===oe||oe.call(T)}))}):nn.y}function Ni(y){return(0,at.e)((E,x)=>{let L,T=null,M=!1;T=E.subscribe((0,qe.x)(x,void 0,void 0,O=>{L=(0,Nn.Xf)(y(O,Ni(y)(E))),T?(T.unsubscribe(),T=null,L.subscribe(x)):M=!0})),M&&(T.unsubscribe(),T=null,L.subscribe(x))})}function Wi(y,E,x,T,M){return(L,O)=>{let Z=x,Y=E,oe=0;L.subscribe((0,qe.x)(O,se=>{const he=oe++;Y=Z?y(Y,se,he):(Z=!0,se),T&&O.next(Y)},M&&(()=>{Z&&O.next(Y),O.complete()})))}}function Br(y,E){return(0,at.e)(Wi(y,E,arguments.length>=2,!0))}function Vr(y){return y<=0?()=>ht.E:(0,at.e)((E,x)=>{let T=[];E.subscribe((0,qe.x)(x,M=>{T.push(M),y<T.length&&T.shift()},()=>{for(const M of T)x.next(M);x.complete()},void 0,()=>{T=null}))})}function yo(y,E){const x=arguments.length>=2;return T=>T.pipe(y?tr((M,L)=>y(M,L,T)):nn.y,Vr(1),x?nr(E):zt(()=>new kt))}function vo(y){return(0,at.e)((E,x)=>{try{E.subscribe(x)}finally{x.add(y)}})}var ai=Me(481);const yn="primary",fr=Symbol("RouteTitle");class rn{constructor(E){this.params=E||{}}has(E){return Object.prototype.hasOwnProperty.call(this.params,E)}get(E){if(this.has(E)){const x=this.params[E];return Array.isArray(x)?x[0]:x}return null}getAll(E){if(this.has(E)){const x=this.params[E];return Array.isArray(x)?x:[x]}return[]}get keys(){return Object.keys(this.params)}}function Et(y){return new rn(y)}function xo(y,E,x){const T=x.path.split("/");if(T.length>y.length||"full"===x.pathMatch&&(E.hasChildren()||T.length<y.length))return null;const M={};for(let L=0;L<T.length;L++){const O=T[L],Z=y[L];if(O.startsWith(":"))M[O.substring(1)]=Z;else if(O!==Z.path)return null}return{consumed:y.slice(0,T.length),posParams:M}}function $n(y,E){const x=y?Object.keys(y):void 0,T=E?Object.keys(E):void 0;if(!x||!T||x.length!=T.length)return!1;let M;for(let L=0;L<x.length;L++)if(M=x[L],!oo(y[M],E[M]))return!1;return!0}function oo(y,E){if(Array.isArray(y)&&Array.isArray(E)){if(y.length!==E.length)return!1;const x=[...y].sort(),T=[...E].sort();return x.every((M,L)=>T[L]===M)}return y===E}function li(y){return Array.prototype.concat.apply([],y)}function mr(y){return y.length>0?y[y.length-1]:null}function Nr(y,E){for(const x in y)y.hasOwnProperty(x)&&E(y[x],x)}function Gn(y){return(0,K.CqO)(y)?y:(0,K.QGY)(y)?(0,Ie.D)(Promise.resolve(y)):c(y)}const Kr=!1,so={exact:function qo(y,E,x){if(!xe(y.segments,E.segments)||!le(y.segments,E.segments,x)||y.numberOfChildren!==E.numberOfChildren)return!1;for(const T in E.children)if(!y.children[T]||!qo(y.children[T],E.children[T],x))return!1;return!0},subset:pi},Zo={exact:function is(y,E){return $n(y,E)},subset:function Ei(y,E){return Object.keys(E).length<=Object.keys(y).length&&Object.keys(E).every(x=>oo(y[x],E[x]))},ignored:()=>!0};function bo(y,E,x){return so[x.paths](y.root,E.root,x.matrixParams)&&Zo[x.queryParams](y.queryParams,E.queryParams)&&!("exact"===x.fragment&&y.fragment!==E.fragment)}function pi(y,E,x){return Ui(y,E,E.segments,x)}function Ui(y,E,x,T){if(y.segments.length>x.length){const M=y.segments.slice(0,x.length);return!(!xe(M,x)||E.hasChildren()||!le(M,x,T))}if(y.segments.length===x.length){if(!xe(y.segments,x)||!le(y.segments,x,T))return!1;for(const M in E.children)if(!y.children[M]||!pi(y.children[M],E.children[M],T))return!1;return!0}{const M=x.slice(0,y.segments.length),L=x.slice(y.segments.length);return!!(xe(y.segments,M)&&le(y.segments,M,T)&&y.children[yn])&&Ui(y.children[yn],E,L,T)}}function le(y,E,x){return E.every((T,M)=>Zo[x](y[M].parameters,T.parameters))}class H{constructor(E=new X([],{}),x={},T=null){this.root=E,this.queryParams=x,this.fragment=T}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Et(this.queryParams)),this._queryParamMap}toString(){return ne.serialize(this)}}class X{constructor(E,x){this.segments=E,this.children=x,this.parent=null,Nr(x,(T,M)=>T.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Q(this)}}class ae{constructor(E,x){this.path=E,this.parameters=x}get parameterMap(){return this._parameterMap||(this._parameterMap=Et(this.parameters)),this._parameterMap}toString(){return On(this)}}function xe(y,E){return y.length===E.length&&y.every((x,T)=>x.path===E[T].path)}let Ce=(()=>{class y{}return y.\u0275fac=function(x){return new(x||y)},y.\u0275prov=K.Yz7({token:y,factory:function(){return new re},providedIn:"root"}),y})();class re{parse(E){const x=new $r(E);return new H(x.parseRootSegment(),x.parseQueryParams(),x.parseFragment())}serialize(E){const x=`/${ve(E.root,!0)}`,T=function lr(y){const E=Object.keys(y).map(x=>{const T=y[x];return Array.isArray(T)?T.map(M=>`${lt(x)}=${lt(M)}`).join("&"):`${lt(x)}=${lt(T)}`}).filter(x=>!!x);return E.length?`?${E.join("&")}`:""}(E.queryParams);return`${x}${T}${"string"==typeof E.fragment?`#${function mt(y){return encodeURI(y)}(E.fragment)}`:""}`}}const ne=new re;function Q(y){return y.segments.map(E=>On(E)).join("/")}function ve(y,E){if(!y.hasChildren())return Q(y);if(E){const x=y.children[yn]?ve(y.children[yn],!1):"",T=[];return Nr(y.children,(M,L)=>{L!==yn&&T.push(`${L}:${ve(M,!1)}`)}),T.length>0?`${x}(${T.join("//")})`:x}{const x=function Se(y,E){let x=[];return Nr(y.children,(T,M)=>{M===yn&&(x=x.concat(E(T,M)))}),Nr(y.children,(T,M)=>{M!==yn&&(x=x.concat(E(T,M)))}),x}(y,(T,M)=>M===yn?[ve(y.children[yn],!1)]:[`${M}:${ve(T,!1)}`]);return 1===Object.keys(y.children).length&&null!=y.children[yn]?`${Q(y)}/${x[0]}`:`${Q(y)}/(${x.join("//")})`}}function we(y){return encodeURIComponent(y).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function lt(y){return we(y).replace(/%3B/gi,";")}function Ct(y){return we(y).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function yt(y){return decodeURIComponent(y)}function xn(y){return yt(y.replace(/\+/g,"%20"))}function On(y){return`${Ct(y.path)}${function Kt(y){return Object.keys(y).map(E=>`;${Ct(E)}=${Ct(y[E])}`).join("")}(y.parameters)}`}const Kn=/^[^\/()?;=#]+/;function mi(y){const E=y.match(Kn);return E?E[0]:""}const os=/^[^=?&#]+/,Ge=/^[^&#]+/;class $r{constructor(E){this.url=E,this.remaining=E}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new X([],{}):new X([],this.parseChildren())}parseQueryParams(){const E={};if(this.consumeOptional("?"))do{this.parseQueryParam(E)}while(this.consumeOptional("&"));return E}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const E=[];for(this.peekStartsWith("(")||E.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),E.push(this.parseSegment());let x={};this.peekStartsWith("/(")&&(this.capture("/"),x=this.parseParens(!0));let T={};return this.peekStartsWith("(")&&(T=this.parseParens(!1)),(E.length>0||Object.keys(x).length>0)&&(T[yn]=new X(E,x)),T}parseSegment(){const E=mi(this.remaining);if(""===E&&this.peekStartsWith(";"))throw new K.vHH(4009,Kr);return this.capture(E),new ae(yt(E),this.parseMatrixParams())}parseMatrixParams(){const E={};for(;this.consumeOptional(";");)this.parseParam(E);return E}parseParam(E){const x=mi(this.remaining);if(!x)return;this.capture(x);let T="";if(this.consumeOptional("=")){const M=mi(this.remaining);M&&(T=M,this.capture(T))}E[yt(x)]=yt(T)}parseQueryParam(E){const x=function Di(y){const E=y.match(os);return E?E[0]:""}(this.remaining);if(!x)return;this.capture(x);let T="";if(this.consumeOptional("=")){const O=function wo(y){const E=y.match(Ge);return E?E[0]:""}(this.remaining);O&&(T=O,this.capture(T))}const M=xn(x),L=xn(T);if(E.hasOwnProperty(M)){let O=E[M];Array.isArray(O)||(O=[O],E[M]=O),O.push(L)}else E[M]=L}parseParens(E){const x={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const T=mi(this.remaining),M=this.remaining[T.length];if("/"!==M&&")"!==M&&";"!==M)throw new K.vHH(4010,Kr);let L;T.indexOf(":")>-1?(L=T.slice(0,T.indexOf(":")),this.capture(L),this.capture(":")):E&&(L=yn);const O=this.parseChildren();x[L]=1===Object.keys(O).length?O[yn]:new X([],O),this.consumeOptional("//")}return x}peekStartsWith(E){return this.remaining.startsWith(E)}consumeOptional(E){return!!this.peekStartsWith(E)&&(this.remaining=this.remaining.substring(E.length),!0)}capture(E){if(!this.consumeOptional(E))throw new K.vHH(4011,Kr)}}function ao(y){return y.segments.length>0?new X([],{[yn]:y}):y}function Ja(y){const E={};for(const T of Object.keys(y.children)){const L=Ja(y.children[T]);(L.segments.length>0||L.hasChildren())&&(E[T]=L)}return function Ti(y){if(1===y.numberOfChildren&&y.children[yn]){const E=y.children[yn];return new X(y.segments.concat(E.segments),E.children)}return y}(new X(y.segments,E))}function lo(y){return y instanceof H}function Tn(y,E,x,T,M){if(0===x.length)return ot(E.root,E.root,E.root,T,M);const L=function Qr(y){if("string"==typeof y[0]&&1===y.length&&"/"===y[0])return new yr(!0,0,y);let E=0,x=!1;const T=y.reduce((M,L,O)=>{if("object"==typeof L&&null!=L){if(L.outlets){const Z={};return Nr(L.outlets,(Y,oe)=>{Z[oe]="string"==typeof Y?Y.split("/"):Y}),[...M,{outlets:Z}]}if(L.segmentPath)return[...M,L.segmentPath]}return"string"!=typeof L?[...M,L]:0===O?(L.split("/").forEach((Z,Y)=>{0==Y&&"."===Z||(0==Y&&""===Z?x=!0:".."===Z?E++:""!=Z&&M.push(Z))}),M):[...M,L]},[]);return new yr(x,E,T)}(x);return L.toRoot()?ot(E.root,E.root,new X([],{}),T,M):function O(Y){const oe=function Ri(y,E,x,T){if(y.isAbsolute)return new pr(E.root,!0,0);if(-1===T)return new pr(x,x===E.root,0);return function Tr(y,E,x){let T=y,M=E,L=x;for(;L>M;){if(L-=M,T=T.parent,!T)throw new K.vHH(4005,!1);M=T.segments.length}return new pr(T,!1,M-L)}(x,T+(_r(y.commands[0])?0:1),y.numberOfDoubleDots)}(L,E,y.snapshot?._urlSegment,Y),se=oe.processChildren?bn(oe.segmentGroup,oe.index,L.commands):Eo(oe.segmentGroup,oe.index,L.commands);return ot(E.root,oe.segmentGroup,se,T,M)}(y.snapshot?._lastPathIndex)}function _r(y){return"object"==typeof y&&null!=y&&!y.outlets&&!y.segmentPath}function Jr(y){return"object"==typeof y&&null!=y&&y.outlets}function ot(y,E,x,T,M){let O,L={};T&&Nr(T,(Y,oe)=>{L[oe]=Array.isArray(Y)?Y.map(se=>`${se}`):`${Y}`}),O=y===E?x:Cn(y,E,x);const Z=ao(Ja(O));return new H(Z,L,M)}function Cn(y,E,x){const T={};return Nr(y.children,(M,L)=>{T[L]=M===E?x:Cn(M,E,x)}),new X(y.segments,T)}class yr{constructor(E,x,T){if(this.isAbsolute=E,this.numberOfDoubleDots=x,this.commands=T,E&&T.length>0&&_r(T[0]))throw new K.vHH(4003,!1);const M=T.find(Jr);if(M&&M!==mr(T))throw new K.vHH(4004,!1)}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class pr{constructor(E,x,T){this.segmentGroup=E,this.processChildren=x,this.index=T}}function Eo(y,E,x){if(y||(y=new X([],{})),0===y.segments.length&&y.hasChildren())return bn(y,E,x);const T=function $s(y,E,x){let T=0,M=E;const L={match:!1,pathIndex:0,commandIndex:0};for(;M<y.segments.length;){if(T>=x.length)return L;const O=y.segments[M],Z=x[T];if(Jr(Z))break;const Y=`${Z}`,oe=T<x.length-1?x[T+1]:null;if(M>0&&void 0===Y)break;if(Y&&oe&&"object"==typeof oe&&void 0===oe.outlets){if(!ri(Y,oe,O))return L;T+=2}else{if(!ri(Y,{},O))return L;T++}M++}return{match:!0,pathIndex:M,commandIndex:T}}(y,E,x),M=x.slice(T.commandIndex);if(T.match&&T.pathIndex<y.segments.length){const L=new X(y.segments.slice(0,T.pathIndex),{});return L.children[yn]=new X(y.segments.slice(T.pathIndex),y.children),bn(L,0,M)}return T.match&&0===M.length?new X(y.segments,{}):T.match&&!y.hasChildren()?Xi(y,E,x):T.match?bn(y,0,M):Xi(y,E,x)}function bn(y,E,x){if(0===x.length)return new X(y.segments,{});{const T=function xs(y){return Jr(y[0])?y[0].outlets:{[yn]:y}}(x),M={};return!T[yn]&&y.children[yn]&&1===y.numberOfChildren&&0===y.children[yn].segments.length?bn(y.children[yn],E,x):(Nr(T,(L,O)=>{"string"==typeof L&&(L=[L]),null!==L&&(M[O]=Eo(y.children[O],E,L))}),Nr(y.children,(L,O)=>{void 0===T[O]&&(M[O]=L)}),new X(y.segments,M))}}function Xi(y,E,x){const T=y.segments.slice(0,E);let M=0;for(;M<x.length;){const L=x[M];if(Jr(L)){const Y=va(L.outlets);return new X(T,Y)}if(0===M&&_r(x[0])){T.push(new ae(y.segments[E].path,ei(x[0]))),M++;continue}const O=Jr(L)?L.outlets[yn]:`${L}`,Z=M<x.length-1?x[M+1]:null;O&&Z&&_r(Z)?(T.push(new ae(O,ei(Z))),M+=2):(T.push(new ae(O,{})),M++)}return new X(T,{})}function va(y){const E={};return Nr(y,(x,T)=>{"string"==typeof x&&(x=[x]),null!==x&&(E[T]=Xi(new X([],{}),0,x))}),E}function ei(y){const E={};return Nr(y,(x,T)=>E[T]=`${x}`),E}function ri(y,E,x){return y==x.path&&$n(E,x.parameters)}const Ur="imperative";class Wn{constructor(E,x){this.id=E,this.url=x}}class Ci extends Wn{constructor(E,x,T="imperative",M=null){super(E,x),this.type=0,this.navigationTrigger=T,this.restoredState=M}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class Yi extends Wn{constructor(E,x,T){super(E,x),this.urlAfterRedirects=T,this.type=1}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class Gr extends Wn{constructor(E,x,T,M){super(E,x),this.reason=T,this.code=M,this.type=2}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class Xn extends Wn{constructor(E,x,T,M){super(E,x),this.reason=T,this.code=M,this.type=16}}class hc extends Wn{constructor(E,x,T,M){super(E,x),this.error=T,this.target=M,this.type=3}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class Gs extends Wn{constructor(E,x,T,M){super(E,x),this.urlAfterRedirects=T,this.state=M,this.type=4}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Hr extends Wn{constructor(E,x,T,M){super(E,x),this.urlAfterRedirects=T,this.state=M,this.type=7}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class ss extends Wn{constructor(E,x,T,M,L){super(E,x),this.urlAfterRedirects=T,this.state=M,this.shouldActivate=L,this.type=8}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class Hs extends Wn{constructor(E,x,T,M){super(E,x),this.urlAfterRedirects=T,this.state=M,this.type=5}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Ro extends Wn{constructor(E,x,T,M){super(E,x),this.urlAfterRedirects=T,this.state=M,this.type=6}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class ur{constructor(E){this.route=E,this.type=9}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class xa{constructor(E){this.route=E,this.type=10}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class Li{constructor(E){this.snapshot=E,this.type=11}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class ii{constructor(E){this.snapshot=E,this.type=12}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class bs{constructor(E){this.snapshot=E,this.type=13}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class as{constructor(E){this.snapshot=E,this.type=14}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Zs{constructor(E,x,T){this.routerEvent=E,this.position=x,this.anchor=T,this.type=15}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}let Ml=(()=>{class y{createUrlTree(x,T,M,L,O,Z){return Tn(x||T.root,M,L,O,Z)}}return y.\u0275fac=function(x){return new(x||y)},y.\u0275prov=K.Yz7({token:y,factory:y.\u0275fac}),y})(),ls=(()=>{class y{}return y.\u0275fac=function(x){return new(x||y)},y.\u0275prov=K.Yz7({token:y,factory:function(E){return Ml.\u0275fac(E)},providedIn:"root"}),y})();class ws{constructor(E){this._root=E}get root(){return this._root.value}parent(E){const x=this.pathFromRoot(E);return x.length>1?x[x.length-2]:null}children(E){const x=Qa(E,this._root);return x?x.children.map(T=>T.value):[]}firstChild(E){const x=Qa(E,this._root);return x&&x.children.length>0?x.children[0].value:null}siblings(E){const x=ci(E,this._root);return x.length<2?[]:x[x.length-2].children.map(M=>M.value).filter(M=>M!==E)}pathFromRoot(E){return ci(E,this._root).map(x=>x.value)}}function Qa(y,E){if(y===E.value)return E;for(const x of E.children){const T=Qa(y,x);if(T)return T}return null}function ci(y,E){if(y===E.value)return[E];for(const x of E.children){const T=ci(y,x);if(T.length)return T.unshift(E),T}return[]}class co{constructor(E,x){this.value=E,this.children=x}toString(){return`TreeNode(${this.value})`}}function Wo(y){const E={};return y&&y.children.forEach(x=>E[x.value.outlet]=x),E}class dc extends ws{constructor(E,x){super(E),this.snapshot=x,cs(this,E)}toString(){return this.snapshot.toString()}}function fc(y,E){const x=function pc(y,E){const O=new el([],{},{},"",{},yn,E,null,y.root,-1,{});return new tl("",new co(O,[]))}(y,E),T=new Ht([new ae("",{})]),M=new Ht({}),L=new Ht({}),O=new Ht({}),Z=new Ht(""),Y=new ba(T,M,O,Z,L,yn,E,x.root);return Y.snapshot=x.root,new dc(new co(Y,[]),x)}class ba{constructor(E,x,T,M,L,O,Z,Y){this.url=E,this.params=x,this.queryParams=T,this.fragment=M,this.data=L,this.outlet=O,this.component=Z,this.title=this.data?.pipe((0,Ut.U)(oe=>oe[fr]))??c(void 0),this._futureSnapshot=Y}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe((0,Ut.U)(E=>Et(E)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe((0,Ut.U)(E=>Et(E)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function Pl(y,E="emptyOnly"){const x=y.pathFromRoot;let T=0;if("always"!==E)for(T=x.length-1;T>=1;){const M=x[T],L=x[T-1];if(M.routeConfig&&""===M.routeConfig.path)T--;else{if(L.component)break;T--}}return function Rl(y){return y.reduce((E,x)=>({params:{...E.params,...x.params},data:{...E.data,...x.data},resolve:{...x.data,...E.resolve,...x.routeConfig?.data,...x._resolvedData}}),{params:{},data:{},resolve:{}})}(x.slice(T))}class el{get title(){return this.data?.[fr]}constructor(E,x,T,M,L,O,Z,Y,oe,se,he){this.url=E,this.params=x,this.queryParams=T,this.fragment=M,this.data=L,this.outlet=O,this.component=Z,this.routeConfig=Y,this._urlSegment=oe,this._lastPathIndex=se,this._resolve=he}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=Et(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Et(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(T=>T.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class tl extends ws{constructor(E,x){super(x),this.url=E,cs(this,x)}toString(){return nl(this._root)}}function cs(y,E){E.value._routerState=y,E.children.forEach(x=>cs(y,x))}function nl(y){const E=y.children.length>0?` { ${y.children.map(nl).join(", ")} } `:"";return`${y.value}${E}`}function us(y){if(y.snapshot){const E=y.snapshot,x=y._futureSnapshot;y.snapshot=x,$n(E.queryParams,x.queryParams)||y.queryParams.next(x.queryParams),E.fragment!==x.fragment&&y.fragment.next(x.fragment),$n(E.params,x.params)||y.params.next(x.params),function Yr(y,E){if(y.length!==E.length)return!1;for(let x=0;x<y.length;++x)if(!$n(y[x],E[x]))return!1;return!0}(E.url,x.url)||y.url.next(x.url),$n(E.data,x.data)||y.data.next(x.data)}else y.snapshot=y._futureSnapshot,y.data.next(y._futureSnapshot.data)}function rr(y,E){const x=$n(y.params,E.params)&&function fe(y,E){return xe(y,E)&&y.every((x,T)=>$n(x.parameters,E[T].parameters))}(y.url,E.url);return x&&!(!y.parent!=!E.parent)&&(!y.parent||rr(y.parent,E.parent))}function ds(y,E,x){if(x&&y.shouldReuseRoute(E.value,x.value.snapshot)){const T=x.value;T._futureSnapshot=E.value;const M=function Es(y,E,x){return E.children.map(T=>{for(const M of x.children)if(y.shouldReuseRoute(T.value,M.value.snapshot))return ds(y,T,M);return ds(y,T)})}(y,E,x);return new co(T,M)}{if(y.shouldAttach(E.value)){const L=y.retrieve(E.value);if(null!==L){const O=L.route;return O.value._futureSnapshot=E.value,O.children=E.children.map(Z=>ds(y,Z)),O}}const T=function Ws(y){return new ba(new Ht(y.url),new Ht(y.params),new Ht(y.queryParams),new Ht(y.fragment),new Ht(y.data),y.outlet,y.component,y)}(E.value),M=E.children.map(L=>ds(y,L));return new co(T,M)}}const Xs="ngNavigationCancelingError";function Ys(y,E){const{redirectTo:x,navigationBehaviorOptions:T}=lo(E)?{redirectTo:E,navigationBehaviorOptions:void 0}:E,M=Ks(!1,0,E);return M.url=x,M.navigationBehaviorOptions=T,M}function Ks(y,E,x){const T=new Error("NavigationCancelingError: "+(y||""));return T[Xs]=!0,T.cancellationCode=E,x&&(T.url=x),T}function Js(y){return wa(y)&&lo(y.url)}function wa(y){return y&&y[Xs]}class uo{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.injector=null,this.children=new Lo,this.attachRef=null}}let Lo=(()=>{class y{constructor(){this.contexts=new Map}onChildOutletCreated(x,T){const M=this.getOrCreateContext(x);M.outlet=T,this.contexts.set(x,M)}onChildOutletDestroyed(x){const T=this.getContext(x);T&&(T.outlet=null,T.attachRef=null)}onOutletDeactivated(){const x=this.contexts;return this.contexts=new Map,x}onOutletReAttached(x){this.contexts=x}getOrCreateContext(x){let T=this.getContext(x);return T||(T=new uo,this.contexts.set(x,T)),T}getContext(x){return this.contexts.get(x)||null}}return y.\u0275fac=function(x){return new(x||y)},y.\u0275prov=K.Yz7({token:y,factory:y.\u0275fac,providedIn:"root"}),y})();const ui=!1;let Ds=(()=>{class y{constructor(){this.activated=null,this._activatedRoute=null,this.name=yn,this.activateEvents=new K.vpe,this.deactivateEvents=new K.vpe,this.attachEvents=new K.vpe,this.detachEvents=new K.vpe,this.parentContexts=(0,K.f3M)(Lo),this.location=(0,K.f3M)(K.s_b),this.changeDetector=(0,K.f3M)(K.sBO),this.environmentInjector=(0,K.f3M)(K.lqb)}ngOnChanges(x){if(x.name){const{firstChange:T,previousValue:M}=x.name;if(T)return;this.isTrackedInParentContexts(M)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(M)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name)}isTrackedInParentContexts(x){return this.parentContexts.getContext(x)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;const x=this.parentContexts.getContext(this.name);x?.route&&(x.attachRef?this.attach(x.attachRef,x.route):this.activateWith(x.route,x.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new K.vHH(4012,ui);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new K.vHH(4012,ui);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new K.vHH(4012,ui);this.location.detach();const x=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(x.instance),x}attach(x,T){this.activated=x,this._activatedRoute=T,this.location.insert(x.hostView),this.attachEvents.emit(x.instance)}deactivate(){if(this.activated){const x=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(x)}}activateWith(x,T){if(this.isActivated)throw new K.vHH(4013,ui);this._activatedRoute=x;const M=this.location,O=x.snapshot.component,Z=this.parentContexts.getOrCreateContext(this.name).children,Y=new Ea(x,Z,M.injector);if(T&&function gn(y){return!!y.resolveComponentFactory}(T)){const oe=T.resolveComponentFactory(O);this.activated=M.createComponent(oe,M.length,Y)}else this.activated=M.createComponent(O,{index:M.length,injector:Y,environmentInjector:T??this.environmentInjector});this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return y.\u0275fac=function(x){return new(x||y)},y.\u0275dir=K.lG2({type:y,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[K.TTD]}),y})();class Ea{constructor(E,x,T){this.route=E,this.childContexts=x,this.parent=T}get(E,x){return E===ba?this.route:E===Lo?this.childContexts:this.parent.get(E,x)}}let Qs=(()=>{class y{}return y.\u0275fac=function(x){return new(x||y)},y.\u0275cmp=K.Xpm({type:y,selectors:[["ng-component"]],standalone:!0,features:[K.jDz],decls:1,vars:0,template:function(x,T){1&x&&K._UZ(0,"router-outlet")},dependencies:[Ds],encapsulation:2}),y})();function Ts(y,E){return y.providers&&!y._injector&&(y._injector=(0,K.MMx)(y.providers,E,`Route: ${y.path}`)),y._injector??E}function fo(y){const E=y.children&&y.children.map(fo),x=E?{...y,children:E}:{...y};return!x.component&&!x.loadComponent&&(E||x.loadChildren)&&x.outlet&&x.outlet!==yn&&(x.component=Qs),x}function ki(y){return y.outlet||yn}function ol(y,E){const x=y.filter(T=>ki(T)===E);return x.push(...y.filter(T=>ki(T)!==E)),x}function wn(y){if(!y)return null;if(y.routeConfig?._injector)return y.routeConfig._injector;for(let E=y.parent;E;E=E.parent){const x=E.routeConfig;if(x?._loadedInjector)return x._loadedInjector;if(x?._injector)return x._injector}return null}class Ll{constructor(E,x,T,M){this.routeReuseStrategy=E,this.futureState=x,this.currState=T,this.forwardEvent=M}activate(E){const x=this.futureState._root,T=this.currState?this.currState._root:null;this.deactivateChildRoutes(x,T,E),us(this.futureState.root),this.activateChildRoutes(x,T,E)}deactivateChildRoutes(E,x,T){const M=Wo(x);E.children.forEach(L=>{const O=L.value.outlet;this.deactivateRoutes(L,M[O],T),delete M[O]}),Nr(M,(L,O)=>{this.deactivateRouteAndItsChildren(L,T)})}deactivateRoutes(E,x,T){const M=E.value,L=x?x.value:null;if(M===L)if(M.component){const O=T.getContext(M.outlet);O&&this.deactivateChildRoutes(E,x,O.children)}else this.deactivateChildRoutes(E,x,T);else L&&this.deactivateRouteAndItsChildren(x,T)}deactivateRouteAndItsChildren(E,x){E.value.component&&this.routeReuseStrategy.shouldDetach(E.value.snapshot)?this.detachAndStoreRouteSubtree(E,x):this.deactivateRouteAndOutlet(E,x)}detachAndStoreRouteSubtree(E,x){const T=x.getContext(E.value.outlet),M=T&&E.value.component?T.children:x,L=Wo(E);for(const O of Object.keys(L))this.deactivateRouteAndItsChildren(L[O],M);if(T&&T.outlet){const O=T.outlet.detach(),Z=T.children.onOutletDeactivated();this.routeReuseStrategy.store(E.value.snapshot,{componentRef:O,route:E,contexts:Z})}}deactivateRouteAndOutlet(E,x){const T=x.getContext(E.value.outlet),M=T&&E.value.component?T.children:x,L=Wo(E);for(const O of Object.keys(L))this.deactivateRouteAndItsChildren(L[O],M);T&&T.outlet&&(T.outlet.deactivate(),T.children.onOutletDeactivated(),T.attachRef=null,T.resolver=null,T.route=null)}activateChildRoutes(E,x,T){const M=Wo(x);E.children.forEach(L=>{this.activateRoutes(L,M[L.value.outlet],T),this.forwardEvent(new as(L.value.snapshot))}),E.children.length&&this.forwardEvent(new ii(E.value.snapshot))}activateRoutes(E,x,T){const M=E.value,L=x?x.value:null;if(us(M),M===L)if(M.component){const O=T.getOrCreateContext(M.outlet);this.activateChildRoutes(E,x,O.children)}else this.activateChildRoutes(E,x,T);else if(M.component){const O=T.getOrCreateContext(M.outlet);if(this.routeReuseStrategy.shouldAttach(M.snapshot)){const Z=this.routeReuseStrategy.retrieve(M.snapshot);this.routeReuseStrategy.store(M.snapshot,null),O.children.onOutletReAttached(Z.contexts),O.attachRef=Z.componentRef,O.route=Z.route.value,O.outlet&&O.outlet.attach(Z.componentRef,Z.route.value),us(Z.route.value),this.activateChildRoutes(E,null,O.children)}else{const Z=wn(M.snapshot),Y=Z?.get(K._Vd)??null;O.attachRef=null,O.route=M,O.resolver=Y,O.injector=Z,O.outlet&&O.outlet.activateWith(M,O.injector),this.activateChildRoutes(E,null,O.children)}}else this.activateChildRoutes(E,null,T)}}class ta{constructor(E){this.path=E,this.route=this.path[this.path.length-1]}}class sl{constructor(E,x){this.component=E,this.route=x}}function kl(y,E,x){const T=y._root;return fs(T,E?E._root:null,x,[T.value])}function Vi(y,E){const x=Symbol(),T=E.get(y,x);return T===x?"function"!=typeof y||(0,K.Z0I)(y)?E.get(y):y:T}function fs(y,E,x,T,M={canDeactivateChecks:[],canActivateChecks:[]}){const L=Wo(E);return y.children.forEach(O=>{(function pt(y,E,x,T,M={canDeactivateChecks:[],canActivateChecks:[]}){const L=y.value,O=E?E.value:null,Z=x?x.getContext(y.value.outlet):null;if(O&&L.routeConfig===O.routeConfig){const Y=function Jn(y,E,x){if("function"==typeof x)return x(y,E);switch(x){case"pathParamsChange":return!xe(y.url,E.url);case"pathParamsOrQueryParamsChange":return!xe(y.url,E.url)||!$n(y.queryParams,E.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!rr(y,E)||!$n(y.queryParams,E.queryParams);default:return!rr(y,E)}}(O,L,L.routeConfig.runGuardsAndResolvers);Y?M.canActivateChecks.push(new ta(T)):(L.data=O.data,L._resolvedData=O._resolvedData),fs(y,E,L.component?Z?Z.children:null:x,T,M),Y&&Z&&Z.outlet&&Z.outlet.isActivated&&M.canDeactivateChecks.push(new sl(Z.outlet.component,O))}else O&&na(E,Z,M),M.canActivateChecks.push(new ta(T)),fs(y,null,L.component?Z?Z.children:null:x,T,M)})(O,L[O.value.outlet],x,T.concat([O.value]),M),delete L[O.value.outlet]}),Nr(L,(O,Z)=>na(O,x.getContext(Z),M)),M}function na(y,E,x){const T=Wo(y),M=y.value;Nr(T,(L,O)=>{na(L,M.component?E?E.children.getContext(O):null:E,x)}),x.canDeactivateChecks.push(new sl(M.component&&E&&E.outlet&&E.outlet.isActivated?E.outlet.component:null,M))}function Xo(y){return"function"==typeof y}function ll(y){return y instanceof kt||"EmptyError"===y?.name}const Zr=Symbol("INITIAL_VALUE");function $i(){return en(y=>ar(y.map(E=>E.pipe(jn(1),function Ln(...y){const E=(0,Dt.yG)(y);return(0,at.e)((x,T)=>{(E?cn(y,x,E):cn(y,x)).subscribe(T)})}(Zr)))).pipe((0,Ut.U)(E=>{for(const x of E)if(!0!==x){if(x===Zr)return Zr;if(!1===x||x instanceof H)return x}return!0}),tr(E=>E!==Zr),jn(1)))}function ul(y){return(0,We.z)(Vn(E=>{if(lo(E))throw Ys(0,E)}),(0,Ut.U)(E=>!0===E))}const dl={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function Fl(y,E,x,T,M){const L=Ss(y,E,x);return L.matched?function hl(y,E,x,T){const M=E.canMatch;return M&&0!==M.length?c(M.map(O=>{const Z=Vi(O,y);return Gn(function al(y){return y&&Xo(y.canMatch)}(Z)?Z.canMatch(E,x):y.runInContext(()=>Z(E,x)))})).pipe($i(),ul()):c(!0)}(T=Ts(E,T),E,x).pipe((0,Ut.U)(O=>!0===O?L:{...dl})):c(L)}function Ss(y,E,x){if(""===E.path)return"full"===E.pathMatch&&(y.hasChildren()||x.length>0)?{...dl}:{matched:!0,consumedSegments:[],remainingSegments:x,parameters:{},positionalParamSegments:{}};const M=(E.matcher||xo)(x,y,E);if(!M)return{...dl};const L={};Nr(M.posParams,(Z,Y)=>{L[Y]=Z.path});const O=M.consumed.length>0?{...L,...M.consumed[M.consumed.length-1].parameters}:L;return{matched:!0,consumedSegments:M.consumed,remainingSegments:x.slice(M.consumed.length),parameters:O,positionalParamSegments:M.posParams??{}}}function ms(y,E,x,T){if(x.length>0&&function bc(y,E,x){return x.some(T=>Yo(y,E,T)&&ki(T)!==yn)}(y,x,T)){const L=new X(E,function Ta(y,E,x,T){const M={};M[yn]=T,T._sourceSegment=y,T._segmentIndexShift=E.length;for(const L of x)if(""===L.path&&ki(L)!==yn){const O=new X([],{});O._sourceSegment=y,O._segmentIndexShift=E.length,M[ki(L)]=O}return M}(y,E,T,new X(x,y.children)));return L._sourceSegment=y,L._segmentIndexShift=E.length,{segmentGroup:L,slicedSegments:[]}}if(0===x.length&&function Hi(y,E,x){return x.some(T=>Yo(y,E,T))}(y,x,T)){const L=new X(y.segments,function ko(y,E,x,T,M){const L={};for(const O of T)if(Yo(y,x,O)&&!M[ki(O)]){const Z=new X([],{});Z._sourceSegment=y,Z._segmentIndexShift=E.length,L[ki(O)]=Z}return{...M,...L}}(y,E,x,T,y.children));return L._sourceSegment=y,L._segmentIndexShift=E.length,{segmentGroup:L,slicedSegments:x}}const M=new X(y.segments,y.children);return M._sourceSegment=y,M._segmentIndexShift=E.length,{segmentGroup:M,slicedSegments:x}}function Yo(y,E,x){return(!(y.hasChildren()||E.length>0)||"full"!==x.pathMatch)&&""===x.path}function Is(y,E,x,T){return!!(ki(y)===T||T!==yn&&Yo(E,x,y))&&("**"===y.path||Ss(E,y,x).matched)}function _i(y,E,x){return 0===E.length&&!y.children[x]}const An=!1;class z{constructor(E){this.segmentGroup=E||null}}class W{constructor(E){this.urlTree=E}}function U(y){return it(new z(y))}function ee(y){return it(new W(y))}class Yt{constructor(E,x,T,M,L){this.injector=E,this.configLoader=x,this.urlSerializer=T,this.urlTree=M,this.config=L,this.allowRedirects=!0}apply(){const E=ms(this.urlTree.root,[],[],this.config).segmentGroup,x=new X(E.segments,E.children);return this.expandSegmentGroup(this.injector,this.config,x,yn).pipe((0,Ut.U)(L=>this.createUrlTree(Ja(L),this.urlTree.queryParams,this.urlTree.fragment))).pipe(Ni(L=>{if(L instanceof W)return this.allowRedirects=!1,this.match(L.urlTree);throw L instanceof z?this.noMatchError(L):L}))}match(E){return this.expandSegmentGroup(this.injector,this.config,E.root,yn).pipe((0,Ut.U)(M=>this.createUrlTree(Ja(M),E.queryParams,E.fragment))).pipe(Ni(M=>{throw M instanceof z?this.noMatchError(M):M}))}noMatchError(E){return new K.vHH(4002,An)}createUrlTree(E,x,T){const M=ao(E);return new H(M,x,T)}expandSegmentGroup(E,x,T,M){return 0===T.segments.length&&T.hasChildren()?this.expandChildren(E,x,T).pipe((0,Ut.U)(L=>new X([],L))):this.expandSegment(E,T,x,T.segments,M,!0)}expandChildren(E,x,T){const M=[];for(const L of Object.keys(T.children))"primary"===L?M.unshift(L):M.push(L);return(0,Ie.D)(M).pipe(si(L=>{const O=T.children[L],Z=ol(x,L);return this.expandSegmentGroup(E,Z,O,L).pipe((0,Ut.U)(Y=>({segment:Y,outlet:L})))}),Br((L,O)=>(L[O.outlet]=O.segment,L),{}),yo())}expandSegment(E,x,T,M,L,O){return(0,Ie.D)(T).pipe(si(Z=>this.expandSegmentAgainstRoute(E,x,T,Z,M,L,O).pipe(Ni(oe=>{if(oe instanceof z)return c(null);throw oe}))),ni(Z=>!!Z),Ni((Z,Y)=>{if(ll(Z))return _i(x,M,L)?c(new X([],{})):U(x);throw Z}))}expandSegmentAgainstRoute(E,x,T,M,L,O,Z){return Is(M,x,L,O)?void 0===M.redirectTo?this.matchSegmentAgainstRoute(E,x,M,L,O):Z&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(E,x,T,M,L,O):U(x):U(x)}expandSegmentAgainstRouteUsingRedirect(E,x,T,M,L,O){return"**"===M.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(E,T,M,O):this.expandRegularSegmentAgainstRouteUsingRedirect(E,x,T,M,L,O)}expandWildCardWithParamsAgainstRouteUsingRedirect(E,x,T,M){const L=this.applyRedirectCommands([],T.redirectTo,{});return T.redirectTo.startsWith("/")?ee(L):this.lineralizeSegments(T,L).pipe((0,vn.z)(O=>{const Z=new X(O,{});return this.expandSegment(E,Z,x,O,M,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(E,x,T,M,L,O){const{matched:Z,consumedSegments:Y,remainingSegments:oe,positionalParamSegments:se}=Ss(x,M,L);if(!Z)return U(x);const he=this.applyRedirectCommands(Y,M.redirectTo,se);return M.redirectTo.startsWith("/")?ee(he):this.lineralizeSegments(M,he).pipe((0,vn.z)(be=>this.expandSegment(E,x,T,be.concat(oe),O,!1)))}matchSegmentAgainstRoute(E,x,T,M,L){return"**"===T.path?(E=Ts(T,E),T.loadChildren?(T._loadedRoutes?c({routes:T._loadedRoutes,injector:T._loadedInjector}):this.configLoader.loadChildren(E,T)).pipe((0,Ut.U)(Z=>(T._loadedRoutes=Z.routes,T._loadedInjector=Z.injector,new X(M,{})))):c(new X(M,{}))):Fl(x,T,M,E).pipe(en(({matched:O,consumedSegments:Z,remainingSegments:Y})=>O?this.getChildConfig(E=T._injector??E,T,M).pipe((0,vn.z)(se=>{const he=se.injector??E,be=se.routes,{segmentGroup:Le,slicedSegments:Pe}=ms(x,Z,Y,be),Te=new X(Le.segments,Le.children);if(0===Pe.length&&Te.hasChildren())return this.expandChildren(he,be,Te).pipe((0,Ut.U)(ze=>new X(Z,ze)));if(0===be.length&&0===Pe.length)return c(new X(Z,{}));const et=ki(T)===L;return this.expandSegment(he,Te,be,Pe,et?yn:L,!0).pipe((0,Ut.U)(He=>new X(Z.concat(He.segments),He.children)))})):U(x)))}getChildConfig(E,x,T){return x.children?c({routes:x.children,injector:E}):x.loadChildren?void 0!==x._loadedRoutes?c({routes:x._loadedRoutes,injector:x._loadedInjector}):function xc(y,E,x,T){const M=E.canLoad;return void 0===M||0===M.length?c(!0):c(M.map(O=>{const Z=Vi(O,y);return Gn(function Da(y){return y&&Xo(y.canLoad)}(Z)?Z.canLoad(E,x):y.runInContext(()=>Z(E,x)))})).pipe($i(),ul())}(E,x,T).pipe((0,vn.z)(M=>M?this.configLoader.loadChildren(E,x).pipe(Vn(L=>{x._loadedRoutes=L.routes,x._loadedInjector=L.injector})):function $e(y){return it(Ks(An,3))}())):c({routes:[],injector:E})}lineralizeSegments(E,x){let T=[],M=x.root;for(;;){if(T=T.concat(M.segments),0===M.numberOfChildren)return c(T);if(M.numberOfChildren>1||!M.children[yn])return it(new K.vHH(4e3,An));M=M.children[yn]}}applyRedirectCommands(E,x,T){return this.applyRedirectCreateUrlTree(x,this.urlSerializer.parse(x),E,T)}applyRedirectCreateUrlTree(E,x,T,M){const L=this.createSegmentGroup(E,x.root,T,M);return new H(L,this.createQueryParams(x.queryParams,this.urlTree.queryParams),x.fragment)}createQueryParams(E,x){const T={};return Nr(E,(M,L)=>{if("string"==typeof M&&M.startsWith(":")){const Z=M.substring(1);T[L]=x[Z]}else T[L]=M}),T}createSegmentGroup(E,x,T,M){const L=this.createSegments(E,x.segments,T,M);let O={};return Nr(x.children,(Z,Y)=>{O[Y]=this.createSegmentGroup(E,Z,T,M)}),new X(L,O)}createSegments(E,x,T,M){return x.map(L=>L.path.startsWith(":")?this.findPosParam(E,L,M):this.findOrReturn(L,T))}findPosParam(E,x,T){const M=T[x.path.substring(1)];if(!M)throw new K.vHH(4001,An);return M}findOrReturn(E,x){let T=0;for(const M of x){if(M.path===E.path)return x.splice(T),M;T++}return E}}class Zn{}class cr{constructor(E,x,T,M,L,O,Z){this.injector=E,this.rootComponentType=x,this.config=T,this.urlTree=M,this.url=L,this.paramsInheritanceStrategy=O,this.urlSerializer=Z}recognize(){const E=ms(this.urlTree.root,[],[],this.config.filter(x=>void 0===x.redirectTo)).segmentGroup;return this.processSegmentGroup(this.injector,this.config,E,yn).pipe((0,Ut.U)(x=>{if(null===x)return null;const T=new el([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,{},yn,this.rootComponentType,null,this.urlTree.root,-1,{}),M=new co(T,x),L=new tl(this.url,M);return this.inheritParamsAndData(L._root),L}))}inheritParamsAndData(E){const x=E.value,T=Pl(x,this.paramsInheritanceStrategy);x.params=Object.freeze(T.params),x.data=Object.freeze(T.data),E.children.forEach(M=>this.inheritParamsAndData(M))}processSegmentGroup(E,x,T,M){return 0===T.segments.length&&T.hasChildren()?this.processChildren(E,x,T):this.processSegment(E,x,T,T.segments,M)}processChildren(E,x,T){return(0,Ie.D)(Object.keys(T.children)).pipe(si(M=>{const L=T.children[M],O=ol(x,M);return this.processSegmentGroup(E,O,L,M)}),Br((M,L)=>M&&L?(M.push(...L),M):null),function rs(y,E=!1){return(0,at.e)((x,T)=>{let M=0;x.subscribe((0,qe.x)(T,L=>{const O=y(L,M++);(O||E)&&T.next(L),!O&&T.complete()}))})}(M=>null!==M),nr(null),yo(),(0,Ut.U)(M=>{if(null===M)return null;const L=qr(M);return function Cr(y){y.sort((E,x)=>E.value.outlet===yn?-1:x.value.outlet===yn?1:E.value.outlet.localeCompare(x.value.outlet))}(L),L}))}processSegment(E,x,T,M,L){return(0,Ie.D)(x).pipe(si(O=>this.processSegmentAgainstRoute(O._injector??E,O,T,M,L)),ni(O=>!!O),Ni(O=>{if(ll(O))return _i(T,M,L)?c([]):c(null);throw O}))}processSegmentAgainstRoute(E,x,T,M,L){if(x.redirectTo||!Is(x,T,M,L))return c(null);let O;if("**"===x.path){const Z=M.length>0?mr(M).parameters:{},Y=Ca(T)+M.length;O=c({snapshot:new el(M,Z,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,wu(x),ki(x),x.component??x._loadedComponent??null,x,oa(T),Y,Ia(x)),consumedSegments:[],remainingSegments:[]})}else O=Fl(T,x,M,E).pipe((0,Ut.U)(({matched:Z,consumedSegments:Y,remainingSegments:oe,parameters:se})=>{if(!Z)return null;const he=Ca(T)+Y.length;return{snapshot:new el(Y,se,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,wu(x),ki(x),x.component??x._loadedComponent??null,x,oa(T),he,Ia(x)),consumedSegments:Y,remainingSegments:oe}}));return O.pipe(en(Z=>{if(null===Z)return c(null);const{snapshot:Y,consumedSegments:oe,remainingSegments:se}=Z;E=x._injector??E;const he=x._loadedInjector??E,be=function Do(y){return y.children?y.children:y.loadChildren?y._loadedRoutes:[]}(x),{segmentGroup:Le,slicedSegments:Pe}=ms(T,oe,se,be.filter(et=>void 0===et.redirectTo));if(0===Pe.length&&Le.hasChildren())return this.processChildren(he,be,Le).pipe((0,Ut.U)(et=>null===et?null:[new co(Y,et)]));if(0===be.length&&0===Pe.length)return c([new co(Y,[])]);const Te=ki(x)===L;return this.processSegment(he,be,Le,Pe,Te?yn:L).pipe((0,Ut.U)(et=>null===et?null:[new co(Y,et)]))}))}}function St(y){const E=y.value.routeConfig;return E&&""===E.path&&void 0===E.redirectTo}function qr(y){const E=[],x=new Set;for(const T of y){if(!St(T)){E.push(T);continue}const M=E.find(L=>T.value.routeConfig===L.value.routeConfig);void 0!==M?(M.children.push(...T.children),x.add(M)):E.push(T)}for(const T of x){const M=qr(T.children);E.push(new co(T.value,M))}return E.filter(T=>!x.has(T))}function oa(y){let E=y;for(;E._sourceSegment;)E=E._sourceSegment;return E}function Ca(y){let E=y,x=E._segmentIndexShift??0;for(;E._sourceSegment;)E=E._sourceSegment,x+=E._segmentIndexShift??0;return x-1}function wu(y){return y.data||{}}function Ia(y){return y.resolve||{}}function Eu(y){return"string"==typeof y.title||null===y.title}function Pa(y){return en(E=>{const x=y(E);return x?(0,Ie.D)(x).pipe((0,Ut.U)(()=>E)):c(E)})}const la=new K.OlP("ROUTES");let zl=(()=>{class y{constructor(x,T){this.injector=x,this.compiler=T,this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap}loadComponent(x){if(this.componentLoaders.get(x))return this.componentLoaders.get(x);if(x._loadedComponent)return c(x._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(x);const T=Gn(x.loadComponent()).pipe((0,Ut.U)(pl),Vn(L=>{this.onLoadEndListener&&this.onLoadEndListener(x),x._loadedComponent=L}),vo(()=>{this.componentLoaders.delete(x)})),M=new qn(T,()=>new Ee.x).pipe(dn());return this.componentLoaders.set(x,M),M}loadChildren(x,T){if(this.childrenLoaders.get(T))return this.childrenLoaders.get(T);if(T._loadedRoutes)return c({routes:T._loadedRoutes,injector:T._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(T);const L=this.loadModuleFactoryOrRoutes(T.loadChildren).pipe((0,Ut.U)(Z=>{this.onLoadEndListener&&this.onLoadEndListener(T);let Y,oe,se=!1;Array.isArray(Z)?oe=Z:(Y=Z.create(x).injector,oe=li(Y.get(la,[],K.XFs.Self|K.XFs.Optional)));return{routes:oe.map(fo),injector:Y}}),vo(()=>{this.childrenLoaders.delete(T)})),O=new qn(L,()=>new Ee.x).pipe(dn());return this.childrenLoaders.set(T,O),O}loadModuleFactoryOrRoutes(x){return Gn(x()).pipe((0,Ut.U)(pl),(0,vn.z)(M=>M instanceof K.YKP||Array.isArray(M)?c(M):(0,Ie.D)(this.compiler.compileModuleAsync(M))))}}return y.\u0275fac=function(x){return new(x||y)(K.LFG(K.zs3),K.LFG(K.Sil))},y.\u0275prov=K.Yz7({token:y,factory:y.\u0275fac,providedIn:"root"}),y})();function pl(y){return function Bl(y){return y&&"object"==typeof y&&"default"in y}(y)?y.default:y}let ml=(()=>{class y{get hasRequestedNavigation(){return 0!==this.navigationId}constructor(){this.currentNavigation=null,this.lastSuccessfulNavigation=null,this.events=new Ee.x,this.configLoader=(0,K.f3M)(zl),this.environmentInjector=(0,K.f3M)(K.lqb),this.urlSerializer=(0,K.f3M)(Ce),this.rootContexts=(0,K.f3M)(Lo),this.navigationId=0,this.afterPreactivation=()=>c(void 0),this.rootComponentType=null,this.configLoader.onLoadEndListener=M=>this.events.next(new xa(M)),this.configLoader.onLoadStartListener=M=>this.events.next(new ur(M))}complete(){this.transitions?.complete()}handleNavigationRequest(x){const T=++this.navigationId;this.transitions?.next({...this.transitions.value,...x,id:T})}setupNavigations(x){return this.transitions=new Ht({id:0,targetPageId:0,currentUrlTree:x.currentUrlTree,currentRawUrl:x.currentUrlTree,extractedUrl:x.urlHandlingStrategy.extract(x.currentUrlTree),urlAfterRedirects:x.urlHandlingStrategy.extract(x.currentUrlTree),rawUrl:x.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:Ur,restoredState:null,currentSnapshot:x.routerState.snapshot,targetSnapshot:null,currentRouterState:x.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(tr(T=>0!==T.id),(0,Ut.U)(T=>({...T,extractedUrl:x.urlHandlingStrategy.extract(T.rawUrl)})),en(T=>{let M=!1,L=!1;return c(T).pipe(Vn(O=>{this.currentNavigation={id:O.id,initialUrl:O.rawUrl,extractedUrl:O.extractedUrl,trigger:O.source,extras:O.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null}}),en(O=>{const Z=x.browserUrlTree.toString(),Y=!x.navigated||O.extractedUrl.toString()!==Z||Z!==x.currentUrlTree.toString();if(!Y&&"reload"!==(O.extras.onSameUrlNavigation??x.onSameUrlNavigation)){const se="";return this.events.next(new Xn(O.id,x.serializeUrl(T.rawUrl),se,0)),x.rawUrlTree=O.rawUrl,O.resolve(null),ht.E}if(x.urlHandlingStrategy.shouldProcessUrl(O.rawUrl))return La(O.source)&&(x.browserUrlTree=O.extractedUrl),c(O).pipe(en(se=>{const he=this.transitions?.getValue();return this.events.next(new Ci(se.id,this.urlSerializer.serialize(se.extractedUrl),se.source,se.restoredState)),he!==this.transitions?.getValue()?ht.E:Promise.resolve(se)}),function Qn(y,E,x,T){return en(M=>function rt(y,E,x,T,M){return new Yt(y,E,x,T,M).apply()}(y,E,x,M.extractedUrl,T).pipe((0,Ut.U)(L=>({...M,urlAfterRedirects:L}))))}(this.environmentInjector,this.configLoader,this.urlSerializer,x.config),Vn(se=>{this.currentNavigation={...this.currentNavigation,finalUrl:se.urlAfterRedirects},T.urlAfterRedirects=se.urlAfterRedirects}),function Ma(y,E,x,T,M){return(0,vn.z)(L=>function jr(y,E,x,T,M,L,O="emptyOnly"){return new cr(y,E,x,T,M,O,L).recognize().pipe(en(Z=>null===Z?function In(y){return new bt.y(E=>E.error(y))}(new Zn):c(Z)))}(y,E,x,L.urlAfterRedirects,T.serialize(L.urlAfterRedirects),T,M).pipe((0,Ut.U)(O=>({...L,targetSnapshot:O}))))}(this.environmentInjector,this.rootComponentType,x.config,this.urlSerializer,x.paramsInheritanceStrategy),Vn(se=>{if(T.targetSnapshot=se.targetSnapshot,"eager"===x.urlUpdateStrategy){if(!se.extras.skipLocationChange){const be=x.urlHandlingStrategy.merge(se.urlAfterRedirects,se.rawUrl);x.setBrowserUrl(be,se)}x.browserUrlTree=se.urlAfterRedirects}const he=new Gs(se.id,this.urlSerializer.serialize(se.extractedUrl),this.urlSerializer.serialize(se.urlAfterRedirects),se.targetSnapshot);this.events.next(he)}));if(Y&&x.urlHandlingStrategy.shouldProcessUrl(x.rawUrlTree)){const{id:se,extractedUrl:he,source:be,restoredState:Le,extras:Pe}=O,Te=new Ci(se,this.urlSerializer.serialize(he),be,Le);this.events.next(Te);const et=fc(he,this.rootComponentType).snapshot;return c(T={...O,targetSnapshot:et,urlAfterRedirects:he,extras:{...Pe,skipLocationChange:!1,replaceUrl:!1}})}{const se="";return this.events.next(new Xn(O.id,x.serializeUrl(T.extractedUrl),se,1)),x.rawUrlTree=O.rawUrl,O.resolve(null),ht.E}}),Vn(O=>{const Z=new Hr(O.id,this.urlSerializer.serialize(O.extractedUrl),this.urlSerializer.serialize(O.urlAfterRedirects),O.targetSnapshot);this.events.next(Z)}),(0,Ut.U)(O=>T={...O,guards:kl(O.targetSnapshot,O.currentSnapshot,this.rootContexts)}),function cl(y,E){return(0,vn.z)(x=>{const{targetSnapshot:T,currentSnapshot:M,guards:{canActivateChecks:L,canDeactivateChecks:O}}=x;return 0===O.length&&0===L.length?c({...x,guardsResult:!0}):function ia(y,E,x,T){return(0,Ie.D)(y).pipe((0,vn.z)(M=>function vc(y,E,x,T,M){const L=E&&E.routeConfig?E.routeConfig.canDeactivate:null;return L&&0!==L.length?c(L.map(Z=>{const Y=wn(E)??M,oe=Vi(Z,Y);return Gn(function gc(y){return y&&Xo(y.canDeactivate)}(oe)?oe.canDeactivate(y,E,x,T):Y.runInContext(()=>oe(y,E,x,T))).pipe(ni())})).pipe($i()):c(!0)}(M.component,M.route,x,E,T)),ni(M=>!0!==M,!0))}(O,T,M,y).pipe((0,vn.z)(Z=>Z&&function hi(y){return"boolean"==typeof y}(Z)?function Gi(y,E,x,T){return(0,Ie.D)(E).pipe(si(M=>cn(function _c(y,E){return null!==y&&E&&E(new Li(y)),c(!0)}(M.route.parent,T),function Nc(y,E){return null!==y&&E&&E(new bs(y)),c(!0)}(M.route,T),function bu(y,E,x){const T=E[E.length-1],L=E.slice(0,E.length-1).reverse().map(O=>function Ol(y){const E=y.routeConfig?y.routeConfig.canActivateChild:null;return E&&0!==E.length?{node:y,guards:E}:null}(O)).filter(O=>null!==O).map(O=>Jt(()=>c(O.guards.map(Y=>{const oe=wn(O.node)??x,se=Vi(Y,oe);return Gn(function gi(y){return y&&Xo(y.canActivateChild)}(se)?se.canActivateChild(T,y):oe.runInContext(()=>se(T,y))).pipe(ni())})).pipe($i())));return c(L).pipe($i())}(y,M.path,x),function yc(y,E,x){const T=E.routeConfig?E.routeConfig.canActivate:null;if(!T||0===T.length)return c(!0);const M=T.map(L=>Jt(()=>{const O=wn(E)??x,Z=Vi(L,O);return Gn(function ps(y){return y&&Xo(y.canActivate)}(Z)?Z.canActivate(E,y):O.runInContext(()=>Z(E,y))).pipe(ni())}));return c(M).pipe($i())}(y,M.route,x))),ni(M=>!0!==M,!0))}(T,L,y,E):c(Z)),(0,Ut.U)(Z=>({...x,guardsResult:Z})))})}(this.environmentInjector,O=>this.events.next(O)),Vn(O=>{if(T.guardsResult=O.guardsResult,lo(O.guardsResult))throw Ys(0,O.guardsResult);const Z=new ss(O.id,this.urlSerializer.serialize(O.extractedUrl),this.urlSerializer.serialize(O.urlAfterRedirects),O.targetSnapshot,!!O.guardsResult);this.events.next(Z)}),tr(O=>!!O.guardsResult||(x.restoreHistory(O),this.cancelNavigationTransition(O,"",3),!1)),Pa(O=>{if(O.guards.canActivateChecks.length)return c(O).pipe(Vn(Z=>{const Y=new Hs(Z.id,this.urlSerializer.serialize(Z.extractedUrl),this.urlSerializer.serialize(Z.urlAfterRedirects),Z.targetSnapshot);this.events.next(Y)}),en(Z=>{let Y=!1;return c(Z).pipe(function sa(y,E){return(0,vn.z)(x=>{const{targetSnapshot:T,guards:{canActivateChecks:M}}=x;if(!M.length)return c(x);let L=0;return(0,Ie.D)(M).pipe(si(O=>function Ii(y,E,x,T){const M=y.routeConfig,L=y._resolve;return void 0!==M?.title&&!Eu(M)&&(L[fr]=M.title),function fl(y,E,x,T){const M=function Aa(y){return[...Object.keys(y),...Object.getOwnPropertySymbols(y)]}(y);if(0===M.length)return c({});const L={};return(0,Ie.D)(M).pipe((0,vn.z)(O=>function wc(y,E,x,T){const M=wn(E)??T,L=Vi(y,M);return Gn(L.resolve?L.resolve(E,x):M.runInContext(()=>L(E,x)))}(y[O],E,x,T).pipe(ni(),Vn(Z=>{L[O]=Z}))),Vr(1),function Vs(y){return(0,Ut.U)(()=>y)}(L),Ni(O=>ll(O)?ht.E:it(O)))}(L,y,E,T).pipe((0,Ut.U)(O=>(y._resolvedData=O,y.data=Pl(y,x).resolve,M&&Eu(M)&&(y.data[fr]=M.title),null)))}(O.route,T,y,E)),Vn(()=>L++),Vr(1),(0,vn.z)(O=>L===M.length?c(x):ht.E))})}(x.paramsInheritanceStrategy,this.environmentInjector),Vn({next:()=>Y=!0,complete:()=>{Y||(x.restoreHistory(Z),this.cancelNavigationTransition(Z,"",2))}}))}),Vn(Z=>{const Y=new Ro(Z.id,this.urlSerializer.serialize(Z.extractedUrl),this.urlSerializer.serialize(Z.urlAfterRedirects),Z.targetSnapshot);this.events.next(Y)}))}),Pa(O=>{const Z=Y=>{const oe=[];Y.routeConfig?.loadComponent&&!Y.routeConfig._loadedComponent&&oe.push(this.configLoader.loadComponent(Y.routeConfig).pipe(Vn(se=>{Y.component=se}),(0,Ut.U)(()=>{})));for(const se of Y.children)oe.push(...Z(se));return oe};return ar(Z(O.targetSnapshot.root)).pipe(nr(),jn(1))}),Pa(()=>this.afterPreactivation()),(0,Ut.U)(O=>{const Z=function hs(y,E,x){const T=ds(y,E._root,x?x._root:void 0);return new dc(T,E)}(x.routeReuseStrategy,O.targetSnapshot,O.currentRouterState);return T={...O,targetRouterState:Z}}),Vn(O=>{x.currentUrlTree=O.urlAfterRedirects,x.rawUrlTree=x.urlHandlingStrategy.merge(O.urlAfterRedirects,O.rawUrl),x.routerState=O.targetRouterState,"deferred"===x.urlUpdateStrategy&&(O.extras.skipLocationChange||x.setBrowserUrl(x.rawUrlTree,O),x.browserUrlTree=O.urlAfterRedirects)}),((y,E,x)=>(0,Ut.U)(T=>(new Ll(E,T.targetRouterState,T.currentRouterState,x).activate(y),T)))(this.rootContexts,x.routeReuseStrategy,O=>this.events.next(O)),Vn({next:O=>{M=!0,this.lastSuccessfulNavigation=this.currentNavigation,x.navigated=!0,this.events.next(new Yi(O.id,this.urlSerializer.serialize(O.extractedUrl),this.urlSerializer.serialize(x.currentUrlTree))),x.titleStrategy?.updateTitle(O.targetRouterState.snapshot),O.resolve(!0)},complete:()=>{M=!0}}),vo(()=>{M||L||this.cancelNavigationTransition(T,"",1),this.currentNavigation?.id===T.id&&(this.currentNavigation=null)}),Ni(O=>{if(L=!0,wa(O)){Js(O)||(x.navigated=!0,x.restoreHistory(T,!0));const Z=new Gr(T.id,this.urlSerializer.serialize(T.extractedUrl),O.message,O.cancellationCode);if(this.events.next(Z),Js(O)){const Y=x.urlHandlingStrategy.merge(O.url,x.rawUrlTree),oe={skipLocationChange:T.extras.skipLocationChange,replaceUrl:"eager"===x.urlUpdateStrategy||La(T.source)};x.scheduleNavigation(Y,Ur,null,oe,{resolve:T.resolve,reject:T.reject,promise:T.promise})}else T.resolve(!1)}else{x.restoreHistory(T,!0);const Z=new hc(T.id,this.urlSerializer.serialize(T.extractedUrl),O,T.targetSnapshot??void 0);this.events.next(Z);try{T.resolve(x.errorHandler(O))}catch(Y){T.reject(Y)}}return ht.E}))}))}cancelNavigationTransition(x,T,M){const L=new Gr(x.id,this.urlSerializer.serialize(x.extractedUrl),T,M);this.events.next(L),x.resolve(!1)}}return y.\u0275fac=function(x){return new(x||y)},y.\u0275prov=K.Yz7({token:y,factory:y.\u0275fac,providedIn:"root"}),y})();function La(y){return y!==Ur}let Nl=(()=>{class y{buildTitle(x){let T,M=x.root;for(;void 0!==M;)T=this.getResolvedTitleForRoute(M)??T,M=M.children.find(L=>L.outlet===yn);return T}getResolvedTitleForRoute(x){return x.data[fr]}}return y.\u0275fac=function(x){return new(x||y)},y.\u0275prov=K.Yz7({token:y,factory:function(){return(0,K.f3M)(Ul)},providedIn:"root"}),y})(),Ul=(()=>{class y extends Nl{constructor(x){super(),this.title=x}updateTitle(x){const T=this.buildTitle(x);void 0!==T&&this.title.setTitle(T)}}return y.\u0275fac=function(x){return new(x||y)(K.LFG(ai.Dx))},y.\u0275prov=K.Yz7({token:y,factory:y.\u0275fac,providedIn:"root"}),y})(),Ko=(()=>{class y{}return y.\u0275fac=function(x){return new(x||y)},y.\u0275prov=K.Yz7({token:y,factory:function(){return(0,K.f3M)(Du)},providedIn:"root"}),y})();class jl{shouldDetach(E){return!1}store(E,x){}shouldAttach(E){return!1}retrieve(E){return null}shouldReuseRoute(E,x){return E.routeConfig===x.routeConfig}}let Du=(()=>{class y extends jl{}return y.\u0275fac=function(){let E;return function(T){return(E||(E=K.n5z(y)))(T||y)}}(),y.\u0275prov=K.Yz7({token:y,factory:y.\u0275fac,providedIn:"root"}),y})();const gl=new K.OlP("",{providedIn:"root",factory:()=>({})});let Vl=(()=>{class y{}return y.\u0275fac=function(x){return new(x||y)},y.\u0275prov=K.Yz7({token:y,factory:function(){return(0,K.f3M)(jc)},providedIn:"root"}),y})(),jc=(()=>{class y{shouldProcessUrl(x){return!0}extract(x){return x}merge(x,T){return x}}return y.\u0275fac=function(x){return new(x||y)},y.\u0275prov=K.Yz7({token:y,factory:y.\u0275fac,providedIn:"root"}),y})();function yi(y){throw y}function ka(y,E,x){return E.parse("/")}const $c={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},Tu={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let mo=(()=>{class y{get navigationId(){return this.navigationTransitions.navigationId}get browserPageId(){return this.location.getState()?.\u0275routerPageId}get events(){return this.navigationTransitions.events}constructor(){this.disposed=!1,this.currentPageId=0,this.console=(0,K.f3M)(K.c2e),this.isNgZoneEnabled=!1,this.options=(0,K.f3M)(gl,{optional:!0})||{},this.errorHandler=this.options.errorHandler||yi,this.malformedUriErrorHandler=this.options.malformedUriErrorHandler||ka,this.navigated=!1,this.lastSuccessfulId=-1,this.urlHandlingStrategy=(0,K.f3M)(Vl),this.routeReuseStrategy=(0,K.f3M)(Ko),this.urlCreationStrategy=(0,K.f3M)(ls),this.titleStrategy=(0,K.f3M)(Nl),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.config=li((0,K.f3M)(la,{optional:!0})??[]),this.navigationTransitions=(0,K.f3M)(ml),this.urlSerializer=(0,K.f3M)(Ce),this.location=(0,K.f3M)(Un.Ye),this.isNgZoneEnabled=(0,K.f3M)(K.R0b)instanceof K.R0b&&K.R0b.isInAngularZone(),this.resetConfig(this.config),this.currentUrlTree=new H,this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.routerState=fc(this.currentUrlTree,null),this.navigationTransitions.setupNavigations(this).subscribe(x=>{this.lastSuccessfulId=x.id,this.currentPageId=x.targetPageId},x=>{this.console.warn(`Unhandled Navigation Error: ${x}`)})}resetRootComponentType(x){this.routerState.root.component=x,this.navigationTransitions.rootComponentType=x}initialNavigation(){if(this.setUpLocationChangeListener(),!this.navigationTransitions.hasRequestedNavigation){const x=this.location.getState();this.navigateToSyncWithBrowser(this.location.path(!0),Ur,x)}}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(x=>{const T="popstate"===x.type?"popstate":"hashchange";"popstate"===T&&setTimeout(()=>{this.navigateToSyncWithBrowser(x.url,T,x.state)},0)}))}navigateToSyncWithBrowser(x,T,M){const L={replaceUrl:!0},O=M?.navigationId?M:null;if(M){const Y={...M};delete Y.navigationId,delete Y.\u0275routerPageId,0!==Object.keys(Y).length&&(L.state=Y)}const Z=this.parseUrl(x);this.scheduleNavigation(Z,T,O,L)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}resetConfig(x){this.config=x.map(fo),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(x,T={}){const{relativeTo:M,queryParams:L,fragment:O,queryParamsHandling:Z,preserveFragment:Y}=T,oe=Y?this.currentUrlTree.fragment:O;let se=null;switch(Z){case"merge":se={...this.currentUrlTree.queryParams,...L};break;case"preserve":se=this.currentUrlTree.queryParams;break;default:se=L||null}return null!==se&&(se=this.removeEmptyProps(se)),this.urlCreationStrategy.createUrlTree(M,this.routerState,this.currentUrlTree,x,se,oe??null)}navigateByUrl(x,T={skipLocationChange:!1}){const M=lo(x)?x:this.parseUrl(x),L=this.urlHandlingStrategy.merge(M,this.rawUrlTree);return this.scheduleNavigation(L,Ur,null,T)}navigate(x,T={skipLocationChange:!1}){return function go(y){for(let E=0;E<y.length;E++){if(null==y[E])throw new K.vHH(4008,!1)}}(x),this.navigateByUrl(this.createUrlTree(x,T),T)}serializeUrl(x){return this.urlSerializer.serialize(x)}parseUrl(x){let T;try{T=this.urlSerializer.parse(x)}catch(M){T=this.malformedUriErrorHandler(M,this.urlSerializer,x)}return T}isActive(x,T){let M;if(M=!0===T?{...$c}:!1===T?{...Tu}:T,lo(x))return bo(this.currentUrlTree,x,M);const L=this.parseUrl(x);return bo(this.currentUrlTree,L,M)}removeEmptyProps(x){return Object.keys(x).reduce((T,M)=>{const L=x[M];return null!=L&&(T[M]=L),T},{})}scheduleNavigation(x,T,M,L,O){if(this.disposed)return Promise.resolve(!1);let Z,Y,oe,se;return O?(Z=O.resolve,Y=O.reject,oe=O.promise):oe=new Promise((he,be)=>{Z=he,Y=be}),se="computed"===this.canceledNavigationResolution?M&&M.\u0275routerPageId?M.\u0275routerPageId:L.replaceUrl||L.skipLocationChange?this.browserPageId??0:(this.browserPageId??0)+1:0,this.navigationTransitions.handleNavigationRequest({targetPageId:se,source:T,restoredState:M,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:x,extras:L,resolve:Z,reject:Y,promise:oe,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),oe.catch(he=>Promise.reject(he))}setBrowserUrl(x,T){const M=this.urlSerializer.serialize(x),L={...T.extras.state,...this.generateNgRouterState(T.id,T.targetPageId)};this.location.isCurrentPathEqualTo(M)||T.extras.replaceUrl?this.location.replaceState(M,"",L):this.location.go(M,"",L)}restoreHistory(x,T=!1){if("computed"===this.canceledNavigationResolution){const M=this.currentPageId-x.targetPageId;"popstate"!==x.source&&"eager"!==this.urlUpdateStrategy&&this.currentUrlTree!==this.getCurrentNavigation()?.finalUrl||0===M?this.currentUrlTree===this.getCurrentNavigation()?.finalUrl&&0===M&&(this.resetState(x),this.browserUrlTree=x.currentUrlTree,this.resetUrlToCurrentUrlTree()):this.location.historyGo(M)}else"replace"===this.canceledNavigationResolution&&(T&&this.resetState(x),this.resetUrlToCurrentUrlTree())}resetState(x){this.routerState=x.currentRouterState,this.currentUrlTree=x.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,x.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(x,T){return"computed"===this.canceledNavigationResolution?{navigationId:x,\u0275routerPageId:T}:{navigationId:x}}}return y.\u0275fac=function(x){return new(x||y)},y.\u0275prov=K.Yz7({token:y,factory:y.\u0275fac,providedIn:"root"}),y})(),$l=(()=>{class y{constructor(x,T,M,L,O,Z){this.router=x,this.route=T,this.tabIndexAttribute=M,this.renderer=L,this.el=O,this.locationStrategy=Z,this._preserveFragment=!1,this._skipLocationChange=!1,this._replaceUrl=!1,this.href=null,this.commands=null,this.onChanges=new Ee.x;const Y=O.nativeElement.tagName;this.isAnchorElement="A"===Y||"AREA"===Y,this.isAnchorElement?this.subscription=x.events.subscribe(oe=>{oe instanceof Yi&&this.updateHref()}):this.setTabIndexIfNotOnNativeEl("0")}set preserveFragment(x){this._preserveFragment=(0,K.D6c)(x)}get preserveFragment(){return this._preserveFragment}set skipLocationChange(x){this._skipLocationChange=(0,K.D6c)(x)}get skipLocationChange(){return this._skipLocationChange}set replaceUrl(x){this._replaceUrl=(0,K.D6c)(x)}get replaceUrl(){return this._replaceUrl}setTabIndexIfNotOnNativeEl(x){null!=this.tabIndexAttribute||this.isAnchorElement||this.applyAttributeValue("tabindex",x)}ngOnChanges(x){this.isAnchorElement&&this.updateHref(),this.onChanges.next(this)}set routerLink(x){null!=x?(this.commands=Array.isArray(x)?x:[x],this.setTabIndexIfNotOnNativeEl("0")):(this.commands=null,this.setTabIndexIfNotOnNativeEl(null))}onClick(x,T,M,L,O){return!!(null===this.urlTree||this.isAnchorElement&&(0!==x||T||M||L||O||"string"==typeof this.target&&"_self"!=this.target))||(this.router.navigateByUrl(this.urlTree,{skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state}),!this.isAnchorElement)}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){this.href=null!==this.urlTree&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(this.urlTree)):null;const x=null===this.href?null:(0,K.P3R)(this.href,this.el.nativeElement.tagName.toLowerCase(),"href");this.applyAttributeValue("href",x)}applyAttributeValue(x,T){const M=this.renderer,L=this.el.nativeElement;null!==T?M.setAttribute(L,x,T):M.removeAttribute(L,x)}get urlTree(){return null===this.commands?null:this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}}return y.\u0275fac=function(x){return new(x||y)(K.Y36(mo),K.Y36(ba),K.$8M("tabindex"),K.Y36(K.Qsj),K.Y36(K.SBq),K.Y36(Un.S$))},y.\u0275dir=K.lG2({type:y,selectors:[["","routerLink",""]],hostVars:1,hostBindings:function(x,T){1&x&&K.NdJ("click",function(L){return T.onClick(L.button,L.ctrlKey,L.shiftKey,L.altKey,L.metaKey)}),2&x&&K.uIk("target",T.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",relativeTo:"relativeTo",preserveFragment:"preserveFragment",skipLocationChange:"skipLocationChange",replaceUrl:"replaceUrl",routerLink:"routerLink"},standalone:!0,features:[K.TTD]}),y})(),ca=(()=>{class y{get isActive(){return this._isActive}constructor(x,T,M,L,O){this.router=x,this.element=T,this.renderer=M,this.cdr=L,this.link=O,this.classes=[],this._isActive=!1,this.routerLinkActiveOptions={exact:!1},this.isActiveChange=new K.vpe,this.routerEventsSubscription=x.events.subscribe(Z=>{Z instanceof Yi&&this.update()})}ngAfterContentInit(){c(this.links.changes,c(null)).pipe((0,wt.J)()).subscribe(x=>{this.update(),this.subscribeToEachLinkOnChanges()})}subscribeToEachLinkOnChanges(){this.linkInputChangesSubscription?.unsubscribe();const x=[...this.links.toArray(),this.link].filter(T=>!!T).map(T=>T.onChanges);this.linkInputChangesSubscription=(0,Ie.D)(x).pipe((0,wt.J)()).subscribe(T=>{this._isActive!==this.isLinkActive(this.router)(T)&&this.update()})}set routerLinkActive(x){const T=Array.isArray(x)?x:x.split(" ");this.classes=T.filter(M=>!!M)}ngOnChanges(x){this.update()}ngOnDestroy(){this.routerEventsSubscription.unsubscribe(),this.linkInputChangesSubscription?.unsubscribe()}update(){!this.links||!this.router.navigated||Promise.resolve().then(()=>{const x=this.hasActiveLinks();this._isActive!==x&&(this._isActive=x,this.cdr.markForCheck(),this.classes.forEach(T=>{x?this.renderer.addClass(this.element.nativeElement,T):this.renderer.removeClass(this.element.nativeElement,T)}),x&&void 0!==this.ariaCurrentWhenActive?this.renderer.setAttribute(this.element.nativeElement,"aria-current",this.ariaCurrentWhenActive.toString()):this.renderer.removeAttribute(this.element.nativeElement,"aria-current"),this.isActiveChange.emit(x))})}isLinkActive(x){const T=function Oo(y){return!!y.paths}(this.routerLinkActiveOptions)?this.routerLinkActiveOptions:this.routerLinkActiveOptions.exact||!1;return M=>!!M.urlTree&&x.isActive(M.urlTree,T)}hasActiveLinks(){const x=this.isLinkActive(this.router);return this.link&&x(this.link)||this.links.some(x)}}return y.\u0275fac=function(x){return new(x||y)(K.Y36(mo),K.Y36(K.SBq),K.Y36(K.Qsj),K.Y36(K.sBO),K.Y36($l,8))},y.\u0275dir=K.lG2({type:y,selectors:[["","routerLinkActive",""]],contentQueries:function(x,T,M){if(1&x&&K.Suo(M,$l,5),2&x){let L;K.iGM(L=K.CRH())&&(T.links=L)}},inputs:{routerLinkActiveOptions:"routerLinkActiveOptions",ariaCurrentWhenActive:"ariaCurrentWhenActive",routerLinkActive:"routerLinkActive"},outputs:{isActiveChange:"isActiveChange"},exportAs:["routerLinkActive"],standalone:!0,features:[K.TTD]}),y})();class Gl{}let Oa=(()=>{class y{constructor(x,T,M,L,O){this.router=x,this.injector=M,this.preloadingStrategy=L,this.loader=O}setUpPreloading(){this.subscription=this.router.events.pipe(tr(x=>x instanceof Yi),si(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(x,T){const M=[];for(const L of T){L.providers&&!L._injector&&(L._injector=(0,K.MMx)(L.providers,x,`Route: ${L.path}`));const O=L._injector??x,Z=L._loadedInjector??O;L.loadChildren&&!L._loadedRoutes&&void 0===L.canLoad||L.loadComponent&&!L._loadedComponent?M.push(this.preloadConfig(O,L)):(L.children||L._loadedRoutes)&&M.push(this.processRoutes(Z,L.children??L._loadedRoutes))}return(0,Ie.D)(M).pipe((0,wt.J)())}preloadConfig(x,T){return this.preloadingStrategy.preload(T,()=>{let M;M=T.loadChildren&&void 0===T.canLoad?this.loader.loadChildren(x,T):c(null);const L=M.pipe((0,vn.z)(O=>null===O?c(void 0):(T._loadedRoutes=O.routes,T._loadedInjector=O.injector,this.processRoutes(O.injector??x,O.routes))));if(T.loadComponent&&!T._loadedComponent){const O=this.loader.loadComponent(T);return(0,Ie.D)([L,O]).pipe((0,wt.J)())}return L})}}return y.\u0275fac=function(x){return new(x||y)(K.LFG(mo),K.LFG(K.Sil),K.LFG(K.lqb),K.LFG(Gl),K.LFG(zl))},y.\u0275prov=K.Yz7({token:y,factory:y.\u0275fac,providedIn:"root"}),y})();const Ki=new K.OlP("");let Jo=(()=>{class y{constructor(x,T,M,L,O={}){this.urlSerializer=x,this.transitions=T,this.viewportScroller=M,this.zone=L,this.options=O,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},O.scrollPositionRestoration=O.scrollPositionRestoration||"disabled",O.anchorScrolling=O.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(x=>{x instanceof Ci?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=x.navigationTrigger,this.restoredId=x.restoredState?x.restoredState.navigationId:0):x instanceof Yi&&(this.lastId=x.id,this.scheduleScrollEvent(x,this.urlSerializer.parse(x.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(x=>{x instanceof Zs&&(x.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(x.position):x.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(x.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(x,T){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new Zs(x,"popstate"===this.lastSource?this.store[this.restoredId]:null,T))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}}return y.\u0275fac=function(x){K.$Z()},y.\u0275prov=K.Yz7({token:y,factory:y.\u0275fac}),y})();function ua(y,E){return{\u0275kind:y,\u0275providers:E}}function Dc(){const y=(0,K.f3M)(K.zs3);return E=>{const x=y.get(K.z2F);if(E!==x.components[0])return;const T=y.get(mo),M=y.get(Cu);1===y.get(Tc)&&T.initialNavigation(),y.get(Su,null,K.XFs.Optional)?.setUpPreloading(),y.get(Ki,null,K.XFs.Optional)?.init(),T.resetRootComponentType(x.componentTypes[0]),M.closed||(M.next(),M.unsubscribe())}}const Cu=new K.OlP("",{factory:()=>new Ee.x}),Tc=new K.OlP("",{providedIn:"root",factory:()=>1});const Su=new K.OlP("");function _h(y){return ua(0,[{provide:Su,useExisting:Oa},{provide:Gl,useExisting:y}])}const Oi=new K.OlP("ROUTER_FORROOT_GUARD"),h=[Un.Ye,{provide:Ce,useClass:re},mo,Lo,{provide:ba,useFactory:function As(y){return y.routerState.root},deps:[mo]},zl,[]];function r(){return new K.PXZ("Router",mo)}let l=(()=>{class y{constructor(x){}static forRoot(x,T){return{ngModule:y,providers:[h,[],{provide:la,multi:!0,useValue:x},{provide:Oi,useFactory:S,deps:[[mo,new K.FiY,new K.tp0]]},{provide:gl,useValue:T||{}},T?.useHash?{provide:Un.S$,useClass:Un.Do}:{provide:Un.S$,useClass:Un.b0},{provide:Ki,useFactory:()=>{const y=(0,K.f3M)(Un.EM),E=(0,K.f3M)(K.R0b),x=(0,K.f3M)(gl),T=(0,K.f3M)(ml),M=(0,K.f3M)(Ce);return x.scrollOffset&&y.setOffset(x.scrollOffset),new Jo(M,T,y,E,x)}},T?.preloadingStrategy?_h(T.preloadingStrategy).\u0275providers:[],{provide:K.PXZ,multi:!0,useFactory:r},T?.initialNavigation?A(T):[],[{provide:R,useFactory:Dc},{provide:K.tb,multi:!0,useExisting:R}]]}}static forChild(x){return{ngModule:y,providers:[{provide:la,multi:!0,useValue:x}]}}}return y.\u0275fac=function(x){return new(x||y)(K.LFG(Oi,8))},y.\u0275mod=K.oAB({type:y}),y.\u0275inj=K.cJS({imports:[Qs]}),y})();function S(y){return"guarded"}function A(y){return["disabled"===y.initialNavigation?ua(3,[{provide:K.ip1,multi:!0,useFactory:()=>{const E=(0,K.f3M)(mo);return()=>{E.setUpLocationChangeListener()}}},{provide:Tc,useValue:2}]).\u0275providers:[],"enabledBlocking"===y.initialNavigation?ua(2,[{provide:Tc,useValue:0},{provide:K.ip1,multi:!0,deps:[K.zs3],useFactory:E=>{const x=E.get(Un.V_,Promise.resolve());return()=>x.then(()=>new Promise(M=>{const L=E.get(mo),O=E.get(Cu);(function T(M){E.get(mo).events.pipe(tr(O=>O instanceof Yi||O instanceof Gr||O instanceof hc),(0,Ut.U)(O=>O instanceof Yi||O instanceof Gr&&(0===O.code||1===O.code)&&null),tr(O=>null!==O),jn(1)).subscribe(()=>{M()})})(()=>{M(!0)}),E.get(ml).afterPreactivation=()=>(M(!0),O.closed?c(void 0):O),L.initialNavigation()}))}}]).\u0275providers:[]]}const R=new K.OlP("")}},er=>{er(er.s=278)}]);